window.__require=function t(i,e,n){function s(a,l){if(!e[a]){if(!i[a]){var h=a.split("/");if(h=h[h.length-1],!i[h]){var c="function"==typeof __require&&__require;if(!l&&c)return c(h,!0);if(o)return o(h,!0);throw new Error("Cannot find module '"+a+"'")}a=h}var r=e[a]={exports:{}};i[a][0].call(r.exports,function(t){return s(i[a][1][t]||t)},r,r.exports,t,i,e,n)}return e[a].exports}for(var o="function"==typeof __require&&__require,a=0;a<n.length;a++)s(n[a]);return s}({JuicyGardenConstants:[function(t,i,e){"use strict";cc._RF.push(i,"ab3f54O2/JCV4KVCno6K7PG","JuicyGardenConstants"),Object.defineProperty(e,"__esModule",{value:!0}),e.WinJackpot=e.BigWin=e.SixiangGame=e.Symbol=e.SPEED_AUTO=e.SPEED_NORMAL=e.RECT_SIZE=e.ZINDEX_LINE=e.ZINDEX_ITEMANIM=void 0,e.ZINDEX_ITEMANIM=30,e.ZINDEX_LINE=10,e.RECT_SIZE=cc.v2(150,150),e.SPEED_NORMAL=.15,e.SPEED_AUTO=.1,e.Symbol={8:0,4:1,2:2,16:3,4355:4,4356:5,4354:6,4353:7,4357:8,4359:9,4358:10,65535:11,512:12,4360:12,4361:12,4368:12,4369:13,4371:14,4372:15,4373:16,4384:13,4385:13,4386:13,4387:13,4388:13,4389:13,4390:13,SI_XIANG_SYMBOL_JUICE_FUIT_SELECT_FREE_GAME:4391,SI_XIANG_SYMBOL_JUICE_FUIT_SELECT_FRUIT_RAIN:4392},e.SixiangGame={SI_XIANG_GAME_NORMAL:1,SI_XIANG_GAME_JUICE_NORMAL:200,SI_XIANG_GAME_JUICE_FRUIT_BASKET:201,SI_XIANG_GAME_JUICE_FRUIT_RAIN:202,SI_XIANG_GAME_JUICE_FREE_GAME:203},e.BigWin={0:0,5:0,10:2,25:1,50:3},e.WinJackpot={0:"NONE",10:"JP_MINOR",20:"JP_MAJOR",30:"NONE",150:"JP_GRAND",1:"JP_MINI"},cc._RF.pop()},{}],JuicyGardenController:[function(t,i,e){"use strict";cc._RF.push(i,"0d60debmGFFxo4R1co1eLpn","JuicyGardenController");var n,s=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,i,e,n);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(a=(o<3?s(a):o>3?s(i,e,a):s(i,e))||a);return o>3&&a&&Object.defineProperty(i,e,a),a};Object.defineProperty(e,"__esModule",{value:!0});const o=t("../../lobby/src/language/LanguageController"),a=t("../../lobby/src/common/Utils"),l=t("../../lobby/src/common/Constants"),h=t("../../lobby/src/dialogs/banner/BannerDialog"),c=t("../../lobby/src/common/User"),r=t("../../lobby/src/common/GlobalApp"),u=t("../../lobby/src/dialogs/shop/ShopDialog"),p=t("../../lobby/src/dialogs/option/OptionDialog"),m=t("../../lobby/src/chat/ChatPresenter"),d=t("./JuicyGardenRuleDialog"),S=t("./JuicyGardenNetworkTransport"),g=t("./JuicyGardenPresenter"),f=t("./JuicyGardenItemAnimation"),_=t("./JuicyGardenItem"),I=t("./JuicyGardenConstants"),{ccclass:b,property:A}=cc._decorator;let C=n=class extends cc.Component{constructor(){super(...arguments),this.itemAnim=null,this.itemSlot=null,this.sprItems=[],this.blackMask=null,this.parentItemNode=null,this.parentItemNodeBonus=null,this.itemMiniResult=null,this.listItemMiniResult=[],this.bkg_mid=null,this.bkg_Top=null,this.bkg_Bottom=null,this.btn_Spin=null,this.bkg_Black_Bonus=null,this.lb_markBet=null,this.lb_ChipWinRound=null,this.lb_Chip=null,this.lb_Result=null,this.lb_info=null,this.lb_titleWin=null,this.txt_win=[],this.lb_freeSpinLeft=null,this.lb_TypeMark=null,this.lb_numLine1=null,this.lb_numLine2=null,this.lb_JPGrand=null,this.lb_JPMinor=null,this.lb_JPMajor=null,this.lb_JPMini=null,this.lb_JP_Ainm=null,this.anim_chip_win=null,this.anim_choose_game=null,this.anim_win_jackpot=null,this.anim_effect_bonus=null,this.freeSpin_Screen=null,this.freeFruitRain_Screen=null,this.popup_FruitRain=null,this.popup_Endgame=null,this.fontAnims=[],this.scatterAmin=null,this.itemWildAnim=null,this.bigWinAmin=null,this.freeSpinVienAmin=null,this.freeNumAmin=null,this.itemsAmin=[],this.effectResultAmin=null,this.listItem=[],this.count=0,this.clickSpinCount=0,this.listLineRect=[],this.listPosRect=[],this.listcolumn=[],this.listOriginItem=[],this.listCheckStopCol=[!1,!1,!1,!1,!1],this.listColor=["#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE","#920E48","#F277E2","#BC8B15","#AC6456","#E17512","#E8C500","#F0E915","#FD93A1","#C735D4","#FF0C04","#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE","#920E48","#F277E2","#BC8B15","#AC6456","#E17512","#E8C500","#F0E915","#FD93A1","#C735D4","#FF0C04","#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE"],this.winningLine=[],this.listWinLineNode=[],this.listItemAnim=[],this.listDataAnimLine=[],this.listSpriteId=[],this.listPosItem=[cc.v2(75,217),cc.v2(238,217),cc.v2(398,217),cc.v2(556,217),cc.v2(713,217)],this.listAnimWS=[],this.listAnimBkgFree=[],this.skeData=[],this.listIndexSpr=[],this.listCheckResultBonus=[],this.listCheckResultValueBonus=[],this.pointResultBonus=0,this.speedSpin=I.SPEED_NORMAL,this.agPlayer=0,this.markIndex=0,this.winType=0,this.firstDelay=2,this.scatterCount=0,this.totalWin=0,this.startNum=0,this.endNum=0,this.deltaNum=0,this.timeShow=0,this.curNum=0,this.curJackPotNum=0,this.jackPotEndNum=0,this.timeHoldSpin=0,this.totalAgFSP=0,this.spinCountCheck=0,this.timeRunSpin=0,this.curChip=0,this.freeSpinLeft=0,this.curMarkBet=0,this.countFruitCoin=0,this.wildAdded=0,this.countWild=0,this.idMini=-1,this.timeShowBigMega=0,this.initHeightItem=0,this.resetPosY1=0,this.resetPosY2=0,this.resetPosY3=0,this.posAnimSpeedX=0,this.playerVip=0,this.listMarkBet=[],this.payLine=[],this.listScatter=[],this.jpGrandPlayer=0,this.jpMajorPlayer=0,this.rateJPGrand=0,this.rateJPMajor=0,this.rateJPMinor=0,this.rateJPMini=0,this.valueJPGrandCurrent=0,this.valueJPMajorCurrent=0,this.valueJPMinorCurrent=0,this.valueJPMiniCurrent=0,this.numPerSec=0,this.initPosItem=null,this.isClickSpin=!1,this.isHoldSpin=!1,this.isRunJPNum=!1,this.isRunEffPlusMoney=!1,this.isCheckScatterItem3=!1,this.isAutoSpin=!1,this.isHave2Scatter=!1,this.isStop=!0,this.isShowBigWin=!1,this.isShowHugeWin=!1,this.isCountFSPAg=!1,this.canSpin=!1,this.canSpinSixCoin=!1,this.isShowJackpot=!1,this.isShowEndBonus=!1,this.isShowPopupFruitRain=!1,this.isAllowClick=!0,this.allowSelectBonus=!1,this.isBonusGame=!1,this.isFreeGame=!1,this.clickRight=!1,this.clickLeft=!1,this.viewBonusGame=!1,this.isSpin=!1,this.isFreeSpin=!1,this.isSpinFree=!1,this.isCountAgFreeSpin=!1,this.isWildWinInLine=!1,this.mock=!1,this.isStarted=!1,this.firstAnim=null,this.lb_Money=null,this.animBtnSpin=null,this.blackMaskBig=null,this.animPool=null,this.jackPot=null,this.selectBonus=null,this.selectBonusGame=null,this.finishData=null,this.finishView=[],this.lbFreeAnim=null}static getInstance(){return this.instance}update(t){this.isHoldSpin&&(this.timeHoldSpin+=t,this.timeHoldSpin>=1&&this.isStop&&(this.onClickAutoSpin(),this.setStateSpinBtn(),this.isHoldSpin=!1,this.timeHoldSpin=0))}start(){n.instance=this,S.default.subscribe(),this.setMatchInfo(),this.btn_Spin.node.on("touchstart",t=>{this.btn_Spin.node.getBoundingBoxToWorld().contains(t.getLocation())&&(this.timeHoldSpin=0,this.isHoldSpin=!0)}),this.btn_Spin.node.on("touchend",t=>{this.isHoldSpin&&(this.btn_Spin.node.getBoundingBoxToWorld().contains(t.getLocation())&&(this.isHoldSpin=!1,console.log("time hold spin="+this.timeHoldSpin),this.timeHoldSpin<1&&this.onClickSpin()),this.timeHoldSpin=0)}),this.anim_choose_game.node.parent.zIndex=999,this.anim_chip_win.node.zIndex=I.ZINDEX_ITEMANIM+2,this.anim_chip_win.node.setScale(cc.winSize.width/1280,cc.winSize.height/720),this.isStarted=!1}onEnable(){this.listOriginItem=this.listOriginItem||[],this.listCheckStopCol=this.listCheckStopCol||[!1,!1,!1,!1,!1],this.listColor=this.listColor||["#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE","#920E48","#F277E2","#BC8B15","#AC6456","#E17512","#E8C500","#F0E915","#FD93A1","#C735D4","#FF0C04","#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE","#920E48","#F277E2","#BC8B15","#AC6456","#E17512","#E8C500","#F0E915","#FD93A1","#C735D4","#FF0C04","#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE"],this.winningLine=this.winningLine||[],this.listWinLineNode=this.listWinLineNode||[],this.listItemAnim=this.listItemAnim||[],this.listDataAnimLine=this.listDataAnimLine||[],this.listSpriteId=this.listSpriteId||[],this.listAnimWS=this.listAnimWS||[],this.listAnimBkgFree=this.listAnimBkgFree||[],this.skeData=this.skeData||[],this.listIndexSpr=this.listIndexSpr||[],this.listCheckResultBonus=this.listCheckResultBonus||[],this.listCheckResultValueBonus=this.listCheckResultValueBonus||[],this.pointResultBonus=this.pointResultBonus||0,this.speedSpin=this.speedSpin||I.SPEED_NORMAL,this.agPlayer=this.agPlayer||0,this.markIndex=this.markIndex||0,this.winType=this.winType||0,this.firstDelay=this.firstDelay||2,this.scatterCount=this.scatterCount||0,this.bkg_mid.opacity=this.bkg_mid.opacity||0,this.totalWin=this.totalWin||0,this.startNum=this.startNum||0,this.endNum=this.endNum||0,this.deltaNum=this.deltaNum||0,this.timeShow=this.timeShow||0,this.curNum=this.curNum||0,this.curJackPotNum=this.curJackPotNum||0,this.jackPotEndNum=this.jackPotEndNum||0,this.timeHoldSpin=this.timeHoldSpin||0,this.totalAgFSP=this.totalAgFSP||0,this.spinCountCheck=this.spinCountCheck||0,this.timeRunSpin=this.timeRunSpin||0,this.curChip=this.curChip||0,this.initPosItem=cc.v2(this.parentItemNode.width/10,this.parentItemNode.height/2-8),this.isClickSpin=this.isClickSpin||!1,this.isHoldSpin=this.isHoldSpin||!1,this.isRunJPNum=this.isRunJPNum||!1,this.isRunEffPlusMoney=this.isRunEffPlusMoney||!1,this.isCheckScatterItem3=this.isCheckScatterItem3||!1,this.isAutoSpin=this.isAutoSpin||!1,this.isHave2Scatter=this.isHave2Scatter||!1,this.isStop=this.isStop||!0,this.isShowBigWin=this.isShowBigWin||!1,this.isShowHugeWin=this.isShowHugeWin||!1,this.isCountFSPAg=this.isCountFSPAg||!1,this.canSpin=this.canSpin||!1,this.canSpinSixCoin=this.canSpinSixCoin||!1,this.isShowJackpot=this.isShowJackpot||!1,this.isShowEndBonus=this.isShowEndBonus||!1,this.isShowPopupFruitRain=this.isShowPopupFruitRain||!1,this.countFruitCoin=this.countFruitCoin||0,this.wildAdded=this.wildAdded||0,this.isAllowClick=this.isAllowClick||!0,this.firstAnim=this.firstAnim||null,this.lb_Money=this.lb_Money||null,this.animBtnSpin=this.animBtnSpin||this.btn_Spin.node.getChildByName("ItemAnimation").getComponent(f.default),this.blackMaskBig=this.blackMaskBig||this.node.getChildByName("bkg_black"),this.animPool=this.animPool||new cc.NodePool("animPool"),this.jackPot=this.jackPot||null,this.allowSelectBonus=this.allowSelectBonus||!1,this.selectBonus=this.selectBonus||null,this.isBonusGame=this.isBonusGame||!1,this.isFreeGame=this.isFreeGame||!1,this.selectBonusGame=this.selectBonusGame||null,this.clickRight=this.clickRight||!1,this.clickLeft=this.clickLeft||!1,this.viewBonusGame=this.viewBonusGame||!1,this.isSpin=!1,this.setChipAnim(),this.lb_TypeMark.string=o.default.getInstance().getString("txt_bet"),this.lb_titleWin.string=o.default.getInstance().getString("txt_win"),this.initItemSlot([[{id:0,value:0},{id:3,value:0},{id:7,value:285}],[{id:4,value:0},{id:3,value:0},{id:1,value:585}],[{id:0,value:0},{id:2,value:0},{id:0,value:0}],[{id:10,value:0},{id:12,value:125},{id:9,value:0}],[{id:3,value:0},{id:5,value:0},{id:8,value:0}]]),h.default.show(l.Game.Enum.JUICY_GARDEN)}setMatchInfo(){m.default.getInstance().joinChatRoom(r.default.getInstance().matchInfo.match_id,this)}onClickBack(){p.default.show(this,p.DialogPosition.LEFT)}startEffect(){this.bkg_Top.stopAllActions(),this.bkg_Bottom.stopAllActions(),this.bkg_mid.stopAllActions(),this.bkg_Top.runAction(cc.spawn(cc.moveTo(.5,cc.v2(0,(cc.winSize.height-this.bkg_Top.height)/2)),cc.fadeTo(.5,255))),this.bkg_Bottom.runAction(cc.spawn(cc.moveTo(.5,cc.v2(0,-(cc.winSize.height-this.bkg_Bottom.height)/2)),cc.fadeTo(.5,255))),this.bkg_mid.runAction(cc.sequence(cc.fadeTo(.5,255),cc.callFunc(()=>{this.canSpin=!0})))}handleCTable(t){var i,e,n,s,o,l,h,r;if(t.slotViews=[],t.currentSixiangGame!=I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_BASKET)for(let a=0;a<t.matrix.cols;a++){let i=[];for(let e=0;e<t.matrix.lists.length;e++)if(e%t.matrix.cols===a){let n={id:I.Symbol[t.matrix.lists[e]],value:0};if(t.matrix.spinLists&&t.matrix.spinLists.length>0)for(let i=0;i<t.matrix.spinLists.length;i++)t.matrix.spinLists[i].index===e&&(n.value=Number(t.matrix.spinLists[i].winAmount));i.push(n)}t.slotViews.push(i)}if(this.isStarted){let a={typeBonus:0,numSpin:0};return t.currentSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_RAIN&&(this.selectBonus.typeBonus=5),this.selectBonus.numSpin=Number(t.numSpinLeft)>0?Number(t.numSpinLeft):0,void this.handleSpin(Object.assign(Object.assign({},t),{currentChipBonus:Number(t.gameReward.perlGreenForestChipsCollect),freeSpinLeft:Number(t.numSpinLeft)>=0||Number(null===(i=null==t?void 0:t.gameConfig)||void 0===i?void 0:i.numFreeSpin)?Number(t.numSpinLeft)|Number(null===(e=null==t?void 0:t.gameConfig)||void 0===e?void 0:e.numFreeSpin):0,freeSpin:t.currentSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FREE_GAME,isFreeSpin:t.nextSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FREE_GAME,isBonusGame:t.currentSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_RAIN,allowSelectBonus:t.currentSixiangGame!==I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_BASKET&&t.nextSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_BASKET,isFreeGame:t.nextSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FREE_GAME,selectBonus:a,winType:I.BigWin[t.bigWin],agWin:I.BigWin[t.bigWin]>0?t.gameReward.totalChipsWinByGame:0,chipBonusFullExp:t.gameReward.updateChipsBonus?t.gameReward.perlGreenForestChips:0,jpGrandPlayer:Number(null===(s=null===(n=t.winJpHistory)||void 0===n?void 0:n.grand)||void 0===s?void 0:s.chipsAccum),jpMajorPlayer:Number(null===(l=null===(o=t.winJpHistory)||void 0===o?void 0:o.major)||void 0===l?void 0:l.chipsAccum)}))}t.currentChipBonus=Number(t.gameReward.perlGreenForestChipsCollect),t.freeSpinLeft=Number(t.numSpinLeft)>=0||Number(null===(h=null==t?void 0:t.gameConfig)||void 0===h?void 0:h.numFreeSpin)?Number(t.numSpinLeft)|Number(null===(r=null==t?void 0:t.gameConfig)||void 0===r?void 0:r.numFreeSpin):0,t.freeSpin=t.currentSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FREE_GAME,t.isFreeSpin=t.nextSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FREE_GAME,t.isBonusGame=t.currentSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_RAIN,t.allowSelectBonus=t.currentSixiangGame!==I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_BASKET&&t.nextSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_BASKET,t.isFreeGame=t.nextSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FREE_GAME,t.views=[];for(let a=0;a<t.matrix.cols;a++){let i=[];for(let e=0;e<t.matrix.lists.length;e++)if(e%t.matrix.cols===a){let n={id:I.Symbol[t.matrix.lists[e]],value:0};if(t.matrix.spinLists&&t.matrix.spinLists.length>0)for(let i=0;i<t.matrix.spinLists.length;i++)t.matrix.spinLists[i].index===e&&(n.value=Number(t.matrix.spinLists[i].winAmount));i.push(n)}t.views.push(i)}this.finishData=t;for(let a=0;a<t.views.length;a++)for(let i=0;i<t.views[a].length;i++)-1===t.views[a][i].id&&(t.views[a][i].id=this.getRanNum(0,12)),t.isBonusGame||t.isFreeGame||(t.views[a][i].id=this.getRanNum(0,13));this.selectBonus={typeBonus:0,numSpin:0},t.currentSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_RAIN&&(this.selectBonus.typeBonus=5),this.selectBonus.numSpin=Number(t.numSpinLeft)>0?Number(t.numSpinLeft):0,this.isBonusGame=t.isBonusGame,this.isFreeGame=t.isFreeGame,t.allowSelectBonus&&(this.resetForNextSpin(),this.showTwoBasketView()),this.isBonusGame&&this.initParentNodeBonus(t.views),this.isSpin&&this.initItemSlot(t.views),this.isBonusGame?this.viewBonusGame=!0:this.viewBonusGame=!1,this.payLine=[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[0,0,1,2,2],[2,2,1,0,0],[1,0,1,2,1],[1,2,1,0,1],[1,0,0,1,0],[1,2,2,1,2],[0,1,0,0,1],[2,1,2,2,1],[0,2,0,2,0],[2,0,2,0,2],[1,0,2,0,1],[1,2,0,2,1],[0,1,1,1,0],[2,1,1,1,2],[0,2,2,2,0]],this.lb_numLine1.string=this.payLine.length+"",this.lb_numLine2.string=this.payLine.length+"",this.listMarkBet=[],this.isFreeSpin=t.currentSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FREE_GAME,this.freeSpinLeft=Number(t.numSpinLeft)>0?Number(t.numSpinLeft):0,this.freeSpinLeft>0&&0===this.listAnimBkgFree.length&&!t.allowSelectBonus&&this.showAnimBkgFreeSpin(this.freeSpinLeft),this.setStateSpinBtn(),this.lb_ChipWinRound.string=t.gameReward.totalChipsWinByGame,this.agPlayer=Number(t.gameReward.balanceChipsWalletAfter),this.listMarkBet=t.betLevels,this.curMarkBet=Number(t.chipsMcb);for(let a=0;a<t.betLevels.length;a++)if(Number(t.betLevels[a])===Number(t.chipsMcb)){this.markIndex=a;break}this.initJackPot(t),this.lb_markBet.string=a.default.formatNumber(this.curMarkBet),this.lb_Chip.string=a.default.formatMoneyChip(this.agPlayer),this.playerVip=c.default.vipLevel,this.isStarted=!0}initItemSlot(t){let i=0;this.listcolumn=[];for(let e=0;e<this.listItem.length;e++)this.listItem[e].destroy();this.listItem=[];for(let e=0;e<5;e++){let e=cc.instantiate(this.itemSlot).getComponent(_.default),n=cc.instantiate(this.itemSlot).getComponent(_.default),s=cc.instantiate(this.itemSlot).getComponent(_.default);if(this.initHeightItem=e.node.height,e.node.position=cc.v3(this.listPosItem[i].x,this.initPosItem.y,0),this.parentItemNode.addChild(e.node),cc.log("item1.node.position",e.node.position),e.typeItem=1,e.numCol=i,e.setSpriteListItem(t[i]),this.resetPosY1=this.initPosItem.y,3===i){let t=this.parentItemNode.convertToWorldSpaceAR(e.node.position);this.posAnimSpeedX=this.bkg_mid.convertToNodeSpaceAR(t).x}n.node.position=cc.v3(e.node.x,e.node.position.y+e.node.height,0),this.parentItemNode.addChild(n.node),n.typeItem=2,n.numCol=i,n.setSpriteListItem(t[i]),this.resetPosY2=n.node.position.y,s.node.position=cc.v3(e.node.x,n.node.position.y+n.node.height,0),this.parentItemNode.addChild(s.node),s.typeItem=3,s.numCol=i,s.setSpriteListItem(t[i]),this.resetPosY3=s.node.position.y;let o=[];o.push(e.node,n.node,s.node),this.listcolumn.push(o),this.listItem.push(e,n,s),i++}this.startEffect(),this.initItemAnim()}initItemAnim(){for(let t=0;t<5;t++){let t=cc.instantiate(this.itemAnim).getComponent(f.default);this.node.addChild(t.node,I.ZINDEX_ITEMANIM),t.node.active=!1,this.listItemAnim.push(t)}this.firstAnim=cc.instantiate(this.itemAnim).getComponent(f.default),this.node.addChild(this.firstAnim.node,I.ZINDEX_ITEMANIM),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null}onClickSpin(){if(!this.isStarted)return;if(!this.canSpin&&!this.isAutoSpin)return;if(this.canSpinSixCoin)return;if(this.clickSpinCount>1)return;if(!this.isStop&&this.isFreeSpin)return;if((0===this.listMarkBet.length||this.agPlayer<this.listMarkBet[0])&&this.freeSpinLeft<=0)return void r.default.getInstance().alertDialog.showMessage(o.default.getInstance().getString("txt_not_enough_money_gl"));if(!this.isAllowClick)return void this.setStateSpinBtn();if(this.clickSpinCount>0)return this.isAutoSpin=!1,this.setStateSpinBtn(),void(this.isStop&&this.resetForNextSpin());this.isSpinFree=this.isFreeSpin,this.node.stopAllActions(),this.turnOffAnim(),this.playSoundEff("clickspin"),this.isFreeSpin||(this.allowSelectBonus?this.curChip=this.agPlayer:(this.curChip=this.agPlayer,this.lb_Chip.string=a.default.formatMoneyChip(this.curChip-this.curMarkBet),this.agPlayer-=this.curMarkBet,this.curChip=this.agPlayer)),this.freeSpinLeft>0&&!this.allowSelectBonus&&(0===this.listAnimBkgFree.length?this.showAnimBkgFreeSpin(this.freeSpinLeft):this.lbFreeAnim.string=this.freeSpinLeft+" "+o.default.getInstance().getString("txt_freespin")),this.clickSpinCount++,S.default.sendSpin({chips:this.curMarkBet}),this.mock=!1,this.isStop=!1,this.setStateSpinBtn(),this.blackMask.active=!1;for(let e=0;e<this.listCheckStopCol.length;e++)this.listCheckStopCol[e]=!1;this.lb_info.node.active=!0,this.lb_info.string=o.default.getInstance().getString("txt_playing_lines").replace("%d","20");let t=cc.callFunc(()=>{this.playSoundEff("wheelspin"),this.resetParentNodeContentInstead();for(let t=0;t<this.listcolumn.length;t++){let i=this.listcolumn[t];for(let e=0;e<i.length;e++){let n=i[e].getComponent(_.default),s=n.listIdView;for(let t=0;t<s.length;t++)n.node.children[t].children[0].color=cc.Color.WHITE;let o=cc.v2(n.node.position.x,n.node.position.y+60),a=cc.v2(n.node.position.x,n.node.position.y-this.initHeightItem),l=cc.moveTo(.15,o).easing(cc.easeSineOut()),h=cc.moveTo(this.speedSpin,a),c=cc.callFunc(()=>{n.setSpriteListItem(n.listDataView,!1)}),r=cc.sequence(l,cc.spawn(c,h)),u=cc.callFunc(()=>{if(n.typeItem--,this.listCheckStopCol[t]||n.numCol!==t){if(this.listCheckStopCol[t]&&n.numCol===t){let i=0;3===t&&this.isCheckScatterItem3&&(i=0),n.typeItem<0&&(n.node.position=cc.v3(n.node.position.x,this.resetPosY2,0),n.typeItem=2,n.setSpriteListItem(this.finishView[t],!1),this.listOriginItem.push(n.node)),0===n.typeItem&&(n.node.position=cc.v3(n.node.position.x,this.resetPosY3),n.typeItem=3);let e=this.isAutoSpin?.1:.15,s=this.isAutoSpin?30:50,o=cc.v2(n.node.position.x,n.node.position.y-this.initHeightItem-s),a=cc.v2(n.node.position.x,n.node.position.y-this.initHeightItem),l=cc.moveTo(.2,o).easing(cc.easeSineOut()),h=cc.moveTo(e,a).easing(cc.easeSineIn()),c=cc.spawn(h,cc.callFunc(()=>{this.listCheckStopCol[t+1]=!0})),r=cc.sequence(h,cc.delayTime(i),cc.callFunc(()=>{this.listCheckStopCol[t+1]=!0})),u=h;this.isAutoSpin&&this.isCheckScatterItem3?u=r:this.isAutoSpin&&(u=c);let p=cc.callFunc(()=>{n.setSpriteListItem(n.listDataView,!1)});n.node.runAction(cc.sequence(cc.spawn(l,p),cc.spawn(u,cc.callFunc(()=>{this.playSoundEff("stopspin"),this.canSpin=!1})),cc.delayTime(i),cc.callFunc(()=>{if(4===t&&2===n.typeItem){for(let t=0;t<this.winningLine.length;t++)this.initLineWin(this.winningLine[t]);this.getOriginItem(),this.checkWildWinInLine(),this.acShowWinLine()}n.typeItem--,3===t&&this.isCheckScatterItem3&&(this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null),this.isAutoSpin||(this.listCheckStopCol[t+1]=!0)})))}}else{n.typeItem<0&&(n.node.position=cc.v3(n.node.position.x,this.resetPosY2,0),n.typeItem=2,n.setRandomId(!1));let i=this.speedSpin;4===t&&!this.isAutoSpin&&this.isCheckScatterItem3&&(i=I.SPEED_NORMAL);let e=cc.moveTo(i,cc.v2(n.node.position.x,n.node.position.y-this.initHeightItem));n.node.runAction(cc.sequence(e,u))}});n.node.stopAllActions(),n.node.runAction(cc.sequence(r,u))}}}),i=this.acSpinBonus();this.viewBonusGame?this.node.runAction(i):this.node.runAction(t)}acSpinBonus(){return cc.callFunc(()=>{this.playSoundEff("wheelspin");for(let t=0;t<this.listcolumn.length;t++){let i=this.listcolumn[t];for(let e=0;e<i.length;e++){let n=i[e].getComponent(_.default),s=n.listIdView;for(let t=0;t<s.length;t++)n.node.children[t].children[0].color=cc.Color.GRAY;let o=cc.v2(n.node.position.x,n.node.position.y),a=cc.v2(n.node.position.x,n.node.position.y),l=cc.moveTo(.15,o).easing(cc.easeSineOut()),h=cc.moveTo(this.speedSpin,a),c=cc.callFunc(()=>{n.setSpriteListItem(n.listDataView,!0)}),r=cc.sequence(l,cc.spawn(c,h)),u=cc.callFunc(()=>{if(n.typeItem--,this.listCheckStopCol[t]||n.numCol!==t){if(this.listCheckStopCol[t]&&n.numCol===t){let i=0;3===t&&this.isCheckScatterItem3&&(i=0),n.typeItem<0&&(n.node.position=cc.v3(n.node.position.x,this.resetPosY2,0),n.typeItem=2,n.setSpriteListItem(this.finishView[t],!0),this.listOriginItem.push(n.node)),0===n.typeItem&&(n.node.position=cc.v3(n.node.position.x,this.resetPosY3,0),n.typeItem=3);let e=this.isAutoSpin?.1:.15,s=this.isAutoSpin?10:20,o=cc.v2(n.node.position.x,n.node.position.y-this.initHeightItem-s),a=cc.v2(n.node.position.x,n.node.position.y-this.initHeightItem),l=cc.moveTo(.2,o).easing(cc.easeSineOut()),h=cc.moveTo(e,a).easing(cc.easeSineIn()),c=cc.spawn(h,cc.callFunc(()=>{this.listCheckStopCol[t+1]=!0})),r=cc.sequence(h,cc.delayTime(i),cc.callFunc(()=>{this.listCheckStopCol[t+1]=!0})),u=h;this.isAutoSpin&&this.isCheckScatterItem3?u=r:this.isAutoSpin&&(u=c);let p=cc.callFunc(()=>{n.setSpriteListItem(n.listDataView,!0)});n.node.runAction(cc.sequence(cc.spawn(l,p),cc.spawn(u,cc.callFunc(()=>{this.playSoundEff("stopspin"),this.canSpin=!1})),cc.delayTime(i),cc.callFunc(()=>{if(4===t&&2===n.typeItem){for(let t=0;t<this.winningLine.length;t++)this.initLineWin(this.winningLine[t]);this.getOriginItem(),this.checkWildWinInLine(),this.acShowWinLine()}n.typeItem--,3===t&&this.isCheckScatterItem3&&(this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null),this.isAutoSpin||(this.listCheckStopCol[t+1]=!0)})))}}else{n.typeItem<0&&(n.node.position=cc.v3(n.node.position.x,this.resetPosY2,0),n.typeItem=2,n.setRandomId(!0));let i=this.speedSpin;4===t&&!this.isAutoSpin&&this.isCheckScatterItem3&&(i=I.SPEED_NORMAL);let e=cc.moveTo(i,cc.v2(n.node.position.x,n.node.position.y-this.initHeightItem));n.node.runAction(cc.sequence(e,u))}});n.node.stopAllActions(),n.node.runAction(cc.sequence(r,u))}}})}setStateSpinBtn(t=null){let i;switch(this.isStop?i=this.isFreeSpin?"freespinOn":"spinOn":(i=this.isAutoSpin?"autoSpin":"spinOff",i=this.isFreeSpin?"freespinOff":i),null!==t&&(i=t),i){case"spinOn":this.animBtnSpin.playAnimation2("autospin2",!0);break;case"spinOff":this.animBtnSpin.node.active=!0,this.animBtnSpin.playAnimation2("autospin2",!0);break;case"freespinOn":case"freespinOff":this.animBtnSpin.node.active=!0,this.animBtnSpin.playAnimation2("freespin2",!0);break;case"autoSpin":this.animBtnSpin.node.active=!0,this.animBtnSpin.playAnimation2("stop2",!0)}}onClickAutoSpin(){this.isAutoSpin=!this.isAutoSpin,this.setStateSpinBtn(),this.isStop&&(this.speedSpin=I.SPEED_AUTO,this.onClickSpin())}handleSpin(t){if(this.isSpin=!0,this.finishData=t,!this.finishData.isFinishGame&&Number(this.curMarkBet)!==Number(t.chipsMcb))return void this.updateJackpot(t);this.jackPot={typeJP:I.WinJackpot[t.winJp],winJP:""},this.jpGrandPlayer=t.jpGrandPlayer,this.jpMajorPlayer=t.jpMajorPlayer,this.totalWin=Number(t.gameReward.totalChipsWinByGame);let i=0;t.nextSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_RAIN&&(this.listCheckResultBonus=[],this.listCheckResultValueBonus=[]),this.pointResultBonus=0;for(let e=0;e<t.slotViews.length;e++)for(let n=0;n<t.slotViews[e].length;n++)-1===t.slotViews[e][n].id&&(t.slotViews[e][n].id=this.getRanNum(0,12)),12!==t.slotViews[e][n].id||1!==e&&2!==e||i++,t.slotViews[e][n].id>=13&&t.slotViews[e][n].id<17&&this.countFruitCoin++,13===t.slotViews[e][n].id&&Number(t.slotViews[e][n].value)>0&&(this.parentItemNodeBonus.children[e].children[n].children[2].getComponent(cc.Label).string=a.default.formatMoneyChip(t.slotViews[e][n].value)),t.slotViews[e][n].id>12&&0===t.freeSpinLeft&&t.isBonusGame&&(this.listCheckResultBonus.push(e+1+5*n),this.listCheckResultValueBonus.push(t.slotViews[e][n].value)),t.slotViews[e][n].id<13&&(this.parentItemNodeBonus.children[e].children[n].active=!1);if(this.finishView=t.slotViews,this.isBonusGame=t.isBonusGame,this.isFreeGame=t.isFreeSpin,this.allowSelectBonus=t.allowSelectBonus,this.selectBonus=t.selectBonus,this.isCheckScatterItem3=!1,t.nextSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_RAIN?this.viewBonusGame=!0:this.viewBonusGame=!1,2===i&&(this.isCheckScatterItem3=!0),this.getLineWin(t),this.setTimeout(()=>{this.node&&this.onStopSpin()},500),this.updateJackpot(t),this.agPlayer=Number(t.gameReward.balanceChipsWalletAfter),this.winType=t.winType,this.freeSpinLeft=t.freeSpinLeft,this.isFreeSpin=0!==t.freeSpinLeft,this.isCountAgFreeSpin=this.isFreeSpin,this.listMarkBet=[],t.freeSpin&&0!=t.freeSpinLeft)this.listMarkBet=t.betLevels;else{for(let i=0;i<t.betLevels.length;i++)Number(t.betLevels[i])<=Number(this.agPlayer)&&this.listMarkBet.push(t.betLevels[i]);this.agPlayer<t.betLevels[0]&&this.listMarkBet.push(t.betLevels[0]),Number(this.curMarkBet)>Number(this.listMarkBet.slice().pop())&&(this.curMarkBet=Number(this.listMarkBet[this.listMarkBet.length-1]),this.markIndex=this.listMarkBet.length-1)}this.freeSpinLeft<=0&&(this.lb_markBet.string=a.default.formatNumber(this.curMarkBet),this.isSpinFree=!1),(t.freeSpin||this.allowSelectBonus)&&(this.totalAgFSP=Number(t.gameReward.totalChipsWinByGame)),this.isFreeSpin&&!this.finishData.allowSelectBonus&&this.countFruitCoin<6&&(this.lb_ChipWinRound.string=a.default.formatNumber(t.gameReward.totalChipsWinByGame),this.lb_titleWin.string=o.default.getInstance().getString("txt_total_win")),this.finishData.currentSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_BASKET&&this.handleChooseGame(t)}onClickChooseLeft(){this.clickLeft&&(this.clickLeft=!1,this.clickRight=!1,this.anim_choose_game.animation="thungtrai",this.showTypeFreeSpin(0))}onClickChooseRight(){this.clickRight&&(this.clickLeft=!1,this.clickRight=!1,this.anim_choose_game.animation="thungphai",this.showTypeFreeSpin(1))}showAnimScatter(){this.playSoundEff("wildscatter"),this.checkAnimScatterHighLight();for(let t=0;t<this.listScatter.length;t++){let i=this.listScatter[t],e=this.getAnimFromPool(this.listAnimWS);this.setInfoAnim(e,this.scatterAmin,i.pos,1),this.node.addChild(e.node),e.playAnimation2("animation",!0)}}checkAnimScatterHighLight(){if(!(this.listScatter.length>4||0===this.listScatter.length))for(let t=0;t<this.listScatter.length-1;t++){let i=this.listScatter[t];this.listScatter[t+1].pos.x-i.pos.x>200&&(0===t?this.listScatter.splice(t,1):this.listScatter.splice(t+1,1))}}setInfoAnim(t,i,e,n,s=!1){t.node.active=!0,t.node.zIndex=I.ZINDEX_ITEMANIM,t.animation.node.setScale(n),t.node.position=e,t.initAnimation(i),t.node.getChildByName("lb_Money").active=s}showAnimOneWinLine(){if(this.blackMaskBig.active=!1,this.btn_Spin.interactable=!this.isAutoSpin,0===this.listWinLineNode.length||this.isAutoSpin&&this.listWinLineNode.length>1)return this.canSpin=!0,console.log("showAnimOneWinLine",this.canSpin),this.setStateSpinBtn(),null!==this.firstAnim&&(this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.firstAnim.node.getChildByName("lb_Money").active=!1),void(this.agPlayer>=this.listMarkBet[0]||this.finishData.freeSpinLeft>0?this.resetForNextSpin():(this.lb_info.string=o.default.getInstance().getString("not_enought_gold"),r.default.getInstance().alertDialog.showMessage(o.default.getInstance().getString("txt_not_enough_money_gl"))));if(this.isAutoSpin?(this.canSpin=!0,console.log("showAnimOneWinLine",this.canSpin)):this.setTimeout(()=>{this.node&&(this.canSpin=!0,console.log("showAnimOneWinLine",this.canSpin),this.setStateSpinBtn())},300),null!==this.firstAnim&&(this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.firstAnim.node.getChildByName("lb_Money").active=!1),2===this.clickSpinCount)return;let t=this.listWinLineNode.length,i=cc.callFunc(()=>{(this.isAutoSpin||this.finishData.isBonusGame||this.finishData.freeSpin&&this.finishData.freeSpinLeft>0&&!this.finishData.allowSelectBonus)&&this.resetForNextSpin()});for(let e=0;e<t;e++)this.node.runAction(cc.sequence(cc.delayTime(1.5*e),cc.callFunc(()=>{var t,i,n;for(let e=0;e<this.listWinLineNode.length;e++)this.listWinLineNode[e].node.active=!1;this.playSoundEff("showline"),this.turnOffAnim(),this.turnOffMiniResult();for(let e=0;e<this.listIndexSpr.length;e++)null===(i=null===(t=this.listOriginItem[this.listIndexSpr[e].column])||void 0===t?void 0:t.getComponent(_.default))||void 0===i||i.setStateSpr(this.listIndexSpr[e].index,!0);this.listIndexSpr=[];for(let e=0;e<this.listLineRect.length;e++)this.listLineRect[e].active=!1;let s=this.winningLine[e].lineWin;this.listPosRect=[];let o=[],a=[];for(let l=0;l<s.length;l++){let t=null===(n=this.listOriginItem[this.winningLine[e].startCol+l])||void 0===n?void 0:n.getComponent(_.default);if(!t)continue;let i=s[l],h=t.getWordPosItem(t.listItem[i]);a.push(h);let c=t.listIdView[i];o.push(Number(c))}this.idMini=-1,this.showListAnim(a,o,this.winningLine[e])}),cc.delayTime(1.07),i))}showAllWinLine(){if(this.updateMoney(),this.blackMaskBig.active=!1,0===this.listWinLineNode.length||this.finishData.allowSelectBonus||(this.blackMask.active=!0),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.listWinLineNode.length>1&&!this.finishData.allowSelectBonus)for(let t=0;t<this.listWinLineNode.length;t++)this.node.runAction(cc.sequence(cc.delayTime(I.SPEED_NORMAL*t),cc.callFunc(()=>{this.listWinLineNode[t].node.active=!0})));this.turnOffAnim(),this.turnOffMiniResult(),this.isStop=!0}showAnimAllWild(){this.playSoundEff("wildscatter");let t=[];for(let i=0;i<this.winningLine.length;i++){let e={lineWinId:[],lineWin:[]},n=this.winningLine[i].lineWinId;n.includes(11)&&(e.lineWinId=n,e.lineWin=this.winningLine[i].lineWin),t.push(e)}for(let i=0;i<t.length;i++){let e=t[i],n=this.checkIndexToShowAnim(e.lineWinId);for(let t=0;t<=n;t++){let i=this.listOriginItem[t].getComponent(_.default);if(11===e.lineWinId[t]){let n=i.getWordPosItem(i.listItem[e.lineWin[t]]),s=this.getAnimFromPool(this.listAnimWS);this.setInfoAnim(s,this.itemWildAnim,n,1),this.node.addChild(s.node,I.ZINDEX_ITEMANIM),s.playAnimation2("animation",!0)}}}}showAnimBigWin(){this.playSoundEff("bigwin"),this.blackMaskBig.active=!0,this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.setInfoAnim(this.firstAnim,this.bigWinAmin,cc.v2(0,-10),cc.v2(1,1)),this.firstAnim.node.parent=this.node,this.firstAnim.node.zIndex=900,this.firstAnim.playAnimation2("big2",!1);let t=this.firstAnim.node.getChildByName("lb_Money");t.active=!0,t.opacity=255,this.lb_Money=t.getComponent(cc.Label),this.lb_Money.fontSize=15,this.lb_Money.node.position=cc.v3(0,-170,0);let i=Number(this.finishData.gameReward.totalChipsWinByGame);this.createEffNumRun(t.getComponent(cc.Label),0,i,this.timeShowBigMega-1),t.runAction(cc.sequence(cc.scaleTo(this.timeShowBigMega-1,1),cc.scaleTo(.5,.8).easing(cc.easeBackOut()),cc.delayTime(.1),cc.scaleTo(.1,0)))}showAnimHugeWin(){this.playSoundEff("megawin"),this.blackMaskBig.active=!0,this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.setInfoAnim(this.firstAnim,this.bigWinAmin,cc.v2(0,-10),cc.v2(1,1)),this.firstAnim.node.parent=this.node,this.firstAnim.node.zIndex=900,this.firstAnim.playAnimation2("mega2",!1);let t=this.firstAnim.node.getChildByName("lb_Money");t.active=!0,t.opacity=255,this.lb_Money=t.getComponent(cc.Label),this.lb_Money.fontSize=15,this.lb_Money.node.position=cc.v3(0,-200,0);let i=Number(this.finishData.gameReward.totalChipsWinByGame);this.createEffNumRun(t.getComponent(cc.Label),0,i,this.timeShowBigMega-1),t.runAction(cc.sequence(cc.scaleTo(this.timeShowBigMega-1,1),cc.scaleTo(.5,.8).easing(cc.easeBackOut()),cc.delayTime(.1),cc.scaleTo(.1,0)))}showAnimBkgFreeSpin(t){let i=this.getAnimFromPool(this.listAnimBkgFree);this.setInfoAnim(i,this.freeSpinVienAmin,cc.v2(0,-30),cc.v2(.8,.95)),this.bkg_mid.addChild(i.node),i.playAnimation2("animation",!0),this.showAnimFreeNum(t)}showAnimFreeNum(t){let i=this.parentItemNode.zIndex+1,e=this.getAnimFromPool(this.listAnimBkgFree);this.setInfoAnim(e,this.freeNumAmin,cc.v2(0,225),cc.v2(1,1),!0),this.lbFreeAnim=e.node.getChildByName("lb_Money").getComponent(cc.Label),this.lbFreeAnim.node.position=cc.v3(0,0,0),this.lbFreeAnim.node.active=t>0,this.lbFreeAnim.string=t+" "+o.default.getInstance().getString("txt_freespin"),this.lbFreeAnim.node.color=new cc.Color(252,255,0,255),this.lbFreeAnim.useSystemFont=!0,this.lbFreeAnim.fontSize=25,this.lbFreeAnim.lineHeight=30,this.node.addChild(e.node,i),e.playAnimation2("animation",!0)}showAnimEndBonus(){let t=this.listCheckResultBonus.length,i=0;this.canSpin=!1,this.isAllowClick=!1,this.btn_Spin.interactable=!1;let e=0;this.finishData.winType>1?e=3:this.finishData.winType>0&&(e=2),this.parentItemNodeBonus.runAction(cc.sequence(cc.callFunc(()=>{this.node.getChildByName("popup_jackpot").active=!1}),cc.repeat(cc.sequence(cc.callFunc(()=>{this.scaleLb_CoinEffect(this.listCheckResultBonus[i])}),cc.callFunc(()=>{this.showAnimResultBonusGame(this.listCheckResultBonus[i],this.listCheckResultValueBonus[i]),this.isHoldSpin=!1}),cc.delayTime(1),cc.callFunc(()=>{i++})),t),cc.delayTime(.5),cc.callFunc(()=>{this.isShowJackpot&&this.showAnimJackPot(this.jackPot.typeJP,this.jackPot.winJP)}),cc.delayTime(3),cc.callFunc(()=>{a.default.runNumber(this.lb_ChipWinRound,this.totalWin,.8),this.anim_chip_win.setAnimation(0,"animation",!1),this.anim_chip_win.node.active=!0}),cc.delayTime(.5),cc.callFunc(()=>{this.lb_Chip.string=a.default.formatMoneyChip(this.agPlayer),this.btn_Spin.interactable=!0}),cc.delayTime(3.5),cc.callFunc(()=>{this.anim_chip_win.node.active=!1}),cc.delayTime(e),cc.callFunc(()=>{this.isAllowClick=!0,this.anim_effect_bonus.node.active=!1,this.node.getChildByName("popup_jackpot").active=!0,this.isShowEndBonus=!1,this.popup_Endgame.active=!0,this.popup_Endgame.getChildByName("lb_chip").getComponent(cc.Label).string=a.default.formatNumber(Number(this.finishData.gameReward.totalChipsWinByGame))})))}onStopSpin(){this.listOriginItem=[],this.listCheckStopCol[0]=!0,this.isCheckScatterItem3,this.timeRunSpin}getOriginItem(){this.listScatter=[];for(let t=0;t<this.listItem.length;t++){let i=this.listItem[t];i.node.position.y>this.initPosItem.y-100&&i.node.position.y<this.initPosItem.y+50?i.getScatterItem():i.setRandomId(!1)}this.isHave2Scatter=this.scatterCount>1}initLineWin(t){const{lineWin:i,color:e,startCol:n}=t;let s=[];for(let o=0;o<i.length;o++){if(!this.listOriginItem[n+o])continue;let t=this.listOriginItem[n+o].getComponent(_.default),e=t.getWordPosItem(t.listItem[i[o]]);s.push(e)}this.drawLine(s,e)}getLineWin(t){this.winningLine=[],t.paylines.forEach(t=>{let i={lineWin:[],lineWinId:[],color:null,pays:null,startCol:0},e=[],n=t.id-1;for(let s=0;s<this.payLine[n].length;s++){let t=this.payLine[n][s];e.push(this.finishView[s][t])}i.startCol=t.indices[0]%5,i.color=this.listColor[n],i.lineWin=t.indices.map(t=>Math.floor(t/5)),i.pays=Number(t.chips),i.lineWinId=e,this.winningLine.push(i)})}acShowWinLine(){if(this.isFreeSpin||(this.totalAgFSP>50*this.curMarkBet?this.isShowHugeWin=!0:this.totalAgFSP>20*this.curMarkBet&&(this.isShowBigWin=!0),0===this.finishData.freeSpinLeft&&(this.finishData.isBonusGame||this.finishData.freeSpin)&&(this.destroyAnimFreeSpin(),this.isAutoSpin=!1)),this.finishData.isBonusGame&&0===this.finishData.freeSpinLeft&&(this.isShowEndBonus=!0),"NONE"!==this.jackPot.typeJP&&""!==this.jackPot.typeJP&&(this.isShowJackpot=!0,this.isShowEndBonus=!0),this.finishData.allowSelectBonus&&(this.isAllowClick=!1),!this.isFreeSpin&&this.finishData.freeSpin&&(this.totalWin=this.totalAgFSP),this.finishData.isBonusGame)for(let a=0;a<this.finishData.slotViews.length;a++)for(let t=0;t<this.finishData.slotViews[a].length;t++)13===this.finishData.slotViews[a][t].id?(this.parentItemNodeBonus.children[a].children[t].active=!0,this.parentItemNodeBonus.children[a].children[t].children[1].getComponent(cc.Sprite).spriteFrame=this.sprItems[13],this.parentItemNodeBonus.children[a].children[t].children[2].active=!0):this.finishData.slotViews[a][t].id>13&&this.finishData.slotViews[a][t].id<17&&(this.parentItemNodeBonus.children[a].children[t].children[2].active=!1,this.parentItemNodeBonus.children[a].children[t].children[1].getComponent(cc.Sprite).spriteFrame=this.sprItems[this.finishData.slotViews[a][t].id],this.parentItemNodeBonus.children[a].children[t].active=!0);this.selectBonus.typeBonus<=4&&(this.countFruitCoin=0),this.isShowPopupFruitRain=this.finishData.nextSixiangGame===I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_RAIN&&this.finishData.currentSixiangGame!==I.SixiangGame.SI_XIANG_GAME_JUICE_FRUIT_RAIN,this.isShowPopupFruitRain&&(this.canSpinSixCoin=!0),this.lb_ChipWinRound.string=a.default.formatNumber(Number(this.finishData.gameReward.totalChipsWinByGame));let t=0,i=0,e=.1*this.listWinLineNode.length,n=0,s=0,o=0,l=0,h=0,c=0;this.listWinLineNode.length>1&&(c=this.listWinLineNode.length*I.SPEED_NORMAL+.7),this.isShowJackpot&&(o=4.5),this.isShowEndBonus&&(l=1.1*this.listCheckResultBonus.length+o),(this.isWildWinInLine||this.isHave2Scatter)&&(h=1.3),this.finishData.allowSelectBonus&&(s=3);let r=[100,101,102];r.includes(this.winType)&&(n=2),((r=[1,101]).includes(this.winType)&&!this.finishData.freeSpin||this.isShowBigWin)&&(t=3),((r=[2,102]).includes(this.winType)&&!this.finishData.freeSpin||this.isShowHugeWin)&&(t=0,i=6),this.timeShowBigMega=t+i;let u=cc.callFunc(()=>{this.showAllWinLine()}),p=cc.callFunc(()=>{this.node.runAction(cc.callFunc(()=>{this.showAnimOneWinLine()}))}),m=cc.callFunc(()=>{this.isHave2Scatter&&this.allowSelectBonus&&this.showAnimScatter()}),d=cc.callFunc(()=>{this.isWildWinInLine&&this.showAnimAllWild()}),S=cc.callFunc(()=>{([1,101].includes(this.winType)&&!this.finishData.freeSpin||this.isShowBigWin)&&this.showAnimBigWin()}),g=cc.callFunc(()=>{([2,102].includes(this.winType)&&!this.finishData.freeSpin||this.isShowHugeWin)&&this.showAnimHugeWin()}),f=cc.callFunc(()=>{this.finishData.allowSelectBonus&&(this.resetForNextSpin(),this.showTwoBasketView())}),_=cc.callFunc(()=>{this.isShowEndBonus&&this.showAnimEndBonus()}),b=cc.callFunc(()=>{this.isShowPopupFruitRain&&this.showPopupFruiRain()}),A=cc.sequence(m,cc.delayTime(n),d,cc.delayTime(h),u,cc.delayTime(c),f,cc.delayTime(s),_,cc.delayTime(l),b,S,cc.delayTime(t),g,cc.delayTime(i),p,cc.delayTime(e));this.node.runAction(A),this.lb_info.node.active=!1,this.updateJackpot(this.finishData)}drawLine(t,i){let e=this.createLine(i,!0);e.moveTo(t[0].x-72,t[0].y),e.lineTo(t[0].x,t[0].y);let n=t.length;for(let s=1;s<n;s++)e.lineJoin=cc.Graphics.LineJoin.ROUND,e.lineTo(t[s].x,t[s].y);e.lineTo(t[n-1].x+72,t[n-1].y),e.stroke(),e.node.active=!1,this.listWinLineNode.push(e)}drawLineLast(t,i){let e=this.createLine(i,!0),n=this.getCrossPoint(t[0],t[1]);n&&e.moveTo(n.x,n.y);let s=t.length;for(let o=1;o<s;o++)e.lineJoin=cc.Graphics.LineJoin.ROUND,e.lineTo(t[o].x,t[o].y);e.lineTo(t[s-1].x+72,t[s-1].y),e.stroke(),this.listLineRect.push(e.node)}createLine(t,i,e=5){let n=(new cc.Node).addComponent(cc.Graphics);return n.lineWidth=e,n.lineCap=cc.Graphics.LineCap.ROUND,n.strokeColor=(new cc.Color).fromHEX(t),n.node.active=!0,this.node.addChild(n.node,I.ZINDEX_LINE),i&&(n.node.zIndex=I.ZINDEX_ITEMANIM+1),n}showListAnim(t,i,e){const{color:n,pays:s,lineWin:o,startCol:a}=e;let l=this.checkIndexToShowAnim(i);for(let h=0;h<=l;h++){this.showItemAnim(a+h,t[h],i[h],s,o),this.turnOffItemSpr(a+h,o[h]);let e=t[h],c=l<4&&h===l;if(h+1<=l&&(t[h].y>t[h+1].y+I.RECT_SIZE.y||t[h].y<t[h+1].y-I.RECT_SIZE.y)){let i=this.getCrossPoint(t[h],t[h+1]),e=this.getCrossPoint(t[h+1],t[h]),s=this.createLine(n,!0);i&&s.moveTo(i.x,i.y),e&&s.lineTo(e.x,e.y),s.stroke(),this.listLineRect.push(s.node)}this.drawRect(e,n,c,l,t)}}checkIndexToShowAnim(t){let i=0,e=t[0];for(let n=1;n<t.length;n++)if(11!==e){if(t[n]!==e&&11!==t[n])break;i++}else{if(12===t[n])break;e=t[n],i++}return i}showItemAnim(t,i,e,n,s=!0){this.setItemMiniResult(e,t,n);let o=this.listItemAnim[t],a=1,l=null;switch(e){case 0:l=this.itemsAmin[0];break;case 1:l=this.itemsAmin[1];break;case 2:l=this.itemsAmin[2];break;case 3:l=this.itemsAmin[3];break;case 4:l=this.itemsAmin[4];break;case 5:l=this.itemsAmin[5];break;case 6:l=this.itemsAmin[6];break;case 7:l=this.itemsAmin[7];break;case 8:l=this.itemsAmin[8],a=.8;break;case 9:l=this.itemsAmin[9],a=.8;break;case 10:l=this.itemsAmin[10],a=.8;break;case 11:l=this.itemsAmin[11],a=.8;break;case 12:l=this.itemsAmin[12],a=.8}o.initAnimation(l),o.node.position=i,o.node.active=!0,o.animation.node.scale=a,o.playAnimation2("animation",!0)}setItemMiniResult(t,i,e){if(11!==t){this.idMini=t;for(let e=0;e<i;e++)this.listItemMiniResult[e].spriteFrame=this.sprItems[t]}11===t&&-1!==this.idMini&&(t=this.idMini),this.listItemMiniResult[i].node.active=!0,this.listItemMiniResult[i].spriteFrame=this.sprItems[t],this.lb_Result.string=o.default.getInstance().getString("txt_pays_chip").replace("%s",a.default.formatMoney(e)),this.itemMiniResult.active=!0}turnOffMiniResult(){for(let t=0;t<this.listItemMiniResult.length;t++)this.listItemMiniResult[t].node.active=!1}getCrossPoint(t,i){let e=t.y>i.y?-1:1,n=cc.v3(t.x-I.RECT_SIZE.x,t.y+I.RECT_SIZE.y/2*e),s=cc.v3(n.x+I.RECT_SIZE.x,n.y);return Math.abs(t.y-i.y)<1&&(n=cc.v3(t.x+I.RECT_SIZE.x/2,t.y+I.RECT_SIZE.y/2),s=cc.v3(t.x+I.RECT_SIZE.x/2,t.y-I.RECT_SIZE.y/2)),a.default.getIntersectPoint(n,s,t,i)}turnOffItemSpr(t,i){this.listIndexSpr.push({column:t,index:i}),this.listOriginItem[t].getComponent(_.default).setStateSpr(i,!1)}turnOffAnim(){for(let t=0;t<this.listAnimWS.length;t++)this.listAnimWS[t].node.destroy();this.listAnimWS=[];for(let t=0;t<this.listItemAnim.length;t++)this.listItemAnim[t].node.active=!1,this.listItemAnim[t].animation.skeletonData=null}checkWildWinInLine(){let t=[];this.isWildWinInLine=!1;for(let i=0;i<this.winningLine.length;i++){let e=this.winningLine[i].lineWin;for(let n=0;n<e.length;n++)t.push(this.finishView[this.winningLine[i].startCol+n][e[n]])}this.countWild=this.checkIndexToShowAnim(t);for(let i=0;i<=this.countWild;i++)11===t[i]&&(this.isWildWinInLine=!0)}drawRect(t,i,e,n,s){let o=this.createLine(i,!0,5),a=cc.v2(t.x-I.RECT_SIZE.x/2,t.y-I.RECT_SIZE.y/2);if(o.moveTo(a.x,a.y),o.rect(a.x,a.y,I.RECT_SIZE.x,I.RECT_SIZE.y),this.listLineRect.push(o.node),o.stroke(),e){let t=s.slice(n,5);t&&t.length>=2&&this.drawLineLast(t,i)}}resetForNextSpin(){var t,i;for(let e=0;e<this.listIndexSpr.length;e++)null===(i=null===(t=this.listOriginItem[this.listIndexSpr[e].column])||void 0===t?void 0:t.getComponent(_.default))||void 0===i||i.setStateSpr(this.listIndexSpr[e].index,!0);this.listIndexSpr=[],this.node.stopAllActions(),this.canSpin=!0,this.blackMask.active=!1;for(let e=0;e<this.listWinLineNode.length;e++)this.listWinLineNode[e].node.destroy();this.turnOffAnim();for(let e=0;e<this.listLineRect.length;e++)this.listLineRect[e].destroy();this.listLineRect=[],this.listWinLineNode=[],this.winningLine=[],this.clickSpinCount=0,this.scatterCount=0,this.isShowBigWin=!1,this.isShowHugeWin=!1,this.blackMaskBig.active=!1,this.isFreeSpin?this.finishData.allowSelectBonus?this.lb_titleWin.string=o.default.getInstance().getString("txt_win"):this.lb_titleWin.string=o.default.getInstance().getString("txt_total_win"):this.lb_titleWin.string=o.default.getInstance().getString("txt_last_win"),this.lb_ChipWinRound.string=a.default.formatNumber(Number(this.finishData.gameReward.totalChipsWinByGame)),!this.finishData.freeSpin||this.isAutoSpin?this.speedSpin=I.SPEED_AUTO:this.speedSpin=I.SPEED_NORMAL,this.setStateSpinBtn(),this.agPlayer<this.listMarkBet[0]&&(this.btn_Spin.interactable=!1,r.default.getInstance().alertDialog.showMessage(o.default.getInstance().getString("txt_not_enough_money_gl"))),this.itemMiniResult.active=!1,this.firstDelay=2,this.lb_info.node.active=!0,this.agPlayer>=this.listMarkBet[0]||this.freeSpinLeft>0?(this.parentItemNode.getComponent(cc.Button).interactable=!0,this.lb_info.string=this.isAutoSpin?this.lb_info.string=o.default.getInstance().getString("txt_playing_lines").replace("%d","20"):o.default.getInstance().getString("txt_press_spin_to_play")):(this.parentItemNode.getComponent(cc.Button).interactable=!1,this.btn_Spin.interactable=!1,this.lb_info.string=o.default.getInstance().getString("not_enought_gold"),r.default.getInstance().alertDialog.showMessage(o.default.getInstance().getString("txt_not_enough_money_gl"))),this.freeSpinLeft>0&&0!==this.selectBonus.typeBonus&&(this.isAutoSpin=!0),!this.finishData.isBonusGame&&!this.finishData.freeSpin&&this.finishData.freeSpinLeft>0?this.isAutoSpin=!1:!this.isAutoSpin&&!this.isSpinFree||this.allowSelectBonus||this.onClickSpin()}onClickPlusMarkBet(){!this.isStop||this.isFreeSpin||this.markIndex<0||this.isAutoSpin||this.selectBonus.typeBonus>0||(this.markIndex<this.listMarkBet.length-1?(this.markIndex++,this.markIndex===this.listMarkBet.length-1&&(this.lb_TypeMark.string=o.default.getInstance().getString("shan2_maxbet"))):(this.markIndex=0,this.lb_TypeMark.string=o.default.getInstance().getString("txt_bet")),this.lb_markBet.string=a.default.formatNumber(this.listMarkBet[this.markIndex]),g.default.updateBet(this.listMarkBet[this.markIndex]))}onClickMinusMarkBet(){!this.isStop||this.isFreeSpin||this.markIndex<0||this.isAutoSpin||this.selectBonus.typeBonus>0||(this.markIndex>0?(this.markIndex--,this.lb_TypeMark.string=o.default.getInstance().getString("txt_bet")):(this.markIndex=this.listMarkBet.length-1,this.lb_TypeMark.string=o.default.getInstance().getString("shan2_maxbet")),this.lb_markBet.string=a.default.formatNumber(this.listMarkBet[this.markIndex]),g.default.updateBet(this.listMarkBet[this.markIndex]))}onClickMaxBet(){this.agPlayer<this.listMarkBet[0]||!this.isStop||this.isFreeSpin||this.markIndex<0||this.isAutoSpin||this.selectBonus.typeBonus>0||(this.lb_TypeMark.string=o.default.getInstance().getString("shan2_maxbet"),this.markIndex=this.listMarkBet.length-1,this.lb_markBet.string=a.default.formatNumber(this.listMarkBet[this.markIndex]),g.default.updateBet(this.listMarkBet[this.markIndex]))}getRanNum(t,i){let e=Math.random()*(i-t)+t;return Math.floor(e)}createEffNumRun(t,i,e,n){t.node.active=!0,this.endNum=e,this.deltaNum=this.endNum-this.startNum,this.numPerSec=this.deltaNum/n,this.curNum=i,this.isRunEffPlusMoney=!0,this.effRunNumber(n,t,this.curNum,this.endNum,this.numPerSec)}effRunNumber(t,i,e,n,s){let o=s/20;o<0&&(o=1);let l=cc.callFunc(()=>{(e+=o)>=n&&(e=n),i.string=a.default.formatNumber(Math.ceil(e))}),h=cc.callFunc(()=>{e>=n&&i.node.stopActionByTag(0)}),c=cc.repeat(cc.sequence(l,cc.delayTime(.05),h),20*t);i.node.runAction(c)}updateMoney(){if(!(0!==this.finishData.freeSpinLeft&&!this.allowSelectBonus&&this.selectBonus.typeBonus<4||this.finishData.isBonusGame)){if(this.curChip===this.agPlayer)this.lb_Chip.string=a.default.formatMoneyChip(this.agPlayer);else{if(0===this.totalWin)return;this.anim_chip_win.node.active=!0,this.anim_chip_win.node.stopAllActions(),this.anim_chip_win.clearTracks(),this.anim_chip_win.node.runAction(cc.sequence(cc.callFunc(()=>{this.finishData.isBonusGame||this.anim_chip_win.setAnimation(0,"animation",!1),this.canSpin=!1}),cc.delayTime(1),cc.callFunc(()=>{this.lb_Chip.string=a.default.formatMoneyChip(this.agPlayer)}),cc.callFunc(()=>{this.canSpin=!0}),cc.delayTime(4),cc.callFunc(()=>{this.anim_chip_win.node.active=!1,this.canSpin=!0})))}0===this.finishData.agWin||this.finishData.freeSpin||this.finishData.isBonusGame||(this.lb_titleWin.string=o.default.getInstance().getString("txt_win")),this.finishData.isBonusGame||(this.lb_ChipWinRound.string=a.default.formatNumber(Number(this.finishData.gameReward.totalChipsWinByGame))),this.finishData.allowSelectBonus&&(this.totalAgFSP=0)}}onClickShop(){this.isStop&&u.default.show()}getAnimFromPool(t){let i=cc.instantiate(this.itemAnim).getComponent(f.default);return t.push(i),i}putAnimBackPool(t){}playSoundEff(t){}stopSoundEff(){}setChipAnim(){}showAnimJackPot(t,i){switch(this.isShowJackpot=!1,t){case"JP_GRAND":t="JP_grand",i+=this.jpGrandPlayer;break;case"JP_MINI":t="JP_mini";break;case"JP_MAJOR":t="JP_major",i+=this.jpMajorPlayer;break;case"JP_MINOR":t="JP_minor"}this.blackMaskBig.active=!0,this.anim_win_jackpot.node.active=!0,this.anim_win_jackpot.node.zIndex=1100,this.anim_win_jackpot.node.runAction(cc.scaleTo(.5,1).easing(cc.easeBackOut())),this.anim_win_jackpot.animation=t,this.setTimeout(()=>{this.blackMaskBig.active=!1,this.anim_win_jackpot.node.active=!1},3e3),this.lb_JP_Ainm.string=a.default.formatNumber(i)}setTimeout(t,i){setTimeout(()=>{null!=this.node&&t.call()},i)}onClickOffPopupFruitRain(){this.canSpin=!0,this.canSpinSixCoin=!1,this.popup_FruitRain.active=!1,this.viewBonusGame=!0,this.resetForNextSpin(),this.onClickSpin()}onClickOffPopupEndGame(){this.popup_Endgame.active=!1,5===this.finishData.selectBonus.typeBonus&&(this.popup_FruitRain.active=!0),g.default.getMatchResult()}showTypeFreeSpin(t){g.default.sendSpinWithIndex(t),this.canSpin=!0,this.isAllowClick=!0}handleChooseGame(t){t.spinSymbols&&0!==t.spinSymbols.length&&(t.spinSymbols[0].symbol===I.Symbol.SI_XIANG_SYMBOL_JUICE_FUIT_SELECT_FREE_GAME?(this.freeSpin_Screen.children[0].getComponent(cc.Label).string=t.gameConfig.numFreeSpin+"",this.freeSpin_Screen.children[2].getComponent(cc.Label).string=t.gameConfig.numWild+"",this.setTimeout(()=>{this.freeSpin_Screen.active=!0},3e3),this.setTimeout(()=>{this.freeSpin_Screen.active=!1,this.anim_choose_game.node.active=!1,this.bkg_Black_Bonus.active=!1},5e3)):(this.setTimeout(()=>{this.freeFruitRain_Screen.active=!0},2e3),this.setTimeout(()=>{this.popup_FruitRain.active=!0,this.freeFruitRain_Screen.active=!1,this.anim_choose_game.node.active=!1,this.bkg_Black_Bonus.active=!1},5e3)),this.freeSpinLeft>0&&(0===this.listAnimBkgFree.length?this.showAnimBkgFreeSpin(this.freeSpinLeft):this.lbFreeAnim.string=this.freeSpinLeft+" "+o.default.getInstance().getString("txt_freespin")))}showPopupFruiRain(){this.popup_Endgame.active||(this.resetParentNodeContentInstead(),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.firstAnim.node.getChildByName("lb_Money").active=!1,this.isShowPopupFruitRain=!1,this.canSpin=!1,this.setTimeout(()=>{if(this.popup_FruitRain.active=!0,this.isFreeSpin=!0,this.setStateSpinBtn(),5===this.finishData.selectBonus.typeBonus){for(let t=0;t<this.listcolumn.length;t++){let i=this.listcolumn[t];for(let t=0;t<i.length;t++)i[t].getComponent(_.default).setRandomId(!0)}this.initParentNodeBonus(this.finishData.selectBonus.view),this.showAnimBkgFreeSpin(this.finishData.selectBonus.numSpin)}},1200))}resetParentNodeContentInstead(){for(let t=0;t<5;t++)for(let i=0;i<3;i++)this.parentItemNodeBonus.children[t].children[i].active=!1}initParentNodeBonus(t){let i=cc.callFunc(()=>{for(let i=0;i<t.length;i++)for(let e=0;e<t[i].length;e++)0===t[i][e].value&&(this.parentItemNodeBonus.children[i].children[e].active=!1),13===t[i][e].id&&(this.parentItemNodeBonus.children[i].children[e].children[1].getComponent(cc.Sprite).spriteFrame=this.sprItems[13],this.parentItemNodeBonus.children[i].children[e].children[2].getComponent(cc.Label).string=a.default.formatMoneyChip(t[i][e].value)),t[i][e].id>13?(this.parentItemNodeBonus.children[i].children[e].children[2].active=!1,this.parentItemNodeBonus.children[i].children[e].children[1].getComponent(cc.Sprite).spriteFrame=this.sprItems[t[i][e].id]):this.parentItemNodeBonus.children[i].children[e].children[2].active=!0}),e=cc.callFunc(()=>{for(let i=0;i<t.length;i++)for(let e=0;e<t[i].length;e++)t[i][e].id>=13&&(this.parentItemNodeBonus.children[i].children[e].active=!0)}),n=cc.sequence(i,e);this.parentItemNodeBonus.runAction(n)}showTwoBasketView(){this.canSpin=!1,this.btn_Spin.node.children[1].active=!0,this.setTimeout(()=>{this.bkg_Black_Bonus.active=!0,this.anim_choose_game.node.active=!0,this.btn_Spin.node.children[1].active=!1,this.anim_choose_game.setAnimation(0,"thung2",!1)},2500),this.clickRight=!0,this.clickLeft=!0}initJackPot(t){this.jpGrandPlayer=Number(t.winJpHistory.grand.chipsAccum),this.jpMajorPlayer=Number(t.winJpHistory.major.chipsAccum),this.rateJPGrand=Number(t.winJpHistory.grand.ratio),this.rateJPMajor=Number(t.winJpHistory.major.ratio),this.rateJPMinor=Number(t.winJpHistory.minor.ratio),this.rateJPMini=Number(t.winJpHistory.mini.ratio),this.valueJPGrandCurrent=Number(t.winJpHistory.grand.chips)+this.jpGrandPlayer,this.valueJPMajorCurrent=Number(t.winJpHistory.major.chips)+this.jpMajorPlayer,this.valueJPMinorCurrent=Number(t.winJpHistory.minor.chips),this.valueJPMiniCurrent=Number(t.winJpHistory.mini.chips),this.lb_JPGrand.string=a.default.formatNumber(this.valueJPGrandCurrent),this.lb_JPMajor.string=a.default.formatNumber(this.valueJPMajorCurrent),this.lb_JPMinor.string=a.default.formatNumber(this.valueJPMinorCurrent),this.lb_JPMini.string=a.default.formatNumber(this.valueJPMiniCurrent)}updateJackpot(t){var i,e,n,s;this.valueJPGrandCurrent=Number(null===(i=t.winJpHistory)||void 0===i?void 0:i.grand.chips)+this.jpGrandPlayer,this.valueJPMajorCurrent=Number(null===(e=t.winJpHistory)||void 0===e?void 0:e.major.chips)+this.jpMajorPlayer,this.valueJPMinorCurrent=Number(null===(n=t.winJpHistory)||void 0===n?void 0:n.minor.chips),this.valueJPMiniCurrent=Number(null===(s=t.winJpHistory)||void 0===s?void 0:s.mini.chips),this.lb_JPGrand.string=a.default.formatNumber(this.valueJPGrandCurrent),this.lb_JPMajor.string=a.default.formatNumber(this.valueJPMajorCurrent),this.lb_JPMinor.string=a.default.formatNumber(this.valueJPMinorCurrent),this.lb_JPMini.string=a.default.formatNumber(this.valueJPMiniCurrent)}destroyAnimFreeSpin(){for(let t=0;t<this.listAnimBkgFree.length;t++)this.listAnimBkgFree[t].node.destroy();this.listAnimBkgFree=[]}showAnimResultBonusGame(t,i){this.anim_effect_bonus.node.active=!0,this.pointResultBonus+=i;let e=cc.instantiate(this.itemAnim).getComponent(f.default),n=""+t;this.setInfoAnim(e,this.effectResultAmin,cc.v2(0,0),cc.v2(1,1)),e.node.parent=this.node,e.playAnimation2(n,!1),this.anim_effect_bonus.node.getChildByName("lb_point_effect").getComponent(cc.Label).string=a.default.formatNumber(this.pointResultBonus),this.setTimeout(()=>{e.node.destroy()},1e3)}scaleLb_CoinEffect(t){let i=0,e=0;switch(t){case 1:i=0,e=0;break;case 2:i=1,e=0;break;case 3:i=2,e=0;break;case 4:i=3,e=0;break;case 5:i=4,e=0;break;case 6:i=0,e=1;break;case 7:i=1,e=1;break;case 8:i=2,e=1;break;case 9:i=3,e=1;break;case 10:i=4,e=1;break;case 11:i=0,e=2;break;case 12:i=1,e=2;break;case 13:i=2,e=2;break;case 14:i=3,e=2;break;case 15:i=4,e=2}let n=this.parentItemNodeBonus.children[i].children[e].children[2].getComponent(cc.Label);n.node.scale=1.2,this.setTimeout(()=>{n.node.scale=1},500)}onClickRule(){d.default.show(this.node)}onQuit(){h.BannerData.setBannerData(l.Banner.ShowType.LEFT_MATCH,!0,l.Game.Enum.JUICY_GARDEN),S.default.onQuit()}};C.instance=null,s([A(cc.Prefab)],C.prototype,"itemAnim",void 0),s([A(cc.Prefab)],C.prototype,"itemSlot",void 0),s([A([cc.SpriteFrame])],C.prototype,"sprItems",void 0),s([A(cc.Node)],C.prototype,"blackMask",void 0),s([A(cc.Node)],C.prototype,"parentItemNode",void 0),s([A(cc.Node)],C.prototype,"parentItemNodeBonus",void 0),s([A(cc.Node)],C.prototype,"itemMiniResult",void 0),s([A([cc.Sprite])],C.prototype,"listItemMiniResult",void 0),s([A(cc.Node)],C.prototype,"bkg_mid",void 0),s([A(cc.Node)],C.prototype,"bkg_Top",void 0),s([A(cc.Node)],C.prototype,"bkg_Bottom",void 0),s([A(cc.Button)],C.prototype,"btn_Spin",void 0),s([A(cc.Node)],C.prototype,"bkg_Black_Bonus",void 0),s([A(cc.Label)],C.prototype,"lb_markBet",void 0),s([A(cc.Label)],C.prototype,"lb_ChipWinRound",void 0),s([A(cc.Label)],C.prototype,"lb_Chip",void 0),s([A(cc.Label)],C.prototype,"lb_Result",void 0),s([A(cc.Label)],C.prototype,"lb_info",void 0),s([A(cc.Label)],C.prototype,"lb_titleWin",void 0),s([A([cc.SpriteFrame])],C.prototype,"txt_win",void 0),s([A(cc.Label)],C.prototype,"lb_freeSpinLeft",void 0),s([A(cc.Label)],C.prototype,"lb_TypeMark",void 0),s([A(cc.Label)],C.prototype,"lb_numLine1",void 0),s([A(cc.Label)],C.prototype,"lb_numLine2",void 0),s([A(cc.Label)],C.prototype,"lb_JPGrand",void 0),s([A(cc.Label)],C.prototype,"lb_JPMinor",void 0),s([A(cc.Label)],C.prototype,"lb_JPMajor",void 0),s([A(cc.Label)],C.prototype,"lb_JPMini",void 0),s([A(cc.Label)],C.prototype,"lb_JP_Ainm",void 0),s([A(sp.Skeleton)],C.prototype,"anim_chip_win",void 0),s([A(sp.Skeleton)],C.prototype,"anim_choose_game",void 0),s([A(sp.Skeleton)],C.prototype,"anim_win_jackpot",void 0),s([A(sp.Skeleton)],C.prototype,"anim_effect_bonus",void 0),s([A(cc.Node)],C.prototype,"freeSpin_Screen",void 0),s([A(cc.Node)],C.prototype,"freeFruitRain_Screen",void 0),s([A(cc.Node)],C.prototype,"popup_FruitRain",void 0),s([A(cc.Node)],C.prototype,"popup_Endgame",void 0),s([A([cc.Font])],C.prototype,"fontAnims",void 0),s([A(sp.SkeletonData)],C.prototype,"scatterAmin",void 0),s([A(sp.SkeletonData)],C.prototype,"itemWildAnim",void 0),s([A(sp.SkeletonData)],C.prototype,"bigWinAmin",void 0),s([A(sp.SkeletonData)],C.prototype,"freeSpinVienAmin",void 0),s([A(sp.SkeletonData)],C.prototype,"freeNumAmin",void 0),s([A([sp.SkeletonData])],C.prototype,"itemsAmin",void 0),s([A(sp.SkeletonData)],C.prototype,"effectResultAmin",void 0),C=n=s([b],C),e.default=C,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/dialogs/shop/ShopDialog":void 0,"../../lobby/src/language/LanguageController":void 0,"./JuicyGardenConstants":"JuicyGardenConstants","./JuicyGardenItem":"JuicyGardenItem","./JuicyGardenItemAnimation":"JuicyGardenItemAnimation","./JuicyGardenNetworkTransport":"JuicyGardenNetworkTransport","./JuicyGardenPresenter":"JuicyGardenPresenter","./JuicyGardenRuleDialog":"JuicyGardenRuleDialog"}],JuicyGardenItemAnimation:[function(t,i,e){"use strict";cc._RF.push(i,"af88aXoESNGJaaUziglkGD6","JuicyGardenItemAnimation");var n=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,i,e,n);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(a=(o<3?s(a):o>3?s(i,e,a):s(i,e))||a);return o>3&&a&&Object.defineProperty(i,e,a),a};Object.defineProperty(e,"__esModule",{value:!0});const{ccclass:s,property:o}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.animation=null}initAnimation(t){this.animation.skeletonData=t,this.animation.premultipliedAlpha=!1,this.animation.animation="animation"}playAnimation(t="animation",i=!1,e=!0,n=!1){this.animation.node.active=!0,this.animation.paused=!1,this.animation.setAnimation(0,t,i),n||this.animation.node.runAction(cc.sequence(cc.delayTime(3.5),cc.removeSelf()))}playAnimation2(t="animation",i=!1){this.animation.node.active=!0,this.animation.paused=!1,this.animation.setAnimation(0,t,i)}playAnimBinh(t="animation",i=!1){this.animation.node.opacity=255,this.animation.setAnimation(0,t,i)}setMultiAlpha(t){this.animation.premultipliedAlpha=t}stopAnimation(){this.animation.node.active=!1,this.animation.paused=!0}};n([o(sp.Skeleton)],a.prototype,"animation",void 0),a=n([s],a),e.default=a,cc._RF.pop()},{}],JuicyGardenItem:[function(t,i,e){"use strict";cc._RF.push(i,"bea58UW3F5D14GIEoVFEJjs","JuicyGardenItem");var n=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,i,e,n);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(a=(o<3?s(a):o>3?s(i,e,a):s(i,e))||a);return o>3&&a&&Object.defineProperty(i,e,a),a};Object.defineProperty(e,"__esModule",{value:!0});const s=t("../../lobby/src/common/Utils"),o=t("./JuicyGardenController"),{ccclass:a,property:l}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.timeMove=0,this.sprItems=[],this.sprBlurs=[],this.listItem=[],this.itemBlur=[],this.itemMain=[],this.numCol=null,this.typeItem=null,this.listDataView=[],this.listIdView=[],this.listValueView=[]}getRanNum(t,i){let e=Math.random()*(i-t)+t;return Math.floor(e)}setRandomId(t){let i=[{id:this.getRanNum(0,12),value:0},{id:this.getRanNum(0,12),value:0},{id:this.getRanNum(0,12),value:0}];this.setSpriteListItem(i,t)}setSpriteListItem(t,i=!1){let e=[],n=[];for(let s=0;s<this.listItem.length;s++){let o=t[s].id,a=t[s].value;this.setSprSonItem(s,o,a,i),e.push(t[s].id),n.push(t[s].value)}this.listDataView=t.slice(),this.listIdView=e.slice(),this.listValueView=n.slice()}setSprSonItem(t,i,e,n){let o=this.itemBlur[t],a=this.itemMain[t];switch(o.getComponent(cc.Sprite).spriteFrame=this.sprBlurs[i],a.getComponent(cc.Sprite).spriteFrame=this.sprItems[i],a.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.TRIMMED,i){case 0:a.setContentSize(cc.size(108,104));break;case 1:case 2:a.setContentSize(cc.size(95,114.4));break;case 3:a.setContentSize(cc.size(111.8,106.6));break;case 4:a.setContentSize(cc.size(111,129));break;case 5:a.setContentSize(cc.size(138,124));break;case 6:a.setContentSize(cc.size(119,131));break;case 7:a.setContentSize(cc.size(144,121));break;case 8:a.setContentSize(cc.size(159,132));break;case 9:a.setContentSize(cc.size(154,138));break;case 10:a.setContentSize(cc.size(159,147));break;case 11:a.setContentSize(cc.size(149,152));break;case 12:a.setContentSize(cc.size(134,151));break;case 13:a.setContentSize(cc.size(139,144));break;case 14:case 15:case 16:a.setContentSize(cc.size(136,143));break;default:a.setContentSize(cc.size(136,140))}let l=a.parent.getChildByName("lb_coin");13===i?(l.getComponent(cc.Label).string=s.default.formatMoneyChip(e),l.active=!0):l.active=!1,n&&i<13?(a.color=new cc.Color(115,90,40),a.opacity=155):(a.color=new cc.Color(255,255,255),a.opacity=255)}getWordPosItemList(){let t=[];for(let i=0;i<this.listItem.length;i++){let e=this.getWordPosItem(this.listItem[i]);t.push(e)}return t}getWordPosItem(t){let i=this.node.convertToWorldSpaceAR(t.position);return o.default.getInstance().node.convertToNodeSpaceAR(i)}getScatterItem(){let t={id:null,pos:null};for(let i=0;i<this.listIdView.length;i++){let e=this.listIdView[i];12===e&&(t.pos=this.getWordPosItem(this.listItem[i]),t.id=e,o.default.getInstance().scatterCount++,o.default.getInstance().listScatter.push(t))}}getItemWithId(t){let i=[];for(let e=0;e<this.listIdView.length;e++)this.listIdView[e]===t&&i.push(this.listItem[e]);return i}setStateSpr(t,i){this.itemMain[t].active=i}};n([l],h.prototype,"timeMove",void 0),n([l([cc.SpriteFrame])],h.prototype,"sprItems",void 0),n([l([cc.SpriteFrame])],h.prototype,"sprBlurs",void 0),n([l([cc.Node])],h.prototype,"listItem",void 0),n([l([cc.Node])],h.prototype,"itemBlur",void 0),n([l([cc.Node])],h.prototype,"itemMain",void 0),h=n([a],h),e.default=h,cc._RF.pop()},{"../../lobby/src/common/Utils":void 0,"./JuicyGardenController":"JuicyGardenController"}],JuicyGardenNetworkTransport:[function(t,i,e){"use strict";cc._RF.push(i,"caaa5OjpuhGU7dlZoi2PM6D","JuicyGardenNetworkTransport"),Object.defineProperty(e,"__esModule",{value:!0});const n=t("../../lobby/src/network/NetworkClient"),s=t("../../lobby/src/common/ConfigClient"),o=t("../../lobby/src/common/Constants"),a=t("../../lobby/src/common/GlobalApp"),l=t("../../lobby/src/chat/ChatPresenter"),h=t("./JuicyGardenController"),c=t("../../lobby/src/lobby/GameList");class r{static subscribe(){n.default.getInstance().subscribeEventHandler(o.Game.Enum.JUICY_GARDEN,this)}static matchDataHandler(t){switch(t.op_code){case s.default.Network.OP_CODE.OPCODE_UPDATE_TABLE:cc.log("OPCODE_UPDATE_TABLE",t.data),h.default.getInstance().handleCTable(t.data);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_DEAL:cc.log("OPCODE_UPDATE_DEAL",t.data);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_GAME_STATE:r.processUpdateGameState(t);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_FINISH:cc.log("result",t);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_WALLET:cc.log("wallet",t);break;case s.default.Network.OP_CODE.OPCODE_KICK_OFF_THE_TABLE:cc.log("kick off",t),r.onQuit();break;default:cc.log("Data code not found ",t)}}static processUpdateGameState(t){switch(t.data.state){case o.Game.GAME_STATE.PREPARE:break;case o.Game.GAME_STATE.RUN:cc.log("GAME_STATE.RUN",t);break;case o.Game.GAME_STATE.REWARD:cc.log("GAME_STATE.REWARD",t);break;case o.Game.GAME_STATE.FINISH:cc.log("GAME_STATE.FINISH",t);break;default:cc.log("Match state not found ",t)}}static sendSpin(t){n.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,s.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_SPIN,t).then(t=>{cc.log("sendSpin success ",t)},t=>{cc.log("sendSpin err",t)})}static onQuit(t=(()=>{})){n.default.getInstance().leaveMatch(a.default.getInstance().matchInfo.match_id).then(i=>{cc.log("leave match: ",i),l.default.getInstance().leaveChat(),cc.sys.isBrowser&&s.default.AppInfo.WEB_NATIVE?(t(),window.location.href="/"):a.default.getInstance().loadSceneByMainBundle(s.default.AppInfo.SCENE_NAME.GAMELIST,()=>{var i;t(),null===(i=c.default.getInstance())||void 0===i||i.setGameType(o.GameType.Enum.SLOT_GAME),h.default.getInstance().node.destroy()})},()=>{cc.log("err when leave match")})}}e.default=r,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/lobby/GameList":void 0,"../../lobby/src/network/NetworkClient":void 0,"./JuicyGardenController":"JuicyGardenController"}],JuicyGardenPresenter:[function(t,i,e){"use strict";cc._RF.push(i,"81514DeORhMTbzdwvhdlWyy","JuicyGardenPresenter"),Object.defineProperty(e,"__esModule",{value:!0});const n=t("../../lobby/src/network/NetworkClient"),s=t("../../lobby/src/common/ConfigClient"),o=t("../../lobby/src/common/GlobalApp");e.default=class{static getMatchResult(){n.default.getInstance().sendMatchState(o.default.getInstance().matchInfo.match_id,s.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_INFO_TABLE,{}).then(()=>{cc.log("getMatchResult success ")},t=>{cc.log("getMatchResult err",t)})}static updateBet(t){n.default.getInstance().sendMatchState(o.default.getInstance().matchInfo.match_id,s.default.Network.OP_CODE_REQUEST.OPCODE_BET,{chips:t}).then(()=>{cc.log("updateBet success ",t)},t=>{cc.log("updateBet err",t)})}static sendSpinWithIndex(t){n.default.getInstance().sendMatchState(o.default.getInstance().matchInfo.match_id,s.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_SPIN,{id:t}).then(()=>{cc.log("sendSpinWithIndex success ",t)},t=>{cc.log("sendSpinWithIndex err",t)})}},cc._RF.pop()},{"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/network/NetworkClient":void 0}],JuicyGardenRuleDialog:[function(t,i,e){"use strict";cc._RF.push(i,"3c8c0UxGtpP4Z08rB7EadIF","JuicyGardenRuleDialog");var n,s=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,a=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,i,e,n);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(a=(o<3?s(a):o>3?s(i,e,a):s(i,e))||a);return o>3&&a&&Object.defineProperty(i,e,a),a};Object.defineProperty(e,"__esModule",{value:!0});const o=t("../../../bundles/lobby/src/common/BaseDialog"),a=t("../../../bundles/lobby/src/common/GlobalApp"),l=t("../../../bundles/lobby/src/common/ConfigClient"),{ccclass:h,property:c}=cc._decorator;let r=n=class extends o.default{constructor(){super(...arguments),this.ruleSprites=[],this.ruleContent=null,this.spriteIndex=0,this.isAnimating=!1}static getInstance(){return this.instance}actionNext(){this.ruleSprites.length<=0||this.isAnimating||(this.spriteIndex++,this.spriteIndex>=this.ruleSprites.length&&(this.spriteIndex=0),this.playPageTurnEffect(!0))}actionPrevious(){this.ruleSprites.length<=0||this.isAnimating||(this.spriteIndex--,this.spriteIndex<0&&(this.spriteIndex=this.ruleSprites.length-1),this.playPageTurnEffect(!1))}updateRuleDisplay(){this.ruleContent&&this.ruleSprites.length>0&&(this.ruleContent.spriteFrame=this.ruleSprites[this.spriteIndex])}playPageTurnEffect(t){if(!this.ruleContent||!this.ruleContent.node)return;this.isAnimating=!0;const i=this.ruleContent.node.scale,e=this.ruleContent.node.position,n=this.ruleContent.node.opacity;this.ruleContent.node.opacity=0,this.ruleContent.node.scale=.8*i,this.ruleContent.node.x=t?e.x+50:e.x-50,this.updateRuleDisplay(),cc.tween(this.ruleContent.node).to(.05,{opacity:100}).to(.25,{scale:i,x:e.x,opacity:n},{easing:"quartOut"}).call(()=>{this.isAnimating=!1}).start()}static show(t){null==this.instance||null==this.instance.node?a.default.getInstance().loadPrefabByBundle(l.default.Bundle.BUNDLE_NAME.JUICYGARDEN,"res/prefabs/JuicyGardenRuleDialog",(i,e)=>{if(null!=i)return void a.default.getInstance().alertDialog.showMessage(i);let s=cc.instantiate(e);s.parent=t,this.instance=s.getComponent(n),this.instance.node.zIndex=1e3,this.instance.show()}):(this.instance.node.zIndex=1e3,this.instance.show())}show(){super.show(),this.spriteIndex=0,this.updateRuleDisplay()}};r.instance=null,s([c([cc.SpriteFrame])],r.prototype,"ruleSprites",void 0),s([c(cc.Sprite)],r.prototype,"ruleContent",void 0),r=n=s([h],r),e.default=r,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}]},{},["JuicyGardenConstants","JuicyGardenController","JuicyGardenItem","JuicyGardenItemAnimation","JuicyGardenNetworkTransport","JuicyGardenPresenter","JuicyGardenRuleDialog"]);