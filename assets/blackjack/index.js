window.__require=function e(t,a,n){function i(l,r){if(!a[l]){if(!t[l]){var c=l.split("/");if(c=c[c.length-1],!t[c]){var s="function"==typeof __require&&__require;if(!r&&s)return s(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+l+"'")}l=c}var d=a[l]={exports:{}};t[l][0].call(d.exports,function(e){return i(t[l][1][e]||e)},d,d.exports,e,t,a,n)}return a[l].exports}for(var o="function"==typeof __require&&__require,l=0;l<n.length;l++)i(n[l]);return i}({BlackJackChip:[function(e,t){"use strict";cc._RF.push(t,"2ab7fjuTPVAKJQDqSbMhS2f","BlackJackChip");var a,n=(a=e("../../lobby/src/common/Utils"))&&a.__esModule?a:{default:a};cc.Class({extends:cc.Component,properties:{sprite:{default:null,type:cc.Sprite},label:{default:null,type:cc.Label},chipSprites:{default:[],type:cc.SpriteFrame},chip:0},setData:function(e){this.sprite.spriteFrame=this.chipSprites[e.spriteIndex],this.label.string=n.default.formatBetNumber(e.chip)||0,this.chip=Number(e.chip)||0}}),cc._RF.pop()},{"../../lobby/src/common/Utils":void 0}],BlackJackNetworkTransport:[function(e,t){"use strict";cc._RF.push(t,"1ffb51WU0tCTbOsJF/zRsce","BlackJackNetworkTransport");var a=c(e("../../lobby/src/network/NetworkClient")),n=c(e("../../lobby/src/common/ConfigClient")),i=e("../../lobby/src/common/Constants"),o=c(e("../../lobby/src/common/User")),l=c(e("../../lobby/src/common/GlobalApp")),r=c(e("../../lobby/src/chat/ChatPresenter"));function c(e){return e&&e.__esModule?e:{default:e}}var s=cc.Class({extends:cc.Component,properties:{instance:null},statics:{getInstance:function(){return null==this.instance&&(this.instance=new s,a.default.getInstance().subscribeEventHandler(i.Game.Enum.BLACKJACK,this.instance)),this.instance}},matchDataHandler:function(t){switch(t.op_code){case n.default.Network.OP_CODE.OPCODE_UPDATE_TABLE:cc.log("OPCODE_UPDATE_TABLE",t.data),e("BlackJack").getInstance().updateDesk(t.data);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_DEAL:cc.log("OPCODE_UPDATE_DEAL",t.data),e("BlackJack").getInstance().updateDeal(t.data);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_GAME_STATE:this.processUpdateGameState(t);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_FINISH:cc.log("result",t),e("BlackJack").getInstance().endGame(t.data);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_WALLET:cc.log("wallet",t),e("BlackJack").getInstance().updateGameBalances(t.data);break;case n.default.Network.OP_CODE.OPCODE_KICK_OFF_THE_TABLE:cc.log("kick off",t),this.onQuit();break;case n.default.Network.OP_CODE.OPCODE_LIST_PLAYER:cc.log("OPCODE_LIST_PLAYER",t),e("BlackJack").getInstance().loadListPlayerSuccess(t.data);break;default:cc.log("Data code not found ",t)}},processUpdateGameState:function(t){switch(t.data.state){case i.Game.GAME_STATE.PREPARE:e("BlackJack").getInstance().prepare(t.data);break;case i.Game.GAME_STATE.RUN:cc.log("GAME_STATE.RUN",t),e("BlackJack").getInstance().gameState=i.Game.GAME_STATE.RUN,e("BlackJack").getInstance().countDown(t.data.countDown);break;case i.Game.GAME_STATE.REWARD:cc.log("GAME_STATE.REWARD",t),e("BlackJack").getInstance().gameState=i.Game.GAME_STATE.REWARD,e("BlackJack").getInstance().reward();break;case i.Game.GAME_STATE.FINISH:cc.log("GAME_STATE.FINISH",t);break;default:cc.log("Match state not found ",t)}},sendBet:function(e){a.default.getInstance().sendMatchState(l.default.getInstance().matchInfo.match_id,n.default.Network.OP_CODE_REQUEST.OPCODE_BET,e).then(function(e){cc.log("sendBet success ",e)},function(e){cc.log("sendBet err",e)})},sendAction:function(e){a.default.getInstance().sendMatchState(l.default.getInstance().matchInfo.match_id,n.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_DECLARE_CARDS,e).then(function(e){cc.log("sendAction success ",e)},function(e){cc.log("sendAction err",e)})},getUsers:function(){a.default.getInstance().sendMatchState(l.default.getInstance().matchInfo.match_id,n.default.Network.OP_CODE_REQUEST.OPCODE_LIST_USERS,{}).then(function(){cc.log("list users ")},function(e){cc.log("get list users failed",e)})},onQuit:function(t,i){void 0===t&&(t=function(){}),void 0===i&&(i=!0),a.default.getInstance().leaveMatch(l.default.getInstance().matchInfo.match_id).then(function(a){cc.log("leave match: ",a),e("BlackJack").getInstance().gameState=null,r.default.getInstance().leaveChat(),i&&l.default.getInstance().loadSceneByMainBundle(o.default.vipLevel>0?n.default.AppInfo.SCENE_NAME.TABLELIST:n.default.AppInfo.SCENE_NAME.GAMELIST),t&&t()},function(e){cc.log("err when leave match",e)})}});t.exports=s,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/network/NetworkClient":void 0,BlackJack:"BlackJack"}],BlackJackPresenter:[function(e,t){"use strict";cc._RF.push(t,"4fdf7gZlElGS5B23VIN1uXt","BlackJackPresenter"),cc.Class({extends:cc.Component,statics:{},properties:{}}),cc._RF.pop()},{}],BlackJackRuleDialog:[function(e,t,a){"use strict";cc._RF.push(t,"7ed33ZsU7xJSrFZ2e/Nf99S","BlackJackRuleDialog");var n,i=this&&this.__decorate||function(e,t,a,n){var i,o=arguments.length,l=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,n);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(l=(o<3?i(l):o>3?i(t,a,l):i(t,a))||l);return o>3&&l&&Object.defineProperty(t,a,l),l};Object.defineProperty(a,"__esModule",{value:!0});const o=e("../../../bundles/lobby/src/common/BaseDialog"),l=e("../../../bundles/lobby/src/common/GlobalApp"),r=e("../../../bundles/lobby/src/common/ConfigClient"),{ccclass:c,property:s}=cc._decorator;let d=n=class extends o.default{static getInstance(){return this.instance}static show(e){null==this.instance||null==this.instance.node?l.default.getInstance().loadPrefabByBundle(r.default.Bundle.BUNDLE_NAME.BLACKJACK,"res/prefabs/BlackJackRuleDialog",(t,a)=>{if(null!=t)return void l.default.getInstance().alertDialog.showMessage(t);let i=cc.instantiate(a);i.parent=e,this.instance=i.getComponent(n),this.instance.node.zIndex=1e3,this.instance.show()}):(this.instance.node.zIndex=1e3,this.instance.show())}};d.instance=null,d=n=i([c],d),a.default=d,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}],BlackJack:[function(e,t){"use strict";cc._RF.push(t,"890fcEriBNGg5GoT3Or4ur5","BlackJack");var a=N(e("../../lobby/src/audio/AudioController")),n=N(e("../../lobby/src/common/GlobalApp")),i=N(e("../../lobby/src/language/LanguageController")),o=N(e("../../lobby/src/common/Utils")),l=e("../../lobby/src/dialogs/banner/BannerDialog"),r=e("../../lobby/src/common/Constants"),c=N(e("../../lobby/src/game/GamePresenter")),s=N(e("../../lobby/src/common/User")),d=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=C(void 0);if(t&&t.has(e))return t.get(e);var a={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(a,i,o):a[i]=e[i]}return a.default=e,t&&t.set(e,a),a}(e("../../lobby/src/dialogs/option/OptionDialog")),u=N(e("../../lobby/src/dialogs/chatingame/ChatInGameDialog")),h=N(e("../../lobby/src/chat/ChatPresenter")),p=N(e("./BlackJackRuleDialog")),f=N(e("../../lobby/src/network/NetworkClient")),y=N(e("../../lobby/src/common/ConfigClient")),m=N(e("../../lobby/src/scripts/ingame/BubbleChat")),b=N(e("../../lobby/src/scripts/ingame/PlayerCasino")),g=N(e("../../lobby/src/scripts/ingame/Card"));function C(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(C=function(e){return e?a:t})(e)}function N(e){return e&&e.__esModule?e:{default:e}}function v(){return(v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var P=e("BlackJackPresenter"),k=cc.Class({extends:cc.Component,properties:{chips:{default:[],type:cc.Node},nodeChips:{default:[],type:cc.Node},user_avt:{default:null,type:cc.Sprite},user_avt_border:{default:null,type:cc.Sprite},user_name:{default:null,type:cc.Label},user_wallet:{default:null,type:cc.Label},btnCancel:{default:null,type:cc.Button},btnDeal:{default:null,type:cc.Button},lbPrepareTime:{default:null,type:cc.Label},nodeUsers:{default:[],type:cc.Node},nodeMyChipN01:{default:null,type:cc.Label},nodeMyChipN02:{default:null,type:cc.Label},nodePlayerChipN01:{default:[],type:cc.Label},nodePlayerChipN02:{default:[],type:cc.Label},nodeMyInsurance:{default:null,type:cc.Node},nodePlayerInsurance:{default:[],type:cc.Node},popupInsurance:{default:null,type:cc.Node},nodeBanker:{default:null,type:cc.Node},nodeMyCardsN01:{default:null,type:cc.Node},nodeMyCardsN02:{default:null,type:cc.Node},nodeBoxMyCardsN02:{default:null,type:cc.Node},nodePlayerCardsN01:{default:[],type:cc.Node},nodePlayerCardsN02:{default:[],type:cc.Node},nodeBoxPlayerCardsN02:{default:[],type:cc.Node},lbPointBanker:{default:null,type:cc.Label},lbMyPointN01:{default:null,type:cc.Label},lbMyPointN02:{default:null,type:cc.Label},lbPlayerPointN01:{default:[],type:cc.Label},lbPlayerPointN02:{default:[],type:cc.Label},specialCardBanker:{default:null,type:cc.Sprite},specialMyCardN01:{default:null,type:cc.Sprite},specialMyCardN02:{default:null,type:cc.Sprite},animationMyCardN01:{default:null,type:sp.Skeleton},animationMyCardN02:{default:null,type:sp.Skeleton},specialPlayerCardN01:{default:[],type:cc.Sprite},specialPlayerCardN02:{default:[],type:cc.Sprite},waitingBetAnim:{default:[],type:sp.Skeleton},animationPlayerCardN01:{default:[],type:sp.Skeleton},animationPlayerCardN02:{default:[],type:sp.Skeleton},spriteBust:{default:null,type:cc.SpriteFrame},spriteBlackJack:{default:null,type:cc.SpriteFrame},nodePlay:{default:null,type:cc.Node},btnsPlay:{default:[],type:cc.Button},myBetTime:{default:null,type:cc.ProgressBar},playerBetTime:{default:[],type:cc.ProgressBar},cardPrefab:{default:null,type:cc.Prefab},lbWin:{default:null,type:cc.Label},lbChip:{default:null,type:cc.Label},fontWin:{default:null,type:cc.Font},winPopup:{default:null,type:cc.Node},bgResult:{default:null,type:cc.Node},animResult:{default:null,type:sp.Skeleton},bgBlackJack:{default:null,type:cc.Node},animResultWin:{default:null,type:sp.SkeletonData},spriteFrameExitMatch:{default:null,type:cc.SpriteFrame},spriteFrameChangeMatch:{default:null,type:cc.SpriteFrame},icBack:{default:null,type:cc.Node},lbInfo:{default:null,type:cc.Label},bubbleChatPrefab:cc.Prefab,bgThrow:{default:null,type:cc.Node},lbMinMaxBet:{default:null,type:cc.Label},insuranceBetTime:{default:null,type:cc.ProgressBar},lbinsuranceBetTime:{default:null,type:cc.Label},animWow:{default:null,type:sp.SkeletonData},animNoBai:{default:null,type:sp.SkeletonData},animWin:{default:null,type:sp.SkeletonData},nodeLabelMyChipN01:{default:null,type:cc.Label},nodeLabelPlayerChipN01:{default:[],type:cc.Label},thu_bai_pos:{default:null,type:cc.Node},chia_bai_pos:{default:null,type:cc.Node},thu_chip_pos:{default:null,type:cc.Node},anim_dongho:{default:null,type:sp.Skeleton},chipAnim:{default:null,type:sp.SkeletonData},chipPrefab:{default:null,type:cc.Prefab},tableAudio:{default:null,type:cc.AudioClip},playerPrefab:{default:null,type:cc.Prefab},bgPlayer:{default:null,type:cc.Node},playerScale:{default:.8,type:cc.Float},totalBetted:{default:0,type:cc.Float},betData:{default:{},type:cc.Json}},statics:{instance:null,getInstance:function(){return this.instance}},onLoad:function(){k.instance=this,e("BlackJackNetworkTransport").getInstance(),localStorage.setItem("isLeave","false"),a.default.getInstance().playMusic(this.tableAudio,!0),this.gameState=null,this.listBet=[100,200,500,1e3,5e3],this.loadListBet(),this.loadProfile(),this.totalDeal=0,this.users=[],this.playerCardsN01=new Map,this.playerCardsN02=new Map,this.bankerCards=[],this.isBet=!1,this.isInsuranceCountDown=!1,this.insuranceMaxTime=5,this.lastBets=0,this.totalBets=0,this.oldAction=null,this.deskData=null},start:function(){this.setMatchInfo()},onClickRule:function(){p.default.show(this.node)},loadListBet:function(){var e=this;this.listBet.forEach(function(t,a){e.chips[a].children[0].getComponent(cc.Label).string=o.default.formatBetNumber(t)}),this.lbMinMaxBet.string="MIN BET "+this.listBet[0]+" \t\t MAX BET "+this.listBet[this.listBet.length-1]},loadProfile:function(){this.nodeUsers[2].active=!0,this.nodeUsers[2].getComponent(b.default).setData({id:s.default.userId,user_name:s.default.displayName,wallet:s.default.accountChip,avatar_id:s.default.avatarId,vipLevel:s.default.vipLevel,sId:s.default.userSid}),this.user_name.string=s.default.displayName||"",this.user_wallet.string=o.default.formatBetNumber(s.default.accountChip),this.userChip=s.default.accountChip},resetChipBorder:function(){this.chips.forEach(function(e){e.children[1].active=!1})},setTotalDealLabel:function(){this.btnCancel.node.children[0].getComponent(cc.Label).string=o.default.formatBetNumber(this.totalDeal)||0,this.btnDeal.node.children[0].getComponent(cc.Label).string=o.default.formatBetNumber(this.totalDeal)||0},onClickChip:function(e,t){this.gameState===r.Game.GAME_STATE.PREPARE&&(this.totalDeal+=this.listBet[t],console.log(this.totalDeal),this.setTotalDealLabel(),this.btnCancel.interactable=!0,this.btnDeal.interactable=!0,this.resetChipBorder(),this.chips[t].children[1].active=!0)},onCancel:function(){this.totalDeal=0,this.setTotalDealLabel(),this.resetChipBorder(),this.btnCancel.interactable=!1,this.btnDeal.interactable=!1},onDeal:function(){if(this.gameState===r.Game.GAME_STATE.PREPARE){var t={user_id:s.default.userId,chips:this.totalDeal,code:0};this.totalBets+=this.totalDeal,console.log("bet data: ",t),e("BlackJackNetworkTransport").getInstance().sendBet(t),this.totalDeal=0,this.setTotalDealLabel(),this.resetChipBorder(),this.btnCancel.interactable=!1,this.btnDeal.interactable=!1}},onRebet:function(){if(!(this.gameState!==r.Game.GAME_STATE.PREPARE&&Number(this.lastBets)>0)){var t={user_id:s.default.userId,chips:this.lastBets,code:0};console.log("rebet: ",t),e("BlackJackNetworkTransport").getInstance().sendBet(t)}},onDouble:function(){if(this.gameState===r.Game.GAME_STATE.PREPARE){var t={user_id:s.default.userId,chips:this.totalBets,code:2};this.isBet||(t.chips=2*this.lastBets),this.totalBets+=t.chips,e("BlackJackNetworkTransport").getInstance().sendBet(t)}},setDataUser:function(e,t){console.log("setDataUser",t),e.getComponent(b.default).setData({id:t.id,user_name:t.userName,wallet:t.wallet,avatar_id:t.avatarId,vipLevel:t.vipLevel,sId:t.sid}),e.active=!0},onClickAction:function(t,a){this.btnsPlay.forEach(function(e){e.interactable=!1});var n={user_id:s.default.userId,code:Number(a)};if(this.deskData.inTurn&&1==n.code){var i=this["lbMyPointN0"+this.deskData.handN0].node.extra_data;this["lbMyPointN0"+this.deskData.handN0].string=i.maxPoint}e("BlackJackNetworkTransport").getInstance().sendAction(n)},onClickRejectInsurance:function(){this.popupInsurance.active=!1},onClickInsurance:function(){var t={user_id:s.default.userId,code:5};console.log("insurance bet: ",t),e("BlackJackNetworkTransport").getInstance().sendAction(t),this.popupInsurance.active=!1,this.bankerCards[1].runAction(cc.sequence(cc.scaleTo(.2,.7,.63),cc.rotateTo(.2,-15).easing(cc.easeCubicActionIn()),cc.rotateTo(.2,15).easing(cc.easeCubicActionIn()),cc.rotateTo(.2,-15).easing(cc.easeCubicActionIn()),cc.rotateTo(.2,15).easing(cc.easeCubicActionIn()),cc.rotateTo(.2,0).easing(cc.easeCubicActionIn()),cc.scaleTo(.2,.5,.47).easing(cc.easeCubicActionOut())))},resetNodeCardScale:function(){this.nodeMyCardsN01.scale=1,this.nodeMyCardsN02.scale=1},clearAllData:function(){this.onCancel(),this.deskData=null,this.lbPrepareTime.node.parent.active=!1,this.totalBetted=0,this.count=0,this.totalBets=0,this.isBet=!1,this.btnCancel.node.active=!0,this.btnDeal.node.active=!0,this.nodeMyChipN01.node.parent.active=!1,this.nodeMyChipN02.node.parent.active=!1,this.nodeBoxMyCardsN02.active=!1,this.nodeLabelMyChipN01.node.parent.active=!1,this.nodeMyInsurance.active=!1,this.waitingBetAnim.forEach(function(e){e.node.active=!1}),this.nodeBoxPlayerCardsN02.forEach(function(e){e.active=!1}),this.nodePlayerChipN01.forEach(function(e){e.node.parent.active=!1}),this.nodeLabelPlayerChipN01.forEach(function(e){e.node.parent.active=!1}),this.nodePlayerChipN02.forEach(function(e){e.node.parent.active=!1}),this.nodePlayerInsurance.forEach(function(e){e.active=!1}),this.playerCardsN01=new Map,this.playerCardsN02=new Map,this.bankerCards=[],this.nodeBanker.destroyAllChildren(),this.nodeMyCardsN01.destroyAllChildren(),this.nodeMyCardsN02.destroyAllChildren(),this.nodePlayerCardsN01.forEach(function(e){e.destroyAllChildren()}),this.nodePlayerCardsN02.forEach(function(e){e.destroyAllChildren()}),this.lbPointBanker.node.parent.active=!1,this.lbMyPointN01.node.parent.active=!1,this.lbMyPointN02.node.parent.active=!1,this.lbPlayerPointN01.forEach(function(e){e.node.parent.active=!1}),this.lbPlayerPointN02.forEach(function(e){e.node.parent.active=!1}),this.specialCardBanker.node.active=!1,this.specialMyCardN01.node.active=!1,this.specialMyCardN02.node.active=!1,this.specialPlayerCardN01.forEach(function(e){e.node.active=!1}),this.specialPlayerCardN02.forEach(function(e){e.node.active=!1}),this.btnsPlay.forEach(function(e){e.interactable=!1}),this.nodePlay.active=!1,this.nodeChips.forEach(function(e){e.active=!0}),this.inturnPlayerIndex=null,this.winPopup.active=!1,this.bgResult.active=!1},loadListPlayerSuccess:function(e){var t=this;console.log(e),this.users=e.players.filter(function(e){return e.id!==s.default.userId}),this.nodeUsers.forEach(function(e,a){a<2&&(e.active=!1,t.waitingBetAnim[a].node.active=!1)}),this.users.forEach(function(e,a){t.waitingBetAnim[a].node.active=!0,t.setDataUser(t.nodeUsers[a],e)}),console.log(this.users)},updateDesk:function(e){var t=this;if(this.deskData=e,e.error)return 1==e.error.errorType&&n.default.getInstance().alertDialog.showMessage(i.default.getInstance().getString("txt_not_enough_money_gl")),this.oldAction&&this.oldAction.forEach(function(e){t.btnsPlay[e-1].interactable=!0}),void console.log("updateDesk",e.error);if(this.nodePlay.active=!1,this.myBetTime.node.active=!1,this.timeInTurn=null,this.insuranceTurn=!1,this.playerBetTime.forEach(function(e){e.node.active=!1}),this.resetNodeCardScale(),e.playersBet.length&&e.playersBet.forEach(function(e){if(e.userId===s.default.userId)t.isBet=!0,t.nodeMyChipN01.string=o.default.formatBetNumber(e.first),t.setupChip(t.getPlayer(e.userId),t.nodeLabelMyChipN01,e.first),t.nodeMyChipN02.string=o.default.formatBetNumber(e.second),t.nodeMyChipN02.node.parent.active=o.default.formatBetNumber(e.second),t.nodeMyInsurance.children[1].getComponent(cc.Label).string=o.default.formatBetNumber(e.insurance),t.nodeMyInsurance.active=o.default.formatBetNumber(e.insurance);else{var a=t.users.findIndex(function(t){return t.id===e.userId});-1!==a&&(t.nodePlayerChipN01[a].string=o.default.formatBetNumber(e.first),t.nodePlayerChipN01[a].node.parent.active=o.default.formatBetNumber(e.first),t.waitingBetAnim[a].node.active=!1,t.setupChip(t.getPlayer(e.userId),t.nodeLabelPlayerChipN01[a],e.first),t.nodePlayerChipN02[a].string=o.default.formatBetNumber(e.second),t.nodePlayerChipN02[a].node.parent.active=o.default.formatBetNumber(e.second),t.nodePlayerInsurance[a].children[1].getComponent(cc.Label).string=o.default.formatBetNumber(e.insurance),t.nodePlayerInsurance[a].active=o.default.formatBetNumber(e.insurance))}}),e.isUpdateBet)if(e.bet.userId===s.default.userId){var a,l,r,c,d,u;this.isBet=!0;var h,p,f,y=this.getPlayer(e.bet.userId);s.default.accountChip=Number(null==(a=e.bet)?void 0:null==(l=a.balance)?void 0:l.amountChipCurrent),Number(null==(r=e.bet)?void 0:null==(c=r.balance)?void 0:c.amountChipAdd)<0&&(null==(h=y.getComponent(b.default))||h.showEffectFlyMoney2(Number(null==(p=e.bet)?void 0:null==(f=p.balance)?void 0:f.amountChipAdd),30,50,-40)),y.getComponent(b.default).updateWallet(Number(null==(d=e.bet)?void 0:null==(u=d.balance)?void 0:u.amountChipCurrent)),this.totalBetted=Number(e.bet.first)+Number(e.bet.second)+Number(e.bet.insurance),this.betData=e.bet,this.nodeMyChipN01.string=o.default.formatBetNumber(e.bet.first),this.nodeMyChipN01.node.parent.active=o.default.formatBetNumber(e.bet.first),this.setupChip(y,this.nodeLabelMyChipN01,e.bet.first),this.nodeMyChipN02.string=o.default.formatBetNumber(e.bet.second),this.nodeMyChipN02.node.parent.active=o.default.formatBetNumber(e.bet.second),this.nodeMyInsurance.children[1].getComponent(cc.Label).string=o.default.formatBetNumber(e.bet.insurance),this.nodeMyInsurance.active=o.default.formatBetNumber(e.bet.insurance)}else{var m=this.users.findIndex(function(t){return t.id===e.bet.userId});-1!==m&&(this.nodePlayerChipN01[m].string=o.default.formatBetNumber(e.bet.first),this.nodePlayerChipN01[m].node.parent.active=o.default.formatBetNumber(e.bet.first),this.waitingBetAnim[m].node.active=!1,this.setupChip(this.getPlayer(e.bet.userId),this.nodeLabelPlayerChipN01[m],e.bet.first),this.nodePlayerChipN02[m].string=o.default.formatBetNumber(e.bet.second),this.nodePlayerChipN02[m].node.parent.active=o.default.formatBetNumber(e.bet.second),this.nodePlayerInsurance[m].children[1].getComponent(cc.Label).string=o.default.formatBetNumber(e.bet.insurance),this.nodePlayerInsurance[m].active=o.default.formatBetNumber(e.bet.insurance))}if(e.isInsuranceTurnEnter&&this.isBet?(this.insuranceTurn=!0,this.isInsuranceCountDown=!1,this.popupInsurance.active=!0):this.popupInsurance.active=!1,e.inTurn){var g=this.users.findIndex(function(t){return t.id==e.inTurn});this.inturnPlayerIndex=g,console.log(" this.inturnPlayerIndex: ",this.inturnPlayerIndex),-1==g&&(this.oldAction=e.actions.actions,this.nodePlay.active=!0,this.nodeChips.forEach(function(e){e.active=!1}),e.actions.actions.forEach(function(e){t.btnsPlay[e-1].interactable=!0}),this["nodeMyCardsN0"+e.handN0].scale=1.3)}},setupChip:function(e,t,a){var n=this;if(this.gameState!=r.Game.GAME_STATE.RUN&&!(a<=0)){for(var i=0,l=this.listBet.length-1;l>=0;l--)if(Number(a)>=this.listBet[l]){i=l;break}var c=t.node.parent.parent.position,s=cc.instantiate(this.chipPrefab);s.scale=0,s.parent=this.bgThrow,s.position=e.position,s.zIndex=t.node.parent.zIndex-5;var d={spriteIndex:i,chip:this.listBet[i]};s.getComponent("BlackJackChip").setData(d),cc.tween(s).to(.25,{scale:1.2,position:cc.v2(c.x,c.y-63.651)}).call(function(){t.node.parent.scale=1}).to(.1,{scale:0}).call(function(){s.destroy()}).start(),cc.tween(t.node.parent).delay(.37).call(function(){t.string=o.default.formatBetNumber(n.listBet[i]),t.node.parent.getComponent(cc.Sprite).spriteFrame=n.chips[i].getComponent(cc.Sprite).spriteFrame,t.node.parent.active=!0}).to(.1,{scale:1.1}).to(.1,{scale:.9}).to(.1,{scale:1}).start()}},getPoint:function(e){return e.point>=20?e.point:e.pointCardA||e.point},updateDeal:function(e){var t=this;if(e.allPlayerHand[0])e.allPlayerHand.forEach(function(a){if(""==a.userId)a.first.cards.forEach(function(e){var a=cc.instantiate(t.cardPrefab);a.getComponent(g.default).showCardPusoy(),0==e.rank&&a.getComponent(g.default).hideCardPusoy(),a.getComponent(g.default).setData(e.rank,e.suit),a.scale=cc.v2(.5,.47),t.nodeBanker.addChild(a),t.bankerCards.push(a)}),t.lbPointBanker.string=a.first.point,t.lbPointBanker.node.parent.active=!0,1==a.first.type?(t.specialCardBanker.spriteFrame=t.spriteBust,t.specialCardBanker.node.active=!0):4==a.first.type&&(t.specialCardBanker.spriteFrame=t.spriteBlackJack,t.specialCardBanker.node.active=!0);else{var n=t.users.findIndex(function(e){return e.id==a.userId}),i=["first","second"];i.forEach(function(o){var l,r;null==(l=a[""+o])||null==(r=l.cards)||r.forEach(function(l){var r=cc.instantiate(t.cardPrefab);r.getComponent(g.default).showCardPusoy(),r.getComponent(g.default).setData(l.rank,l.suit),r.scale=.37;var c=o==i[0]?1:2;-1==n?(t["nodeMyCardsN0"+c].addChild(r),t["lbMyPointN0"+c].string=t.getPoint(a[""+o]),t["lbMyPointN0"+c].node.extra_data=v({},a[""+o]),t["lbMyPointN0"+c].node.parent.active=!0,t.nodeLabelMyChipN01.node.parent.active=!1,2==c&&(t.nodeBoxMyCardsN02.active=!0),21===Number(a[""+o].point)&&cc.tween(t["nodeMyCardsN0"+e.handN0]).call(function(){t["animationMyCardN0"+e.handN0].skeletonData=t.animWow,t["animationMyCardN0"+e.handN0].node.active=!0,t["animationMyCardN0"+e.handN0].animation="animation"}).delay(1).call(function(){t["animationMyCardN0"+e.handN0].node.active=!1,t["animationMyCardN0"+e.handN0].skeletonData=null}).start(),1==a[""+o].type?(t["specialMyCardN0"+c].spriteFrame=t.spriteBust,t["specialMyCardN0"+c].node.active=!0,cc.tween(t["nodeMyCardsN0"+e.handN0]).call(function(){t["animationMyCardN0"+e.handN0].skeletonData=t.animNoBai,t["animationMyCardN0"+e.handN0].animation="animation"}).delay(1).call(function(){t["animationMyCardN0"+e.handN0].skeletonData=null}).start()):4==a[""+o].type&&(t["specialMyCardN0"+c].spriteFrame=t.spriteBlackJack,t["specialMyCardN0"+c].node.active=!0)):(t["nodePlayerCardsN0"+c][n].addChild(r),t["lbPlayerPointN0"+c][n].string=t.getPoint(a[""+o]),t["lbPlayerPointN0"+c][n].node.extra_data=v({},a[""+o]),t["lbPlayerPointN0"+c][n].node.parent.active=!0,t.nodeLabelPlayerChipN01[n].node.parent.active=!1,2==c&&(t.nodeBoxPlayerCardsN02[n].active=!0),21===Number(a[""+o].point)&&cc.tween(t["nodePlayerCardsN0"+e.handN0]).call(function(){t["animationPlayerCardN0"+e.handN0][n].skeletonData=t.animWow,t["animationPlayerCardN0"+e.handN0][n].node.active=!0,t["animationPlayerCardN0"+e.handN0][n].animation="animation"}).delay(1).call(function(){t["animationPlayerCardN0"+e.handN0][n].node.active=!1,t["animationPlayerCardN0"+e.handN0][n].skeletonData=null}).start(),1==a[""+o].type?(t["specialPlayerCardN0"+c][n].spriteFrame=t.spriteBust,t["specialPlayerCardN0"+c][n].node.active=!0,cc.tween(t["nodePlayerCardsN0"+e.handN0]).call(function(){t["animationPlayerCardN0"+e.handN0][n].skeletonData=t.animNoBai,t["animationPlayerCardN0"+e.handN0][n].animation="animation"}).delay(1).call(function(){t["animationPlayerCardN0"+e.handN0][n].active=!1,t["animationPlayerCardN0"+e.handN0][n].skeletonData=null}).start()):4==a[""+o].type&&(t["specialPlayerCardN0"+c][n].spriteFrame=t.spriteBlackJack,t["specialPlayerCardN0"+c][n].node.active=!0));var s=t["playerCardsN0"+c].get(a.userId)||[];s.push(r),t["playerCardsN0"+c].set(a.userId,s)})})}});else if(this.nodePlay.active=!1,this.inturnPlayerIndex=null,this.myBetTime.node.active=!1,this.popupInsurance.active=!1,this.playerBetTime.forEach(function(e){e.node.active=!1}),this.scheduleOnce(function(){t.count=0},1),e.isBanker){this.resetNodeCardScale();for(var a=function(){var a=e.hand.first.cards[n];if(t.bankerCards[n])return t.bankerCards[n].getComponent(g.default).showCardPusoy(),0==a.rank&&t.bankerCards[n].getComponent(g.default).hideCardPusoy(),t.bankerCards[n].getComponent(g.default).setData(a.rank,a.suit),t.bankerCards[n].scale=cc.v2(.5,.47),n==e.hand.first.cards.length-1&&(t.lbPointBanker.string=e.hand.first.point,t.lbPointBanker.node.parent.active=!0,1==e.hand.first.type?(t.specialCardBanker.spriteFrame=t.spriteBust,t.specialCardBanker.node.active=!0):4==e.hand.first.type&&(t.specialCardBanker.spriteFrame=t.spriteBlackJack,t.specialCardBanker.node.active=!0)),"continue";var i=cc.instantiate(t.cardPrefab);i.getComponent(g.default).showCardPusoy(),0==a.rank&&i.getComponent(g.default).hideCardPusoy(),i.getComponent(g.default).setData(a.rank,a.suit),i.scale=cc.v2(.5,.47),t.bankerCards.push(i);var o=cc.instantiate(t.cardPrefab);o.getComponent(g.default).hideCardPusoy(),o.position=t.chia_bai_pos.position,o.active=!1,o.scale=cc.v2(.5,.47),o.parent=t.bgThrow,o.getComponent(g.default).setData(a.rank,a.suit),cc.tween(o).delay(.5*t.count).call(function(){o.position=t.chia_bai_pos.position,o.scaleX=.5,o.angle=68,o.active=!0}).to(.25,{position:cc.v2((t.chia_bai_pos.position.x+t.nodeBanker.position.x)/2,(t.chia_bai_pos.position.y+t.nodeBanker.position.y)/2),scaleX:0,angle:34}).call(function(){o.getComponent(g.default).showCardPusoy(),0==a.rank&&o.getComponent(g.default).hideCardPusoy()}).to(.25,{position:t.nodeBanker.position,scaleX:.5,angle:0}).call(function(){t.nodeBanker.addChild(i),t.lbPointBanker.string=e.hand.first.point,t.lbPointBanker.node.parent.active=!0,1==e.hand.first.type?(t.specialCardBanker.spriteFrame=t.spriteBust,t.specialCardBanker.node.active=!0):4==e.hand.first.type&&(t.specialCardBanker.spriteFrame=t.spriteBlackJack,t.specialCardBanker.node.active=!0),o.destroy()}).start(),t.count+=1},n=0;n<e.hand.first.cards.length;n++)a()}else for(var i=this.users.findIndex(function(t){return t.id==e.userId}),o=["first","second"],l=function(){var a=e.hand[""+o[e.handN0-1]].cards[r],n=t["playerCardsN0"+e.handN0].get(e.userId)||[];if(-1!=i&&n[r])return n[r].getComponent(g.default).showCardPusoy(),n[r].getComponent(g.default).setData(a.rank,a.suit),n[r].scale=.37,"continue";if(-1==i&&n[r])return n[r].getComponent(g.default).showCardPusoy(),n[r].getComponent(g.default).setData(a.rank,a.suit),n[r].scale=.37,"continue";var l=cc.instantiate(t.cardPrefab);l.getComponent(g.default).showCardPusoy(),l.getComponent(g.default).setData(a.rank,a.suit),l.scale=.37;var c=t["nodeMyCardsN0"+e.handN0].parent.position;-1!=i&&(c=t["nodePlayerCardsN0"+e.handN0][i].parent.position);var s=cc.instantiate(t.cardPrefab);s.getComponent(g.default).hideCardPusoy(),s.position=t.chia_bai_pos.position,s.active=!1,s.scale=cc.v2(.37,.37),s.parent=t.bgThrow,s.getComponent(g.default).setData(a.rank,a.suit),cc.tween(s).delay(.5*t.count).call(function(){s.position=t.chia_bai_pos.position,s.scaleX=.37,s.angle=68,s.active=!0}).to(.25,{position:cc.v2((t.chia_bai_pos.position.x+c.x)/2,(t.chia_bai_pos.position.y+c.y)/2),scaleX:0,angle:34}).call(function(){s.getComponent(g.default).showCardPusoy(),0==a.rank&&s.getComponent(g.default).hideCardPusoy()}).to(.25,{position:c,scaleX:.37,angle:0}).call(function(){-1==i?(console.log("handN0: ","nodeMyCardsN0"+e.handN0),t["nodeMyCardsN0"+e.handN0].addChild(l),t["lbMyPointN0"+e.handN0].string=t.getPoint(e.hand[""+o[e.handN0-1]]),t["lbMyPointN0"+e.handN0].node.extra_data=v({},e.hand[""+o[e.handN0-1]]),t["lbMyPointN0"+e.handN0].node.parent.active=!0,t.nodeLabelMyChipN01.node.parent.active=!1,2===e.handN0&&(t.nodeBoxMyCardsN02.active=!0),21===Number(e.hand[""+o[e.handN0-1]].point)&&cc.tween(t["nodeMyCardsN0"+e.handN0]).call(function(){t["animationMyCardN0"+e.handN0].skeletonData=t.animWow,t["animationMyCardN0"+e.handN0].node.active=!0,t["animationMyCardN0"+e.handN0].animation="animation"}).delay(1).call(function(){t["animationMyCardN0"+e.handN0].node.active=!1,t["animationMyCardN0"+e.handN0].skeletonData=null}).start(),1==e.hand[""+o[e.handN0-1]].type?(t["specialMyCardN0"+e.handN0].spriteFrame=t.spriteBust,t["specialMyCardN0"+e.handN0].node.active=!0,cc.tween(t["nodeMyCardsN0"+e.handN0]).call(function(){t["animationMyCardN0"+e.handN0].skeletonData=t.animNoBai,t["animationMyCardN0"+e.handN0].animation="animation"}).delay(1).call(function(){t["animationMyCardN0"+e.handN0].skeletonData=null}).start()):4==e.hand[""+o[e.handN0-1]].type&&(t["lbMyPointN0"+e.handN0].node.parent.active=!1,t["specialMyCardN0"+e.handN0].spriteFrame=t.spriteBlackJack,t["specialMyCardN0"+e.handN0].node.active=!0,cc.tween(t.bgBlackJack).call(function(){t.bgBlackJack.active=!0,t.bgBlackJack.children[0].getComponent(sp.Skeleton).animation="animation"}).delay(2).call(function(){t.bgBlackJack.active=!1,t.bgBlackJack.children[0].getComponent(sp.Skeleton).animation=null}).start())):(t["nodePlayerCardsN0"+e.handN0][i].addChild(l),t["lbPlayerPointN0"+e.handN0][i].string=t.getPoint(e.hand[""+o[e.handN0-1]]),t["lbPlayerPointN0"+e.handN0][i].node.parent.active=!0,t["lbPlayerPointN0"+e.handN0][i].node.extra_data=v({},e.hand[""+o[e.handN0-1]]),t.nodeLabelPlayerChipN01[i].node.parent.active=!1,2==e.handN0&&(t.nodeBoxPlayerCardsN02[i].active=!0),21===Number(e.hand[""+o[e.handN0-1]].point)&&cc.tween(t["nodePlayerCardsN0"+e.handN0]).call(function(){t["animationPlayerCardN0"+e.handN0][i].skeletonData=t.animWow,t["animationPlayerCardN0"+e.handN0][i].node.active=!0,t["animationPlayerCardN0"+e.handN0][i].animation="animation"}).delay(1).call(function(){t["animationPlayerCardN0"+e.handN0][i].node.active=!1,t["animationPlayerCardN0"+e.handN0][i].skeletonData=null}).start(),1==e.hand[""+o[e.handN0-1]].type?(t["specialPlayerCardN0"+e.handN0][i].spriteFrame=t.spriteBust,t["specialPlayerCardN0"+e.handN0][i].node.active=!0,cc.tween(t["nodePlayerCardsN0"+e.handN0]).call(function(){t["animationPlayerCardN0"+e.handN0][i].skeletonData=t.animNoBai,t["animationPlayerCardN0"+e.handN0][i].active=!0,t["animationPlayerCardN0"+e.handN0][i].animation="animation"}).delay(1).call(function(){t["animationPlayerCardN0"+e.handN0][i].active=!1,t["animationPlayerCardN0"+e.handN0][i].skeletonData=null}).start()):4==e.hand[""+o[e.handN0-1]].type&&(t["lbPlayerPointN0"+e.handN0][i].node.parent.active=!1,t["specialPlayerCardN0"+e.handN0][i].spriteFrame=t.spriteBlackJack,t["specialPlayerCardN0"+e.handN0][i].node.active=!0));var a=t["playerCardsN0"+e.handN0].get(e.userId)||[];a.push(l),t["playerCardsN0"+e.handN0].set(e.userId,a),s.destroy()}).start(),t.count++},r=0;r<e.hand[""+o[e.handN0-1]].cards.length;r++)l()},prepare:function(e){var t=this;this.lbPrepareTime.string=e.countDown,this.anim_dongho.animation="animation",this.lbPrepareTime.node.parent.active=!0,this.gameState!=r.Game.GAME_STATE.PREPARE&&(this.clearAllData(),this.leaveMatch(),this.gameState=r.Game.GAME_STATE.PREPARE,this.waitingBetAnim.forEach(function(e,a){t.nodeUsers[a].active&&(t.waitingBetAnim[a].node.active=!0)}))},countDown:function(e){this.anim_dongho.animation=null,this.lbPrepareTime.node.parent.active=!1,this.btnCancel.node.active=!1,this.btnDeal.node.active=!1,this.isInsuranceCountDown||(this.insuranceMaxTime=Number(e),this.isInsuranceCountDown=!0),this.insuranceTurn&&(console.log("countDown",Number(e),this.insuranceMaxTime),this.insuranceBetTime.progress=Number(e)/this.insuranceMaxTime,this.lbinsuranceBetTime.string=""+e),this.timeInTurn||null===this.inturnPlayerIndex||void 0===this.inturnPlayerIndex||(this.timelineprogress=e,this.timeInTurn=e)},reward:function(){},endGame:function(){},createChips:function(e,t,a){var n=new cc.Node,i=n.addComponent(sp.Skeleton);i.loop=!0,i.premultipliedAlpha=!1,i.skeletonData=this.chipAnim,i.animation="animation",n.setPosition(t),n.scale=.5,n.zIndex=40,this.bgThrow.addChild(n);var o=cc.v2((a.x+t.x)/2,(a.y+t.y)/2);cc.tween(n).to(e/2-.05,{position:o}).delay(.2).to(e/2-.05,{position:a}).call(function(){n.destroy()}).start()},flyChips:function(e,t,a,n){var i=this;void 0===n&&(n=function(){});for(var o=0;o<=e;o++)cc.tween(this.node).delay(.25*o).call(function(){i.createChips(1,t,a)}).start();this.scheduleOnce(function(){n()},.5*e+.25)},updateGameBalances:function(e){var t=this;console.log("balance: ",e),this.lastBets=this.totalBets,this.totalBets=0;var a=new Map;e.updates.forEach(function(e){a[e.userId]=e}),this.balances=a,this.balances[s.default.userId]&&(this.user_wallet.string=o.default.formatBetNumber(this.balances[s.default.userId].amountChipCurrent),this.nodeUsers[2].getComponent(b.default).updateWallet(this.balances[s.default.userId].amountChipCurrent),this.userChip=this.balances[s.default.userId].amountChipCurrent),cc.tween(this.node).delay(1).call(function(){Object.keys(t.balances).forEach(function(e){var a=t.getPlayer(e);console.log("this.balances",e,t.balances[e].amountChipAdd,a);var n=Number(t.balances[e].amountChipAdd)>0,i=Number(t.balances[e].totalChipInMatch)<0;n?t.flyChips(3,t.thu_chip_pos.position,a.position,function(){}):i&&t.flyChips(3,a.position,t.thu_chip_pos.position,function(){}),t.scheduleOnce(function(){var o,l,r;if(t.balances[e])if(n)null==(o=a.getComponent(b.default))||o.showEffectWinLose(1),e==s.default.userId?null==(l=a.getComponent(b.default))||l.showEffectFlyMoney2(Number(t.balances[e].amountChipAdd),30,50,-40):null==(r=a.getComponent(b.default))||r.showEffectFlyMoney2(Number(t.balances[e].amountChipAdd),30,50);else if(i){var c,d,u;null==(c=a.getComponent(b.default))||c.showEffectWinLose(-1),e==s.default.userId?null==(d=a.getComponent(b.default))||d.showEffectFlyMoney2(Number(t.balances[e].totalChipInMatch),30,50,-40):null==(u=a.getComponent(b.default))||u.showEffectFlyMoney2(Number(t.balances[e].totalChipInMatch),30,50)}},2)})}).delay(2).call(function(){t.lbPointBanker.node.parent.active=!1,t.lbMyPointN01.node.parent.active=!1,t.lbMyPointN02.node.parent.active=!1,t.lbPlayerPointN01.forEach(function(e){e.node.parent.active=!1}),t.lbPlayerPointN02.forEach(function(e){e.node.parent.active=!1}),t.specialCardBanker.node.active=!1,t.specialMyCardN01.node.active=!1,t.specialMyCardN02.node.active=!1,t.specialPlayerCardN01.forEach(function(e){e.node.active=!1}),t.specialPlayerCardN02.forEach(function(e){e.node.active=!1}),t.nodeMyChipN01.node.parent.active=!1,t.nodeMyChipN02.node.parent.active=!1,t.nodeBoxMyCardsN02.active=!1,t.nodeLabelMyChipN01.node.parent.active=!1,t.nodeMyInsurance.active=!1,t.nodeBoxPlayerCardsN02.forEach(function(e){e.active=!1}),t.nodePlayerChipN01.forEach(function(e){e.node.parent.active=!1}),t.nodeLabelPlayerChipN01.forEach(function(e){e.node.parent.active=!1})}).call(function(){t.bgResult.active=!1;for(var e=function(e){if(!t.bankerCards[e].active)return"continue";var a=cc.instantiate(t.cardPrefab);a.getComponent(g.default).setData(t.bankerCards[e].getComponent(g.default).data.rank,t.bankerCards[e].getComponent(g.default).data.suit),a.position=t.nodeBanker.position,a.parent=t.bgThrow,a.scale=.4,a.active=!1,cc.tween(a).delay(.4*e).call(function(){a.position=t.nodeBanker.position,a.angle=0,a.active=!0,t.bankerCards[e]&&(t.bankerCards[e].active=!1)}).to(.2,{position:cc.v2((t.thu_bai_pos.position.x+t.nodeBanker.position.x)/2,(t.thu_bai_pos.position.y+t.nodeBanker.position.y)/2),scaleX:0,angle:34}).call(function(){a.getComponent(g.default).hideCardPusoy()}).to(.2,{position:t.thu_bai_pos.position,scaleX:.4,angle:68}).call(function(){a.destroy()}).start()},a=t.bankerCards.length-1;a>=0;a--)e(a)}).delay(2).call(function(){for(var e=Array.from(t.playerCardsN01.keys()),a=function(){for(var a=t.getPlayerIndex(n),i=t.playerCardsN01.get(e[n])||[],o=function(){var o=o,l=cc.instantiate(t.cardPrefab);l.getComponent(g.default).setData(i[o].getComponent(g.default).data.rank,i[o].getComponent(g.default).data.suit),l.parent=t.bgThrow,l.scale=.4,l.active=!1;var r=t.nodeMyCardsN01.parent.position;e[n]!==s.default.userId&&(r=t.nodePlayerCardsN01[a].parent.position),l.position=r,cc.tween(l).delay(.4*o+.4*n).call(function(){l.position=r,l.angle=0,l.active=!0,i[o]&&(i[o].active=!1)}).to(.2,{position:cc.v2((t.thu_bai_pos.position.x+r.x)/2,(t.thu_bai_pos.position.y+r.y)/2),scaleX:0,angle:34}).call(function(){l.getComponent(g.default).hideCardPusoy()}).to(.2,{position:t.thu_bai_pos.position,scaleX:.4,angle:68}).call(function(){l.destroy()}).start()},l=0;l<i.length;l++)o()},n=0;n<e.length;n++)a();for(var i=Array.from(t.playerCardsN02.keys()),o=function(){for(var e=t.getPlayerIndex(l),a=t.playerCardsN02.get(i[l])||[],n=function(){var n=n,o=cc.instantiate(t.cardPrefab);o.getComponent(g.default).setData(a[n].getComponent(g.default).data.rank,a[n].getComponent(g.default).data.suit),o.parent=t.bgThrow,o.scale=.4,o.active=!1;var r=t.nodeMyCardsN02.parent.position;i[l]!==s.default.userId&&(r=t.nodePlayerCardsN02[e].parent.position),o.position=r,cc.tween(o).delay(.4*n+.8*l).call(function(){o.position=r,o.angle=0,o.active=!0,a[n]&&(a[n].active=!1)}).to(.2,{position:cc.v2((t.thu_bai_pos.position.x+r.x)/2,(t.thu_bai_pos.position.y+r.y)/2),scaleX:0,angle:34}).call(function(){o.getComponent(g.default).hideCardPusoy()}).to(.2,{position:t.thu_bai_pos.position,scaleX:.4,angle:68}).call(function(){o.destroy()}).start()},o=0;o<a.length;o++)n()},l=0;l<i.length;l++)o()}).delay(3).call(function(){t.clearAllData()}).start()},setMatchInfo:function(){h.default.getInstance().joinChatRoom(n.default.getInstance().matchInfo.match_id,this);var e=JSON.parse(n.default.getInstance().matchInfo.label),t=e.tableId.slice(0,5);e.tableId.length>5&&(t+="..."),this.lbInfo.string="ID: "+t,localStorage.setItem("isLeave","false"),localStorage.setItem("isChangeMatch","false"),this.listBet=[1,5,10,50,100].map(function(t){return t*e.markUnit}),this.loadListBet(),(e.gameState===r.Game.GAME_STATE.RUN||r.Game.GAME_STATE.PREPARE)&&(new P).syncTable()},onMenuClick:function(){d.default.show(this,d.DialogPosition.RIGHT)},leaveMatch:function(){var t=this;"true"===localStorage.getItem("isLeave")?(l.BannerData.setBannerData(r.Banner.ShowType.LEFT_MATCH,!0),e("BlackJackNetworkTransport").getInstance().onQuit()):"true"===localStorage.getItem("isChangeMatch")&&(this.icBack.active=!1,e("BlackJackNetworkTransport").getInstance().onQuit(function(){t.clearAllData(),cc.Tween.stopAllByTarget(t.node),t.unscheduleAllCallbacks(),setTimeout(function(){var e=JSON.parse(n.default.getInstance().matchInfo.label);c.default.changeMatch(e.markUnit,n.default.getInstance().matchInfo)},2)},!1))},onChangeMatch:function(){var t=this;this.gameState===r.Game.GAME_STATE.RUN||this.gameState===r.Game.GAME_STATE.REWARD?(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameChangeMatch,this.icBack.scale=.5,"true"===localStorage.getItem("isChangeMatch")?(this.icBack.active=!1,localStorage.setItem("isChangeMatch","false"),n.default.getInstance().toast.showToast(i.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isChangeMatch","true"),n.default.getInstance().toast.showToast(i.default.getInstance().getString("wait_game_end_to_leave")))):e("BlackJackNetworkTransport").getInstance().onQuit(function(){n.default.getInstance().showProcessing(!0),t.clearAllData(),cc.Tween.stopAllByTarget(t.node),t.unscheduleAllCallbacks(),setTimeout(function(){var e=JSON.parse(n.default.getInstance().matchInfo.label);c.default.changeMatch(e.markUnit,n.default.getInstance().matchInfo)},2)},!1)},onAvtClick:function(e,t){var a,n,i,o,l,c;this.gameState!==r.Game.GAME_STATE.SPECTATING&&(this.playerInfo={id:null==(a=this.nodeUsers[t])?void 0:a.getComponent(b.default).id,name:null==(n=this.nodeUsers[t])?void 0:n.getComponent(b.default).user_name,chip:null==(i=this.nodeUsers[t])?void 0:i.getComponent(b.default).wallet,avatar_id:null==(o=this.nodeUsers[t])?void 0:o.getComponent(b.default).avatar_id,vipLevel:(null==(l=this.nodeUsers[t])?void 0:l.getComponent(b.default).vipLevel)||0,sid:(null==(c=this.nodeUsers[t])?void 0:c.getComponent(b.default).sid)||""})},getPlayerIndex:function(e){for(var t=-1,a=0;a<this.nodeUsers.length;a++)this.nodeUsers[a].active&&this.nodeUsers[a].getComponent(b.default).id===e&&(t=a);return t},getPlayer:function(e){return this.nodeUsers[this.getPlayerIndex(e)]},throwIcons:function(e){var t=this,a=this.getPlayerIndex(e.sender_id),n=this.getPlayerIndex(e.throw.to_id);a==n?this.nodeUsers.forEach(function(n,i){nodeUsers.active&&n.getComponent(b.default).id!==e.sender_id&&t.createIconAndThrow(e.throw.iconIndex,a,i)}):this.createIconAndThrow(e.throw.iconIndex,a,n)},createIconAndThrow:function(e,t,a){var n=this;console.log("createIconAndThrow",e,t,a);var i=new cc.Node,o=i.addComponent(cc.Sprite),l=h.default.getInstance().getThrowIcon(e);o.spriteFrame=l,i.setPosition(this.nodeUsers[t].position),this.bgThrow.addChild(i),cc.tween(i).to(.5,{position:this.nodeUsers[a].position}).call(function(){i.destroy();var t=new cc.Node,o=t.addComponent(sp.Skeleton);o.skeletonData=h.default.getInstance().getThrowAnimation(e),o.animation="animation",o.loop=!1,o.premultipliedAlpha=!1,n.nodeUsers[a].addChild(t),n.scheduleOnce(function(){t.destroy()},3)}).start()},onChatClick:function(){this.gameState!==r.Game.GAME_STATE.SPECTATING&&u.default.show()},showChat:function(e){var t=this.getPlayerIndex(e.sender_id),a=e.message,n=cc.instantiate(this.bubbleChatPrefab);n.getComponent(m.default).setData(a),this.nodeUsers[t].addChild(n),this.scheduleOnce(function(){n.destroy()},3)},showEmoji:function(e){console.log("showEmoji",e);var t=h.default.getInstance().getEmojiByTypeAndIndex(e.emoji.type,e.emoji.index).value,a=this.getPlayerIndex(e.sender_id),n=new cc.Node,i=n.addComponent(sp.Skeleton);i.skeletonData=t,i.animation="animation",i.premultipliedAlpha=!1,"F"==e.emoji.type&&(n.scale=.6),n.position=cc.v2(-39.017,0),this.nodeUsers[a].addChild(n),this.scheduleOnce(function(){n.destroy()},2)},onQuit:function(){this.gameState!==r.Game.GAME_STATE.RUN&&this.gameState!==r.Game.GAME_STATE.REWARD&&this.gameState!==r.Game.GAME_STATE.PREPARE||!this.isBet?(l.BannerData.setBannerData(r.Banner.ShowType.LEFT_MATCH,!0),e("BlackJackNetworkTransport").getInstance().onQuit()):(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameExitMatch,this.icBack.scale=1,"true"===localStorage.getItem("isLeave")?(this.icBack.active=!1,localStorage.setItem("isLeave","false"),n.default.getInstance().toast.showToast(i.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isLeave","true"),n.default.getInstance().toast.showToast(i.default.getInstance().getString("wait_game_end_to_leave"))))},update:function(e){if(this.gameState==r.Game.GAME_STATE.RUN&&null!==this.inturnPlayerIndex&&void 0!==this.inturnPlayerIndex){if(-1==this.inturnPlayerIndex)return this.timelineprogress-=e,this.myBetTime.progress=this.timelineprogress/this.timeInTurn,void(this.myBetTime.node.active=!0);this.timelineprogress-=e,this.playerBetTime[this.inturnPlayerIndex].progress=this.timelineprogress/this.timeInTurn,this.playerBetTime[this.inturnPlayerIndex].node.active=!0}},getPlayerNodeUserId:function(e){for(var t=0;t<this.bgPlayer.children.length;t++)if(this.bgPlayer.children[t].active&&this.bgPlayer.children[t].getComponent(b.default)&&this.bgPlayer.children[t].getComponent(b.default).id==e)return this.bgPlayer.children[t];return null},getPlayerInfoByUserId:function(e){console.log("getPlayerInfoByUserId",e);for(var t=0;t<this.bgPlayer.children.length;t++){if(this.bgPlayer.children[t].active&&this.bgPlayer.children[t].getComponent(b.default)&&this.bgPlayer.children[t].getComponent(b.default).id==e)return this.bgPlayer.children[t].getComponent(b.default).getInfo();console.log(b.default,this.bgPlayer.children[t])}return null},reloadListPlayer:function(e){var t=this,a=this.bgPlayer.children.length-1;this.bgPlayer.children.forEach(function(t,n){if(t.active&&(n!==a||t.getComponent(b.default))){for(var i=0;i<e.players.length;i++)if(e.players[i].id==t.getComponent(b.default).id)return;t.active=!1}}),this.bgPlayer.children[a].active&&!this.bgPlayer.children[a].getComponent(b.default)&&e.players.length<=a+1&&(this.bgPlayer.children[a].active=!1),e.players.forEach(function(a){if(a.id!==s.default.userId){for(var n=!1,i=0;i<t.bgPlayer.children.length;i++){var o;if(t.bgPlayer.children[i].active&&a.id==(null==(o=t.bgPlayer.children[i].getComponent(b.default))?void 0:o.id)){n=!0;break}}n||t.updatePlayer(a,e.players.length)}})},getNextIndex:function(){for(var e=0;e<this.bgPlayer.children.length;e++)if(!this.bgPlayer.children[e].active)return this.bgPlayer.children[e].scale=this.playerScale,e;return-1},updatePlayer:function(e,t){var a=this.getNextIndex();if(console.log("updatePlayer",a,e),-1!=a&&(this.bgPlayer.children[a].active=!0),a==this.bgPlayer.children.length-1||-1==a){if(!this.bgPlayer.children[this.bgPlayer.children.length-1].getComponent(b.default))return a=this.bgPlayer.children.length-1,void(this.bgPlayer.children[a].children[0].getComponent(cc.Label).string="+"+(t-this.bgPlayer.children.length));if(-1==a)return}this.bgPlayer.children[a].getComponent(b.default).setData({id:null==e?void 0:e.id,user_name:null==e?void 0:e.userName,wallet:null==e?void 0:e.wallet,avatar_id:null==e?void 0:e.avatarId,vipLevel:null==e?void 0:e.vipLevel,sId:null==e?void 0:e.sid}),this.bgPlayer.children[a].getChildByName("avatar").getComponent(cc.Button)||(this.bgPlayer.children[a].getChildByName("avatar").addComponent(cc.Button),this.bgPlayer.children[a].getChildByName("avatar").getComponent(cc.Button).target=this.bgPlayer.children[a]);var n=new cc.Component.EventHandler;n.target=this.node,n.component=this.node._name,n.handler="profileClick",n.customEventData=null==e?void 0:e.id,this.bgPlayer.children[a].getChildByName("avatar").getComponent(cc.Button).clickEvents=[n]},profileClick:function(e){e.target.parent.getComponent(b.default).showPlayerInfo()},reloadProfileInfo:function(){f.default.getInstance().rpcCall(y.default.Network.RPC_ID.GET_PROFILE,{}).then(function(e){console.log("profile: ",e.payload),s.default.init(e.payload)},function(e){console.log("err when get PROFILE ",e)})}});cc._RF.pop()},{"../../lobby/src/audio/AudioController":void 0,"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/chatingame/ChatInGameDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/game/GamePresenter":void 0,"../../lobby/src/language/LanguageController":void 0,"../../lobby/src/network/NetworkClient":void 0,"../../lobby/src/scripts/ingame/BubbleChat":void 0,"../../lobby/src/scripts/ingame/Card":void 0,"../../lobby/src/scripts/ingame/PlayerCasino":void 0,"./BlackJackRuleDialog":"BlackJackRuleDialog",BlackJackNetworkTransport:"BlackJackNetworkTransport",BlackJackPresenter:"BlackJackPresenter"}]},{},["BlackJack","BlackJackChip","BlackJackNetworkTransport","BlackJackPresenter","BlackJackRuleDialog"]);