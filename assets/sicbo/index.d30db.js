window.__require=function t(e,n,a){function i(l,s){if(!n[l]){if(!e[l]){var c=l.split("/");if(c=c[c.length-1],!e[c]){var r="function"==typeof __require&&__require;if(!s&&r)return r(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+l+"'")}l=c}var h=n[l]={exports:{}};e[l][0].call(h.exports,function(t){return i(e[l][1][t]||t)},h,h.exports,t,e,n,a)}return n[l].exports}for(var o="function"==typeof __require&&__require,l=0;l<a.length;l++)i(a[l]);return i}({SicboChip:[function(t,e){"use strict";cc._RF.push(e,"2850dkL+RFEJYka/MIHzKj7","SicboChip");var n,a=(n=t("../../lobby/src/common/Utils"))&&n.__esModule?n:{default:n};cc.Class({extends:cc.Component,properties:{sprite:{default:null,type:cc.Sprite},label:{default:null,type:cc.Label},chipSprites:{default:[],type:cc.SpriteFrame},chip:0},setData:function(t){this.sprite.spriteFrame=this.chipSprites[t.spriteIndex],this.label.string=a.default.formatBetNumber(t.chip)||0,this.chip=t.chip||0}}),cc._RF.pop()},{"../../lobby/src/common/Utils":void 0}],SicboHistoryDialog:[function(t,e,n){"use strict";cc._RF.push(e,"901e1Xg6FZNoosSFCcjpIXX","SicboHistoryDialog");var a,i=this&&this.__decorate||function(t,e,n,a){var i,o=arguments.length,l=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,a);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(l=(o<3?i(l):o>3?i(e,n,l):i(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};Object.defineProperty(n,"__esModule",{value:!0});const o=t("../../../bundles/lobby/src/common/GlobalApp"),l=t("../../../bundles/lobby/src/common/ConfigClient"),s=t("../../../bundles/lobby/src/common/BaseDialog"),{ccclass:c,property:r}=cc._decorator;let h=a=class extends s.default{constructor(){super(...arguments),this.sprTrang=null,this.sprTrangTop=null,this.lbNumberSmallTop=null,this.lbNumberBigTop=null,this.lbNumberSmall=null,this.lbNumberBig=null,this.listSpriteFrameItemHistory=[],this.tableItemHistory=null,this.scrResult=null,this.numberSmall=0,this.numberBig=0,this.totalBet=0,this.HISTORY_OLD_VALUE=null,this.HISTORY_COT=0,this.HISTORY_HANG=0,this.historyArray=[],this.listItemHistory=null}static getInstance(){return this.instance}static show(t,e){null==this.instance||null==this.instance.node?o.default.getInstance().loadPrefabByBundle(l.default.Bundle.BUNDLE_NAME.SICBO,"res/prefabs/SicboHistoryDialog",(n,i)=>{if(null!=n)return void o.default.getInstance().alertDialog.showMessage(n);let l=cc.instantiate(i);l.parent=t,this.instance=l.getComponent(a),this.instance.node.zIndex=1e3,this.instance.showHistory(e)}):(this.instance.node.zIndex=1e3,this.instance.showHistory(e))}showHistory(t){this.show(),this.handleDataHistory(t)}start(){this.numberSmall=0,this.numberBig=0,this.totalBet=0,this.resetIndex(),this.scrResult.content.destroyAllChildren(),this.tableItemHistory.destroyAllChildren()}handleDataHistory(t){let e=0,n=[];for(let o=0;o<t.length;o++){const a=t[o];for(let t=0;t<a.length;t++){const n=a[t];e+=parseInt(n.toString())}n.push(e),e=0}for(let o=0;o<n.length;o++)n[o]>10?this.numberBig++:this.numberSmall++,this.totalBet++;let a=0,i=0;0!=this.totalBet&&(a=this.numberBig/this.totalBet*100,i=this.numberSmall/this.totalBet*100),this.sprTrang.fillRange=i/100,this.lbNumberBig.string=Math.ceil(a).toString()+"%",this.lbNumberSmall.string=Math.floor(i).toString()+"%";for(let o=0;o<n.length;o++)n[o]>10?this.genIndexHistory(1):this.genIndexHistory(0);this.listItemHistory=new Array(this.HISTORY_COT+1);for(let o=0;o<this.listItemHistory.length;o++)this.listItemHistory[o]=new Array(5);this.resetIndex();for(let o=0;o<n.length;o++){const t=n[o];t>10?this.creatItemHistory(1,t):this.creatItemHistory(0,t)}this.setPositionItem();for(let o=0;o<n.length;o++){const t=n[o];let e=new cc.Node;e.addComponent(cc.Sprite),e.getComponent(cc.Sprite).spriteFrame=t>10?this.listSpriteFrameItemHistory[1]:this.listSpriteFrameItemHistory[0],this.scrResult.content.addChild(e)}}creatItemHistory(t,e){let n=new cc.Node("itemHistory");n.height=n.width=670/19;let a=new cc.Node("icon").addComponent(cc.Sprite);a.node.parent=n,a.spriteFrame=this.listSpriteFrameItemHistory[t],a.node.x=0,a.node.y=-3;let i=new cc.Node("nodeLabel"),o=i.addComponent(cc.Label);o.string=e.toString(),o.fontSize=15,o.lineHeight=20,o.horizontalAlign=cc.Label.HorizontalAlign.CENTER,o.verticalAlign=cc.Label.VerticalAlign.CENTER,e>10?(o.node.color=new cc.Color(255,255,255),n._tag=1):(o.node.color=new cc.Color(0,0,0),n._tag=0),i.setPosition(cc.v2(0,0)),n.addChild(i),this.genIndexHistory(t),this.listItemHistory[this.HISTORY_COT][this.HISTORY_HANG]=n}setPositionItem(){this.resetIndex(),console.log("this.history length = ",this.listItemHistory);let t=0;for(let a=this.listItemHistory.length>=19?this.listItemHistory.length-19:0;a<this.listItemHistory.length;a++){for(let e=0;e<this.listItemHistory[a].length;e++){const n=this.listItemHistory[a][e];void 0!==n&&(this.genIndexHistory(n._tag),n._tag,this.tableItemHistory.addChild(n),n.x=(t-9)*n.width,n.y=(2-e)*n.height)}t++}let e=0,n=0;0!=this.totalBet&&(e=this.numberBig/this.totalBet*100,n=this.numberSmall/this.totalBet*100),this.sprTrangTop.fillRange=n/100,this.lbNumberBigTop.string=Math.ceil(e).toString()+"%",this.lbNumberSmallTop.string=Math.floor(n).toString()+"%"}resetIndex(){this.setup2dArray(),this.HISTORY_OLD_VALUE=null,this.HISTORY_COT=0,this.HISTORY_HANG=0}genIndexHistory(t){if(null==this.HISTORY_OLD_VALUE)this.HISTORY_HANG=0,this.HISTORY_COT=0,this.HISTORY_OLD_VALUE=t,this.historyArray[this.HISTORY_HANG][this.HISTORY_COT]=1;else if(t==this.HISTORY_OLD_VALUE&&this.HISTORY_HANG<4)this.HISTORY_HANG++,this.historyArray[this.HISTORY_HANG][this.HISTORY_COT]=1,this.HISTORY_OLD_VALUE=t;else{for(let t=0;t<this.historyArray[0].length;t++)if(0==this.historyArray[0][t]){this.HISTORY_COT=t;break}this.HISTORY_HANG=0,this.HISTORY_OLD_VALUE=t,this.historyArray[this.HISTORY_HANG][this.HISTORY_COT]=1}}setup2dArray(){this.historyArray=new Array(5);for(let t=0;t<this.historyArray.length;t++)this.historyArray[t]=new Array(200);for(let t=0;t<5;t++)for(let e=0;e<200;e++)this.historyArray[t][e]=0}convertArrayIndexToPosition(t,e){return cc.v2(2.5+36.2*t,-36.1*e-3.5)}};h.instance=null,i([r(cc.Sprite)],h.prototype,"sprTrang",void 0),i([r(cc.Sprite)],h.prototype,"sprTrangTop",void 0),i([r(cc.Label)],h.prototype,"lbNumberSmallTop",void 0),i([r(cc.Label)],h.prototype,"lbNumberBigTop",void 0),i([r(cc.Label)],h.prototype,"lbNumberSmall",void 0),i([r(cc.Label)],h.prototype,"lbNumberBig",void 0),i([r([cc.SpriteFrame])],h.prototype,"listSpriteFrameItemHistory",void 0),i([r(cc.Node)],h.prototype,"tableItemHistory",void 0),i([r(cc.ScrollView)],h.prototype,"scrResult",void 0),h=a=i([c],h),n.default=h,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}],SicboNetworkTransport:[function(t,e){"use strict";cc._RF.push(e,"7f3d8+Qkj1Ia5L5CwjJoVJw","SicboNetworkTransport");var n=s(t("../../lobby/src/common/ConfigClient")),a=t("../../lobby/src/common/Constants"),i=s(t("../../lobby/src/network/NetworkClient")),o=s(t("../../lobby/src/common/GlobalApp")),l=s(t("../../lobby/src/chat/ChatPresenter"));function s(t){return t&&t.__esModule?t:{default:t}}var c=cc.Class({extends:cc.Component,properties:{instance:null},statics:{getInstance:function(){return null==this.instance&&(this.instance=new c,i.default.getInstance().subscribeEventHandler(a.Game.Enum.SICBO,this.instance)),this.instance}},matchDataHandler:function(e){switch(e.op_code){case n.default.Network.OP_CODE.OPCODE_UPDATE_TABLE:cc.log("OPCODE_UPDATE_TABLE",e.data),t("Sicbo").getInstance().updateDesk(e.data);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_GAME_STATE:this.processUpdateGameState(e);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_FINISH:cc.log("result",e),t("Sicbo").getInstance().endGame(e.data);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_WALLET:cc.log("wallet",e),t("Sicbo").getInstance().updateGameBalances(e.data);break;case n.default.Network.OP_CODE.OPCODE_KICK_OFF_THE_TABLE:cc.log("kick off",e),this.onQuit();break;case n.default.Network.OP_CODE.OPCODE_LIST_PLAYER:cc.log("OPCODE_LIST_PLAYER",e),t("Sicbo").getInstance().reloadListPlayer(e.data);break;default:cc.log("Data code not found ",e)}},processUpdateGameState:function(e){switch(e.data.state){case a.Game.GAME_STATE.PREPARE:if(t("Sicbo").getInstance().gameState==a.Game.GAME_STATE.PREPARE)return;t("Sicbo").getInstance().gameState=a.Game.GAME_STATE.PREPARE,t("Sicbo").getInstance().prepare();break;case a.Game.GAME_STATE.RUN:cc.log("GAME_STATE.RUN",e),t("Sicbo").getInstance().gameState=a.Game.GAME_STATE.RUN,t("Sicbo").getInstance().countDown(e.data.countDown);break;case a.Game.GAME_STATE.REWARD:cc.log("GAME_STATE.REWARD",e),t("Sicbo").getInstance().gameState=a.Game.GAME_STATE.REWARD,t("Sicbo").getInstance().reward();break;case a.Game.GAME_STATE.FINISH:cc.log("GAME_STATE.FINISH",e);break;default:cc.log("Match state not found ",e)}},sendBet:function(t){i.default.getInstance().sendMatchState(o.default.getInstance().matchInfo.match_id,n.default.Network.OP_CODE.OPCODE_BET,t).then(function(t){cc.log("sendBet success ",t)},function(t){cc.log("sendBet err",t)})},getUsers:function(){i.default.getInstance().sendMatchState(o.default.getInstance().matchInfo.match_id,n.default.Network.OP_CODE.OPCODE_LIST_USERS,{}).then(function(){cc.log("list users ")},function(t){cc.log("get list users failed",t)})},onQuit:function(e,a){void 0===e&&(e=function(){}),void 0===a&&(a=!0),i.default.getInstance().leaveMatch(o.default.getInstance().matchInfo.match_id).then(function(i){cc.log("leave match: ",i),t("Sicbo").getInstance().gameState=null,l.default.getInstance().leaveChat(),a&&o.default.getInstance().loadScene(n.default.AppInfo.SCENE_NAME.TABLELIST),e&&e()},function(t){cc.log("err when leave match",t)})}});e.exports=c,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/network/NetworkClient":void 0,Sicbo:"Sicbo"}],SicboPresenter:[function(t,e){"use strict";cc._RF.push(e,"6ad12/69tRJdYXrc6Tdb2lW","SicboPresenter"),cc.Class({extends:cc.Component,statics:{},properties:{}}),cc._RF.pop()},{}],SicboRuleDialog:[function(t,e,n){"use strict";cc._RF.push(e,"16e9bWk+nFCRYjhCJjbJRuH","SicboRuleDialog");var a,i=this&&this.__decorate||function(t,e,n,a){var i,o=arguments.length,l=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,a);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(l=(o<3?i(l):o>3?i(e,n,l):i(e,n))||l);return o>3&&l&&Object.defineProperty(e,n,l),l};Object.defineProperty(n,"__esModule",{value:!0});const o=t("../../../bundles/lobby/src/common/BaseDialog"),l=t("../../../bundles/lobby/src/common/GlobalApp"),s=t("../../../bundles/lobby/src/common/ConfigClient"),{ccclass:c,property:r}=cc._decorator;let h=a=class extends o.default{constructor(){super(...arguments),this.tabs=null,this.contents=null}static getInstance(){return this.instance}static show(t){null==this.instance||null==this.instance.node?l.default.getInstance().loadPrefabByBundle(s.default.Bundle.BUNDLE_NAME.SICBO,"res/prefabs/SicboRuleDialog",(e,n)=>{if(null!=e)return void l.default.getInstance().alertDialog.showMessage(e);let i=cc.instantiate(n);i.parent=t,this.instance=i.getComponent(a),this.instance.node.zIndex=1e3,this.instance.show()}):(this.instance.node.zIndex=1e3,this.instance.show())}show(){super.show(),this.tabs.children[0].getComponent(cc.Toggle).isChecked=!0,this.switchTab(0)}start(){this.tabs.children.forEach((t,e)=>{t.on("toggle",()=>{this.switchTab(e)})})}switchTab(t){this.contents.children.forEach((e,n)=>{e.active=n===t})}};h.instance=null,i([r(cc.Node)],h.prototype,"tabs",void 0),i([r(cc.Node)],h.prototype,"contents",void 0),h=a=i([c],h),n.default=h,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}],Sicbo:[function(t,e){"use strict";cc._RF.push(e,"3066exSvOVGL6i4f6fxc+8p","Sicbo");var n=I(t("../../lobby/src/audio/AudioController")),a=I(t("../../lobby/src/common/GlobalApp")),i=I(t("../../lobby/src/language/LanguageController")),o=I(t("../../lobby/src/common/Utils")),l=t("../../lobby/src/dialogs/banner/BannerDialog"),s=t("../../lobby/src/common/Constants"),c=I(t("../../lobby/src/game/GamePresenter")),r=I(t("../../lobby/src/common/User")),h=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=C(void 0);if(e&&e.has(t))return e.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if("default"!==i&&Object.prototype.hasOwnProperty.call(t,i)){var o=a?Object.getOwnPropertyDescriptor(t,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=t[i]}return n.default=t,e&&e.set(t,n),n}(t("../../lobby/src/dialogs/option/OptionDialog")),d=I(t("../../lobby/src/dialogs/chatingame/ChatInGameDialog")),u=I(t("../../lobby/src/chat/ChatPresenter")),f=I(t("./SicboRuleDialog")),p=I(t("./SicboHistoryDialog")),g=I(t("../../lobby/src/network/NetworkClient")),m=I(t("../../lobby/src/common/ConfigClient")),b=I(t("../../lobby/src/scripts/ingame/BubbleChat")),y=I(t("../../lobby/src/scripts/ingame/PlayerCasino"));function C(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,n=new WeakMap;return(C=function(t){return t?n:e})(t)}function I(t){return t&&t.__esModule?t:{default:t}}var v=cc.Class({extends:cc.Component,properties:{playerPrefab:{default:null,type:cc.Prefab},bgPlayer:{default:null,type:cc.Node},nPlayer:{default:null,type:cc.Label},nodeLbBet:{default:null,type:cc.Node},nodeLbTotalBet:{default:null,type:cc.Node},chipPrefab:{default:null,type:cc.Prefab},nodeUser:{default:null,type:cc.Node},nodeLights:{default:null,type:cc.Node},chips:{default:[],type:cc.Node},user_wallet:{default:null,type:cc.Label},anim_clock:{default:null,type:sp.Skeleton},anim_xocdia:{default:null,type:sp.Skeleton},lbClock:{default:null,type:cc.Label},nodeChipBet:{default:null,type:cc.Node},toastBetSuccess:{default:null,type:cc.Node},lbWin:{default:null,type:cc.Label},lbChip:{default:null,type:cc.Label},fontWin:{default:null,type:cc.Font},fontLose:{default:null,type:cc.Font},winPopup:{default:null,type:cc.Node},nodeButtons:{default:null,type:cc.Node},anim_startcompare:{default:null,type:sp.Skeleton},sicboAtlas:{default:null,type:cc.SpriteAtlas},nodeResult:{default:null,type:cc.Node},nodeHistory:{default:null,type:cc.Node},lbTotalReadyToBet:{default:null,type:cc.Label},bgResult:{default:null,type:cc.Node},animResult:{default:null,type:sp.Skeleton},animResultWin:{default:null,type:sp.SkeletonData},animResultLose:{default:null,type:sp.SkeletonData},spriteFrameExitMatch:{default:null,type:cc.SpriteFrame},spriteFrameChangeMatch:{default:null,type:cc.SpriteFrame},icBack:{default:null,type:cc.Node},bubbleChatPrefab:cc.Prefab,bgThrow:{default:null,type:cc.Node},players:{default:[],type:[cc.Node]},lbInfo:{default:null,type:cc.Label},tableAudio:{default:null,type:cc.AudioClip}},statics:{instance:null,getInstance:function(){return this.instance}},onLoad:function(){v.instance=this,t("SicboNetworkTransport").getInstance(),localStorage.setItem("isLeave","false"),n.default.getInstance().playMusic(this.tableAudio,!0),this.gameState=null,this.histories=[],this.chipBetTemp=new Map,this.chipBet=new Map,this.allIn=!1,this.allInBetted=!1,this.allUserBets=new Map,this.left2Right=!0,this.maxPlayer=6,this.listBet=[1e3,2e3,5e3,1e4],this.loadListBet(),this.loadProfile(),this.loadButtons()},start:function(){this.setMatchInfo()},onEnable:function(){this.lbTotalReadyToBet.string=0},onClickRule:function(){f.default.show(this.node)},onClickHistory:function(){p.default.show(this.node,this.histories)},getPlayer:function(t){for(var e=0;e<this.players.length;e++)if(this.players[e].active&&this.players[e].getComponent(y.default).id===t)return this.players[e];return this.getPlayerNodeUserId(t)},throwIcons:function(t){var e=this,n=this.getPlayer(t.sender_id),a=this.getPlayer(t.throw.to_id);n==a?this.players.forEach(function(a,i){a.active&&a.id!==t.sender_id&&e.createIconAndThrow(t.throw.iconIndex,n,i)}):this.createIconAndThrow(t.throw.iconIndex,n,a)},createIconAndThrow:function(t,e,n){var a=this,i=new cc.Node,o=i.addComponent(cc.Sprite),l=u.default.getInstance().getThrowIcon(t);o.spriteFrame=l,i.setPosition(e.position),this.bgThrow.addChild(i),cc.tween(i).to(.5,{position:n.position}).call(function(){i.destroy();var e=new cc.Node,o=e.addComponent(sp.Skeleton);o.skeletonData=u.default.getInstance().getThrowAnimation(t),o.animation="animation",o.loop=!1,o.premultipliedAlpha=!1,n.addChild(e),a.scheduleOnce(function(){e.destroy()},3)}).start()},onChatClick:function(){this.gameState!==s.Game.GAME_STATE.SPECTATING&&d.default.show()},showChat:function(t){var e=this.getPlayer(t.sender_id),n=t.message,a=cc.instantiate(this.bubbleChatPrefab);a.getComponent(b.default).setData(n),a.scale=2,a.position=cc.v2(70,0),e.addChild(a),this.scheduleOnce(function(){a.destroy()},3)},showEmoji:function(t){var e=u.default.getInstance().getEmojiByTypeAndIndex(t.emoji.type,t.emoji.index).value,n=this.getPlayer(t.sender_id),a=new cc.Node,i=a.addComponent(sp.Skeleton);i.skeletonData=e,i.animation="animation",i.premultipliedAlpha=!1,"F"==t.emoji.type?a.scale=1.3:a.scale=2,a.position=cc.v2(0,20),n.addChild(a),this.scheduleOnce(function(){a.destroy()},2)},loadListBet:function(){var t=this;this.listBet.forEach(function(e,n){t.chips[n].children[0].getComponent(cc.Label).string=o.default.formatBetNumber(e)}),this.chosenChip=this.listBet[0],this.chips[0].children[1].active=!0},loadProfile:function(){this.players[0].getComponent(y.default).setData({id:r.default.userId,user_name:r.default.displayName,wallet:r.default.accountChip,avatar_id:r.default.avatarId,vipLevel:r.default.vipLevel}),this.user_wallet.string=o.default.formatBetNumber(r.default.accountChip),this.userChip=r.default.accountChip},loadButtons:function(){var t=this;this.nodeButtons.children.forEach(function(e){var n=new cc.Component.EventHandler;n.target=t.node,n.component="Sicbo",n.handler="onClickBet",n.customEventData=e.name,e.getComponent(cc.Button).clickEvents.push(n)})},onClickChip:function(t,e){var n=this;this.chosenChip=this.listBet[e],this.allIn=!1,this.listBet.forEach(function(t,e){n.chips[e].children[1].active=!1}),this.chips[e].children[1].active=!0},sumbet:function(){var t=0;return this.chipBetTemp.forEach(function(e){t+=e}),t},onClickBet:function(t,e){if(!this.allInBetted&&(this.allIn&&(this.allInBetted=!0),this.gameState===s.Game.GAME_STATE.RUN)){var n=this.chipBetTemp.get(e);this.nodeLbBet.getChildByName(e).children[0].getComponent(cc.Label).string=o.default.formatBetNumber((Number(n)||0)+this.chosenChip),0!=this.nodeLbBet.getChildByName(e).children[0].getComponent(cc.Label).string&&(this.nodeLbBet.getChildByName(e).active=!0),this.chipBetTemp.set(e,(Number(this.chipBetTemp.get(e))||0)+Number(this.chosenChip)),this.lbTotalReadyToBet.string=o.default.formatNumberToString(this.sumbet())}},onCancelBet:function(){var t=this;this.lbTotalReadyToBet.string=0,this.chipBetTemp.forEach(function(e,n){t.nodeLbBet.getChildByName(n).children[0].getComponent(cc.Label).string=o.default.formatBetNumber(t.chipBet.get(n))||0,0==t.nodeLbBet.getChildByName(n).children[0].getComponent(cc.Label).string&&(t.nodeLbBet.getChildByName(n).active=!1)}),this.allIn=!1,this.allInBetted=!1,this.chipBetTemp=new Map},onConfirmbet:function(){if(0!=this.sumbet()){this.lbTotalReadyToBet.string=0;var e=[];this.chipBetTemp.forEach(function(t,n){e.push({chips:Number(t),cell:Number(n)})}),console.log("bet data: ",{user_id:r.default.userId||"",bets:e}),t("SicboNetworkTransport").getInstance().sendBet({user_id:r.default.userId||"",bets:e})}},throwChipBet:function(t,e,n){var a=cc.instantiate(this.chipPrefab),i=this.listBet.findIndex(function(t){return t==e});-1==i&&(i=this.listBet.length);var o={spriteIndex:i,chip:e};a.getComponent("SicboChip").setData(o),a.position=new cc.Vec2(t.x,t.y),this.nodeChipBet.addChild(a);var l,s,c=this.nodeButtons.getChildByName(n.toString()),r=new cc.Vec2;return l=c.width/2-20-Math.random()*(c.width-40),s=c.height/2-20-Math.random()*(c.height-40),r=new cc.Vec2(c.x+l,c.y+s),cc.tween(a).to(.3,{position:r}).start(),a},onRebet:function(){var e;this.gameState===s.Game.GAME_STATE.RUN&&(null==(e=this.lastBets)||e.forEach(function(e,n){t("SicboNetworkTransport").getInstance().sendBet({user_id:r.default.userId||"",bets:[{chips:e,cell:n}]})}))},onDouble:function(){var e;this.gameState===s.Game.GAME_STATE.RUN&&(this.isBetted?this.chipBet.forEach(function(e,n){t("SicboNetworkTransport").getInstance().sendBet({user_id:r.default.userId||"",bets:[{chips:e,cell:n}]})}):null==(e=this.lastBets)||e.forEach(function(e,n){t("SicboNetworkTransport").getInstance().sendBet({user_id:r.default.userId||"",bets:[{chips:2*e,cell:n}]})}))},clearAllData:function(){this.allUserBets=new Map,this.nodeLights.children.forEach(function(t){t.active=!1}),this.nodeLbBet.children.forEach(function(t){t.active=!1}),this.nodeLbTotalBet.children.forEach(function(t){t.active=!1}),this.nodeChipBet.destroyAllChildren(),this.winPopup.active=!1,this.bgResult.active=!1,this.isBetted=!1,this.lastBets=new Map(this.chipBet),this.chipBet=new Map,this.allIn=!1,this.allInBetted=!1},showToastBet:function(t){var e=this;this.toastBetSuccess.children[0].getComponent(cc.Label).string="Bet "+t+"!",this.toastBetSuccess.opacity=0,this.toastBetSuccess.active=!0,cc.tween(this.toastBetSuccess).to(.2,{opacity:255}).delay(.5).call(function(){e.toastBetSuccess.active=!1}).start()},updateDesk:function(t){var e,n=this;if(t.error)return 1==t.error.errorType&&a.default.getInstance().alertDialog.showMessage(i.default.getInstance().getString("txt_not_enough_money_gl")),void console.log("updateDesk",t.error);if(t.isUpdateDeskCell&&(null==(e=t.deskCell)||e.forEach(function(t){var e=n.nodeLbTotalBet.getChildByName(t.cell.toString());e&&(e.getComponent(cc.Label).string=o.default.formatBetNumber(t.chips,1e4),e.active=!0)})),t.isUpdateUserBet){var l,s=this.getPlayer(t.userBet.userId);t.userBet.userId==r.default.userId&&(this.isBet=!0,this.showToastBet("success"),this.isBetted=!0,this.chipBetTemp=new Map,s=this.nodeUser),null==(l=t.userBet)||l.bets.forEach(function(e){var a=[{chips:e.chips,cell:e.cell}];n.listBet.includes(Number(e.chips))||(a=n.splitBet(Number(e.chips),e.cell)),a.forEach(function(e){if(t.userBet.userId==r.default.userId){n.chipBet.set(e.cell,(Number(n.chipBet.get(e.cell))||0)+Number(e.chips));var a=n.nodeLbBet.getChildByName(e.cell.toString());a&&(a.children[0].getComponent(cc.Label).string=o.default.formatBetNumber(n.chipBet.get(e.cell),1e4),a.active=!0)}var i=n.throwChipBet(s,e.chips,e.cell);n.allUserBets[e.cell]||(n.allUserBets[e.cell]=new Map),n.allUserBets[e.cell][t.userBet.userId]||(n.allUserBets[e.cell][t.userBet.userId]=[]),n.allUserBets[e.cell][t.userBet.userId].push(i)})})}},splitBet:function(t,e){for(var n=[],a=this.listBet.length-1;a>=0;a--){var i=Math.floor(t/this.listBet[a]);t-=i*this.listBet[a];for(var o=0;o<i;o++)n.push({chips:this.listBet[a],cell:e})}return n},prepare:function(){var t=this;cc.tween(this.node).call(function(){t.clearAllData(),t.leaveMatch()}).delay(.5).call(function(){t.anim_startcompare.node.active=!0,t.anim_startcompare.animation="startgame"}).delay(1).call(function(){t.anim_xocdia.node.active=!0,t.anim_xocdia.animation="lac"}).delay(2).call(function(){t.anim_startcompare.animation=null,t.anim_startcompare.node.active=!1}).delay(2).call(function(){t.anim_startcompare.node.active=!0,t.anim_startcompare.animation="bettime"}).delay(1).call(function(){t.anim_startcompare.animation=null,t.anim_startcompare.node.active=!1}).start()},countDown:function(t){var e=this;cc.tween(this.node).call(function(){e.anim_clock.node.active=!0,e.anim_clock.animation="animation";var n=t;e.lbClock.string=n,e.anim_clock.loop=n<=5,e.anim_clock.animation="animation"}).start()},reward:function(){var t=this;cc.tween(this.node).call(function(){t.onCancelBet(),t.anim_clock.animation=null,t.anim_clock.loop=!1,t.anim_clock.node.active=!1}).start()},endGame:function(t){var e=this;console.log("end game: ",t),cc.tween(this.node).call(function(){e.anim_startcompare.node.active=!0,e.anim_startcompare.animation="compare"}).delay(1).call(function(){e.anim_xocdia.animation="open"}).delay(1).call(function(){e.anim_xocdia.node.active=!1}).delay(.2).call(function(){var n,a;e.histories.push(null==(n=t.hand)?void 0:n.dices),null==(a=t.hand)||a.dices.forEach(function(t,n){e.nodeResult.children[n].children[0].getComponent(cc.Sprite).spriteFrame=e.sicboAtlas.getSpriteFrame(t),e.nodeResult.children[n].children[1].getComponent(cc.Label).string=t,e.nodeHistory.children[n].children[0].getComponent(cc.Sprite).spriteFrame=e.sicboAtlas.getSpriteFrame(t)}),e.nodeResult.active=!0}).delay(2).call(function(){var n;e.anim_xocdia.animation="khong lac",e.anim_xocdia.node.active=!0,e.nodeResult.active=!1,null==(n=t.winCells)||n.forEach(function(t){e.nodeLights.getChildByName(t.toString()).active=!0})}).delay(1).call(function(){Object.keys(e.allUserBets).filter(function(e){return!t.winCells.includes(Number(e))}).forEach(function(t){Object.keys(e.allUserBets[t]).forEach(function(n){e.allUserBets[t][n].forEach(function(t){cc.tween(t).to(.45,{position:cc.v2(e.anim_xocdia.node.position.x,e.anim_clock.node.position.y-10)}).call(function(){t.destroy()}).start()})})})}).delay(.8).call(function(){t.winCells.forEach(function(t){e.allUserBets[t]&&Object.keys(e.allUserBets[t]).forEach(function(n){[].concat(e.allUserBets[t][n]).forEach(function(a){var i=e.throwChipBet(cc.v2(e.anim_xocdia.node.position.x,e.anim_clock.node.position.y-10),a.getComponent("SicboChip").chip,t);e.allUserBets[t][n].push(i)})})})}).delay(.8).call(function(){t.winCells.forEach(function(t){e.allUserBets[t]&&Object.keys(e.allUserBets[t]).forEach(function(n){if(e.allUserBets[t]){var a,i,o=e.getPlayer(n);if(Number(e.balances[n].amountChipAdd)>0)null==(a=o.getComponent(y.default))||a.showEffectWinLose(1),null==(i=o.getComponent(y.default))||i.showEffectFlyMoney2(Number(e.balances[n].amountChipAdd));else if(Number(e.balances[n].amountChipAdd)<0){var l,s;null==(l=o.getComponent(y.default))||l.showEffectWinLose(-1),null==(s=o.getComponent(y.default))||s.showEffectFlyMoney2(Number(e.balances[n].amountChipAdd))}e.allUserBets[t][n].forEach(function(t){cc.tween(t).to(.5,{position:cc.v2(o.x,o.y)}).delay(.5).call(function(){t.destroy()}).start()})}})})}).delay(1).call(function(){if(e.allUserBets=new Map,e.balances[r.default.userId]){var t=Number(e.balances[r.default.userId].amountChipAdd)>0,n=Number(e.balances[r.default.userId].amountChipAdd)<0;t?(e.lbWin.font=e.fontWin,e.lbChip.string="+"+o.default.formatNumberToString(e.balances[r.default.userId].amountChipAdd),e.bgResult.active=!0,e.animResult.skeletonData=e.animResultWin,e.animResult.animation="animation"):n&&(e.lbWin.font=e.fontLose,e.lbChip.string=""+o.default.formatNumberToString(e.balances[r.default.userId].amountChipAdd),e.bgResult.active=!0,e.animResult.skeletonData=e.animResultLose,e.animResult.animation="animation")}}).start()},updateGameBalances:function(t){if(console.log("balance: ",t),t.updates){var e=new Map;t.updates.forEach(function(t){e[t.userId]=t}),this.balances=e,this.balances[r.default.userId]&&(this.players[0].getComponent(y.default).setData({id:r.default.userId,user_name:r.default.displayName,wallet:r.default.accountChip,avatar_id:r.default.avatarId,vipLevel:r.default.vipLevel}),this.user_wallet.string=o.default.formatBetNumber(this.balances[r.default.userId].amountChipCurrent),this.userChip=this.balances[r.default.userId].amountChipCurrent)}},setMatchInfo:function(){console.log("setMatchInfo",a.default.getInstance().matchInfo);var t=JSON.parse(a.default.getInstance().matchInfo.label),e=t.tableId.slice(0,5);t.tableId.length>5&&(e+="..."),this.lbInfo.string="ID: "+e+"\nBertaruh: "+o.default.formatWalletNumber(t.markUnit),u.default.getInstance().joinChatRoom(a.default.getInstance().matchInfo.match_id,this),localStorage.setItem("isLeave","false"),localStorage.setItem("isChangeMatch","false"),this.listBet=[1,5,10,50,100].map(function(e){return Number(e*t.markUnit)}),this.loadListBet()},onMenuClick:function(){h.default.show(this,h.DialogPosition.RIGHT)},leaveMatch:function(){var e=this;"true"===localStorage.getItem("isLeave")?(l.BannerData.setBannerData(s.Banner.ShowType.LEFT_MATCH,!0),t("SicboNetworkTransport").getInstance().onQuit()):"true"===localStorage.getItem("isChangeMatch")&&t("SicboNetworkTransport").getInstance().onQuit(function(){a.default.getInstance().showProcessing(!0),e.clearAllData(),cc.Tween.stopAllByTarget(e.node),e.unscheduleAllCallbacks(),setTimeout(function(){var t=JSON.parse(a.default.getInstance().matchInfo.label);c.default.changeMatch(t.markUnit,a.default.getInstance().matchInfo)},2)},!1)},onChangeMatch:function(){var e=this;!this.isBetted||this.gameState!==s.Game.GAME_STATE.RUN&&this.gameState!==s.Game.GAME_STATE.REWARD?t("SicboNetworkTransport").getInstance().onQuit(function(){a.default.getInstance().showProcessing(!0),e.clearAllData(),cc.Tween.stopAllByTarget(e.node),e.unscheduleAllCallbacks(),setTimeout(function(){var t=JSON.parse(a.default.getInstance().matchInfo.label);c.default.changeMatch(t.markUnit,a.default.getInstance().matchInfo)},2)},!1):(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameChangeMatch,this.icBack.scale=.5,"true"===localStorage.getItem("isChangeMatch")?(this.icBack.active=!1,localStorage.setItem("isChangeMatch","false"),a.default.getInstance().toast.showToast(i.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isChangeMatch","true"),a.default.getInstance().toast.showToast(i.default.getInstance().getString("wait_game_end_to_leave"))))},onQuit:function(){!this.isBetted||this.gameState!==s.Game.GAME_STATE.RUN&&this.gameState!==s.Game.GAME_STATE.REWARD?(l.BannerData.setBannerData(s.Banner.ShowType.LEFT_MATCH,!0),t("SicboNetworkTransport").getInstance().onQuit()):(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameExitMatch,this.icBack.scale=1,"true"===localStorage.getItem("isLeave")?(this.icBack.active=!1,localStorage.setItem("isLeave","false"),a.default.getInstance().toast.showToast(i.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isLeave","true"),a.default.getInstance().toast.showToast(i.default.getInstance().getString("wait_game_end_to_leave"))))},getPlayerNodeUserId:function(t){for(var e=0;e<this.bgPlayer.children.length;e++)if(this.bgPlayer.children[e].active&&this.bgPlayer.children[e].getComponent(y.default)&&this.bgPlayer.children[e].getComponent(y.default).id==t)return this.bgPlayer.children[e];return null},getPlayerInfoByUserId:function(t){console.log("getPlayerInfoByUserId",t);for(var e=0;e<this.bgPlayer.children.length;e++)if(this.bgPlayer.children[e].active&&this.bgPlayer.children[e].getComponent(y.default)&&this.bgPlayer.children[e].getComponent(y.default).id==t)return this.bgPlayer.children[e].getComponent(y.default).getInfo();return null},reloadListPlayer:function(t){var e=this,n=this.bgPlayer.children.length-1;this.bgPlayer.children.forEach(function(e,a){if(e.active&&(a!==n||e.getComponent(y.default))){for(var i=0;i<t.players.length;i++)if(t.players[i].id==e.getComponent(y.default).id)return;e.active=!1}}),this.bgPlayer.children[n].active&&!this.bgPlayer.children[n].getComponent(y.default)&&t.players.length<=n+1&&(this.bgPlayer.children[n].active=!1),t.players.forEach(function(n){if(n.id!==r.default.userId){for(var a=!1,i=0;i<e.bgPlayer.children.length;i++){var o;if(e.bgPlayer.children[i].active&&n.id==(null==(o=e.bgPlayer.children[i].getComponent(y.default))?void 0:o.id)){a=!0;break}}a||e.updatePlayer(n,t.players.length)}})},getNextIndex:function(){for(var t=0;t<this.bgPlayer.children.length;t++)if(!this.bgPlayer.children[t].active)return this.bgPlayer.children[t].scale=this.playerScale,t;return-1},updatePlayer:function(t,e){var n=this.getNextIndex();if(console.log("updatePlayer",n,t),-1!=n&&(this.bgPlayer.children[n].active=!0),n==this.bgPlayer.children.length-1||-1==n){if(!this.bgPlayer.children[this.bgPlayer.children.length-1].getComponent(y.default))return n=this.bgPlayer.children.length-1,void(this.bgPlayer.children[n].children[0].getComponent(cc.Label).string="+"+(e-this.bgPlayer.children.length));if(-1==n)return}this.bgPlayer.children[n].getComponent(y.default).setData({id:null==t?void 0:t.id,user_name:null==t?void 0:t.userName,wallet:null==t?void 0:t.wallet,avatar_id:null==t?void 0:t.avatarId,vipLevel:null==t?void 0:t.vipLevel,sId:null==t?void 0:t.sid}),this.bgPlayer.children[n].getChildByName("avatar").getComponent(cc.Button)||(this.bgPlayer.children[n].getChildByName("avatar").addComponent(cc.Button),this.bgPlayer.children[n].getChildByName("avatar").getComponent(cc.Button).target=this.bgPlayer.children[n]);var a=new cc.Component.EventHandler;a.target=this.node,a.component=this.node._name,a.handler="profileClick",a.customEventData=null==t?void 0:t.id,this.bgPlayer.children[n].getChildByName("avatar").getComponent(cc.Button).clickEvents=[a]},profileClick:function(t){t.target.parent.getComponent(y.default).showPlayerInfo()},reloadProfileInfo:function(){g.default.getInstance().rpcCall(m.default.Network.RPC_ID.GET_PROFILE,{}).then(function(t){console.log("profile: ",t.payload),r.default.init(t.payload)},function(t){console.log("err when get PROFILE ",t)})}});cc._RF.pop()},{"../../lobby/src/audio/AudioController":void 0,"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/chatingame/ChatInGameDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/game/GamePresenter":void 0,"../../lobby/src/language/LanguageController":void 0,"../../lobby/src/network/NetworkClient":void 0,"../../lobby/src/scripts/ingame/BubbleChat":void 0,"../../lobby/src/scripts/ingame/PlayerCasino":void 0,"./SicboHistoryDialog":"SicboHistoryDialog","./SicboRuleDialog":"SicboRuleDialog",SicboNetworkTransport:"SicboNetworkTransport"}]},{},["Sicbo","SicboChip","SicboHistoryDialog","SicboNetworkTransport","SicboPresenter","SicboRuleDialog"]);