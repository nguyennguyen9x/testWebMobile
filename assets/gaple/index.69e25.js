window.__require=function t(e,i,a){function n(r,s){if(!i[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var d=i[r]={exports:{}};e[r][0].call(d.exports,function(t){return n(e[r][1][t]||t)},d,d.exports,t,e,i,a)}return i[r].exports}for(var o="function"==typeof __require&&__require,r=0;r<a.length;r++)n(a[r]);return n}({DominoCardRemain:[function(t,e){"use strict";cc._RF.push(e,"6435cH7xt9FJItLtAl9z46J","DominoCardRemain");cc.Class({extends:cc.Component,properties:{listLbRemain:[cc.Node],listCard:[t("DominoCard")],arrow:cc.Node,parentCard:cc.Node,listCardDrop:[]},start:function(){},onShowRemain:function(){var t=this;this.listLbRemain.forEach(function(e,i){var a=e.parent;a.on(cc.Node.EventType.TOUCH_START,function(){t.arrow.x=a.x+-11,t.parentCard.scale=1,t.initSlitCard(i)},t),a.on(cc.Node.EventType.TOUCH_END,function(){t.parentCard.scale=0},t),a.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.parentCard.scale=0},t)})},offShowRemain:function(){this.listLbRemain.forEach(function(t){var e=t.parent;e.off(cc.Node.EventType.TOUCH_START),e.off(cc.Node.EventType.TOUCH_END),e.off(cc.Node.EventType.TOUCH_CANCEL)})},resetDiceRemain:function(){this.offShowRemain(),this.listCardDrop=[],this.parentCard.scale=0,this.listCard.forEach(function(t){t.node.color=cc.Color.BLACK.fromHEX("#FFFFFF"),t.node.getComponentsInChildren(cc.Sprite).forEach(function(t){t.node.color=cc.Color.BLACK.fromHEX("#FFFFFF")})}),this.listLbRemain.forEach(function(t){t.y=346})},updateDiceRemain:function(t){t&&this.listLbRemain.forEach(function(e,i){t.hasOwnProperty(i)&&cc.tween(e).to(.4,{y:{value:40*t[i]+26,easing:"sineOut"}}).start()})},initSlitCard:function(t){var e=this;cc.log(t),this.listCard.forEach(function(i,a){var n=a>t?7*t+a:7*a+t;i.setCardId(n);var o=e.listCardDrop.includes(n)?"#6E6E6E":"#FFFFFF";i.node.color=cc.Color.BLACK.fromHEX(o),i.node.getComponentsInChildren(cc.Sprite).forEach(function(t){t.node.color=cc.Color.BLACK.fromHEX(o)})})},showListCard:function(t,e){this.parentCard.scale=Math.abs(this.parentCard.scale-1),this.initSlitCard(parseInt(e))}}),cc._RF.pop()},{DominoCard:"DominoCard"}],DominoCard:[function(t,e){"use strict";cc._RF.push(e,"442d9tmRbtMmKllF52xRdaW","DominoCard");var i={top:0,horizontal:1,bottom:2},a={big:.45,small:.2};cc.Class({extends:cc.Component,properties:{diceTop:cc.Sprite,diceBottom:cc.Sprite,diceFrames:[cc.SpriteFrame],cardBackFrame:cc.SpriteFrame,cardFrontFrames:[cc.SpriteFrame]},ctor:function(){this.cardId=null,this.coordinates={horizontal:0,vertical:0,trend:"center",pre_trend:"center"},this.positionOnHand=null,this.checkAvaiableCardPositionOnBoard=null},onLoad:function(){this.handleSnap(this.node.position),this.isMoving=!1,this.checkMovingTimeOut=!1},setRotation:function(t){this.diceTop.node.rotation=t,this.diceBottom.node.rotation=t},onSelectCard:function(){},handleMove:function(){var t=this,e=null,i=0,n=0,o=this.node.zIndex;this.node.off(cc.Node.EventType.TOUCH_START),this.node.off(cc.Node.EventType.TOUCH_MOVE),this.node.off(cc.Node.EventType.TOUCH_END),this.node.off(cc.Node.EventType.TOUCH_CANCEL),this.node.on(cc.Node.EventType.TOUCH_START,function(){t.node.zIndex=o+50,e=t.node.position,cc.Tween.stopAllByTarget(t.node)}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(o){var r=o.getDelta(),s=t.node.x+r.x,c=t.node.y+r.y;s-a.width/2+10<=-cc.winSize.width/2||s+a.width/2-10>=cc.winSize.width/2||c-a.height/2+25<=-cc.winSize.height/2||c+a.height/2-10>=cc.winSize.height/2||(t.node.x+=r.x,t.node.y+=r.y,Math.sqrt(Math.pow(t.node.x-e.x,2))>=10||Math.sqrt(Math.pow(t.node.y-e.y,2))>=10?t.isMoving=!0:t.isMoving=!1,i=Math.sqrt(Math.pow(r.x,2))>=20?-r.x:0,0==(n=Math.sqrt(Math.pow(r.y,2))>=20?r.y:0)&&0!=i&&(n=r.y),t.checkMovingTimeOut||(t.isMoving=!1,t.checkMovingTimeOut=!0,t.scheduleOnce(function(){t.isMoving=!0},.1)),t.checkAvaiableCardPositionOnBoard&&t.checkAvaiableCardPositionOnBoard(t))}),this.node.on(cc.Node.EventType.TOUCH_END,function(){cc.log(t.node.x,t.node.y),t.node.zIndex=o,e=null;var a=t.node.x,r=t.node.y;0!=i&&(a+=20*i,i=0),0!=n&&(r+=20*n,n=0),t.scheduleOnce(function(){t.isMoving=!1},.5),t.checkMovingTimeOut=!1,t.submitCard&&Math.abs(t.node.y)<200&&Math.abs(t.node.x)<cc.winSize.width/2?t.submitCard():(t.handleSnap(cc.v2(a,r)),t.submitCard(!1))}),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){cc.log(t.node.x,t.node.y),t.node.zIndex=o,e=null;var a=t.node.x,r=t.node.y;0!=i&&(a+=20*i,i=0),0!=n&&(r+=20*n,n=0),t.scheduleOnce(function(){t.isMoving=!1},.5),t.checkMovingTimeOut=!1,t.submitCard&&Math.abs(t.node.y)<200&&Math.abs(t.node.x)<cc.winSize.width/2?t.submitCard():(t.handleSnap(cc.v2(a,r)),t.submitCard(!1))})},handleSnap:function(t){var e=this.positionOnHand||t;cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(.25,{position:{value:cc.v2(e),easing:"backOut"}}).start()},setEnableMoving:function(t,e){var i=[null,this.getCardBottomPoint(),this.getCardTopPoint()],a=t&&e.filter(function(t){return i.includes(t)}).length>0,n=!t||e.filter(function(t){return i.includes(t)}).length>0?"#FFFFFF":"#6E6E6E";this.setColorCard(n),a?this.handleMove():(this.node.off(cc.Node.EventType.TOUCH_START),this.node.off(cc.Node.EventType.TOUCH_MOVE),this.node.off(cc.Node.EventType.TOUCH_END),this.node.off(cc.Node.EventType.TOUCH_CANCEL))},setColorCard:function(t){this.node.color=cc.Color.BLACK.fromHEX(t),this.node.getComponentsInChildren(cc.Sprite).forEach(function(e){e.node.color=cc.Color.BLACK.fromHEX(t)})},setCardInfo:function(t){this.setCardId(t.cardId),this.positionOnHand=t.cardPosition,this.checkAvaiableCardPositionOnBoard=t.checkAvaiableCardPositionOnBoard,this.submitCard=t.submitCard},getCardId:function(){return this.cardId},getCardTopPoint:function(){return Math.floor(this.cardId/7)},checkAttached:function(t){return t==this.getCardTopPoint()||t==this.getCardBottomPoint()},getCardBottomPoint:function(){return this.cardId%7},getCardTotalPoint:function(){return this.getCardTopPoint()+this.getCardBottomPoint()},setCardBack:function(){this.getComponent(cc.Sprite).spriteFrame=this.cardBackFrame,this.diceTop.node.active=!1,this.diceBottom.node.active=!1},setCardId:function(t){if(t<0)return this.setCardBack();this.cardId=t,this.getComponent(cc.Sprite).spriteFrame=this.cardFrontFrames[i.top],this.diceTop.node.active=!0,this.diceBottom.node.active=!0,this.diceTop.spriteFrame=this.diceFrames[this.getCardTopPoint()-1],this.diceBottom.spriteFrame=this.diceFrames[this.getCardBottomPoint()-1],this.setRotation(0)},getPositionOnHand:function(){return this.positionOnHand},isConnectTop:function(t){return t==this.getCardTopPoint()},resetCardInfo:function(){this.cardId=null,this.positionOnHand=null,this.checkAvaiableCardPositionOnBoard=null,this.coordinates={horizontal:0,vertical:0,trend:"center",pre_trend:"center"}},setFrontFrames:function(t){this.getComponent(cc.Sprite).spriteFrame=this.cardFrontFrames[i[t]]},isSamePoint:function(){return this.getCardTopPoint()===this.getCardBottomPoint()}}),cc._RF.pop()},{}],DominoController:[function(t,e,i){"use strict";cc._RF.push(e,"819abFfm5FEsYq6CbXRzTfc","DominoController"),i.__esModule=!0,i.default=void 0;var a,n=b(t("Player")),o=b(t("../../lobby/src/common/GlobalApp")),r=b(t("../../lobby/src/language/LanguageController")),s=b(t("../../lobby/src/common/Utils")),c=t("../../lobby/src/common/Constants"),l=v(t("../../lobby/src/dialogs/banner/BannerDialog")),d=b(t("../../lobby/src/game/GamePresenter")),h=b(t("../../lobby/src/common/User")),u=v(t("../../lobby/src/dialogs/option/OptionDialog")),p=b(t("../../lobby/src/dialogs/chatingame/ChatInGameDialog")),m=b(t("../../lobby/src/chat/ChatPresenter")),f=b(t("./GapleRuleDialog")),C=b(t("../../lobby/src/scripts/ingame/BubbleChat")),y=b(t("../../lobby/src/scripts/ingame/Card"));function g(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(g=function(t){return t?i:e})(t)}function v(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var i=g(e);if(i&&i.has(t))return i.get(t);var a={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var r=n?Object.getOwnPropertyDescriptor(t,o):null;r&&(r.get||r.set)?Object.defineProperty(a,o,r):a[o]=t[o]}return a.default=t,i&&i.set(t,a),a}function b(t){return t&&t.__esModule?t:{default:t}}function _(){return(_=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t}).apply(this,arguments)}var I=cc.v2(0,-230),P={GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_UNSPECIFIED:0,GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD:1,GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_TAIL:2,GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_BOTH:3},A=[{top:0,bottom:0},{top:0,bottom:1},{top:0,bottom:2},{top:0,bottom:3},{top:0,bottom:4},{top:0,bottom:5},{top:0,bottom:6},{top:1,bottom:0},{top:1,bottom:1},{top:1,bottom:2},{top:1,bottom:3},{top:1,bottom:4},{top:1,bottom:5},{top:1,bottom:6},{top:2,bottom:0},{top:2,bottom:1},{top:2,bottom:2},{top:2,bottom:3},{top:2,bottom:4},{top:2,bottom:5},{top:2,bottom:6},{top:3,bottom:0},{top:3,bottom:1},{top:3,bottom:2},{top:3,bottom:3},{top:3,bottom:4},{top:3,bottom:5},{top:3,bottom:6},{top:4,bottom:0},{top:4,bottom:1},{top:4,bottom:2},{top:4,bottom:3},{top:4,bottom:4},{top:4,bottom:5},{top:4,bottom:6},{top:5,bottom:0},{top:5,bottom:1},{top:5,bottom:2},{top:5,bottom:3},{top:5,bottom:4},{top:5,bottom:5},{top:5,bottom:6},{top:6,bottom:0},{top:6,bottom:1},{top:6,bottom:2},{top:6,bottom:3},{top:6,bottom:4},{top:6,bottom:5},{top:6,bottom:6}],T=cc.Class(((a={extends:cc.Component,properties:{lbInfo:{default:null,type:cc.Label},listPosView:{default:[],type:[cc.Vec2]},agTable:{default:0,visible:!1},turnCurrentPlayer:{default:null,visible:!1,type:n.default,serializable:!1},table_id:{default:0,visible:!1},indexFinish:{default:0,visible:!1},playerPrefab:cc.Prefab,cardPrefab:cc.Prefab,board:cc.Node,lbBet:cc.Label,startTime:cc.Node,animationStart:sp.Skeleton,animationResult:sp.Skeleton,diceRemainBar:t("DominoCardRemain"),oderDisCard:cc.Node,placeholderCardHead:cc.Node,placeholderCardTail:cc.Node,botInfo:cc.Node,bubbleChatPrefab:cc.Prefab,bgThrow:{default:null,type:cc.Node},popupResult:{default:null,type:cc.Node},popupResultItems:{default:null,type:cc.Node},resultItem:cc.Prefab,chipAnim:sp.SkeletonData},statics:{instance:null,getInstance:function(){return this.instance}},onClickRule:function(){f.default.show(this.node)},ctor:function(){this.currentCardBoards=[],this.headBoard={card:null,point:null},this.tailBoard={card:null,point:null},this.cardPool=null,this.isPlayerSubmit=!1},onLoad:function(){t("DominoNetworkTransport").getInstance(),this.gameState=null,this.arrCard=[],this.wallet=[],this.showMapNode=!0,this.showNumberCard=!0,this.minVertical=0,this.maxVertical=0,this.cardHead=null,this.cardTail=null,this.lastCard=null,this.isPlayerSubmit=!1,this.bgThrow.zIndex=40,this.oderDisCard.active=!1,this.cardPool=new cc.NodePool,this.isPlaying=!0,this.listDataDelay=[],this.players=[],this.thisPlayer=null,this.icBack=null,this.cardPool||(this.cardPool=new cc.NodePool(y.default)),this.node.setContentSize(cc.winSize),l.default.show(c.Game.Enum.GAPLE)},start:function(){T.instance=this,this.setMatchInfo()},setMatchInfo:function(){m.default.getInstance().joinChatRoom(o.default.getInstance().matchInfo.match_id,this);var t,e=JSON.parse(o.default.getInstance().matchInfo.label),i=e.tableId.slice(0,5);e.tableId.length>5&&(i+="..."),this.lbInfo.string="ID: "+i+"\nBertaruh: "+s.default.formatWalletNumber(e.markUnit),this.setMatchInfo(e.markUnit,e.tableId),localStorage.setItem("isLeave","false"),localStorage.setItem("isChangeMatch","false"),(e.gameState===c.Game.GAME_STATE.RUN||c.Game.GAME_STATE.PREPARE)&&(o.default.getInstance().isReconnected=!0,this.isPlaying=(null==e?void 0:null==(t=e.playingPlayers)?void 0:t.findIndex(function(t){return t===h.default.userId}))>=0,d.default.syncTable())},onMenuClick:function(){u.default.show(this,u.DialogPosition.RIGHT)},leaveMatch:function(){var e=this;"true"===localStorage.getItem("isLeave")?(l.BannerData.setBannerData(c.Banner.ShowType.LEFT_MATCH,!0,c.Game.Enum.GAPLE),t("DominoNetworkTransport").getInstance().onQuit()):"true"===localStorage.getItem("isChangeMatch")&&(this.hideIcChange(),t("DominoNetworkTransport").getInstance().onQuit(function(){o.default.getInstance().showProcessing(!0),e.cleanTable(),cc.Tween.stopAllByTarget(e.node),e.removeAllPlayer(),e.unscheduleAllCallbacks(),setTimeout(function(){e.onLoad();var t=JSON.parse(o.default.getInstance().matchInfo.label);d.default.changeMatch(t.markUnit,o.default.getInstance().matchInfo)},2)},!1))},refreshView:function(){var e=this;t("DominoNetworkTransport").getInstance().onQuit(function(){o.default.getInstance().showProcessing(!0),e.cleanTable(),cc.Tween.stopAllByTarget(e.node),e.removeAllPlayer(),e.unscheduleAllCallbacks(),setTimeout(function(){e.onLoad(),d.default.reloadMatch(o.default.getInstance().matchInfo)},2)},!1)},showIcBack:function(){this.players.find(function(t){return t.id==h.default.userId})._playerView.setIconBackOrChange(0),this.players.find(function(t){return t.id==h.default.userId})._playerView.icBack.node.scale=1,this.players.find(function(t){return t.id==h.default.userId})._playerView.icBack.node.active=!0},hideIcBack:function(){this.players.find(function(t){return t.id==h.default.userId})._playerView.icBack.node.active=!1},showIcChange:function(){this.players.find(function(t){return t.id==h.default.userId})._playerView.setIconBackOrChange(1),this.players.find(function(t){return t.id==h.default.userId})._playerView.icBack.node.active=!0,this.players.find(function(t){return t.id==h.default.userId})._playerView.icBack.node.scale=.5},hideIcChange:function(){this.icBack.active=!0,this.players.find(function(t){return t.id==h.default.userId})._playerView.icBack.node.active=!1},onChangeMatch:function(){var e=this;!this.isPlaying||this.gameState!==c.Game.GAME_STATE.RUN&&this.gameState!==c.Game.GAME_STATE.REWARD?t("DominoNetworkTransport").getInstance().onQuit(function(){o.default.getInstance().showProcessing(!0),e.cleanTable(),cc.Tween.stopAllByTarget(e.node),e.removeAllPlayer(),e.unscheduleAllCallbacks(),setTimeout(function(){e.onLoad();var t=JSON.parse(o.default.getInstance().matchInfo.label);d.default.changeMatch(t.markUnit,o.default.getInstance().matchInfo)},2)},!1):"true"===localStorage.getItem("isChangeMatch")?(this.hideIcChange(),localStorage.setItem("isChangeMatch","false"),o.default.getInstance().toast.showToast(r.default.getInstance().getString("minidice_unsign_leave_table"))):(this.showIcChange(),localStorage.setItem("isChangeMatch","true"),o.default.getInstance().toast.showToast(r.default.getInstance().getString("wait_game_end_to_leave")))},onQuit:function(){!this.isPlaying||this.gameState!==c.Game.GAME_STATE.RUN&&this.gameState!==c.Game.GAME_STATE.REWARD?(l.BannerData.setBannerData(c.Banner.ShowType.LEFT_MATCH,!0,c.Game.Enum.GAPLE),t("DominoNetworkTransport").getInstance().onQuit()):"true"===localStorage.getItem("isLeave")?(this.hideIcBack(),localStorage.setItem("isLeave","false"),o.default.getInstance().toast.showToast(r.default.getInstance().getString("minidice_unsign_leave_table"))):(this.showIcBack(),localStorage.setItem("isLeave","true"),o.default.getInstance().toast.showToast(r.default.getInstance().getString("wait_game_end_to_leave")))},handlePlayers:function(t){var e=this;this.gameState==c.Game.GAME_STATE.PREPARE&&(this.gameState=null);var i=t.data.players;this.wallet=t.data.players,this.players.forEach(function(t){i.find(function(e){return e.id==t.id})||e.handleLTable({Name:t.displayName})});var a,n=i.find(function(t){return t.id==h.default.userId}),o=this.players.find(function(t){return t.id==n.id});if(n&&!o){var r={id:n.id,SId:n.sid,VIP:n.vipLevel,Av:n.avatarId,displayName:n.userName,AG:Number(n.wallet),Order:Number(n.order)};this.handleJTable(r)}i.forEach(function(t){if(!e.players.find(function(e){return e.id==t.id||t.id==h.default.userId})){var i={id:(a=t).id,VIP:a.vipLevel,Av:a.avatarId,displayName:a.userName,SId:a.sid,AG:Number(a.wallet),Order:Number(a.order)};e.handleJTable(i)}})},actLc:function(){this.handleLc(JSON.parse('{ "evt": "lc", "arrCard": [13, 32, 20, 10, 3, 25, 18], "actionTime": 2, "turnTime": 5, "nextTurn": 14610095 }'))},actSubmitCard:function(e,i){if(void 0===e&&(e=!0),void 0===i&&(i="check"),this.placeholderCardHead.active&=e,this.placeholderCardTail.active&=e,e){cc.log(i,this.sideSubmit,this.targetCard.getCardId());var a="check"==i?this.sideSubmit:this.currentCardBoards&&0!=this.currentCardBoards.length?i:P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD;this.sideSubmit&&(this.isPlayerSubmit=!0,this.sideSubmit=null,console.log({user_id:h.default.userId,domino:A[this.targetCard.getCardId()],position:a}),t("DominoNetworkTransport").getInstance().sendDomino({user_id:h.default.userId,domino:A[this.targetCard.getCardId()],position:a}),this.targetCard.setEnableMoving(!1,[this.headBoard.point,this.tailBoard.point]))}},submitCard:function(){},actStartTime:function(){this.handleStartGame({actionTime:5})},actShowAnimation:function(){this.animationStart.node.active=!0,this.animationStart.setAnimation(0,"animation",!1)},showAnimationResult:function(t){this.animationResult.node.active=!0,this.animationResult.setAnimation(0,t,!1)},handleDeadEnd:function(){}}).setMatchInfo=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.lbBet.string=cc.js.formatStr("%s : %s",r.default.getInstance().getString("txt_bet"),s.default.formatMoneyChip(t)),this.diceRemainBar.resetDiceRemain(),cc.tween(this.diceRemainBar.node).to(.2,{position:{value:cc.v2(0,-cc.winSize.height/2-200),easing:"sineOut"}}).start()},a.updatePositionPlayerView=function(){for(var t=0;t<this.players.length;t++){var e=this.getDynamicIndex(this.getIndexOf(this.players[t]));this.players[t]._playerView.node.position=this.listPosView[e],this.players[t]._indexDynamic=e,this.players[t]._playerView.setPositionCardRemain(e),this.players[t]._playerView.setPosThanhBarThisPlayer(![2].includes(e)),this.players[t]._playerView.setPosFold(![2].includes(e)),this.players[t]._playerView.node.setScale(.9)}},a.handleJTable=function(t){console.log("handleJTable",t);var e=t,i=new n.default;this.players.push(i),i.isAutoPlayLastOne=!0,i._playerView=cc.instantiate(this.playerPrefab).getComponent("DominoPlayer"),i._playerView.vipBorder.spriteFrame=o.default.getInstance().getAvatarBorderByVip(Number(t.VIP)),this.node.addChild(i._playerView.node,0),this.readDataPlayer(i,e),i.updatePlayerView(),this.updatePositionPlayerView(),t.id==h.default.userId&&(this.thisPlayer=i)},a.initCarDeck=function(t,e){if(0!=e.length){this.diceRemainBar.listCardDrop.push(t),this.effectDc(this.cloneCard(t,cc.v2(0,0)),{idCard:t,side:P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD},!0);for(var i=e.indexOf(t),a=i-1;a>=0;a--){var n=e[a];this.diceRemainBar.listCardDrop.push(n),this.effectDc(this.cloneCard(n,cc.v2(0,0)),{idCard:n,side:P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_TAIL})}for(var o=i+1;o<e.length;o++){var r=e[o];this.diceRemainBar.listCardDrop.push(r),this.effectDc(this.cloneCard(r,cc.v2(0,0)),{idCard:r,side:P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD})}}},a.handleCTable=function(t){var e=JSON.parse(t);this.showMapNode=!0,this.showNumberCard=e.showNumberCard,this.setMatchInfo(e.M,e.Id,e.hasOwnProperty("maxBet")?e.maxBet:e.Time),this.thisPlayer=new n.default,this.thisPlayer.isAutoPlayLastOne=e.ArrP[0].isAutoPlayLastOne,this.players.push(this.thisPlayer),this.thisPlayer._playerView=cc.instantiate(this.playerPrefab).getComponent("DominoPlayer"),this.node.addChild(this.thisPlayer._playerView.node,0),this.readDataPlayer(this.thisPlayer,e.ArrP[0]),this.addChatJoin(this.thisPlayer.displayName),this.thisPlayer.updatePlayerView(),this.updatePositionPlayerView()},a.getPlayerIndex=function(t){for(var e=-1,i=0;i<this.players.length;i++){var a,n,o;this.players[i]&&console.log("getPlayerIndex",this.players[i],this.players[i].id),null!=(a=this.players[i])&&null!=(n=a._playerView)&&null!=(o=n.node)&&o.active&&this.players[i].id===t&&(e=i)}return e},a.throwIcons=function(t){var e=this,i=this.getPlayerIndex(t.sender_id),a=this.getPlayerIndex(t.throw.to_id);i==a?this.players.forEach(function(a,n){a.active&&a.id!==t.sender_id&&e.createIconAndThrow(t.throw.iconIndex,i,n)}):this.createIconAndThrow(t.throw.iconIndex,i,a)},a.createChips=function(t,e,i){var a=new cc.Node,n=a.addComponent(sp.Skeleton);n.loop=!0,n.premultipliedAlpha=!1,n.skeletonData=this.chipAnim,n.animation="animation",a.setPosition(e),a.scale=.5,a.zIndex=40,this.bgThrow.addChild(a);var o=cc.v2((i.x+e.x)/2,(i.y+e.y)/2);cc.tween(a).to(t/2-.05,{position:o}).delay(.2).to(t/2-.05,{position:i}).call(function(){a.destroy()}).start()},a.createIconAndThrow=function(t,e,i){var a=this,n=new cc.Node,o=n.addComponent(cc.Sprite),r=m.default.getInstance().getThrowIcon(t);o.spriteFrame=r,n.setPosition(this.players[e]._playerView.node.position),this.bgThrow.addChild(n),cc.tween(n).to(.5,{position:this.players[i]._playerView.node.position}).call(function(){n.destroy();var e=new cc.Node,o=e.addComponent(sp.Skeleton);o.skeletonData=m.default.getInstance().getThrowAnimation(t),o.animation="animation",o.loop=!1,o.premultipliedAlpha=!1,a.players[i]._playerView.node.addChild(e),a.scheduleOnce(function(){e.destroy()},3)}).start()},a.onChatClick=function(){this.gameState!==c.Game.GAME_STATE.SPECTATING&&p.default.show()},a.showChat=function(t){var e=this.getPlayerIndex(t.sender_id),i=t.message,a=cc.instantiate(this.bubbleChatPrefab);a.getComponent(C.default).setData(i),this.players[e]._playerView.node.addChild(a),this.scheduleOnce(function(){a.destroy()},3)},a.showEmoji=function(t){var e=m.default.getInstance().getEmojiByTypeAndIndex(t.emoji.type,t.emoji.index).value,i=this.getPlayerIndex(t.sender_id),a=new cc.Node,n=a.addComponent(sp.Skeleton);n.skeletonData=e,n.animation="animation",n.premultipliedAlpha=!1,"F"==t.emoji.type&&(a.scale=.6),this.players[i]._playerView.node.addChild(a),this.scheduleOnce(function(){a.destroy()},2)},a.handleSTable=function(t){for(var e=0;e<this.players.length;e++)this.players[e]._playerView.addChildVipLayout(),this.players[e]._playerView.node.destroy();this.players.length=0;var i=JSON.parse(t);this.showMapNode=!0,this.showNumberCard=i.showNumberCard,i.hasOwnProperty("maxBet")?this.setMatchInfo(i.M,i.Id,i.maxBet):this.setMatchInfo(i.M,i.Id);for(var a=i.ArrP,o=0;o<a.length;o++){var r=new n.default;this.players.push(r),r.isAutoPlayLastOne=a[o].isAutoPlayLastOne,r._playerView=cc.instantiate(this.playerPrefab).getComponent("DominoPlayer"),this.node.addChild(r._playerView.node,0),this.readDataPlayer(r,a[o]),r.id===h.default.userId&&(this.thisPlayer=r),r.updatePlayerView(),r.is_ready=!0}null!=this.thisPlayer&&this.addChatJoin(this.thisPlayer.displayName),this.updatePositionPlayerView()},a.handleStartGame=function(t){var e=this;o.default.getInstance().isReconnected=null,this.isPlaying=!0,this.cleanTable(),this.leaveMatch();var i=t.data.countDown;this.startTime.active=!0;var a=this.startTime.getComponentInChildren(cc.Label);a.string=i,this.schedule(function t(){if(--i<0)return e.unschedule(t),void(e.startTime.active=!1);a.string=i},1)},a.updateTable=function(t){var e=this;this.inTurn=t.inTurn;var i=t.remainedFaceletsCount;if(this.mapNode={0:i[0],1:i[1],2:i[2],3:i[3],4:i[4],5:i[5],6:i[6]},cc.tween(this.node).call(function(){for(var t=0;t<e.players.length;t++)e.players[t].setTurn(!1)}).start(),!this.isReloading&&o.default.getInstance().isReconnected||this.gameState!==c.Game.GAME_STATE.RUN&&this.gameState!==c.Game.GAME_STATE.SPECTATING){if(t.action||t.penalty||!t.remaineds||0==t.remaineds.length)return;o.default.getInstance().isReconnected?this.gameState=c.Game.GAME_STATE.RUN:this.gameState!==c.Game.GAME_STATE.RUN&&this.gameState!==c.Game.GAME_STATE.SPECTATING&&(this.gameState=c.Game.GAME_STATE.SPECTATING),this.onReconnected(t)}t.action&&this.handleDc({pid:t.action.userId,idCard:A.findIndex(function(e){return e.top==t.action.domino.top&&e.bottom==t.action.domino.bottom}),side:t.action.position,mapNode:this.mapNode,remaineds:t.remaineds}),t.penalty&&this.handleFold(t.penalty)},a.countDown=function(t){var e=this;if(this.inTurn){if(this.timeCountDown&&this.timeCountDown>t)return;this.timeCountDown=t;var i=7*this.players.length;this.isDealing?(this.isDealing=!1,this.scheduleOnce(function(){e.setPlayerTurn(e.inTurn,e.timeCountDown)},.02*(i+7)+.5)):this.setPlayerTurn(this.inTurn,this.timeCountDown)}},a.showHighlight=function(){this.currentCardBoards.forEach(function(t){t.setColorCard("#6E6E6E")}),this.lastCard.setColorCard("#FFFFFF"),this.cardHead.card&&this.lastCard.checkAttached(this.cardHead.point)&&this.cardHead.card.setColorCard("#FFFFFF"),this.cardTail.card&&this.lastCard.checkAttached(this.cardTail.point)&&this.cardTail.card.setColorCard("#FFFFFF")},a.showResult=function(t){var e=this;this.botInfo.active=!1,this.setPlayerTurn(-1,1),cc.tween(this.node).call(function(){var i="single";switch(t.type){case 2:i="Double";break;case 3:i="Triple";break;case 4:i="Quartet";break;case 5:i="Quintet"}"single"!==i&&e.showHighlight(),e.showAnimationResult(i)}).delay(2).call(function(){e.currentCardBoards.forEach(function(t){cc.tween(t.node).to(.2,{opacity:0}).start()}),t.hands.forEach(function(i){var a,n=e.getPlayerWithId(i.userId);n&&(h.default.userId!==i.userId?i.dominos.map(function(t){return A.findIndex(function(e){return e.top==t.top&&e.bottom==t.bottom})}).forEach(function(i,a){var o,r=null==(o=n.currentCards)?void 0:o.pop(),s=e.board.convertToNodeSpaceAR(n._playerView.getPositionCardRemain());r||(r=e.cloneCard(-1,s)),r.node.position=s,r.node.opacity=255,r.node.scale=.2,r.node.parent=e.board,r.setCardId(i),1==t.type&&r.setColorCard("#6E6E6E"),cc.tween(r.node).delay(.1*a).to(.2,{position:{value:s.add(cc.v2((s.x>-200?-1:1)*a*(r.node.width-30)*r.node.scale,0)),easing:"sineOut"}}).delay(1.5).to(.2,{opacity:0,scale:.2}).call(function(){e.putCardItem(r.node)}).start()}):null==(a=n.currentCards)||a.forEach(function(e,i){1==t.type&&e.setColorCard("#6E6E6E"),cc.tween(e.node).delay(1.5+.1*i).to(.2,{opacity:0,scale:.2}).start()}),n._playerView.setCardRemain(e.showNumberCard,0))})}).delay(2).call(function(){e.wallet.forEach(function(t){null!=t.amountChipAdd&&null!=t.amountChipAdd&&e.getPlayerWithId(t.userId||t.id)._playerView.showEffectWinLose(0==Number(t.amountChipAdd)?0:Number(t.amountChipAdd)>0?1:2)})}).delay(1).call(function(){var t=e.wallet.find(function(t){return null!=t.amountChipAdd&&null!=t.amountChipAdd&&Number(t.amountChipAdd)>0});if(t){var i=e.getPlayerWithId(t.userId||t.id);e.wallet.filter(function(t){return null!=t.amountChipAdd&&null!=t.amountChipAdd&&Number(t.amountChipAdd)<0}).map(function(t){return e.getPlayerWithId(t.userId||t.id)}).forEach(function(t){e.flyChips(5,t._playerView.node.position,i._playerView.node.position,function(){})})}}).delay(1.1).call(function(){e.wallet.forEach(function(t){if(null!=t.amountChipAdd&&null!=t.amountChipAdd){var i=e.getPlayerWithId(t.userId||t.id);i._playerView.effectFlyMoney(Number(t.amountChipAdd),35),i._playerView.setAg(Number(t.amountChipCurrent))}})}).delay(2).call(function(){e.gameState=null,e.cleanTable(),e.leaveMatch()}).start()},a.getTypeWin=function(t){var e="Single";switch(t){case 2:e="Double";break;case 3:e="Triple";break;case 4:e="Quartet";break;case 5:e="Quintet"}return e},a.getPlayerWallet=function(t){var e=this.wallet.find(function(e){return e.userId==t||e.id==t});return Number(e.amountChipCurrent||e.wallet)},a.updateGameBalances=function(t){var e=this;this.wallet.forEach(function(i,a){t.updates.forEach(function(t){i.userId!=t.userId&&i.id!=t.userId||(e.wallet[a]=t)})})},a.onReconnected=function(t){var e,i=this;if(this.currentCardBoards.forEach(function(t){i.putCardItem(t.node)}),this.currentCardBoards=[],this.isReloading=!0,null==(e=t.remaineds)||e.forEach(function(t){var e=i.getPlayerWithId(t.userId);if(e.currentCards||(e.currentCards=[]),i.thisPlayer!=e)for(var a=0;a<t.numCard;a++){var n,o=i.cloneCard(-1,1).node;o.angle=0,o.scale=.45;var r=o.getComponent("DominoCard");e.currentCards||(e.currentCards=[]),null==(n=e.currentCards)||n.push(r),o.position=i.board.convertToNodeSpaceAR(e._playerView.getPositionCardRemain()),o.opacity=0,e._playerView.setCardRemain(i.showNumberCard,t.numCard),i.showMapNode&&(i.diceRemainBar.onShowRemain(),i.diceRemainBar.updateDiceRemain(i.mapNode),cc.tween(i.diceRemainBar.node).to(.2,{position:{value:cc.v2(0,-cc.winSize.height/2),easing:"sineOut"}}).start())}}),t.chain.length>0){var a=t.chain.find(function(t){return 1==t.turnNumber}),n=A.findIndex(function(t){return a.domino.top>a.domino.bottom?a.domino.top==t.bottom&&a.domino.bottom==t.top:a.domino.bottom==t.bottom&&a.domino.top==t.top}),r=t.chain.map(function(t){return A.findIndex(function(e){return t.domino.top>t.domino.bottom?e.top==t.domino.bottom&&e.bottom==t.domino.top:e.top==t.domino.top&&e.bottom==t.domino.bottom})}).reverse();this.initCarDeck(n,r)}this.scheduleOnce(function(){i.isReloading=!1,o.default.getInstance().isReconnected=null},1)},a.handleLc=function(t){var e=this;t.desk&&this.updateTable(t.desk),this.isDealing=!0,this.arrCard=[],this.scheduleOnce(function(){if(t.hand.dominos.sort(function(t,e){return t.bottom>e.bottom||t.bottom==e.bottom&&t.top>e.top?-1:1}).forEach(function(t){e.arrCard.push(A.findIndex(function(e){return e.top==t.top&&e.bottom==t.bottom}))}),o.default.getInstance().isReconnected){var i=e.getPlayerWithId(h.default.userId);return i.currentCards||(i.currentCards=[]),void e.arrCard.forEach(function(t,a){var n,o=cc.v2(79*(a-3),I.y),r=e.cloneCard(t,o).node;r.angle=0,r.scale=.45;var s=r.getComponent("DominoCard");i.currentCards||(i.currentCards=[]),null==(n=i.currentCards)||n.push(s),e.diceRemainBar.listCardDrop.push(t);var c={cardId:t,cardPosition:o,checkAvaiableCardPositionOnBoard:e.checkAvaiableCardPositionOnBoard,submitCard:e.actSubmitCard.bind(e)};s.setCardInfo(c),r.opacity=255})}for(var a=e.players.length,n=7*a,r=n/14,s=cc.v2(-cc.winSize.width/2,cc.winSize.height/2),c=0;c<n;c++)e.cloneCard(-1,s).node;e.scheduleOnce(function(){for(var t=0;t<n;t++){var i=e.board.children[t],a=t;cc.tween(i).delay(.02*t).to(.2,{position:{value:cc.v2(26*(Math.ceil(a/r)-7+.5),0),easing:"sineOut"},opacity:255}).start()}},.1),e.scheduleOnce(function(){var t=e.getPlayerWithId(e.inTurn);if(t){e.players.forEach(function(e){e._playerView.showDealer(e==t,e._indexDynamic>1,!0)}),null==t||t.setHost(!0);for(var i=null==t?void 0:t._indexDynamic,o=e.players.map(function(t){return t._indexDynamic}).sort(),r=function(){var t,r=e.board.children[s];r.angle=0,r.active=!0;var c=o[(n-1-s+o.indexOf(i))%a],l=r.getComponent("DominoCard");l.setColorCard("#FFFFFF");var d=e.getPlayerByDynamicIndex(c);d.currentCards||(d.currentCards=[]),null==(t=d.currentCards)||t.push(l);var h=Math.ceil((n-s)/a);if(0===c){var u=e.arrCard,p=cc.v2(79*(h-1-3),I.y);console.log("cardPosition ",s,p),e.diceRemainBar.listCardDrop.push(u[h-1]),cc.tween(r).delay(.2*(n-1-s)).to(.2,{position:{value:p,easing:"sineOut"},scale:.45}).to(0,{opacity:255}).delay(.02*(h+n)).call(function(){var t={cardId:u[h-1],cardPosition:p,checkAvaiableCardPositionOnBoard:e.checkAvaiableCardPositionOnBoard,submitCard:e.actSubmitCard.bind(e)};l.setCardInfo(t)}).start()}else cc.tween(r).delay(.2*(n-1-s)).to(.2,{position:{value:e.board.convertToNodeSpaceAR(d._playerView.getPositionCardRemain()),easing:"sineOut"}}).to(0,{opacity:0}).call(function(){d._playerView.setCardRemain(e.showNumberCard,h)}).start()},s=n-1;s>=0;s--)r()}},.02*n+.2),e.showMapNode&&(e.diceRemainBar.onShowRemain(),e.diceRemainBar.updateDiceRemain(e.mapNode),cc.tween(e.diceRemainBar.node).to(.2,{position:{value:cc.v2(0,-cc.winSize.height/2),easing:"sineOut"}}).start()),e.scheduleOnce(function(){e.showAnimatonStart(!1)},.2*(n+7)+.5)},.5)},a.handleRJTable=function(t){var e=this,i=JSON.parse(t);this.showMapNode=!0,this.showNumberCard=i.showNumberCard;var a=i.ArrP;this.players=[],i.hasOwnProperty("maxBet")?this.setMatchInfo(i.M,i.Id,i.maxBet):this.setMatchInfo(i.M,i.Id);for(var o=0;o<a.length;o++){var r=new n.default;this.players.push(r),r.isAutoPlayLastOne=a[o].isAutoPlayLastOne,r._playerView=cc.instantiate(this.playerPrefab).getComponent("DominoPlayer"),this.node.addChild(r._playerView.node,0),this.readDataPlayer(r,a[o]),r.id===h.default.userId&&(this.thisPlayer=r),r.updatePlayerView(),r.is_ready=!0}this.updatePositionPlayerView(),null!=this.thisPlayer&&this.addChatJoin(this.thisPlayer.displayName),this.cleanTable(),a.forEach(function(t){var i=e.getPlayerWithId(t.id);t.Arr.sort(function(t,e){return e%7-t%7}).forEach(function(a,n){var o,r=cc.v2(79*(n-3),I.y),s=e.cloneCard(a,r).node;s.angle=0,s.scale=.45;var c=s.getComponent("DominoCard");if(i.currentCards||(i.currentCards=[]),null==(o=i.currentCards)||o.push(c),e.thisPlayer==i){e.diceRemainBar.listCardDrop.push(a);var l={cardId:a,cardPosition:r,checkAvaiableCardPositionOnBoard:e.checkAvaiableCardPositionOnBoard,submitCard:e.actSubmitCard.bind(e)};c.setCardInfo(l),s.opacity=255}else s.position=e.board.convertToNodeSpaceAR(i._playerView.getPositionCardRemain()),s.opacity=0,i._playerView.setCardRemain(e.showNumberCard,t.Arr.length)}),i._playerView.setFoldDice(t.folds),e.showMapNode&&(t.id==h.default.userId&&t.mapNode&&e.diceRemainBar.onShowRemain(),e.diceRemainBar.updateDiceRemain(t.mapNode),cc.tween(e.diceRemainBar.node).to(.2,{position:{value:cc.v2(0,-cc.winSize.height/2),easing:"sineOut"}}).start())}),this.thisPlayer._playerView.icBack.node.active=JSON.parse(cc.sys.localStorage.getItem("isBack")),this.initCarDeck(i.idCardRoot,i.deck),this.scheduleOnce(function(){e.setPlayerTurn(i.currentTurn,i.CT)},2)},a.cloneCard=function(t,e){var i=this.getCardItem();i.scale=.2,i.position=e,i.angle=0,i.active=!0,i.opacity=255,i.parent=this.board;var a=i.getComponent("DominoCard");return a.setCardBack(),a.setEnableMoving(!1,[this.headBoard.point,this.tailBoard.point]),a.setCardId(t),a},a.setCardnormal=function(t){t.scale=.2,t.angle=0,t.active=!0,t.opacity=255},a.onBot=function(){console.log("onBot"),this.botInfo.zIndex=100,this.botInfo.active=!0},a.onBotInfoClick=function(){console.log("onBotInfoClick"),this.botInfo.active=!1},a.handleDc=function(t){var e,i,a=this;this.placeholderCardHead.active=!1,this.placeholderCardTail.active=!1;var n=this.getPlayerWithId(t.pid),o=null;if(n==this.thisPlayer){var r,s,c=null==(r=n.currentCards)?void 0:r.findIndex(function(e){return e.getCardId()===t.idCard});o=null==(s=n.currentCards)?void 0:s.splice(c,1)[0],this.isPlayerSubmit||this.onBot(),this.isPlayerSubmit=!1}else{var l,d,h=null==(l=n.currentCards)?void 0:l.pop();h&&h.node.destroy(),null==(d=t.remaineds)||d.forEach(function(e){e.userId==t.pid&&n._playerView.setCardRemain(a.showNumberCard,e.numCard)})}var u=this.board.convertToNodeSpaceAR(n._playerView.getPositionCardRemain());o?n!=this.thisPlayer&&(o.setCardId(t.idCard),o.node.position=this.board.convertToNodeSpaceAR(n._playerView.getPositionCardRemain()),this.setCardnormal(o.node)):o=this.cloneCard(t.idCard,u),o.setEnableMoving(!1,[this.headBoard.point,this.tailBoard.point]),this.effectDc(o,t,(null==(e=n.currentCards)?void 0:e.length)>0),null==(i=n.currentCards)||i.length,this.diceRemainBar.updateDiceRemain(t.mapNode),this.diceRemainBar.listCardDrop.push(t.idCard)},a.effectDc=function(t,e,i,a,n){var o=this;void 0===i&&(i=!1),void 0===a&&(a=!0),void 0===n&&(n=1),cc.log(e),cc.Tween.stopAllByTarget(t.node);var r=this.getNextPositionCardOnBoardWithSide(t,e.side);if(t.setFrontFrames(r.rotation%180==0?"top":"horizontal"),t.setRotation(180*parseInt(r.rotation/180)),this.cardHead=_({},this.headBoard),this.cardTail=_({},this.tailBoard),this.lastCard=t,cc.tween(t.node).to(.5,{position:r.position,rotation:r.rotation%180,scale:.2}).call(function(){var e=t.getComponent("DominoCard").coordinates.vertical;e<o.minVertical&&(o.minVertical=e),e>o.maxVertical&&(o.maxVertical=e);var i=o.maxVertical+o.minVertical;console.log(e+" "+o.maxVertical+" "+o.minVertical+" "+i),Math.abs(i)>0&&o.changeCardInTable(i<0,Math.abs(i)/2)}).start(),a)switch(e.side){case P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_BOTH:this.headBoard.card=t,this.headBoard.point=t.getComponent("DominoCard").getCardTopPoint(),this.tailBoard.card=t,this.tailBoard.point=t.getComponent("DominoCard").getCardBottomPoint(),this.currentCardBoards.push(t);break;case P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD:if(0==this.currentCardBoards.length){this.headBoard.card=t,this.headBoard.point=t.getComponent("DominoCard").getCardTopPoint(),this.tailBoard.card=t,this.tailBoard.point=t.getComponent("DominoCard").getCardBottomPoint(),this.currentCardBoards.push(t);break}this.currentCardBoards.unshift(t);var s=this.headBoard.point;this.headBoard.card=t,s==t.getComponent("DominoCard").getCardTopPoint()?this.headBoard.point=t.getComponent("DominoCard").getCardBottomPoint():this.headBoard.point=t.getComponent("DominoCard").getCardTopPoint();break;case P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_TAIL:this.currentCardBoards.push(t);var c=this.tailBoard.point;this.tailBoard.card=t,c==t.getComponent("DominoCard").getCardTopPoint()?this.tailBoard.point=t.getComponent("DominoCard").getCardBottomPoint():this.tailBoard.point=t.getComponent("DominoCard").getCardTopPoint()}},a.changeCardInTable=function(t,e){void 0===t&&(t=!0),t?(this.maxVertical+=e,this.minVertical+=e):(this.maxVertical-=e,this.minVertical-=e),this.currentCardBoards.forEach(function(i){if(i){i.getComponent("DominoCard").coordinates.vertical+=t?e:-e;var a=62.5*i.getComponent("DominoCard").coordinates.vertical+7;cc.tween(i.node).to(.5,{y:a}).start()}})},a.handleFold=function(t){var e=this.getPlayerWithId(t.lostPlayer),i={playerIndex:e._indexDynamic,agChange:Number(t.lostPlayerWallet.amountChipAdd),ag:t.lostPlayerWallet.amountChipCurrent};e.setTurn(!1),e._playerView.setFold(i),e._playerView.setFoldDice(t.lostPlayerNotHaveFacelets);var a=this.getPlayerWithId(t.gainPlayer);this.flyChips(5,e._playerView.node.position,a._playerView.node.position,function(){a._playerView.effectFlyMoney(Number(t.gainPlayerWallet.amountChipAdd),35),a._playerView.setAg(t.gainPlayerWallet.amountChipCurrent)})},a.flyChips=function(t,e,i,a){var n=this;void 0===a&&(a=function(){});for(var o=0;o<=t;o++)cc.tween(this.node).delay(.1*o).call(function(){n.createChips(.5,e,i)}).start();this.scheduleOnce(function(){a()},1.1)},a.handleFinish=function(t){var e=this;cc.log(t),this.setPlayerTurn(-1,1),this.unscheduleAllCallbacks(),cc.tween(this.node).call(function(){var i="single";switch(t.winFactor){case 2:i="double";break;case 3:i="triple";break;case 4:i="quartet";break;case 5:i="quintet"}e.showAnimationResult(i)}).delay(Math.max(t.timeAction-2,1)).call(function(){e.currentCardBoards.forEach(function(t){cc.tween(t.node).to(.2,{opacity:0}).start()}),t.players.forEach(function(i){var a,n=e.getPlayerWithId(i.userId);n&&(h.default.userId!=i.userId?i.arrCard.forEach(function(i,a){var o,r=null==(o=n.currentCards)?void 0:o.pop(),s=e.board.convertToNodeSpaceAR(n._playerView.getPositionCardRemain());r||(r=e.cloneCard(-1,s)),r.node.position=s,r.node.opacity=255,r.node.scale=.2,r.node.parent=e.board,r.setCardId(i),1==t.winFactor&&r.setColorCard("#6E6E6E"),cc.tween(r.node).delay(.1*a).to(.2,{position:{value:s.add(cc.v2((s.x>-200?-1:1)*a*(r.node.width-30)*r.node.scale,0)),easing:"sineOut"}}).delay(1.5).to(.2,{opacity:0,scale:.2}).call(function(){e.putCardItem(r.node)}).start()}):null==(a=n.currentCards)||a.forEach(function(e,i){1==t.winFactor&&e.setColorCard("#6E6E6E"),cc.tween(e.node).delay(1.5+.1*i).to(.2,{opacity:0,scale:.2}).start()}),n._playerView.setCardRemain(e.showNumberCard,0),n._playerView.effectFlyMoney(i.M,35),n._playerView.showEffectWinLose(0==i.M?0:i.M>0?1:2),n.ag=i.ag,n._playerView.setAg(i.ag))})}).delay(2).call(function(){e.cleanTable()}).start()},a.getDynamicIndex=function(t){return t},a.getCardItem=function(){var t=this.cardPool.get();return t||(t=cc.instantiate(this.cardPrefab)),t},a.putCardItem=function(t){t.getComponent("DominoCard").resetCardInfo(),this.cardPool.put(t)},a.getPlayerByDynamicIndex=function(t){for(var e=0;e<this.players.length;e++){var i=this.players[e];if(i._indexDynamic===t)return i}},a.setPlayerTurn=function(t,e){var i=this;cc.tween(this.node).call(function(){for(var a,n=0;n<i.players.length;n++)i.players[n].setTurn(!1);i.setEnableMyCurrentCards(h.default.userId==t);var o=i.getPlayerWithId(t);o&&(o!=i.thisPlayer?o.setTurn(!0,e,!0):null==(a=o.currentCards)||a.forEach(function(t){var a=[null,t.getCardBottomPoint(),t.getCardTopPoint()];[i.headBoard.point,i.tailBoard.point].filter(function(t){return a.includes(t)}).length>0&&o.setTurn(!0,e,!0)}))}).start()},a.cleanTable=function(){var t=this;this.startTime.active=!1,this.popupResult.active=!1,this.popupResultItems.destroyAllChildren(),this.minVertical=0,this.maxVertical=0,this.cardHead=null,this.cardTail=null,this.lastCard=null,this.oderDisCard.active=!1,this.setOderDisCard=!0,this.animationResult.node.active=!1,this.placeholderCardHead.active=!1,this.placeholderCardTail.active=!1,this.players.forEach(function(e){var i;e.currentCards||(e.currentCards=[]),null==(i=e.currentCards)||i.forEach(function(e){t.putCardItem(e.node)}),e.currentCards=[],e._playerView.setCardRemain(t.showNumberCard,0),e._playerView.resetFoldDice()}),this.currentCardBoards.forEach(function(e){t.putCardItem(e.node)}),this.currentCardBoards=[],this.headBoard={card:null,point:null},this.tailBoard={card:null,point:null},this.showMapNode&&(this.diceRemainBar.resetDiceRemain(),cc.tween(this.diceRemainBar.node).to(.2,{position:{value:cc.v2(0,-cc.winSize.height/2-200),easing:"sineOut"}}).start())},a.showAnimatonStart=function(t){this.animationStart.node.active=t,t&&this.animationStart.setAnimation(0,"animation",!1)},a.setEnableMyCurrentCards=function(e){var i,a,n=this;if(console.log("setEnableMyCurrentCards",e,this.gameState),this.gameState===c.Game.GAME_STATE.RUN){var o=this.getPlayerWithId(h.default.userId);if(!o)return cc.error("miss player ");if(this.placeholderCardHead.active=!1,this.placeholderCardTail.active=!1,this.placeholderCardHead.getChildByName("high_light").active=!1,this.placeholderCardTail.getChildByName("high_light").active=!1,cc.log("set setEnableMyCurrentCards",e),e&&1==(null==(i=o.currentCards)?void 0:i.length)&&o.isAutoPlayLastOne){var r=o.currentCards[0],s=r.getCardTopPoint(),l=r.getCardBottomPoint();return s==this.headBoard.point||l==this.headBoard.point?(t("DominoNetworkTransport").getInstance().sendDomino({user_id:h.default.userId,domino:A[r.getCardId()],position:P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD}),cc.log("auto dis head")):s==this.tailBoard.point||l==this.tailBoard.point?(t("DominoNetworkTransport").getInstance().sendDomino({user_id:h.default.userId,domino:A[r.getCardId()],position:P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_TAIL}),cc.log("auto dis tail")):(r.setEnableMoving(e,[this.headBoard.point,this.tailBoard.point]),cc.log("not find card auto"))}this.setStateAutoDisCard(o.isAutoPlayLastOne),null==(a=o.currentCards)||a.forEach(function(t,i){cc.tween(t.node).to(.5,{position:cc.v2(79*(i-3),I.y),rotation:0,opacity:255,scale:.45}).start(),t.positionOnHand=cc.v2(79*(i-3),I.y),t.setFrontFrames("top"),t.setEnableMoving(e,[n.headBoard.point,n.tailBoard.point])})}},a.changeOderDisCard=function(){var t=this.getPlayerWithId(h.default.userId);t.isAutoPlayLastOne=!t.isAutoPlayLastOne},a.setStateAutoDisCard=function(t){var e,i=this.getPlayerWithId(h.default.userId);i.isAutoPlayLastOne=t,this.oderDisCard.active=1==(null==(e=i.currentCards)?void 0:e.length),this.oderDisCard.getComponent(cc.Toggle).isChecked=t},a.checkAvaiableCardPositionOnBoard=function(t){var e=this;if(!(t.node.position.y-t.getPositionOnHand().y<=t.node.getContentSize()/2)){this.placeholderCardHead.active=!1,this.placeholderCardTail.active=!1,this.placeholderCardHead.getChildByName("high_light").active=!1,this.placeholderCardTail.getChildByName("high_light").active=!1,this.targetCard=t;var i=t.node.position;if(0==this.currentCardBoards.length){var a=this.getNextPositionCardOnBoardWithSide(t,P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD);this.placeholderCardHead.getComponent("DominoCard").setCardId(t.cardId),cc.Tween.stopAllByTarget(this.placeholderCardHead),cc.tween(this.placeholderCardHead).call(function(){e.placeholderCardHead.position=a.position,e.placeholderCardHead.rotation=a.rotation}).call(function(){e.placeholderCardHead.active=!0,e.placeholderCardHead.getChildByName("high_light").active=Math.abs(i.y)<200&&Math.abs(i.x)<cc.winSize.width/2}).start(),this.sideSubmit=P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD}else{var n=t.getCardTopPoint(),o=t.getCardBottomPoint(),r=2*Math.pow(cc.winSize.width,2),s=2*Math.pow(cc.winSize.width,2);if(n==this.headBoard.point||o==this.headBoard.point){var c=this.getNextPositionCardOnBoardWithSide(t,P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD);this.placeholderCardHead.getComponent("DominoCard").setCardId(t.cardId);var l=i.sub(c.position);r=Math.pow(l.x,2)+Math.pow(l.y,2),cc.Tween.stopAllByTarget(this.placeholderCardHead),cc.tween(this.placeholderCardHead).call(function(){e.placeholderCardHead.position=c.position,e.placeholderCardHead.rotation=c.rotation}).call(function(){e.placeholderCardHead.active=!0,e.placeholderCardHead.getChildByName("high_light").active=s>r&&Math.abs(i.y)<200&&Math.abs(i.x)<cc.winSize.width/2}).start()}if(n==this.tailBoard.point||o==this.tailBoard.point){var d=this.getNextPositionCardOnBoardWithSide(t,P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_TAIL);this.placeholderCardTail.getComponent("DominoCard").setCardId(t.cardId);var h=i.sub(d.position);s=Math.pow(h.x,2)+Math.pow(h.y,2),cc.Tween.stopAllByTarget(this.placeholderCardTail),cc.tween(this.placeholderCardTail).call(function(){e.placeholderCardTail.position=d.position,e.placeholderCardTail.rotation=d.rotation}).call(function(){e.placeholderCardTail.active=!0,e.placeholderCardTail.getChildByName("high_light").active=s<r&&Math.abs(i.y)<200&&Math.abs(i.x)<cc.winSize.width/2}).start()}this.sideSubmit=s>r?P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD:P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_TAIL}}},a.getNextPositionCardOnBoardWithSide=function(t,e){var i=null,a=null,n={horizontal:0,vertical:0,trend:"center",pre_trend:"center"},o=t.isSamePoint(),r=0;switch(e){case P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_BOTH:return{position:cc.Vec2.ZERO.add(cc.v2(0,7)),rotation:o?0:90};case P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_HEAD:if(!this.currentCardBoards||0==this.currentCardBoards.length)return{position:cc.Vec2.ZERO.add(cc.v2(0,7)),rotation:o?0:90};a=(i=this.currentCardBoards[0].getComponent("DominoCard")).coordinates,n.pre_trend=a.trend,n.trend="center"==n.pre_trend?"right":a.trend,r=this.headBoard.point;break;case P.GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_POSITION_GAPLE_DOMINO_CHAIN_TAIL:a=(i=this.currentCardBoards[this.currentCardBoards.length-1].getComponent("DominoCard")).coordinates,n.pre_trend=a.trend,n.trend="center"==n.pre_trend?"left":a.trend,r=this.tailBoard.point}if(!i)return cc.log("khong biet gan vao dau nao ca");var s=i.isSamePoint()&&!["top","bottom"].includes(a.pre_trend)?.25:.5,c=0,l=o?.25:.5;switch(n.trend){case"left":a.horizontal<-3&&!i.isSamePoint()?(n.horizontal=a.horizontal-.25,n.vertical=a.vertical<0?a.vertical-.75:a.vertical+.75,n.trend=a.vertical<0?"bottom":"top"):(n.horizontal=a.horizontal-(l+s),n.vertical=a.vertical);break;case"right":a.horizontal>3&&!i.isSamePoint()?(n.horizontal=a.horizontal+.25,n.vertical=a.vertical<=0?a.vertical-.75:a.vertical+.75,n.trend=a.vertical<=0?"bottom":"top"):(n.horizontal=a.horizontal+(l+s),n.vertical=a.vertical);break;case"top":n.horizontal=a.horizontal<0?a.horizontal+.25:a.horizontal-.25,n.vertical=a.vertical+.75,n.trend=a.horizontal<0?"right":"left";break;case"bottom":n.horizontal=a.horizontal<0?a.horizontal+.25:a.horizontal-.25,n.vertical=a.vertical-.75,n.trend=a.horizontal<0?"right":"left"}switch(n.trend){case"left":c=r==t.getComponent("DominoCard").getCardTopPoint()?0:180;break;case"right":case"top":c=r==t.getComponent("DominoCard").getCardTopPoint()?180:0;break;case"bottom":c=r==t.getComponent("DominoCard").getCardTopPoint()?0:180}t.getComponent("DominoCard").coordinates=n;var d=c+(["top","bottom"].includes(n.trend)||o&&!["top","bottom"].includes(a.trend)?0:90);return{position:cc.v2(56.5*n.horizontal,62.5*n.vertical+7),rotation:d}},a.handleCCTable=function(t){var e=t.Name,i=this.getPlayer(e);if(null!==i)for(var a=0;a<this.players.length;a++){var n=this.players[a];n==i?n.setHost(!0):n.setHost(!1)}},a.readDataPlayer=function(t,e){t.id=e.id,t.sid=e.SId,t.pname=e.N,t.ag=e.AG,t.vip=e.VIP,t.avatar_id=e.Av,t.is_ready=e.isStart,t.ip=e.sIP,t.displayName=e.displayName,t.order=e.Order,null!=e.keyObjectInGame&&(t.keyObjectInGame=e.keyObjectInGame)},a.removePlayer=function(t,e){void 0===e&&(e=!1);var i=this.getPlayer(t);null!==i&&(this.players.splice(this.players.indexOf(i),1),i.clearAllCard(),i._playerView.node.destroy(),i=null,e||this.updatePositionPlayerView())},a.removeAllPlayer=function(){for(var t=0;t<this.players.length;t++){var e=this.players[t];e.clearAllCard(),e._playerView.node.destroy(),e=null}this.players=[]},a.handleLTable=function(t){var e=t.Name,i=this.getPlayer(e);null!=i&&void 0!==i&&e!==h.default.displayName&&this.removePlayer(e)},a.handleRTable=function(t){var e=t.Name,i=this.getPlayer(e);null!==i&&i.setReady(!0)},a.sendTrackingGame=function(){},a.handleFinishGame=function(){this.clearAllCard()},a.addChatJoin=function(){},a.addChatLeave=function(){},a.startGameAndSendTracking=function(){},a.clearAllCard=function(){for(var t=0;t<this.players.length;t++)this.players[t].clearAllCard()},a.setTurn=function(t,e){if(void 0===e&&(e=20),null===this.turnCurrentPlayer)for(var i=0;i<this.players.length;i++)this.players[i].setTurn(!1);else this.turnCurrentPlayer.setTurn(!1);this.turnCurrentPlayer=this.getPlayer(t),null!==this.turnCurrentPlayer&&this.turnCurrentPlayer.setTurn(!0,e)},a.getPlayer=function(t){for(var e=0;e<this.players.length;e++)if(t===this.players[e].pname||t===this.players[e]._displayName)return this.players[e];return null},a.getIndexWithName=function(t){for(var e=0;e<this.players.length;e++)if(t===this.players[e].pname)return e;return null},a.getIndexOfPlayer=function(t){return t.order},a.getIndexOf=function(t){this.players.length;var e=this.getIndexOfPlayer(t),i=4;return this.thisPlayer&&(i=this.getIndexOfPlayer(this.thisPlayer)),(e+4-i)%4},a.getPlayerWithId=function(t){for(var e=0;e<this.players.length;e++)if(t==this.players[e].id)return this.players[e];return null},a.generateRandomNumber=function(t,e){var i=Math.random()*(e-t)+t;return Math.floor(i)},a.removerCard=function(t){this.cardPool.put(t)},a.setTimeout=function(t){function e(e,i){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){var i=this;setTimeout(function(){null!=i.node&&t.call()},e)}),a)),N=T;i.default=N,e.exports=i.default,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/chatingame/ChatInGameDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/game/GamePresenter":void 0,"../../lobby/src/language/LanguageController":void 0,"../../lobby/src/scripts/ingame/BubbleChat":void 0,"../../lobby/src/scripts/ingame/Card":void 0,"./GapleRuleDialog":"GapleRuleDialog",DominoCardRemain:"DominoCardRemain",DominoNetworkTransport:"DominoNetworkTransport",Player:"Player"}],DominoNetworkTransport:[function(t,e){"use strict";cc._RF.push(e,"6b32dfbNoRMp6t79ofX6bOr","DominoNetworkTransport");var i=c(t("../../lobby/src/network/NetworkClient")),a=c(t("../../lobby/src/common/ConfigClient")),n=t("../../lobby/src/common/Constants"),o=c(t("../../lobby/src/common/GlobalApp")),r=c(t("../../lobby/src/common/User")),s=c(t("../../lobby/src/chat/ChatPresenter"));function c(t){return t&&t.__esModule?t:{default:t}}var l=cc.Class({extends:cc.Component,properties:{instance:null},statics:{getInstance:function(){return null==this.instance&&(this.instance=new l,i.default.getInstance().subscribeEventHandler(n.Game.Enum.GAPLE,this.instance)),this.instance}},matchDataHandler:function(e){switch(e.op_code){case a.default.Network.OP_CODE.OPCODE_UPDATE_TABLE:cc.log("OPCODE_UPDATE_TABLE",e.data),t("DominoController").getInstance().updateTable(e.data);break;case a.default.Network.OP_CODE.OPCODE_UPDATE_DEAL:cc.log("OPCODE_UPDATE_DEAL",e.data),t("DominoController").getInstance().gameState=n.Game.GAME_STATE.RUN,t("DominoController").getInstance().handleLc(e.data);break;case a.default.Network.OP_CODE.OPCODE_UPDATE_GAME_STATE:this.processUpdateGameState(e);break;case a.default.Network.OP_CODE.OPCODE_UPDATE_FINISH:cc.log("result",e),t("DominoController").getInstance().showResult(e.data);break;case a.default.Network.OP_CODE.OPCODE_UPDATE_WALLET:cc.log("wallet",e),t("DominoController").getInstance().updateGameBalances(e.data);break;case a.default.Network.OP_CODE.OPCODE_KICK_OFF_THE_TABLE:cc.log("kick off",e),this.onQuit();break;case a.default.Network.OP_CODE.OPCODE_LIST_PLAYER:cc.log("OPCODE_LIST_PLAYER",e),t("DominoController").getInstance().handlePlayers(e);break;default:cc.log("Data code not found ",e)}},processUpdateGameState:function(e){switch(e.data.state){case n.Game.GAME_STATE.PREPARE:if(t("DominoController").getInstance().gameState==n.Game.GAME_STATE.PREPARE)return;t("DominoController").getInstance().gameState=n.Game.GAME_STATE.PREPARE,t("DominoController").getInstance().handleStartGame(e);break;case n.Game.GAME_STATE.RUN:t("DominoController").getInstance().gameState==n.Game.GAME_STATE.PREPARE&&t("DominoController").getInstance().showAnimatonStart(!0),t("DominoController").getInstance().countDown(e.data.countDown);break;case n.Game.GAME_STATE.REWARD:cc.log("GAME_STATE.REWARD",e),t("DominoController").getInstance().gameState=n.Game.GAME_STATE.REWARD;break;case n.Game.GAME_STATE.FINISH:cc.log("GAME_STATE.FINISH",e);break;default:cc.log("Match state not found ",e)}},sendDomino:function(t){i.default.getInstance().sendMatchState(o.default.getInstance().matchInfo.match_id,a.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_DECLARE_CARDS,t).then(function(t){cc.log("sendDomino success ",t)},function(t){cc.log("sendDomino err",t)})},getUsers:function(){i.default.getInstance().sendMatchState(o.default.getInstance().matchInfo.match_id,a.default.Network.OP_CODE_REQUEST.OPCODE_LIST_USERS,{}).then(function(){cc.log("list users ")},function(t){cc.log("get list users failed",t)})},onQuit:function(e,n){void 0===e&&(e=function(){}),void 0===n&&(n=!0),i.default.getInstance().leaveMatch(o.default.getInstance().matchInfo.match_id).then(function(i){cc.log("leave match: ",i),t("DominoController").getInstance().gameState=null,s.default.getInstance().leaveChat(),n&&o.default.getInstance().loadSceneByBundle(r.default.vipLevel>0?a.default.AppInfo.SCENE_NAME.TABLELIST:a.default.AppInfo.SCENE_NAME.GAMELIST),e&&e()},function(t){cc.log("err when leave match",t)})}});e.exports=l,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/network/NetworkClient":void 0,DominoController:"DominoController"}],DominoPlayer:[function(t,e){"use strict";cc._RF.push(e,"c559fASH8JD3ohn+O0E+zDx","DominoPlayer");var i=l(t("../../lobby/src/language/LanguageController")),a=l(t("../../lobby/src/common/Utils")),n=l(t("../../lobby/src/common/User")),o=l(t("../../lobby/src/network/NetworkClient")),r=l(t("../../lobby/src/common/GlobalApp")),s=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=c(void 0);if(e&&e.has(t))return e.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=a?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=t[n]}return i.default=t,e&&e.set(t,i),i}(t("../../lobby/src/dialogs/playerinfo/PlayerInfoDialog"));function c(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(c=function(t){return t?i:e})(t)}function l(t){return t&&t.__esModule?t:{default:t}}cc.Class({extends:cc.Component,properties:{lbName:{default:null,type:cc.Label},lbAg:{default:null,type:cc.Label},imgAvatar:{default:null,type:cc.Sprite},vipBorder:{default:null,type:cc.Sprite},animVip:{default:null,type:cc.Node},imgTime:{default:null,type:cc.Sprite},time_turn:20,time_turn_cur:0,imgHost:cc.Node,id_pl:{default:"",visible:!1},name_pl:{default:"",visible:!1},avaid_pl:{default:0,visible:!1},chip_pl:{default:0,visible:!1},vip_pl:{default:0,visible:!1},sid_pl:{default:0,visible:!1},aniLose:{default:null,type:sp.Skeleton},aniWin:{default:null,type:sp.Skeleton},aniDraw:{default:null,type:sp.Skeleton},fontPlus:{default:null,type:cc.Font},fontSub:{default:null,type:cc.Font},aniPhao:{default:null,type:sp.Skeleton},lbVip:cc.Label,bkgThanhBar:cc.Node,isDealer:!1,_isTurn:!1,isRunEffect:!1,isPlayer:!1,listChipBetPl:[],isCurMoney:0,isLastMoney:0,isDeltaMoney:0,isDeltaTime:0,order:0,isRunAction:!1,icBack:cc.Sprite,listSprBack:[cc.SpriteFrame],lbScore:{default:null,type:cc.Label},lbDeclare:{default:null,type:cc.Label},chipJackpot:0,isVibrator:!1,listImgVip:[cc.Node],animVipLayout:cc.Node,justClick:!1,currentObjectIngame:null,nodeCard:cc.Node,dealerIcon:cc.Node,hitpot:cc.Node,foldNode:cc.Node,cardRemainNode:cc.Node,listFoldNode:cc.Node,currentCards:[]},update:function(t){if(this._isTurn)if(this.time_turn_cur+=t,this.time_turn_cur<=this.time_turn){this.imgTime.fillRange=(this.time_turn-this.time_turn_cur)/this.time_turn;var e=this.imgTime.node.getComponentInChildren(cc.Label);e&&(e.string=parseInt(this.time_turn-this.time_turn_cur)+1)}else this.imgTime.node.active=!1,this._isTurn=!1;this.isRunEffect&&(this.isDeltaTime+=t)>=.01&&(this.isDeltaTime=0,this.isCurMoney+=this.isDeltaMoney,this.isCurMoney>=this.isLastMoney&&this.isDeltaMoney>0&&(this.isCurMoney=this.isLastMoney,this.isRunEffect=!1),this.isCurMoney<=this.isLastMoney&&this.isDeltaMoney<0&&(this.isCurMoney=this.isLastMoney,this.isRunEffect=!1),this.lbAg.string=a.default.formatMoney(this.isCurMoney))},onLoad:function(){var t=this;this.node.on("position-changed",function(){t.updateAnimVipPos()},this),this.node.parent.on("touchstart",function(){t.closeListAnimVip()},this)},onEnable:function(){this.setTurn(!1,0),this.bkgThanhBar.position=cc.v2(0,-80),this.icBack.node.active=!1,this.isRunEffect=!1,this.aniWin.node.active=!1,this.aniDraw.node.active=!1,this.aniLose.node.active=!1},effLbName:function(){if(this.lbName.node.stopAllActions(),this.lbName.node.position=cc.v2(0,0),this.lbName.node.width>this.lbName.node.parent.width-10){var t=(this.lbName.node.width-this.lbName.node.parent.width)/2,e=t/30,i=cc.moveTo(e,t,0),a=cc.moveTo(e,-t,0);if(e<1&&(e=1),t<3)return;this.lbName.node.anchorX=.5,this.lbName.node.x=-t,this.lbName.node.runAction(cc.repeatForever(cc.sequence(cc.delayTime(1.5),i,cc.delayTime(1.5),a)))}},setPosThanhBarThisPlayer:function(t){void 0===t&&(t=!0),this.bkgThanhBar.position=t?cc.v2(0,-80):cc.v2(150,-20)},onAvtClick:function(){s.default.show(s.PlayerInfo.toPlayerInfo(this.id_pl,this.displayName,this.chip_pl,this.sid_pl,this.avaid_pl,this.vip_pl))},setData:function(t,e,i,a,n,o,r,s,c,l){this.id_pl=t,this.name_pl=e,this.chip_pl=a,this.vip_pl=i,this.avaid_pl=n,this.sid_pl=c,this.displayName=r,this.order=l,null!=s?this.showAnimVip(s):this.animVip.active=!1},setName:function(t){var e=this;null!==this.lbName&&(this.lbName.string=t),this.scheduleOnce(function(){e.effLbName()},.1)},setAg:function(t){this.chip_pl=t,null!==this.lbAg&&(this.lbAg.string=a.default.formatMoney(t),this.lbAg.node.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1))))},setVip:function(t){null!==this.lbVip&&(this.lbVip.string=i.default.getInstance().getString("txt_vip")+t),this.vip_pl=t},setHost:function(t){null!==this.imgHost&&(this.imgHost.node.active=t)},setReady:function(){this.imgAvatar.node.color=cc.Color.WHITE},setTurn:function(t,e,i,a){if(void 0===a&&(a=null),this.imgTime&&this.imgTime.node){this.imgTime.node.active=t,this._isTurn=t,this.isVibrator=!1;var n=this.node.scale;t&&(i&&this.node.runAction(cc.sequence(cc.scaleTo(.15,1.2*n),cc.scaleTo(.15,1*n))),this.time_turn_cur=0,this.time_turn=e,this.imgTime.fillRange=1)}},setAvatar:function(t){this.imgAvatar.spriteFrame=r.default.getInstance().getAvatarById(t)},setDark:function(t){this.imgAvatar.node.color=t?cc.Color.GRAY:cc.Color.WHITE},updatePlayerView:function(){this.setReady(!0)},showEffectWinLose:function(t){var e=this;if(0===t){this.aniDraw.node.active=!0,this.aniDraw.setAnimation(0,"lose",!0);var i=function(){e.aniDraw.node.active=!1},a=this.aniDraw.node}else 1===t?(this.aniWin.node.active=!0,this.aniWin.setAnimation(0,"win",!0),i=function(){e.aniWin.node.active=!1},a=this.aniWin.node):(this.aniLose.node.active=!0,this.aniLose.setAnimation(0,"lose",!0),i=function(){e.aniLose.node.active=!1},a=this.aniLose.node);a.stopAllActions(),a.runAction(cc.sequence(cc.delayTime(2),cc.callFunc(i)))},getChipbet:function(t){for(var e,i=0;i<this.listChipBetPl.length;i++)if(this.listChipBetPl[i].typeBet===t){e=this.listChipBetPl[i];break}return e},effectFlyMoney:function(t,e,i,n,o){if(void 0===e&&(e=50),void 0===i&&(i=50),void 0===n&&(n=0),void 0===o&&(o=0),"number"==typeof t&&0!=t){var r="",s=null;if(t>=0?(r="+",s=this.fontPlus):(r="-",s=this.fontSub),null!=this.node){var c=new cc.Node("TextFly"),l=c.addComponent(cc.Label);l.string=r+a.default.formatMoney(Math.abs(t)),l.fontSize=e,l.font=s,c.position=this.node.position.add(cc.v2(n,o-50*Math.random())),this.node.getParent().addChild(c);var d=cc.moveBy(2,cc.v2(0,i)),h=cc.delayTime(d.getDuration()-.5),u=cc.fadeOut(d.getDuration()-h.getDuration()),p=cc.spawn(d,cc.sequence(h,u)),m=cc.sequence(p,cc.callFunc(function(){null!==l.node&&l.node.destroy()}));l.node.runAction(m)}}},setIconBackOrChange:function(t){this.icBack.spriteFrame=this.listSprBack[t]},setupEffectChangeMoney:function(t,e){this.isCurMoney=t,this.isLastMoney=e;var i=e-t,a=0;0!=i&&(i>0?(a=i<10?i/5:i<300?i/30:i/70)<1&&(a=1):a=i>-10?i/5:i>-300?i/50:i/100,this.isDeltaMoney=Math.floor(a),this.isRunEffect=!0)},effectScaleMoney:function(){var t=this;this.isRunAction=!0,this.lbAg.node.runAction(cc.sequence(cc.scaleTo(.05,1.2),cc.scaleTo(.05,1))),setTimeout(function(){null!=t.node&&void 0!==t.node&&(t.isRunAction=!1)},100)},setScore:function(t){t<0?this.lbScore.node.getParent().active=!1:(this.lbScore.node.getParent().active=!0,this.lbScore.string=t+"")},setDeclare:function(t){this.setScore(t),this.lbDeclare.node.setScale(2),this.lbDeclare.string=cc.js.formatStr("%s %d",i.default.getInstance().getString("txt_lose"),t),this.lbDeclare.node.runAction(cc.sequence(cc.delayTime(.2),cc.scaleTo(.1,1)))},showAnimVip:function(t){if(this.vip_pl<5||0==t)this.animVip.active=!1;else{n.default.userId!=this.id_pl&&(this.animVip.getComponent(cc.Button).interactable=!1);var e=this.animVip.getChildByName("ani");this.animVip.active=!0,e.active=!0;var i="v_"+t/10;e.getComponent(sp.Skeleton).setAnimation(0,i,!0),this.currentObjectIngame=t}},updateAnimVipPos:function(){this.node.x<=20?(this.animVip.x=-70,this.animVipLayout.anchorX=1):(this.animVip.x=70,this.animVipLayout.anchorX=0)},onClickShowAnimVip:function(){var e=this;if(!(this.vip_pl<=5||this.justClick))if(1!=this.animVipLayout.active){var i=this.vip_pl-4;this.listImgVip.forEach(function(t){t.active=e.listImgVip.indexOf(t)<i}),this.animVipLayout.setScale(0),this.animVipLayout.active=!0,this.animVipLayout.stopAllActions(),this.justClick=!0;var a=this.node.convertToWorldSpaceAR(this.animVipLayout.position);this.animVipLayout.parent=t("DominoController").getInstance().node,this.animVipLayout.position=t("DominoController").getInstance().node.convertToNodeSpaceAR(a),this.animVipLayout.runAction(cc.scaleTo(.3,1).easing(cc.easeBackOut())),this.scheduleOnce(function(){e.justClick=!1},.3)}else this.closeListAnimVip()},addChildVipLayout:function(){this.animVipLayout.parent=this.node},closeListAnimVip:function(){var e=this;this.justClick||(this.animVipLayout.stopAllActions(),this.animVipLayout.runAction(cc.sequence(cc.scaleTo(.3,0).easing(cc.easeBackIn()),cc.callFunc(function(){e.animVipLayout.parent=e.node;var i=t("DominoController").getInstance().node.convertToWorldSpaceAR(e.animVipLayout.position);e.animVipLayout.parent=t("DominoController").getInstance().node,e.animVipLayout.position=e.node.convertToNodeSpaceAR(i),e.animVipLayout.active=!1}))),this.justClick=!0,this.scheduleOnce(function(){e.justClick=!1},.3))},clickChooseAnimVip:function(t,e){this.closeListAnimVip(),10*e!=this.currentObjectIngame&&o.default.getInstance().sendKeyObjectInGame(10*e)},clearNodeCard:function(){this.nodeCard.destroyAllChildren()},showDealer:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),this.dealerIcon.active=t,t&&(this.dealerIcon.x=1==e?-85:85,this.dealerIcon.y=1==i?50:-50,this.dealerIcon.opacity=0,this.dealerIcon.setScale(0),this.dealerIcon.stopAllActions(),this.dealerIcon.runAction(cc.spawn(cc.scaleTo(.4,1).easing(cc.easeBackOut()),cc.fadeIn(.4))))},showLucky9Anim:function(){},enableHitpot:function(t){void 0===t&&(t=!1),this.hitpot.active=t},setHitpot:function(t){for(var e=this.hitpot.children,i=4;i<e.length;i++)e[i].active=i<t+4,i==t+3&&(e[i].setScale(1.5),e[i].runAction(cc.spawn(cc.scaleTo(.2,1).easing(cc.easeBackIn()),cc.fadeIn(.2))))},onBankerXocDia:function(){this.node.getChildByName("iconBankerXocDia").active=!0},offBankerXocDia:function(){this.node.getChildByName("iconBankerXocDia").active=!1},isTurn:function(){return this._isTurn},setFold:function(t){var e=this;this.foldNode.children[0].active=t.playerIndex<2,this.foldNode.children[1].active=t.playerIndex>=2,this.foldNode.active=!0;var i=this.foldNode.children[t.playerIndex<3?0:1];i.setScale(0),cc.tween(i).to(.2,{scale:{value:1,easing:"sineOut"}}).delay(2).call(function(){e.foldNode.active=!1}).start(),this.effectFlyMoney(t.agChange,35),this.setAg(t.ag)},setPosFold:function(t){void 0===t&&(t=!0),this.listFoldNode.position=t?cc.v2(0,100):cc.v2(150,40)},setPositionCardRemain:function(t){switch(t){case 0:case 1:case 2:this.cardRemainNode.setPosition(-98,0);break;case 3:this.cardRemainNode.setPosition(96,0)}},setCardRemain:function(t,e){this.cardRemainNode.active=e>0,this.cardRemainNode.getComponentInChildren(cc.Label).string=t?e:""},getPositionCardRemain:function(){return this.cardRemainNode.getParent().convertToWorldSpaceAR(this.cardRemainNode.getPosition())},resetFoldDice:function(){this.listFoldNode.children.forEach(function(t){t.active=!1})},setFoldDice:function(t){var e=this;t.forEach(function(t){var i=e.listFoldNode.getChildByName(t.toString());if(!i)return cc.log("name dice loi ",t);i.active=!0})}}),cc._RF.pop()},{"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/playerinfo/PlayerInfoDialog":void 0,"../../lobby/src/language/LanguageController":void 0,"../../lobby/src/network/NetworkClient":void 0,DominoController:"DominoController"}],DominoPresenter:[function(t,e){"use strict";cc._RF.push(e,"f85feWaXnlMUanP/zS8TAoo","DominoPresenter"),cc.Class({extends:cc.Component,statics:{},properties:{}}),cc._RF.pop()},{}],GapleRuleDialog:[function(t,e,i){"use strict";cc._RF.push(e,"2c7d9m80RREN4S3t9SFmrj2","GapleRuleDialog");var a,n=this&&this.__decorate||function(t,e,i,a){var n,o=arguments.length,r=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,a);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(r=(o<3?n(r):o>3?n(e,i,r):n(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});const o=t("../../../bundles/lobby/src/common/BaseDialog"),r=t("../../../bundles/lobby/src/common/GlobalApp"),s=t("../../../bundles/lobby/src/common/ConfigClient"),{ccclass:c,property:l}=cc._decorator;let d=a=class extends o.default{static getInstance(){return this.instance}static show(t){null==this.instance||null==this.instance.node?r.default.getInstance().loadPrefabByBundle(s.default.Bundle.BUNDLE_NAME.GAPLE,"res/prefabs/GapleRuleDialog",(e,i)=>{if(null!=e)return void r.default.getInstance().alertDialog.showMessage(e);let n=cc.instantiate(i);n.parent=t,this.instance=n.getComponent(a),this.instance.node.zIndex=1e3,this.instance.show()}):(this.instance.node.zIndex=1e3,this.instance.show())}};d.instance=null,d=a=n([c],d),i.default=d,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}],Player:[function(t,e){"use strict";cc._RF.push(e,"0b6c2dNlilD7rWZmbQvL/nt","Player");var i,a=(i=t("../../lobby/src/scripts/ingame/Card"))&&i.__esModule?i:{default:i},n=cc.Class({properties:{_playerView:null,id:0,fid:0,sid:0,order:0,pname:"",ag:{get:function(){return this._ag},set:function(t){this._ag=t,this.updateMoney()}},vip:0,avatar_id:0,avatar_url:"",is_ready:!1,ip:"",is_turn:!1,is_host:!1,is_dealer:!1,point:0,typeWin:-1,numberCard:0,mauBinhSoBai:!1,isSapLang:!1,mauBinh_BL:!1,mauBinh_M:0,mauBinh_MB:0,timeSwapCard:0,totalPoint:0,scoreChi1:0,scoreChi2:0,scoreChi3:0,bonusChi1:0,bonusChi2:0,bonusChi3:0,vectorChi1:{default:[],type:[a.default]},vectorChi2:{default:[],type:[a.default]},vectorChi3:{default:[],type:[a.default]},vectorCard:{default:[],type:[a.default]},vectorCardD:{default:[],type:[a.default]},vectorCardP1:{default:[],type:[a.default]},vectorCardP2:{default:[],type:[a.default]},vectorCardP3:{default:[],type:[a.default]},arrBinhWin:[],arrCodeCard:[],isSpecial:!1,rate:0,isFold:!1,_indexDynamic:null,_displayName:null,displayName:{get:function(){return null==this._displayName||""==this._displayName?this.pname:this._displayName},set:function(t){null!=t&&void 0!==t&&(this._displayName=t)}},keyObjectInGame:null},updatePlayerView:function(){this.updateData(),this.updateName(),this.updateMoney(),this.updateVip(),this.updateAvatar(),this._playerView.updatePlayerView()},updateData:function(){null!=this._playerView&&this._playerView.setData(this.id,this.pname,this.vip,this.ag,this.avatar_id,this.fid,this.displayName,this.keyObjectInGame,this.sid)},updateName:function(){null!=this._playerView&&this._playerView.setName(this.displayName)},updateMoney:function(){null!=this._playerView&&this._playerView.setAg(this.ag)},updateVip:function(){null!=this._playerView&&this._playerView.setVip(this.vip)},updateAvatar:function(){null!=this._playerView&&this._playerView.setAvatar(this.avatar_id,this.pname,this.fid,this.vip)},setHost:function(t){this.is_host=t,this._playerView.setHost(this.is_host),this.is_host&&this.setReady(this.is_host)},setReady:function(t){this.is_host&&(this.is_ready=!0),this.is_ready=t,this._playerView.setReady(this.is_ready)},setDealer:function(t){this.is_dealer=t},setTurn:function(t,e,i){void 0===e&&(e=20),void 0===i&&(i=!1),this.is_turn=t,this._playerView.setTurn(this.is_turn,e,i)},clearAllCard:function(){for(var e=t("DominoController").getInstance().cardPool,i=0;i<this.vectorCard.length;i++)e.put(this.vectorCard[i].node);this.vectorCard=[];for(var a=0;a<this.vectorChi1.length;a++)e.put(this.vectorChi1[a].node);this.vectorChi1=[];for(var n=0;n<this.vectorChi2.length;n++)e.put(this.vectorChi2[n].node);this.vectorChi2=[];for(var o=0;o<this.vectorChi3.length;o++)e.put(this.vectorChi3[o].node);this.vectorChi3=[];for(var r=0;r<this.vectorCardP1.length;r++)e.put(this.vectorCardP1[r].node);this.vectorCardP1=[];for(var s=0;s<this.vectorCardP2.length;s++)e.put(this.vectorCardP2[s].node);this.vectorCardP2=[];for(var c=0;c<this.vectorCardP3.length;c++)e.put(this.vectorCardP3[c].node);this.vectorCardP3=[];for(var l=0;l<this.vectorCardD.length;l++)e.put(this.vectorCardD[l].node);this.vectorCardD=[]},effectChangeMoney:function(t){null!==this._playerView&&this._playerView.effectChangeMoney(t)},numberEffect:function(t){this._playerView.numberEffect(this.ag,t)},clearState:function(){this.typeWin=-1,this.point=0,this.numberCard=0,this.mauBinh_MB=0,this.mauBinhSoBai=!1,this.isSapLang=!1,this.timeSwapCard=0,this.clearAllCard()},clearVectorCardD:function(){for(var e=t("DominoController").getInstance().cardPool,i=0;i<this.vectorCardD.length;i++)e.put(this.vectorCardD[i].node);this.vectorCardD=[]}});e.exports=n,cc._RF.pop()},{"../../lobby/src/scripts/ingame/Card":void 0,DominoController:"DominoController"}],PopupResultItem:[function(t,e){"use strict";cc._RF.push(e,"7cb55Pov+BL+6RH22MX8t8t","PopupResultItem");var i,a=(i=t("../../lobby/src/common/Utils"))&&i.__esModule?i:{default:i};cc.Class({extends:cc.Component,properties:{avatar:{default:null,type:cc.Sprite},vipBorder:{default:null,type:cc.Sprite},bg:{default:null,type:cc.Sprite},bgWin:{default:null,type:cc.SpriteFrame},bgLost:{default:null,type:cc.SpriteFrame},displayName:{default:null,type:cc.Label},lewat:{default:null,type:cc.Label},profit:{default:null,type:cc.Label},kartu:{default:null,type:cc.Label}},setData:function(t){t.showBg?t.userWin?this.bg.SpriteFrame=this.bgWin:this.bg.SpriteFrame=this.bgLost:this.bg.SpriteFrame=null,this.displayName.string=t.name,t.name.length>10&&(this.displayName.string=t.name.substr(0,10)+"..."),this.lewat.string=t.lewat;var e="-";this.profit.node.color=new cc.Color(255,255,255,255),t.profit>0?(e="+",this.profit.node.color=new cc.Color(255,255,0,255)):0==t.profit&&(e=""),t.avatarID&&(this.avatar.spriteFrame=t.avatarID),t.vipBorder&&(this.vipBorder.spriteFrame=t.vipBorder),this.profit.string=e+a.default.formatMoney(Math.abs(t.profit)),this.kartu.string=t.kartu}}),cc._RF.pop()},{"../../lobby/src/common/Utils":void 0}],PopupResult:[function(t,e){"use strict";cc._RF.push(e,"cf366VajkJCt5MNUJHU+n6U","PopupResult"),cc.Class({extends:cc.Component,properties:{bg:{default:null,type:cc.Sprite},popupTitle:{default:null,type:cc.Sprite},popupTitleWin:{default:null,type:cc.SpriteFrame},bgResultWin:{default:null,type:cc.SpriteFrame},popupTitleLost:{default:null,type:cc.SpriteFrame},bgResultLost:{default:null,type:cc.SpriteFrame}},start:function(){},setData:function(t){console.log("setData",t),t.userWin?(this.bg.spriteFrame=this.bgResultWin,this.popupTitle.spriteFrame=this.popupTitleWin):(this.bg.spriteFrame=this.bgResultLost,this.popupTitle.spriteFrame=this.popupTitleLost)}}),cc._RF.pop()},{}]},{},["DominoCard","DominoCardRemain","DominoController","DominoNetworkTransport","DominoPlayer","DominoPresenter","GapleRuleDialog","Player","PopupResult","PopupResultItem"]);