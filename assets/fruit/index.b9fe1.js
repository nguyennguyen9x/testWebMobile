window.__require=function t(i,e,n){function s(l,a){if(!e[l]){if(!i[l]){var h=l.split("/");if(h=h[h.length-1],!i[h]){var r="function"==typeof __require&&__require;if(!a&&r)return r(h,!0);if(o)return o(h,!0);throw new Error("Cannot find module '"+l+"'")}l=h}var c=e[l]={exports:{}};i[l][0].call(c.exports,function(t){return s(i[l][1][t]||t)},c,c.exports,t,i,e,n)}return e[l].exports}for(var o="function"==typeof __require&&__require,l=0;l<n.length;l++)s(n[l]);return s}({FruitConstants:[function(t,i,e){"use strict";cc._RF.push(i,"c3d4eX2p7iQEs3vNFZ4kBI0","FruitConstants"),Object.defineProperty(e,"__esModule",{value:!0}),e.Symbol=e.SixiangGame=e.BigWin=e.SPEED_AUTO=e.SPEED_NORMAL=e.RECT_SIZE=e.TIME_RUN_SPIN_AUTO=e.TIME_RUN_SPIN_NORMAL=e.SPRITE_STOP=e.SPRITE_FREESPIN=e.SPRITE_SPIN=e.ZINDEX_LINE=e.ZINDEX_ITEMANIM=void 0,e.ZINDEX_ITEMANIM=30,e.ZINDEX_LINE=10,e.SPRITE_SPIN=0,e.SPRITE_FREESPIN=1,e.SPRITE_STOP=2,e.TIME_RUN_SPIN_NORMAL=2500,e.TIME_RUN_SPIN_AUTO=1800,e.RECT_SIZE=cc.v2(180,146),e.SPEED_NORMAL=.15,e.SPEED_AUTO=.1,e.BigWin={0:0,5:0,10:2,25:1,50:3},e.SixiangGame={SI_XIANG_GAME_NORMAL:1,SI_XIANG_GAME_FRUIT_FREE_GAME:301},e.Symbol={8:0,4:1,2:2,16:3,4355:4,4356:5,4354:6,4353:7,4357:8,4359:9,4358:10,65535:11,512:12},cc._RF.pop()},{}],FruitController:[function(t,i,e){"use strict";cc._RF.push(i,"559e94XdMxKK49lfM7E3Iex","FruitController");var n,s=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,l=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,i,e,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(l=(o<3?s(l):o>3?s(i,e,l):s(i,e))||l);return o>3&&l&&Object.defineProperty(i,e,l),l};Object.defineProperty(e,"__esModule",{value:!0});const o=t("../../lobby/src/common/Utils"),l=t("../../lobby/src/common/Constants"),a=t("../../lobby/src/language/LanguageController"),h=t("../../lobby/src/dialogs/banner/BannerDialog"),r=t("../../lobby/src/common/GlobalApp"),c=t("../../lobby/src/dialogs/shop/ShopDialog"),p=t("../../lobby/src/dialogs/option/OptionDialog"),m=t("../../lobby/src/chat/ChatPresenter"),d=t("./FruitRuleDialog"),u=t("./FruitNetworkTransport"),g=t("./FruitItemAnimation"),f=t("./FruitItem"),S=t("./FruitConstants"),I=t("../../lobby/src/common/User"),{ccclass:A,property:b}=cc._decorator;let _=n=class extends cc.Component{constructor(){super(...arguments),this.itemSlotPr=null,this.itemAnim=null,this.fruit_Rule=null,this.listItemMiniResult=[],this.listSprBtn=[],this.sprItems=[],this.blackMask=null,this.parentItemNode=null,this.itemMiniResult=null,this.bkg_mid=null,this.bkg_Top=null,this.bkg_Bottom=null,this.btn_Spin=null,this.lb_markBet=null,this.lb_ChipWinRound=null,this.lb_Chip=null,this.lb_Result=null,this.lb_info=null,this.lb_titleWin=null,this.lb_freeSpinLeft=null,this.lb_TypeMark=null,this.lb_numLine1=null,this.lb_numLine2=null,this.animBtnSpin=null,this.noel_items=[],this.khungFreeAmin=null,this.vienFreeAmin=null,this.speedSpinAnim=null,this.fiveOfaKindAmin=null,this.freespinAnim=null,this.megaBigWinAnim=null,this.freenumAnim=null,this.clickSpinCount=0,this.listLineRect=[],this.listOriginItem=[],this.listCheckStopCol=[!1,!1,!1,!1,!1],this.listColor=["#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE","#920E48","#F277E2","#BC8B15","#AC6456","#E17512","#E8C500","#F0E915","#FD93A1","#C735D4","#FF0C04","#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE","#920E48","#F277E2","#BC8B15","#AC6456","#E17512","#E8C500","#F0E915","#FD93A1","#C735D4","#FF0C04","#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE"],this.winningLine=[],this.listWinLineNode=[],this.listItemAnim=[],this.listDataAnimLine=[],this.listSpriteId=[],this.listPosItem=[cc.v2(145,227),cc.v2(310,227),cc.v2(470,227),cc.v2(632,227),cc.v2(795,227)],this.listAnimWS=[],this.listAnimBkgFree=[],this.listIndexSpr=[],this.speedSpin=S.SPEED_NORMAL,this.agPlayer=0,this.markIndex=0,this.winType=0,this.firstDelay=2,this.scatterCount=0,this.totalWin=0,this.startNum=0,this.endNum=0,this.deltaNum=0,this.timeShow=0,this.curNum=0,this.curJackPotNum=0,this.jackPotEndNum=0,this.timeHoldSpin=0,this.totalAgFSP=0,this.spinCountCheck=0,this.timeRunSpin=0,this.curChip=0,this.timeShowBigMega=0,this.numPerSec=0,this.countWild=0,this.idMini=-1,this.initPosItem=cc.v2(0,0),this.initHeightItem=0,this.resetPosY1=0,this.resetPosY2=0,this.resetPosY3=0,this.posAnimSpeedX=0,this.isClickSpin=!1,this.isHoldSpin=!1,this.isRunJPNum=!1,this.isRunEffPlusMoney=!1,this.isHaveFiveOfaKind=!1,this.isCheckScatterItem3=!1,this.isAutoSpin=!1,this.isHave2Scatter=!1,this.isStop=!0,this.isShowBigWin=!1,this.isShowHugeWin=!1,this.isCountFSPAg=!1,this.canSpin=!1,this.isFreeSpin=!1,this.isSpinFree=!1,this.isCountAgFreeSpin=!1,this.isWildWinInLine=!1,this.isStarted=!1,this.finishData=null,this.finishView=[],this.payLine=[],this.listMarkBet=[],this.curMarkBet=0,this.freeSpinLeft=0,this.listCollum=[],this.listScatter=[],this.playerVip=0,this.listItem=[],this.firstAnim=null,this.lb_Money=null,this.blackMaskBig=null,this.animPool=new cc.NodePool("animPool"),this.lbFreeAnim=null}static getInstance(){return this.instance}onLoad(){n.instance=this,u.default.subscribe(),h.default.show(l.Game.Enum.FRUIT)}update(t){this.isHoldSpin&&(this.timeHoldSpin+=t,this.timeHoldSpin>=1&&this.isStop&&(this.onClickAutoSpin(),this.setStateSpinBtn(),this.isHoldSpin=!1,this.timeHoldSpin=0))}start(){m.default.getInstance().joinChatRoom(r.default.getInstance().matchInfo.match_id,this),this.bkg_mid.opacity=0,this.bkg_Bottom.opacity=0,this.bkg_Top.opacity=0,this.bkg_Top.position=cc.v3(0,cc.winSize.height/2+200,0),this.bkg_Bottom.position=cc.v3(0,-cc.winSize.height/2-200,0),this.initPosItem=cc.v2(this.parentItemNode.width/10,this.parentItemNode.height/2),this.blackMaskBig=this.node.getChildByName("bkg_black"),this.node.on("touchstart",t=>{this.btn_Spin.node.getBoundingBoxToWorld().contains(t.getLocation())&&(this.timeHoldSpin=0,this.isHoldSpin=!0)}),this.node.on("touchend",t=>{this.isHoldSpin&&(this.btn_Spin.node.getBoundingBoxToWorld().contains(t.getLocation())&&(this.isHoldSpin=!1,this.timeHoldSpin<1&&this.onClickSpin()),this.timeHoldSpin=0)}),this.isStarted=!1}startEffect(){this.bkg_Top.stopAllActions(),this.bkg_Bottom.stopAllActions(),this.bkg_mid.stopAllActions(),this.bkg_Top.runAction(cc.spawn(cc.moveTo(.5,cc.v2(0,cc.winSize.height/2)),cc.fadeTo(.5,255))),this.bkg_Bottom.runAction(cc.spawn(cc.moveTo(.5,cc.v2(0,-cc.winSize.height/2)),cc.fadeTo(.5,255))),this.bkg_mid.runAction(cc.sequence(cc.fadeTo(.5,255),cc.delayTime(1.5),cc.callFunc(()=>{this.canSpin=!0})))}handleCTable(t){var i,e,n,s,l,a,h,r;t.slotViews=[];for(let o=0;o<t.matrix.cols;o++){let i=[];for(let e=0;e<t.matrix.lists.length;e++)if(e%t.matrix.cols===o){let n=S.Symbol[t.matrix.lists[e]];i.push(n)}t.slotViews.push(i)}if(this.isStarted)this.handleSpin(Object.assign(Object.assign({},t),{currentChipBonus:Number(t.gameReward.perlGreenForestChipsCollect),freeSpinLeft:Number(t.numSpinLeft)>=0||Number(null===(i=null==t?void 0:t.gameConfig)||void 0===i?void 0:i.numFreeSpin)?Number(t.numSpinLeft)|Number(null===(e=null==t?void 0:t.gameConfig)||void 0===e?void 0:e.numFreeSpin):0,freeSpin:t.currentSixiangGame===S.SixiangGame.SI_XIANG_GAME_FRUIT_FREE_GAME,isFreeSpin:t.nextSixiangGame===S.SixiangGame.SI_XIANG_GAME_FRUIT_FREE_GAME,winType:S.BigWin[t.bigWin],agWin:S.BigWin[t.bigWin]>0?t.gameReward.totalChipsWinByGame:0,chipBonusFullExp:t.gameReward.updateChipsBonus?t.gameReward.perlGreenForestChips:0,jpGrandPlayer:Number(null===(s=null===(n=t.winJpHistory)||void 0===n?void 0:n.grand)||void 0===s?void 0:s.chipsAccum),jpMajorPlayer:Number(null===(a=null===(l=t.winJpHistory)||void 0===l?void 0:l.major)||void 0===a?void 0:a.chipsAccum)}));else{t.currentChipBonus=Number(t.gameReward.perlGreenForestChipsCollect),t.freeSpinLeft=Number(t.numSpinLeft)>=0||Number(null===(h=null==t?void 0:t.gameConfig)||void 0===h?void 0:h.numFreeSpin)?Number(t.numSpinLeft)|Number(null===(r=null==t?void 0:t.gameConfig)||void 0===r?void 0:r.numFreeSpin):0,t.freeSpin=t.currentSixiangGame===S.SixiangGame.SI_XIANG_GAME_FRUIT_FREE_GAME,t.isFreeSpin=t.nextSixiangGame===S.SixiangGame.SI_XIANG_GAME_FRUIT_FREE_GAME,t.views=[];for(let i=0;i<t.matrix.cols;i++){let e=[];for(let n=0;n<t.matrix.lists.length;n++)if(n%t.matrix.cols===i){let i=S.Symbol[t.matrix.lists[n]];e.push(i)}t.views.push(e)}this.finishData=t,this.scheduleOnce(()=>{this.initItemSlot(t.views)},.5),this.payLine=[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[0,0,1,2,2],[2,2,1,0,0],[1,0,1,2,1],[1,2,1,0,1],[1,0,0,1,0],[1,2,2,1,2],[0,1,0,0,1],[2,1,2,2,1],[0,2,0,2,0],[2,0,2,0,2],[1,0,2,0,1],[1,2,0,2,1],[0,1,1,1,0],[2,1,1,1,2],[0,2,2,2,0]],this.lb_numLine1.string=this.payLine.length.toString(),this.lb_numLine2.string=this.payLine.length.toString(),this.listMarkBet=[],this.isFreeSpin=t.nextSixiangGame===S.SixiangGame.SI_XIANG_GAME_FRUIT_FREE_GAME,this.freeSpinLeft=Number(t.numSpinLeft)>0?Number(t.numSpinLeft):0,this.freeSpinLeft>0&&0===this.listAnimBkgFree.length&&this.showAnimBkgFreeSpin(),this.setStateSpinBtn(),this.lb_ChipWinRound.string=t.gameReward.totalChipsWinByGame,this.agPlayer=Number(t.gameReward.balanceChipsWalletAfter),this.listMarkBet=t.betLevels,this.curMarkBet=Number(t.chipsMcb);for(let i=0;i<t.betLevels.length;i++)if(Number(t.betLevels[i])===Number(t.chipsMcb)){this.markIndex=i;break}this.lb_markBet.string=o.default.formatNumber(this.curMarkBet),this.lb_Chip.string=o.default.formatNumber(this.agPlayer),this.playerVip=I.default.vipLevel,this.isStarted=!0}}setTimeout(t,i){setTimeout(()=>{null!=this.node&&t.call()},i)}getCurMarkBet(t){for(let i=0;i<this.listMarkBet.length;i++)if(0===t){let t=this.listMarkBet[i];t<=this.agPlayer/20?(this.curMarkBet=t,this.markIndex=i,i===this.listMarkBet.length-1&&(this.lb_TypeMark.string=a.default.getInstance().getString("shan2_maxbet"))):this.listMarkBet[0]>this.agPlayer/20&&(this.curMarkBet=this.listMarkBet[0],this.markIndex=0)}else this.listMarkBet.includes(t)?(this.curMarkBet=t,this.markIndex=this.listMarkBet.indexOf(t)):this.listMarkBet.length>0&&(this.markIndex=this.listMarkBet.length-1,this.curMarkBet=this.listMarkBet[this.markIndex]);(this.listMarkBet.length<1||this.listMarkBet[0]>this.agPlayer)&&(this.markIndex=0,this.curMarkBet=this.listMarkBet[0])}initItemSlot(t){let i=0;this.listCollum=[];for(let e=0;e<this.listItem.length;e++)this.listItem[e].node.destroy();this.listItem=[];for(let e=0;e<15;e++){let n=cc.instantiate(this.itemSlotPr).getComponent(f.default),s=cc.instantiate(this.itemSlotPr).getComponent(f.default),o=cc.instantiate(this.itemSlotPr).getComponent(f.default);if(this.initHeightItem=n.node.height,n.node.position=cc.v3(this.listPosItem[i].x,this.initPosItem.y),this.parentItemNode.addChild(n.node),n.typeItem=1,n.numCol=i,n.setSpriteListItem(t[i]),this.resetPosY1=this.initPosItem.y,3===i){let t=this.parentItemNode.convertToWorldSpaceAR(n.node.position);this.posAnimSpeedX=this.bkg_mid.convertToNodeSpaceAR(t).x}s.node.position=cc.v3(n.node.x,n.node.position.y+n.node.height),this.parentItemNode.addChild(s.node),s.typeItem=2,s.numCol=i,s.setSpriteListItem(t[i]),this.resetPosY2=s.node.position.y,o.node.position=cc.v3(n.node.x,s.node.position.y+s.node.height),this.parentItemNode.addChild(o.node),o.typeItem=3,o.numCol=i,o.setSpriteListItem(t[i]),this.resetPosY3=o.node.position.y;let l=[];l.push(n.node,s.node,o.node),this.listCollum.push(l),this.listItem.push(n,s,o),i++,e+=2}this.startEffect(),this.initItemAnim()}initItemAnim(){for(let t=0;t<5;t++){let t=cc.instantiate(this.itemAnim).getComponent(g.default);this.node.addChild(t.node,S.ZINDEX_ITEMANIM),t.node.active=!1,this.listItemAnim.push(t)}this.firstAnim=cc.instantiate(this.itemAnim).getComponent(g.default),this.node.addChild(this.firstAnim.node,S.ZINDEX_ITEMANIM),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null}onClickSpin(){if((this.canSpin||this.isAutoSpin)&&!(this.clickSpinCount>1)){if(this.agPlayer<this.listMarkBet[0]&&!this.isFreeSpin)return this.lb_info.string=a.default.getInstance().getString("not_enought_gold"),void r.default.getInstance().alertDialog.showMessage(a.default.getInstance().getString("txt_not_enough_money_gl"));if(this.lb_titleWin.string=this.isFreeSpin?a.default.getInstance().getString("txt_total_win"):a.default.getInstance().getString("txt_last_win"),this.isStop||!this.isFreeSpin){if(this.clickSpinCount>0)return this.isAutoSpin=!1,this.setStateSpinBtn(),void(this.isStop&&this.resetForNextSpin());if(0===this.listMarkBet.length&&!this.isFreeSpin)return this.lb_info.string=a.default.getInstance().getString("not_enought_gold"),void r.default.getInstance().alertDialog.showMessage(a.default.getInstance().getString("txt_not_enough_money_gl"));this.isSpinFree=this.isFreeSpin,this.node.stopAllActions(),this.turnOffAnim(),this.playSoundEff("clickspin"),this.isFreeSpin?this.freeSpinLeft>0&&(0===this.listAnimBkgFree.length?this.showAnimBkgFreeSpin():this.lbFreeAnim.string=this.freeSpinLeft-1+" Sisa Putaran Gratis"):(this.curChip=this.agPlayer,o.default.runNumber(this.lb_Chip,this.curChip-this.curMarkBet,1),this.agPlayer-=this.curMarkBet,this.curChip=this.agPlayer),this.clickSpinCount++,u.default.sendSpin({chips:this.curMarkBet}),this.isStop=!1,this.setStateSpinBtn(),this.blackMask.active=!1;for(let t=0;t<this.listCheckStopCol.length;t++)this.listCheckStopCol[t]=!1;this.lb_info.node.active=!0,this.lb_info.string=a.default.getInstance().getString("txt_playing_lines").replace("%d","20"),this.playSoundEff("wheelspin"),this.listCollum.forEach((t,i)=>{t.forEach(t=>{let e=t.getComponent(f.default);cc.Tween.stopAllByTarget(t);var n=()=>{if(e.typeItem--,this.listCheckStopCol[i]||e.numCol!=i){if(this.listCheckStopCol[i]&&e.numCol==i){let n=0;e.typeItem<0&&(t.y=this.resetPosY2,e.typeItem=2,e.setSpriteListItem(this.finishView[i],!1),this.listOriginItem.push(t)),0==e.typeItem&&(t.y=this.resetPosY3,e.typeItem=3),this.isAutoSpin,2==i&&this.isCheckScatterItem3&&(this.speedSpin=S.SPEED_AUTO,n=1,this.firstAnim&&this.firstAnim.node&&(this.setInfoAnim(this.firstAnim,this.speedSpinAnim,cc.v2(this.posAnimSpeedX-3,0),cc.v2(.8,.87)),this.firstAnim.node.parent=this.bkg_mid,this.firstAnim.node.zIndex=this.parentItemNode.zIndex+1,this.firstAnim.playAnimation2("animation",!0))),e.setSpriteListItem(e.listIdView,!1),cc.tween(t).to(.2,{y:t.y-this.initHeightItem},{easing:cc.easing.backOut}).delay(this.isCheckScatterItem3?n:0).call(()=>{this.listCheckStopCol[i+1]=!0,this.playSoundEff("stopspin"),this.canSpin=!1}).call(()=>{4==i&&2==e.typeItem&&(this.getOriginItem(),this.winningLine.forEach(t=>{this.initLineWin(t.lineWin,t.color)}),this.checkWildWinInLine(),this.acShowWinLine(),this.freeSpinLeft>0&&(0===this.listAnimBkgFree.length?this.showAnimBkgFreeSpin():this.lbFreeAnim.string=this.freeSpinLeft+" Sisa Putaran Gratis")),e.typeItem--,3==i&&this.isCheckScatterItem3&&(this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null),this.isAutoSpin||(this.listCheckStopCol[i+1]=!0)}).start()}}else{e.typeItem<0&&(t.y=this.resetPosY2,e.typeItem=2,this.isCheckScatterItem3&&e.numCol>2&&e.setRandomId(!1));let s=this.speedSpin;4==i&&!this.isAutoSpin&&this.isCheckScatterItem3&&(s=S.SPEED_NORMAL),cc.tween(t).to(s,{y:t.y-this.initHeightItem}).call(n).start()}};cc.tween(t).to(.15,{y:e.node.position.y+60},{easing:cc.easing.sineOut}).call(()=>{e.setSpriteListItem(e.listIdView,!0)}).to(this.speedSpin,{y:t.y-this.initHeightItem}).call(n).start()})})}}}setStateSpinBtn(t=null){let i;switch(this.isStop?i=this.isFreeSpin?"freespinOn":"spinOn":(i=this.isAutoSpin?"autoSpin":"spinOff",i=this.isFreeSpin?"freespinOff":i),null!==t&&(i=t),i){case"spinOn":this.animBtnSpin.playAnimation2("thai",!0);break;case"spinOff":this.animBtnSpin.node.active=!1,this.btn_Spin.getComponent(cc.Sprite).spriteFrame=this.listSprBtn[S.SPRITE_SPIN];break;case"freespinOn":this.animBtnSpin.node.active=!1,this.btn_Spin.getComponent(cc.Sprite).spriteFrame=this.listSprBtn[S.SPRITE_FREESPIN],this.btn_Spin.interactable=!0;break;case"freespinOff":this.animBtnSpin.node.active=!1,this.btn_Spin.getComponent(cc.Sprite).spriteFrame=this.listSprBtn[S.SPRITE_FREESPIN];break;case"autoSpin":this.animBtnSpin.node.active=!1,this.btn_Spin.getComponent(cc.Sprite).spriteFrame=this.listSprBtn[S.SPRITE_STOP]}}onClickAutoSpin(){this.isAutoSpin=!this.isAutoSpin,this.setStateSpinBtn(),this.isStop&&(this.speedSpin=S.SPEED_AUTO,this.onClickSpin())}handleSpin(t){if(this.finishData=t,this.finishData.isFinishGame||Number(this.curMarkBet)===Number(t.chipsMcb)){this.finishView=t.slotViews,this.isCheckScatterItem3=!1,this.finishView[1].includes(12)&&this.finishView[2].includes(12)&&(this.isCheckScatterItem3=!0),console.log("handleSpin",t,this.isCheckScatterItem3),this.getLineWin(t),this.setTimeout(()=>{this.node&&this.onStopSpin()},500),t.freeSpin&&(this.lb_ChipWinRound.string=o.default.formatNumber(Number(t.gameReward.totalChipsWinByGame))),this.totalAgFSP=t.gameReward.totalChipsWinByGame,this.totalWin=t.gameReward.totalChipsWinByGame,this.agPlayer=Number(t.gameReward.balanceChipsWalletAfter),this.winType=t.winType,this.freeSpinLeft=t.freeSpinLeft,this.isFreeSpin=0!==t.freeSpinLeft,this.isCountAgFreeSpin=this.isFreeSpin,this.listMarkBet=t.betLevels,this.curMarkBet=Number(t.chipsMcb);for(let i=0;i<t.betLevels.length;i++)if(Number(t.betLevels[i])===Number(t.chipsMcb)){this.markIndex=i;break}this.freeSpinLeft<=0&&(this.lb_markBet.string=o.default.formatNumber(this.curMarkBet),this.isSpinFree=!1)}}showAnimScatter(){this.playSoundEff("wildscatter");for(let t=0;t<this.listScatter.length;t++){let i=this.listScatter[t],e=this.getAnimFromPool(this.listAnimWS);e&&e.node&&(this.setInfoAnim(e,this.noel_items[12],i.pos,.8),this.node.addChild(e.node),e.playAnimation2("animation",!0))}}setInfoAnim(t,i,e,n,s=!1){t&&t.node&&(t.node.active=!0,t.node.zIndex=S.ZINDEX_ITEMANIM,t.animation.node.setScale(n),t.node.position=e,t.initAnimation(i),t.node.getChildByName("lb_Money").active=s)}showAnimOneWinLine(){if(this.blackMaskBig.active=!1,this.btn_Spin.interactable=!this.isAutoSpin,0===this.listWinLineNode.length||this.isAutoSpin&&this.listWinLineNode.length>1)return this.canSpin=!0,this.setStateSpinBtn(),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.firstAnim.node.getChildByName("lb_Money").active=!1,void this.resetForNextSpin();if(this.isAutoSpin?this.canSpin=!0:setTimeout(()=>{this.node&&(this.canSpin=!0,this.setStateSpinBtn())},300),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.firstAnim.node.getChildByName("lb_Money").active=!1,2===this.clickSpinCount)return;let t=this.listWinLineNode.length,i=cc.callFunc(()=>{(this.isAutoSpin||this.finishData.freeSpin&&0!==this.finishData.freeSpinLeft)&&this.resetForNextSpin()});for(let e=0;e<t;e++)this.node.runAction(cc.sequence(cc.delayTime(1.5*e),cc.callFunc(()=>{for(let e=0;e<this.listWinLineNode.length;e++)this.listWinLineNode[e].node.active=!1;this.playSoundEff("showline"),this.turnOffAnim(),this.turnOffMiniResult();for(let e=0;e<this.listIndexSpr.length;e++)this.listOriginItem[e].getComponent(f.default).setStateSpr(this.listIndexSpr[e],!0);this.listIndexSpr=[];for(let e=0;e<this.listLineRect.length;e++)this.listLineRect[e].active=!1;let t=this.winningLine[e].lineWin,i=[],n=[];for(let e=0;e<t.length;e++){let s=this.listOriginItem[e].getComponent(f.default),o=t[e],l=s.getWordPosItem(s.listItem[o]);n.push(l);let a=s.listIdView[o];i.push(a)}this.idMini=-1,this.showListAnim(n,i,this.winningLine[e].color,this.winningLine[e].pays,t)}),cc.delayTime(1.07),i))}showAllWinLine(){if(this.updateMoney(),this.blackMaskBig.active=!1,0!==this.listWinLineNode.length&&(this.blackMask.active=!0),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.listWinLineNode.length>1)for(let t=0;t<this.listWinLineNode.length;t++)this.node.runAction(cc.sequence(cc.delayTime(S.SPEED_NORMAL*t),cc.callFunc(()=>{this.listWinLineNode[t].node.active=!0})));this.turnOffAnim(),this.turnOffMiniResult(),this.isStop=!0}showAnim5OfAkind(){this.blackMaskBig.active=!0,this.firstAnim.node.active=!0,this.firstAnim.animation.skeletonData=null,this.setInfoAnim(this.firstAnim,this.fiveOfaKindAmin,cc.v2(0,0),cc.v2(1,1)),this.firstAnim.node.parent=this.node,this.firstAnim.playAnimation2("animation",!0)}showAnimFreeSpin(){console.log("showwwwwwwwwwwww"),this.playSoundEff("freespin"),this.blackMaskBig.active=!0,this.turnOffAnim(),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.setInfoAnim(this.firstAnim,this.freespinAnim,cc.v2(0,0),cc.v2(1,1)),this.firstAnim.node.parent=this.node,this.firstAnim.playAnimation2("cam",!0)}showAnimAllWild(){this.playSoundEff("wildscatter");let t=[];for(let i=0;i<this.winningLine.length;i++){let e={lineWinId:[],lineWin:[]},n=this.winningLine[i].lineWinId;n.includes(11)&&(e.lineWinId=n,e.lineWin=this.winningLine[i].lineWin),t.push(e)}for(let i=0;i<t.length;i++){let e=t[i],n=this.checkIndexToShowAnim(e.lineWinId);for(let t=0;t<=n;t++){let i=this.listOriginItem[t].getComponent(f.default);if(11===e.lineWinId[t]){let n=i.getWordPosItem(i.listItem[e.lineWin[t]]),s=this.getAnimFromPool(this.listAnimWS);if(!s||!s.node)return;this.setInfoAnim(s,this.noel_items[11],n,.7),this.node.addChild(s.node,S.ZINDEX_ITEMANIM),s.playAnimation2("animation",!0)}}}}showAnimBigWin(){this.playSoundEff("bigwin"),this.blackMaskBig.active=!0,this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.setInfoAnim(this.firstAnim,this.megaBigWinAnim,cc.v2(0,0),cc.v2(1,1)),this.firstAnim.node.parent=this.node,this.firstAnim.playAnimation2("bigwin_cam",!0);let t=this.firstAnim.node.getChildByName("lb_Money");t.active=!0,t.opacity=255,t.scale=.8,this.lb_Money=t.getComponent(cc.Label),this.lb_Money.node.position=cc.v3(0,-100),this.createEffNumRun(t.getComponent(cc.Label),0,Number(this.finishData.gameReward.totalChipsWinByGame),this.timeShowBigMega-1),t.runAction(cc.sequence(cc.scaleTo(this.timeShowBigMega-1,1.2),cc.scaleTo(.5,1).easing(cc.easeBackOut()),cc.delayTime(.1),cc.scaleTo(.1,0)))}showAnimHugeWin(){this.playSoundEff("megawin"),this.blackMaskBig.active=!0,this.firstAnim.playAnimation2("megawin_cam",!0)}showAnimBkgFreeSpin(){let t=this.bkg_mid.getChildByName("bg_spin").zIndex-1,i=this.getAnimFromPool(this.listAnimBkgFree);i&&i.node&&(this.setInfoAnim(i,this.khungFreeAmin,cc.v2(0,0),cc.v2(cc.winSize.height/1280*1,1)),this.bkg_mid.addChild(i.node,t),i.playAnimation2("animation",!0));let e=this.getAnimFromPool(this.listAnimBkgFree);e&&e.node&&(this.setInfoAnim(e,this.vienFreeAmin,cc.v2(0,0),cc.v2(.97,.97)),this.bkg_mid.addChild(e.node,t),e.playAnimation2("animation",!0),this.showAnimFreeNum())}showAnimFreeNum(){let t=this.parentItemNode.zIndex+1,i=this.getAnimFromPool(this.listAnimBkgFree);i&&i.node&&this.setInfoAnim(i,this.freenumAnim,cc.v2(0,254),cc.v2(.9,1),!0),this.lbFreeAnim=i.node.getChildByName("lb_Money").getComponent(cc.Label),this.lbFreeAnim.node.position=cc.v3(0,2);let e=this.freeSpinLeft;this.lbFreeAnim.string=e+" Sisa Putaran Gratis",this.lbFreeAnim.fontSize=65,this.lbFreeAnim.lineHeight=90,this.node.addChild(i.node,t),i.playAnimation2("animation",!0)}onStopSpin(){this.listOriginItem=[],this.listCheckStopCol[0]=!0}getOriginItem(){this.listScatter=[];for(let t=0;t<this.listItem.length;t++){let i=this.listItem[t];i.node.position.y>this.initPosItem.y-100&&i.node.position.y<this.initPosItem.y+10?i.getScatterItem():i.setRandomId(!1)}this.isHave2Scatter=this.scatterCount>1}initLineWin(t,i){let e=[];for(let n=0;n<t.length;n++){let i=this.listOriginItem[n].getComponent(f.default),s=i.getWordPosItem(i.listItem[t[n]]);e.push(s)}this.drawLine(e,i)}getLineWin(t){t.paylines.forEach(i=>{let e={lineWin:[],lineWinId:[],color:null,pays:null},n=i.indices.map(i=>S.Symbol[t.matrix.lists[i]]);e.lineWin=this.payLine[Number(i.id)-1],e.color=this.listColor[this.getRanNum(0,this.listColor.length-1)],e.pays=Number(i.chips),e.lineWinId=n,this.winningLine.push(e)}),this.checkFiveOfaKind()}acShowWinLine(){if(!this.isFreeSpin&&(this.totalAgFSP>=20*this.curMarkBet&&(this.isShowBigWin=!0),this.totalAgFSP>=50*this.curMarkBet&&(this.isShowHugeWin=!0),this.finishData.freeSpin)){for(let t=0;t<this.listAnimBkgFree.length;t++)this.listAnimBkgFree[t].node.destroy();this.listAnimBkgFree=[]}!this.isFreeSpin&&this.finishData.freeSpin&&(this.totalWin=this.totalAgFSP),this.finishData.freeSpin?this.lb_ChipWinRound.string=o.default.formatNumber(this.totalAgFSP):this.lb_ChipWinRound.string=o.default.formatNumber(this.totalWin),0===this.finishData.agWin||this.finishData.freeSpin||(this.lb_titleWin.string=a.default.getInstance().getString("txt_win")),this.finishData.freeSpin&&(this.lb_titleWin.string=a.default.getInstance().getString("txt_total_win"));let t=0,i=0,e=1.5*this.listWinLineNode.length,n=0,s=0,l=0,h=0;this.listWinLineNode.length>1&&(h=this.listWinLineNode.length*S.SPEED_NORMAL+.7),this.isHaveFiveOfaKind&&(s=2),(this.isWildWinInLine||this.isHave2Scatter)&&(l=1.3);let r=[100,101,102];this.finishData.currentSixiangGame!==S.SixiangGame.SI_XIANG_GAME_FRUIT_FREE_GAME&&this.finishData.nextSixiangGame===S.SixiangGame.SI_XIANG_GAME_FRUIT_FREE_GAME&&(n=2),((r=[1,101,102]).includes(this.winType)&&!this.finishData.freeSpin||this.isShowBigWin)&&(t=3),((r=[2,102]).includes(this.winType)&&!this.finishData.freeSpin||this.isShowHugeWin)&&(t=2.7,i=3),this.timeShowBigMega=t+i;let c=cc.callFunc(()=>{this.showAllWinLine()}),p=cc.callFunc(()=>{this.node.runAction(cc.repeatForever(cc.sequence(cc.callFunc(()=>{this.showAnimOneWinLine()}),cc.delayTime(e))))}),m=cc.callFunc(()=>{this.isHave2Scatter&&this.showAnimScatter()}),d=cc.callFunc(()=>{this.isHaveFiveOfaKind&&this.showAnim5OfAkind()}),u=cc.callFunc(()=>{this.finishData.currentSixiangGame!==S.SixiangGame.SI_XIANG_GAME_FRUIT_FREE_GAME&&this.finishData.nextSixiangGame===S.SixiangGame.SI_XIANG_GAME_FRUIT_FREE_GAME&&this.showAnimFreeSpin()}),g=cc.callFunc(()=>{this.isWildWinInLine&&this.showAnimAllWild()}),f=cc.callFunc(()=>{([1,2,101,102].includes(this.winType)&&!this.finishData.freeSpin||this.isShowBigWin)&&this.showAnimBigWin()}),I=cc.callFunc(()=>{([2,102].includes(this.winType)&&!this.finishData.freeSpin||this.isShowHugeWin)&&this.showAnimHugeWin()}),A=cc.sequence(m,g,cc.delayTime(l),c,cc.delayTime(h),u,cc.delayTime(n),d,cc.delayTime(s),f,cc.delayTime(t),I,cc.delayTime(i),p);this.node.runAction(A),this.lb_info.node.active=!1}drawLine(t,i){let e=this.createLine(i,!0);e.moveTo(t[0].x-90,t[0].y),e.lineTo(t[0].x,t[0].y);let n=t.length;for(let s=1;s<n;s++)e.lineJoin=cc.Graphics.LineJoin.ROUND,e.lineTo(t[s].x,t[s].y);e.lineTo(t[n-1].x+90,t[n-1].y),e.stroke(),e.node.active=!1,this.listWinLineNode.push(e)}drawLineLast(t,i){let e=this.createLine(i,!0),n=this.getCrossPoint(t[0],t[1]);e.moveTo(n.x,n.y);let s=t.length;for(let o=1;o<s;o++)e.lineJoin=cc.Graphics.LineJoin.ROUND,e.lineTo(t[o].x,t[o].y);e.lineTo(t[s-1].x+90,t[s-1].y),e.stroke(),this.listLineRect.push(e.node)}createLine(t,i,e=5){let n=(new cc.Node).addComponent(cc.Graphics);return n.lineWidth=e,n.lineCap=cc.Graphics.LineCap.ROUND,n.strokeColor=(new cc.Color).fromHEX(t),n.node.active=!0,this.node.addChild(n.node,S.ZINDEX_LINE),i&&(n.node.zIndex=S.ZINDEX_ITEMANIM+1),n}showListAnim(t,i,e,n,s){let o=this.checkIndexToShowAnim(i);for(let l=0;l<=o;l++){this.showItemAnim(l,t[l],i[l],n,s),this.turnOffItemSpr(l,s[l]),t[l];let a=!1;if(o<4&&l===o&&(a=!0),l+1<=o&&(t[l].y>t[l+1].y+290||t[l].y<t[l+1].y-290)){let i=this.getCrossPoint(t[l],t[l+1]),n=this.getCrossPoint(t[l+1],t[l]),s=this.createLine(e,!0);s.moveTo(i.x,i.y),s.lineTo(n.x,n.y),s.stroke(),this.listLineRect.push(s.node)}}}checkIndexToShowAnim(t){let i=0,e=t[0];for(let n=1;n<t.length;n++)if(11!==e){if(t[n]!==e&&11!==t[n])break;i++}else e=t[n],i++;return i}showItemAnim(t,i,e,n,s=!0){this.setItemMiniResult(e,t,n);let o=this.listItemAnim[t],l=1;e>=9&&e<=10?l=.7:11==e?l=.6:12==e&&(l=.8),o.initAnimation(this.noel_items[e]),o.node.position=i,o.node.active=!0,o.animation.node.scale=l,o.playAnimation2("animation",!0)}setItemMiniResult(t,i,e){if(11!==t){this.idMini=t;for(let e=0;e<i;e++)this.listItemMiniResult[e].node.getComponent(cc.Sprite).spriteFrame=this.sprItems[t]}11===t&&-1!==this.idMini&&(t=this.idMini),this.listItemMiniResult[i].node.active=!0,this.listItemMiniResult[i].node.getComponent(cc.Sprite).spriteFrame=this.sprItems[t],this.lb_Result.string=a.default.getInstance().getString("txt_pays_chip").replace("%s",o.default.formatMoney(e)),this.itemMiniResult.active=!0}turnOffMiniResult(){for(let t=0;t<this.listItemMiniResult.length;t++)this.listItemMiniResult[t].node.active=!1}getCrossPoint(t,i){let e=t.y>i.y?-1:1,n=cc.v2(t.x-S.RECT_SIZE.x,t.y+S.RECT_SIZE.y/2*e),s=cc.v2(n.x+S.RECT_SIZE.x,n.y);return Math.abs(t.y-i.y)<1&&(n=cc.v2(t.x+S.RECT_SIZE.x/2,t.y+S.RECT_SIZE.y/2),s=cc.v2(t.x+S.RECT_SIZE.x/2,t.y-S.RECT_SIZE.y/2)),o.default.pIntersectPoint(n,s,t,i)}turnOffItemSpr(t,i){this.listIndexSpr.push(i),this.listOriginItem[t].getComponent(f.default).setStateSpr(i,!1)}turnOffAnim(){for(let t=0;t<this.listAnimWS.length;t++)this.listAnimWS[t].node.destroy();this.listAnimWS=[];for(let t=0;t<this.listItemAnim.length;t++)this.listItemAnim[t].node.active=!1,this.listItemAnim[t].animation.skeletonData=null}checkFiveOfaKind(){this.isHaveFiveOfaKind=!1;let t=0;for(let i=0;i<this.winningLine.length;i++){let e=[],n=this.winningLine[i].lineWin;for(let t=0;t<n.length;t++)e.push(this.finishView[t][n[t]]);if(4===(t=this.checkIndexToShowAnim(e)))return void(this.isHaveFiveOfaKind=!0)}}checkWildWinInLine(){let t=[];this.isWildWinInLine=!1;for(let i=0;i<this.winningLine.length;i++){let e=this.winningLine[i].lineWin;for(let i=0;i<e.length;i++)t.push(this.finishView[i][e[i]])}this.countWild=this.checkIndexToShowAnim(t);for(let i=0;i<=this.countWild;i++)11===t[i]&&(this.isWildWinInLine=!0)}checkScatterItem(){}drawRect(t,i,e,n,s){let o=this.createLine(i,!0,5),l=cc.v2(t.x-S.RECT_SIZE.x/2,t.y-S.RECT_SIZE.y/2);if(o.moveTo(l.x,l.y),o.rect(l.x,l.y,S.RECT_SIZE.x,S.RECT_SIZE.y),this.listLineRect.push(o.node),o.stroke(),e){let t=s.slice(n,5);t&&t.length>=2?this.drawLineLast(t,i):console.log("listPosLine",s,t,n)}}resetForNextSpin(){for(let t=0;t<this.listIndexSpr.length;t++)this.listOriginItem[t].getComponent(f.default).setStateSpr(this.listIndexSpr[t],!0);this.listIndexSpr=[],this.node.stopAllActions(),this.canSpin=!0,this.blackMask.active=!1;for(let t=0;t<this.listWinLineNode.length;t++)this.listWinLineNode[t].node.destroy();this.turnOffAnim();for(let t=0;t<this.listLineRect.length;t++)this.listLineRect[t].destroy();this.listLineRect=[],this.listWinLineNode=[],this.winningLine=[],this.clickSpinCount=0,this.scatterCount=0,this.isShowBigWin=!1,this.isShowHugeWin=!1,this.blackMaskBig.active=!1,this.isFreeSpin||(this.totalAgFSP=0),this.finishData.freeSpin||this.isAutoSpin?this.speedSpin=S.SPEED_AUTO:this.speedSpin=S.SPEED_NORMAL,this.setStateSpinBtn(),this.agPlayer<this.listMarkBet[0]&&(this.btn_Spin.interactable=!1),this.itemMiniResult.active=!1,this.firstDelay=2,this.lb_info.node.active=!0,this.agPlayer>=this.listMarkBet[0]?(this.parentItemNode.getComponent(cc.Button).interactable=!0,this.lb_info.string=this.isAutoSpin?a.default.getInstance().getString("txt_playing_lines").replace("%d","20"):a.default.getInstance().getString("txt_press_spin_to_play")):this.isFreeSpin||(this.parentItemNode.getComponent(cc.Button).interactable=!1,this.btn_Spin.interactable=!1,this.lb_info.string=a.default.getInstance().getString("not_enought_gold")),(this.isAutoSpin||this.isSpinFree)&&this.onClickSpin()}onClickPlusMarkBet(){!this.isStop||this.isFreeSpin||this.markIndex<0||this.isAutoSpin||(this.markIndex<this.listMarkBet.filter(t=>t<=this.agPlayer/20).length-1?(this.markIndex++,this.markIndex===this.listMarkBet.length-1&&(this.lb_TypeMark.string=a.default.getInstance().getString("shan2_maxbet"))):(this.markIndex=0,this.lb_TypeMark.string=a.default.getInstance().getString("txt_pok_to")),this.curMarkBet=this.listMarkBet[this.markIndex],this.lb_markBet.string=o.default.formatMoney(this.curMarkBet))}onClickMinusMarkBet(){if(!(!this.isStop||this.isFreeSpin||this.markIndex<0||this.isAutoSpin)){if(this.markIndex>0)this.markIndex--,this.lb_TypeMark.string=a.default.getInstance().getString("txt_pok_to");else{let t=this.listMarkBet.filter(t=>t<=this.agPlayer/20).sort((t,i)=>t-i).pop();this.markIndex=this.listMarkBet.indexOf(t),this.lb_TypeMark.string=a.default.getInstance().getString("shan2_maxbet")}this.curMarkBet=this.listMarkBet[this.markIndex],this.lb_markBet.string=o.default.formatMoney(this.curMarkBet)}}onClickMaxBet(){if(this.agPlayer<this.listMarkBet[0]&&!this.isFreeSpin)return;if(!this.isStop||this.isFreeSpin||this.markIndex<0||this.isAutoSpin)return;this.lb_TypeMark.string=a.default.getInstance().getString("shan2_maxbet");let t=this.listMarkBet.filter(t=>t<=this.agPlayer/20).sort((t,i)=>t-i).pop();this.markIndex=this.listMarkBet.indexOf(t),this.curMarkBet=this.listMarkBet[this.markIndex],this.lb_markBet.string=o.default.formatNumber(this.curMarkBet)}getRanNum(t,i){let e=Math.random()*(i-t)+t;return Math.floor(e)}createEffNumRun(t,i,e,n){t.node.active=!0,this.endNum=e,this.deltaNum=this.endNum-this.startNum,this.numPerSec=this.deltaNum/n,this.curNum=i,this.isRunEffPlusMoney=!0,this.effRunNumber(n,t,this.curNum,this.endNum,this.numPerSec)}effRunNumber(t,i,e,n,s){let l=s/20;l<0&&(l=1);let a=cc.callFunc(()=>{(e+=l)>=n&&(e=n),i.string=o.default.formatNumber(Math.floor(e))}),h=cc.callFunc(()=>{e>=n&&i.node.stopActionByTag(0)}),r=cc.repeat(cc.sequence(a,cc.delayTime(.05),h),20*t);i.node.runAction(r)}updateMoney(){0!==this.finishData.freeSpinLeft&&1==this.finishData.freeSpin||(this.curChip===this.agPlayer?this.lb_Chip.string=o.default.formatNumber(this.agPlayer):o.default.runNumber(this.lb_Chip,this.agPlayer,.8),0!==this.finishData.agWin&&(this.lb_titleWin.string=a.default.getInstance().getString("txt_win")),this.lb_ChipWinRound.string=o.default.formatNumber(this.totalWin))}onClickShop(){this.isStop&&c.default.show()}getAnimFromPool(t){let i=cc.instantiate(this.itemAnim).getComponent(g.default);return t.push(i),i}putAnimBackPool(t){}playSoundEff(t){}stopSoundEff(){}onClickRule(){d.default.show(this.node)}onClickBack(){p.default.show(this,p.DialogPosition.LEFT)}onQuit(){h.BannerData.setBannerData(l.Banner.ShowType.LEFT_MATCH,!0,l.Game.Enum.FRUIT),u.default.onQuit()}};_.instance=null,s([b(cc.Prefab)],_.prototype,"itemSlotPr",void 0),s([b(cc.Prefab)],_.prototype,"itemAnim",void 0),s([b(cc.Prefab)],_.prototype,"fruit_Rule",void 0),s([b([cc.Sprite])],_.prototype,"listItemMiniResult",void 0),s([b([cc.SpriteFrame])],_.prototype,"listSprBtn",void 0),s([b([cc.SpriteFrame])],_.prototype,"sprItems",void 0),s([b(cc.Node)],_.prototype,"blackMask",void 0),s([b(cc.Node)],_.prototype,"parentItemNode",void 0),s([b(cc.Node)],_.prototype,"itemMiniResult",void 0),s([b(cc.Node)],_.prototype,"bkg_mid",void 0),s([b(cc.Node)],_.prototype,"bkg_Top",void 0),s([b(cc.Node)],_.prototype,"bkg_Bottom",void 0),s([b(cc.Button)],_.prototype,"btn_Spin",void 0),s([b(cc.Label)],_.prototype,"lb_markBet",void 0),s([b(cc.Label)],_.prototype,"lb_ChipWinRound",void 0),s([b(cc.Label)],_.prototype,"lb_Chip",void 0),s([b(cc.Label)],_.prototype,"lb_Result",void 0),s([b(cc.Label)],_.prototype,"lb_info",void 0),s([b(cc.Label)],_.prototype,"lb_titleWin",void 0),s([b(cc.Label)],_.prototype,"lb_freeSpinLeft",void 0),s([b(cc.Label)],_.prototype,"lb_TypeMark",void 0),s([b(cc.Label)],_.prototype,"lb_numLine1",void 0),s([b(cc.Label)],_.prototype,"lb_numLine2",void 0),s([b(g.default)],_.prototype,"animBtnSpin",void 0),s([b([sp.SkeletonData])],_.prototype,"noel_items",void 0),s([b(sp.SkeletonData)],_.prototype,"khungFreeAmin",void 0),s([b(sp.SkeletonData)],_.prototype,"vienFreeAmin",void 0),s([b(sp.SkeletonData)],_.prototype,"speedSpinAnim",void 0),s([b(sp.SkeletonData)],_.prototype,"fiveOfaKindAmin",void 0),s([b(sp.SkeletonData)],_.prototype,"freespinAnim",void 0),s([b(sp.SkeletonData)],_.prototype,"megaBigWinAnim",void 0),s([b(sp.SkeletonData)],_.prototype,"freenumAnim",void 0),_=n=s([A],_),e.default=_,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/dialogs/shop/ShopDialog":void 0,"../../lobby/src/language/LanguageController":void 0,"./FruitConstants":"FruitConstants","./FruitItem":"FruitItem","./FruitItemAnimation":"FruitItemAnimation","./FruitNetworkTransport":"FruitNetworkTransport","./FruitRuleDialog":"FruitRuleDialog"}],FruitItemAnimation:[function(t,i,e){"use strict";cc._RF.push(i,"b2c3dTl9qeJAbze8jRWeJAS","FruitItemAnimation");var n=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,l=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,i,e,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(l=(o<3?s(l):o>3?s(i,e,l):s(i,e))||l);return o>3&&l&&Object.defineProperty(i,e,l),l};Object.defineProperty(e,"__esModule",{value:!0});const{ccclass:s,property:o}=cc._decorator;let l=class extends cc.Component{constructor(){super(...arguments),this.animation=null}initAnimation(t){this.animation.skeletonData=t,this.animation.premultipliedAlpha=!1,this.animation.animation="animation"}playAnimation(t="animation",i=!1,e=!0,n=!1){this.animation.node.active=!0,this.animation.paused=!1,this.animation.setAnimation(0,t,i),n||this.animation.node.runAction(cc.sequence(cc.delayTime(3.5),cc.removeSelf()))}playAnimation2(t="animation",i=!1){this.animation.node.active=!0,this.animation.paused=!1,this.animation.setAnimation(0,t,i)}playAnimBinh(t="animation",i=!1){this.animation.node.opacity=255,this.animation.setAnimation(0,t,i)}setMultiAlpha(t){this.animation.premultipliedAlpha=t}stopAnimation(){this.animation.node.active=!1,this.animation.paused=!0}};n([o(sp.Skeleton)],l.prototype,"animation",void 0),l=n([s],l),e.default=l,cc._RF.pop()},{}],FruitItem:[function(t,i,e){"use strict";cc._RF.push(i,"7c5aeLuM1xLt4IZLlbxxzSk","FruitItem");var n=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,l=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,i,e,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(l=(o<3?s(l):o>3?s(i,e,l):s(i,e))||l);return o>3&&l&&Object.defineProperty(i,e,l),l};Object.defineProperty(e,"__esModule",{value:!0});const s=t("./FruitController"),{ccclass:o,property:l}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.sprItems=[],this.sprBlurs=[],this.listItem=[],this.itemBlur=[],this.itemMain=[],this.numCol=null,this.typeItem=null,this.listIdView=[]}getRanNum(t,i){let e=Math.random()*(i-t)+t;return Math.floor(e)}setRandomId(t){let i=[this.getRanNum(0,13),this.getRanNum(0,13),this.getRanNum(0,13)];this.setSpriteListItem(i,t)}setSpriteListItem(t,i=!1){for(let e=0;e<this.listItem.length;e++){let n=t[e];this.setSprSonItem(e,n,i)}this.listIdView=t.slice()}setSprSonItem(t,i,e){let n=this.itemBlur[t],s=this.itemMain[t];n.getComponent(cc.Sprite).spriteFrame=this.sprBlurs[i],s.getComponent(cc.Sprite).spriteFrame=this.sprItems[i]}getWordPosItemList(){let t=[];for(let i=0;i<this.listItem.length;i++){let e=this.getWordPosItem(this.listItem[i]);t.push(e)}}getWordPosItem(t){let i=this.node.convertToWorldSpaceAR(t.position);return s.default.getInstance().node.convertToNodeSpaceAR(i)}getScatterItem(){let t={id:null,pos:null};for(let i=0;i<this.listIdView.length;i++){let e=this.listIdView[i];12===e&&(t.pos=this.getWordPosItem(this.listItem[i]),t.id=e,s.default.getInstance().scatterCount++,s.default.getInstance().listScatter.push(t))}}getItemWithId(t){let i=[];for(let e=0;e<this.listIdView.length;e++)this.listIdView[e]===t&&i.push(this.listItem[e]);return i}setStateSpr(t,i){this.itemMain[t].active=i}};n([l([cc.SpriteFrame])],a.prototype,"sprItems",void 0),n([l([cc.SpriteFrame])],a.prototype,"sprBlurs",void 0),n([l([cc.Node])],a.prototype,"listItem",void 0),n([l([cc.Node])],a.prototype,"itemBlur",void 0),n([l([cc.Node])],a.prototype,"itemMain",void 0),a=n([o],a),e.default=a,cc._RF.pop()},{"./FruitController":"FruitController"}],FruitNetworkTransport:[function(t,i,e){"use strict";cc._RF.push(i,"f48a3bCybVKlYF46tJ6xnRQ","FruitNetworkTransport"),Object.defineProperty(e,"__esModule",{value:!0});const n=t("../../lobby/src/network/NetworkClient"),s=t("../../lobby/src/common/ConfigClient"),o=t("../../lobby/src/common/Constants"),l=t("../../lobby/src/common/GlobalApp"),a=t("../../lobby/src/chat/ChatPresenter"),h=t("./FruitController"),r=t("../../lobby/src/lobby/GameList");class c{static subscribe(){n.default.getInstance().subscribeEventHandler(o.Game.Enum.FRUIT,this)}static matchDataHandler(t){switch(t.op_code){case s.default.Network.OP_CODE.OPCODE_UPDATE_TABLE:cc.log("OPCODE_UPDATE_TABLE",t.data),h.default.getInstance().handleCTable(t.data);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_DEAL:cc.log("OPCODE_UPDATE_DEAL",t.data);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_GAME_STATE:c.processUpdateGameState(t);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_FINISH:cc.log("result",t);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_WALLET:cc.log("wallet",t);break;case s.default.Network.OP_CODE.OPCODE_KICK_OFF_THE_TABLE:cc.log("kick off",t),c.onQuit();break;default:cc.log("Data code not found ",t)}}static processUpdateGameState(t){switch(t.data.state){case o.Game.GAME_STATE.PREPARE:break;case o.Game.GAME_STATE.RUN:cc.log("GAME_STATE.RUN",t);break;case o.Game.GAME_STATE.REWARD:cc.log("GAME_STATE.REWARD",t);break;case o.Game.GAME_STATE.FINISH:cc.log("GAME_STATE.FINISH",t);break;default:cc.log("Match state not found ",t)}}static sendSpin(t){n.default.getInstance().sendMatchState(l.default.getInstance().matchInfo.match_id,s.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_SPIN,t).then(t=>{cc.log("sendSpin success ",t)},t=>{cc.log("sendSpin err",t)})}static onQuit(t=(()=>{})){n.default.getInstance().leaveMatch(l.default.getInstance().matchInfo.match_id).then(i=>{cc.log("leave match: ",i),a.default.getInstance().leaveChat(),cc.sys.isBrowser&&s.default.AppInfo.WEB_NATIVE?(t(),window.location.href="/"):l.default.getInstance().loadSceneByMainBundle(s.default.AppInfo.SCENE_NAME.GAMELIST,()=>{var i;t(),null===(i=r.default.getInstance())||void 0===i||i.setGameType(o.GameType.Enum.SLOT_GAME),h.default.getInstance().node.destroy()})},()=>{cc.log("err when leave match")})}}e.default=c,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/lobby/GameList":void 0,"../../lobby/src/network/NetworkClient":void 0,"./FruitController":"FruitController"}],FruitRuleDialog:[function(t,i,e){"use strict";cc._RF.push(i,"3d75aoI8tJH94ckFYj+H8ud","FruitRuleDialog");var n,s=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,l=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,i,e,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(l=(o<3?s(l):o>3?s(i,e,l):s(i,e))||l);return o>3&&l&&Object.defineProperty(i,e,l),l};Object.defineProperty(e,"__esModule",{value:!0});const o=t("../../../bundles/lobby/src/common/BaseDialog"),l=t("../../../bundles/lobby/src/common/GlobalApp"),a=t("../../../bundles/lobby/src/common/ConfigClient"),{ccclass:h,property:r}=cc._decorator;let c=n=class extends o.default{constructor(){super(...arguments),this.ruleSprites=[],this.ruleContent=null,this.spriteIndex=0,this.isAnimating=!1}static getInstance(){return this.instance}actionNext(){this.ruleSprites.length<=0||this.isAnimating||(this.spriteIndex++,this.spriteIndex>=this.ruleSprites.length&&(this.spriteIndex=0),this.playPageTurnEffect(!0))}actionPrevious(){this.ruleSprites.length<=0||this.isAnimating||(this.spriteIndex--,this.spriteIndex<0&&(this.spriteIndex=this.ruleSprites.length-1),this.playPageTurnEffect(!1))}updateRuleDisplay(){this.ruleContent&&this.ruleSprites.length>0&&(this.ruleContent.spriteFrame=this.ruleSprites[this.spriteIndex])}playPageTurnEffect(t){if(!this.ruleContent||!this.ruleContent.node)return;this.isAnimating=!0;const i=this.ruleContent.node.scale,e=this.ruleContent.node.position,n=this.ruleContent.node.opacity;this.ruleContent.node.opacity=0,this.ruleContent.node.scale=.8*i,this.ruleContent.node.x=t?e.x+50:e.x-50,this.updateRuleDisplay(),cc.tween(this.ruleContent.node).to(.05,{opacity:100}).to(.25,{scale:i,x:e.x,opacity:n},{easing:"quartOut"}).call(()=>{this.isAnimating=!1}).start()}static show(t){null==this.instance||null==this.instance.node?l.default.getInstance().loadPrefabByBundle(a.default.Bundle.BUNDLE_NAME.FRUIT,"res/prefabs/FruitRuleDialog",(i,e)=>{if(null!=i)return void l.default.getInstance().alertDialog.showMessage(i);let s=cc.instantiate(e);s.parent=t,this.instance=s.getComponent(n),this.instance.node.zIndex=1e3,this.instance.show()}):(this.instance.node.zIndex=1e3,this.instance.show())}show(){super.show(),this.spriteIndex=0,this.updateRuleDisplay()}};c.instance=null,s([r([cc.SpriteFrame])],c.prototype,"ruleSprites",void 0),s([r(cc.Sprite)],c.prototype,"ruleContent",void 0),c=n=s([h],c),e.default=c,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}]},{},["FruitConstants","FruitController","FruitItem","FruitItemAnimation","FruitNetworkTransport","FruitRuleDialog"]);