window.__require=function t(e,i,a){function s(n,l){if(!i[n]){if(!e[n]){var r=n.split("/");if(r=r[r.length-1],!e[r]){var c="function"==typeof __require&&__require;if(!l&&c)return c(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+n+"'")}n=r}var h=i[n]={exports:{}};e[n][0].call(h.exports,function(t){return s(e[n][1][t]||t)},h,h.exports,t,e,i,a)}return i[n].exports}for(var o="function"==typeof __require&&__require,n=0;n<a.length;n++)s(a[n]);return s}({BaccaratChip:[function(t,e){"use strict";cc._RF.push(e,"de897gw9q9FO4x8Izh/M8aR","BaccaratChip");var i,a=(i=t("../../lobby/src/common/Utils"))&&i.__esModule?i:{default:i};cc.Class({extends:cc.Component,properties:{sprite:{default:null,type:cc.Sprite},label:{default:null,type:cc.Label},chipSprites:{default:[],type:cc.SpriteFrame},chip:0},setData:function(t){this.sprite.spriteFrame=this.chipSprites[t.spriteIndex],this.label.string=a.default.formatBetNumber(t.chip)||0,this.chip=t.chip||0}}),cc._RF.pop()},{"../../lobby/src/common/Utils":void 0}],BaccaratHistoryDialog:[function(t,e,i){"use strict";cc._RF.push(e,"7f2a0UUll5B35gmM6XFTr1u","BaccaratHistoryDialog");var a,s=this&&this.__decorate||function(t,e,i,a){var s,o=arguments.length,n=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(n=(o<3?s(n):o>3?s(e,i,n):s(e,i))||n);return o>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});const o=t("../../../bundles/lobby/src/common/BaseDialog"),n=t("../../lobby/src/common/ConfigClient"),l=t("../../lobby/src/common/GlobalApp");var r;(function(t){t[t.BANKER=1]="BANKER",t[t.PLAYER=2]="PLAYER",t[t.TIE=3]="TIE",t[t.PLAYER_PB=4]="PLAYER_PB",t[t.BANKER_PB=5]="BANKER_PB",t[t.PLAYER_P=102]="PLAYER_P",t[t.PLAYER_B=12]="PLAYER_B",t[t.BANKER_P=101]="BANKER_P",t[t.BANKER_B=11]="BANKER_B",t[t.TIE_P=103]="TIE_P",t[t.TIE_B=13]="TIE_B",t[t.TIE_PB=113]="TIE_PB"})(r||(r={}));const{ccclass:c,property:h}=cc._decorator;let d=a=class extends o.default{constructor(){super(...arguments),this.baccaratAtlas=null,this.lbHisPlayerDetail=null,this.lbHisBankerDetail=null,this.lbHisTieDetail=null,this.lbHisPlayerPair=null,this.lbHisBankerPair=null,this.content=null,this.itemBigRoad=null,this.tbBreadRoad=null,this.breadRoad=null,this.tbBigEye=null,this.hisBigEye=null,this.tbSmallRoad=null,this.hisSmallRoad=null,this.tbCockRoad=null,this.hisCockRoad=null,this.oldBreadRoad=[],this.oldBigEye=[],this.dataBigEyeRoad=[],this.oldSmallRoad=[],this.oldCockRoad=[],this.numWinB=0,this.numWinP=0,this.numWinT=0,this.numWinPP=0,this.numWinBP=0,this.count=0,this.index=1,this.indexBigEye=1,this.indexSmallRoad=1,this.indexCockRoad=1,this.curBigRoad=null,this.HISTORY_LAST_VALUE=null,this.HISTORY_STATE_IS_VERTICAL=!1,this.HISTORY_LAST_RESULT_COL=0,this.HISTORY_LAST_RESULT_ROW=0,this.HISTORY_STREAK=1,this.BREAD_ROAD_CHILD=null,this.HISTORY_LAST_BIGEYE_VALUE=null,this.HISTORY_STATE_IS_VERTICAL_BIGEYE=!1,this.HISTORY_LAST_BIGEYE_COL=0,this.HISTORY_LAST_BIGEYE_ROW=0,this.HISTORY_STREAK_BIGEYE=0,this.BIG_EYE_CHILD=null,this.isChuyenCot=!1,this.HISTORY_LAST_SMALL_VALUE=null,this.HISTORY_STATE_IS_VERTICAL_SMALL=!1,this.HISTORY_LAST_SMALL_COL=0,this.HISTORY_LAST_SMALL_ROW=0,this.HISTORY_STREAK_SMALL=0,this.SMALL_CHILD=null,this.HISTORY_LAST_COCK_VALUE=null,this.HISTORY_STATE_IS_VERTICAL_COCK=!1,this.HISTORY_LAST_COCK_COL=0,this.HISTORY_LAST_COCK_ROW=0,this.HISTORY_STREAK_COCK=0,this.COCK_CHILD=null,this.historyArray=[],this.historyBigEyeArr=[],this.historySmallRoad=[],this.historyCockRoad=[]}static getInstance(){return this.instance}static show(t){null==this.instance||null==this.instance.node?l.default.getInstance().loadPrefabByBundle(n.default.Bundle.BUNDLE_NAME.BACCARAT,"res/prefabs/BaccaratHistoryDialog",(e,i)=>{if(null!=e)return void l.default.getInstance().alertDialog.showMessage(e);let s=cc.instantiate(i);s.parent=t,this.instance=s.getComponent(a),this.instance.node.zIndex=1e3,this.pendingHistories.length>0&&(this.pendingHistories.forEach(t=>{this.instance.updateHistoryBigRoad(t)}),this.pendingHistories=[]),this.instance.show()}):(this.instance.node.zIndex=1e3,this.instance.show())}init(){this.numWinB=0,this.numWinP=0,this.numWinT=0,this.numWinPP=0,this.numWinBP=0,this.count=0,this.index=1,this.indexBigEye=1,this.indexSmallRoad=1,this.indexCockRoad=1,this.curBigRoad=this.itemBigRoad,this.node.zIndex=cc.macro.MAX_ZINDEX,this.setup2dArray(),this.HISTORY_LAST_VALUE=null,this.HISTORY_STATE_IS_VERTICAL=!1,this.HISTORY_LAST_RESULT_COL=0,this.HISTORY_LAST_RESULT_ROW=0,this.HISTORY_STREAK=1,this.BREAD_ROAD_CHILD=null,this.oldBreadRoad.push(this.tbBreadRoad),this.oldBreadRoad.push(this.tbBreadRoad),this.HISTORY_LAST_BIGEYE_VALUE=null,this.HISTORY_STATE_IS_VERTICAL_BIGEYE=!1,this.HISTORY_LAST_BIGEYE_COL=0,this.HISTORY_LAST_BIGEYE_ROW=0,this.HISTORY_STREAK_BIGEYE=0,this.BIG_EYE_CHILD=null,this.oldBigEye.push(this.hisBigEye),this.oldBigEye.push(this.hisBigEye),this.isChuyenCot=!1,this.HISTORY_LAST_SMALL_VALUE=null,this.HISTORY_STATE_IS_VERTICAL_SMALL=!1,this.HISTORY_LAST_SMALL_COL=0,this.HISTORY_LAST_SMALL_ROW=0,this.HISTORY_STREAK_SMALL=0,this.SMALL_CHILD=null,this.oldSmallRoad.push(this.hisSmallRoad),this.oldSmallRoad.push(this.hisSmallRoad),this.HISTORY_LAST_COCK_VALUE=null,this.HISTORY_STATE_IS_VERTICAL_COCK=!1,this.HISTORY_LAST_COCK_COL=0,this.HISTORY_LAST_COCK_ROW=0,this.HISTORY_STREAK_COCK=0,this.COCK_CHILD=null,this.oldCockRoad.push(this.hisCockRoad),this.oldCockRoad.push(this.hisCockRoad)}start(){this.init(),this.setInfo()}setInfo(){this.lbHisPlayerDetail.string=this.numWinP.toString(),this.lbHisBankerDetail.string=this.numWinB.toString(),this.lbHisTieDetail.string=this.numWinT.toString(),this.lbHisPlayerPair.string=this.numWinPP.toString(),this.lbHisBankerPair.string=this.numWinBP.toString()}updateHistory(t,e,i,a,s){this.numWinB=t,this.numWinP=e,this.numWinT=i,this.numWinPP=s,this.numWinBP=a,this.setInfo()}static addHistory(t){this.instance?this.instance.updateHistoryBigRoad(t):this.pendingHistories.push(t)}updateHistoryBigRoad(t){let e=new cc.Node;e.addComponent(cc.Sprite).spriteFrame=this.getSprBigRoad(t,"BigRoad");var i=this.content.childrenCount;if(this.count>83){if(this.count===84*i){var a=new cc.Node;a.setContentSize(355,153),a.setAnchorPoint(0,1),a.addComponent(cc.Sprite).spriteFrame=this.getSprBigRoad("","BigRoad"),a.setAnchorPoint(0,1),this.content.addChild(a);var s=new cc.Node;s.setPosition(2,-2),s.setAnchorPoint(0,1),s.setContentSize(355,153);let t=s.addComponent(cc.Layout);t.startAxis=cc.Layout.AxisDirection.HORIZONTAL,t.type=cc.Layout.Type.GRID,t.spacingX=5.5,t.spacingY=5.5,t.verticalDirection=cc.Layout.VerticalDirection.TOP_TO_BOTTOM,t.horizontalDirection=cc.Layout.HorizontalDirection.LEFT_TO_RIGHT,a.addChild(s),this.curBigRoad=s}this.curBigRoad.addChild(e)}else this.itemBigRoad.getChildByName("nodeItem").addChild(e);let o;switch(this.count++,t){case r.PLAYER:o=2,this.numWinP+=1;break;case r.PLAYER_P:this.numWinPP+=1,o=2;break;case r.PLAYER_B:case r.PLAYER_PB:o=2;break;case r.BANKER:this.numWinB+=1,o=1;break;case r.BANKER_P:this.numWinBP+=1,o=1;break;case r.BANKER_B:case r.BANKER_PB:o=1;break;case r.TIE:this.numWinT+=1,o=3;break;case r.TIE_P:case r.TIE_B:case r.TIE_PB:o=3}this.setInfo(),this.getPositionToInsertSprite(o,t)}getSprBigRoad(t,e){let i="",a="";switch(e){case"BigRoad":i="BigRoad";break;case"BreadRoad":i="BreadRoad";break;case"CockRoad":i="CockRoad";break;case"SmallRoad":i="SmallRoad";break;case"BigEye":i="BigEye";break;case"cockroad":i="cockroad"}switch(t){case r.PLAYER:a="_P";break;case r.PLAYER_P:a="_P_P";break;case r.PLAYER_B:a="_P_B";break;case r.PLAYER_PB:a="_P_PB";break;case r.BANKER:a="_B";break;case r.BANKER_P:a="_B_P";break;case r.BANKER_B:a="_B_B";break;case r.BANKER_PB:a="_B_PB";break;case r.TIE:a="_T";break;case r.TIE_P:a="_T_P";break;case r.TIE_B:a="_T_B";break;case r.TIE_PB:a="_T_PB";break;case"red":a="_red";break;case"blue":a="_blue";break;default:return this.baccaratAtlas.getSpriteFrame(i)}return this.baccaratAtlas.getSpriteFrame(i+a)}convertArrayIndexToPosition(t,e,i){switch(i){case"BreadRoad":{let i=0,a=0;return this.HISTORY_LAST_RESULT_COL>=32*this.index&&(t-=32*this.index),0===t&&(a=3.5),0===e&&(i=3.5),cc.v2(23.7*t+a,-26.3*e-i)}case"BigEye":{let i=0,a=0;return this.HISTORY_LAST_BIGEYE_COL>=64*this.indexBigEye&&(t-=64*this.indexBigEye),t%2!=0&&(a=.3),0===t&&(a=2),0===e&&(i=2),cc.v2(11.8*t+a,-13*e-i)}case"SmallRoad":{let i=0,a=0;return this.HISTORY_LAST_SMALL_COL>=30*this.indexSmallRoad&&(t-=30*this.indexSmallRoad),t%2!=0&&(a=.3),0===t&&(a=2),0===e&&(i=2),cc.v2(11.8*t+a,-13*e-i)}case"CockRoad":{let i=0,a=0;return this.HISTORY_LAST_COCK_COL>=30*this.indexCockRoad&&(t-=30*this.indexCockRoad),t%2!=0&&(a=.3),0===t&&(a=2),0===e&&(i=2),cc.v2(11.8*t+a,-13*e-i)}}}getPositionToInsertSprite(t,e){if(this.historyArray&&0!=this.historyArray.length||this.init(),3!=t||null!=this.HISTORY_LAST_VALUE){if(null==this.HISTORY_LAST_VALUE)this.HISTORY_LAST_RESULT_ROW=0,this.HISTORY_LAST_RESULT_COL=0,this.HISTORY_LAST_VALUE=t,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1;else{if(3==t)return this.convertArrayIndexToPosition(this.HISTORY_LAST_RESULT_COL,this.HISTORY_LAST_RESULT_ROW,""),void this.setPositionSpriteHistory(t,e);if(t==this.HISTORY_LAST_VALUE)this.isChuyenCot=!1,1==this.HISTORY_STREAK&&(this.HISTORY_STATE_IS_VERTICAL=!0),this.HISTORY_STREAK++,this.HISTORY_STATE_IS_VERTICAL?this.HISTORY_LAST_RESULT_ROW>=5||1==this.historyArray[this.HISTORY_LAST_RESULT_ROW+1][this.HISTORY_LAST_RESULT_COL]?(this.HISTORY_STATE_IS_VERTICAL=!1,this.HISTORY_LAST_RESULT_COL++,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1):1==this.historyArray[this.HISTORY_LAST_RESULT_ROW+1][this.HISTORY_LAST_RESULT_COL]?(this.HISTORY_STATE_IS_VERTICAL=!1,this.HISTORY_LAST_RESULT_COL++,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1):(this.HISTORY_LAST_RESULT_ROW++,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1):(this.HISTORY_LAST_RESULT_COL+=1,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1),this.HISTORY_LAST_VALUE=t;else{for(let t=0;t<this.historyArray[0].length;t++)if(0==this.historyArray[0][t]){this.HISTORY_LAST_RESULT_COL=t;break}this.dataBigEyeRoad.push(this.HISTORY_STREAK),this.isChuyenCot=!0,this.HISTORY_STREAK=1,this.HISTORY_LAST_RESULT_ROW=0,this.HISTORY_LAST_VALUE=t,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1}}this.setPositionSpriteHistory(t,e),this.dataBigEye(),this.dataIndexSmallRoad(),this.dataIndexCockRoad()}else this.HISTORY_LAST_VALUE}dataBigEye(){let t=0;if(!this.isChuyenCot&&this.dataBigEyeRoad.length>0&&this.HISTORY_STREAK>1)t=this.HISTORY_STREAK===this.dataBigEyeRoad[this.dataBigEyeRoad.length-1]+1?2:1;else{if(!(this.dataBigEyeRoad.length>1))return;t=this.dataBigEyeRoad[this.dataBigEyeRoad.length-1]!==this.dataBigEyeRoad[this.dataBigEyeRoad.length-2]?2:1}this.getPositionBigEyeRoad(t)}dataIndexSmallRoad(){let t=0;if(!this.isChuyenCot&&this.dataBigEyeRoad.length>1&&this.HISTORY_STREAK>1)t=this.HISTORY_STREAK===this.dataBigEyeRoad[this.dataBigEyeRoad.length-2]+1?1:2;else{if(!(this.dataBigEyeRoad.length>2))return;t=this.dataBigEyeRoad[this.dataBigEyeRoad.length-1]!==this.dataBigEyeRoad[this.dataBigEyeRoad.length-3]?1:2}this.getPositionSmallRoad(t)}dataIndexCockRoad(){let t=0;if(!this.isChuyenCot&&this.dataBigEyeRoad.length>2&&this.HISTORY_STREAK>1)t=this.HISTORY_STREAK===this.dataBigEyeRoad[this.dataBigEyeRoad.length-3]+1?1:2;else{if(!(this.dataBigEyeRoad.length>3))return;t=this.dataBigEyeRoad[this.dataBigEyeRoad.length-1]!==this.dataBigEyeRoad[this.dataBigEyeRoad.length-4]?1:2}this.getPositionCockRoad(t)}getPositionBigEyeRoad(t){if(null==this.HISTORY_LAST_BIGEYE_VALUE)this.HISTORY_LAST_BIGEYE_ROW=0,this.HISTORY_LAST_BIGEYE_COL=0,this.HISTORY_LAST_BIGEYE_VALUE=t,this.historyBigEyeArr[this.HISTORY_LAST_BIGEYE_ROW][this.HISTORY_LAST_BIGEYE_COL]=1;else if(t==this.HISTORY_LAST_BIGEYE_VALUE)0==this.HISTORY_STREAK_BIGEYE&&(this.HISTORY_STATE_IS_VERTICAL_BIGEYE=!0),this.HISTORY_STREAK_BIGEYE++,this.HISTORY_STATE_IS_VERTICAL_BIGEYE?this.HISTORY_LAST_BIGEYE_ROW>=5||1==this.historyBigEyeArr[this.HISTORY_LAST_BIGEYE_ROW+1][this.HISTORY_LAST_BIGEYE_COL]?(this.HISTORY_STATE_IS_VERTICAL_BIGEYE=!1,this.HISTORY_LAST_BIGEYE_COL++,this.historyBigEyeArr[this.HISTORY_LAST_BIGEYE_ROW][this.HISTORY_LAST_BIGEYE_COL]=1):1==this.historyBigEyeArr[this.HISTORY_LAST_BIGEYE_ROW+1][this.HISTORY_LAST_BIGEYE_COL]?(this.HISTORY_STATE_IS_VERTICAL_BIGEYE=!1,this.HISTORY_LAST_BIGEYE_COL++,this.historyBigEyeArr[this.HISTORY_LAST_BIGEYE_ROW][this.HISTORY_LAST_BIGEYE_COL]=1):(this.HISTORY_LAST_BIGEYE_ROW++,this.historyBigEyeArr[this.HISTORY_LAST_BIGEYE_ROW][this.HISTORY_LAST_BIGEYE_COL]=1):(this.HISTORY_LAST_BIGEYE_COL+=1,this.historyBigEyeArr[this.HISTORY_LAST_BIGEYE_ROW][this.HISTORY_LAST_BIGEYE_COL]=1),this.HISTORY_LAST_BIGEYE_VALUE=t;else{for(let t=0;t<this.historyBigEyeArr[0].length;t++)if(0==this.historyBigEyeArr[0][t]){this.HISTORY_LAST_BIGEYE_COL=t;break}this.HISTORY_STREAK_BIGEYE=0,this.HISTORY_LAST_BIGEYE_ROW=0,this.HISTORY_LAST_BIGEYE_VALUE=t,this.historyBigEyeArr[this.HISTORY_LAST_BIGEYE_ROW][this.HISTORY_LAST_BIGEYE_COL]=1}this.setPositionItemBigEye(t)}getPositionSmallRoad(t){if(null==this.HISTORY_LAST_SMALL_VALUE)this.HISTORY_LAST_SMALL_ROW=0,this.HISTORY_LAST_SMALL_COL=0,this.HISTORY_LAST_SMALL_VALUE=t,this.historySmallRoad[this.HISTORY_LAST_SMALL_ROW][this.HISTORY_LAST_SMALL_COL]=1;else if(t==this.HISTORY_LAST_SMALL_VALUE)0==this.HISTORY_STREAK_SMALL&&(this.HISTORY_STATE_IS_VERTICAL_SMALL=!0),this.HISTORY_STREAK_SMALL++,this.HISTORY_STATE_IS_VERTICAL_SMALL?this.HISTORY_LAST_SMALL_ROW>=5||1==this.historySmallRoad[this.HISTORY_LAST_SMALL_ROW+1][this.HISTORY_LAST_SMALL_COL]?(this.HISTORY_STATE_IS_VERTICAL_SMALL=!1,this.HISTORY_LAST_SMALL_COL++,this.historySmallRoad[this.HISTORY_LAST_SMALL_ROW][this.HISTORY_LAST_SMALL_COL]=1):1==this.historySmallRoad[this.HISTORY_LAST_SMALL_ROW+1][this.HISTORY_LAST_SMALL_COL]?(this.HISTORY_STATE_IS_VERTICAL_SMALL=!1,this.HISTORY_LAST_SMALL_COL++,this.historySmallRoad[this.HISTORY_LAST_SMALL_ROW][this.HISTORY_LAST_SMALL_COL]=1):(this.HISTORY_LAST_SMALL_ROW++,this.historySmallRoad[this.HISTORY_LAST_SMALL_ROW][this.HISTORY_LAST_SMALL_COL]=1):(this.HISTORY_LAST_SMALL_COL+=1,this.historySmallRoad[this.HISTORY_LAST_SMALL_ROW][this.HISTORY_LAST_SMALL_COL]=1),this.HISTORY_LAST_SMALL_VALUE=t;else{for(let t=0;t<this.historySmallRoad[0].length;t++)if(0==this.historySmallRoad[0][t]){this.HISTORY_LAST_SMALL_COL=t;break}this.HISTORY_STREAK_SMALL=0,this.HISTORY_LAST_SMALL_ROW=0,this.HISTORY_LAST_SMALL_VALUE=t,this.historySmallRoad[this.HISTORY_LAST_SMALL_ROW][this.HISTORY_LAST_SMALL_COL]=1}this.setPositionItemSmallRoad(t)}getPositionCockRoad(t){if(null==this.HISTORY_LAST_COCK_VALUE)this.HISTORY_LAST_COCK_ROW=0,this.HISTORY_LAST_COCK_COL=0,this.HISTORY_LAST_COCK_VALUE=t,this.historyCockRoad[this.HISTORY_LAST_COCK_ROW][this.HISTORY_LAST_COCK_COL]=1;else if(t==this.HISTORY_LAST_COCK_VALUE)0==this.HISTORY_STREAK_COCK&&(this.HISTORY_STATE_IS_VERTICAL_COCK=!0),this.HISTORY_STREAK_COCK++,this.HISTORY_STATE_IS_VERTICAL_COCK?this.HISTORY_LAST_COCK_ROW>=5||1==this.historyCockRoad[this.HISTORY_LAST_COCK_ROW+1][this.HISTORY_LAST_COCK_COL]?(this.HISTORY_STATE_IS_VERTICAL_COCK=!1,this.HISTORY_LAST_COCK_COL++,this.historyCockRoad[this.HISTORY_LAST_COCK_ROW][this.HISTORY_LAST_COCK_COL]=1):1==this.historyCockRoad[this.HISTORY_LAST_COCK_ROW+1][this.HISTORY_LAST_COCK_COL]?(this.HISTORY_STATE_IS_VERTICAL_COCK=!1,this.HISTORY_LAST_COCK_COL++,this.historyCockRoad[this.HISTORY_LAST_COCK_ROW][this.HISTORY_LAST_COCK_COL]=1):(this.HISTORY_LAST_COCK_ROW++,this.historyCockRoad[this.HISTORY_LAST_COCK_ROW][this.HISTORY_LAST_COCK_COL]=1):(this.HISTORY_LAST_COCK_COL+=1,this.historyCockRoad[this.HISTORY_LAST_COCK_ROW][this.HISTORY_LAST_COCK_COL]=1),this.HISTORY_LAST_COCK_VALUE=t;else{for(let t=0;t<this.historyCockRoad[0].length;t++)if(0==this.historyCockRoad[0][t]){this.HISTORY_LAST_COCK_COL=t;break}this.HISTORY_STREAK_COCK=0,this.HISTORY_LAST_COCK_ROW=0,this.HISTORY_LAST_COCK_VALUE=t,this.historyCockRoad[this.HISTORY_LAST_COCK_ROW][this.HISTORY_LAST_COCK_COL]=1}this.setPositionItemCockRoad(t)}setPositionSpriteHistory(t,e){let i=new cc.Node,a=i.addComponent(cc.Sprite);3!==t&&(a.spriteFrame=this.getSprBigRoad(e,"BreadRoad")),i.setAnchorPoint(0,1);var s=this.breadRoad.childrenCount;if(this.HISTORY_LAST_RESULT_COL>=32*this.index){if(this.HISTORY_LAST_RESULT_COL===32*s){var o=new cc.Node;o.setContentSize(754,151),o.setAnchorPoint(0,1),o.addComponent(cc.Sprite).spriteFrame=this.getSprBigRoad("","BreadRoad"),this.breadRoad.addChild(o),this.oldBreadRoad.push(o),32===this.HISTORY_LAST_RESULT_COL?this.index=1:this.index++}this.BREAD_ROAD_CHILD=this.oldBreadRoad[this.oldBreadRoad.length-1],this.BREAD_ROAD_CHILD.addChild(i)}else if(this.BREAD_ROAD_CHILD=this.oldBreadRoad[this.oldBreadRoad.length-2],this.BREAD_ROAD_CHILD.addChild(i),this.HISTORY_LAST_RESULT_COL>=32){let t=this.convertArrayIndexToPosition(this.HISTORY_LAST_RESULT_COL-32*(this.index-1),this.HISTORY_LAST_RESULT_ROW,"BreadRoad");return void i.setPosition(t)}let n=this.convertArrayIndexToPosition(this.HISTORY_LAST_RESULT_COL,this.HISTORY_LAST_RESULT_ROW,"BreadRoad");i.setPosition(n)}setPositionItemBigEye(t){let e=new cc.Node,i=e.addComponent(cc.Sprite);e.setScale(.5),3!==t&&(i.spriteFrame=this.getSprBigRoad(t,"BreadRoad"));var a=this.tbBigEye.childrenCount;if(e.setAnchorPoint(0,1),this.HISTORY_LAST_BIGEYE_COL>=64*this.indexBigEye){if(this.HISTORY_LAST_BIGEYE_COL===64*a){var s=new cc.Node;s.setContentSize(754,77),s.setAnchorPoint(0,1),s.addComponent(cc.Sprite).spriteFrame=this.getSprBigRoad("","BigEye"),this.tbBigEye.addChild(s),this.oldBigEye.push(s),64===this.HISTORY_LAST_BIGEYE_COL?this.indexBigEye=1:this.indexBigEye++}this.BIG_EYE_CHILD=this.oldBigEye[this.oldBigEye.length-1],this.BIG_EYE_CHILD.addChild(e)}else if(this.BIG_EYE_CHILD=this.oldBigEye[this.oldBigEye.length-2],this.BIG_EYE_CHILD.addChild(e),this.HISTORY_LAST_BIGEYE_COL>=64){let t=this.convertArrayIndexToPosition(this.HISTORY_LAST_BIGEYE_COL-64*(this.indexBigEye-1),this.HISTORY_LAST_BIGEYE_ROW,"BigEye");return void e.setPosition(t)}let o=this.convertArrayIndexToPosition(this.HISTORY_LAST_BIGEYE_COL,this.HISTORY_LAST_BIGEYE_ROW,"BigEye");e.setPosition(o)}setPositionItemSmallRoad(t){let e=new cc.Node,i=e.addComponent(cc.Sprite);e.setScale(.5),3!==t&&(i.spriteFrame=this.getSprBigRoad(t,"SmallRoad"));var a=this.tbSmallRoad.childrenCount;if(e.setAnchorPoint(0,1),this.HISTORY_LAST_SMALL_COL>=30*this.indexSmallRoad){if(this.HISTORY_LAST_SMALL_COL===30*a){var s=new cc.Node;s.setContentSize(355,77),s.setAnchorPoint(0,1),s.addComponent(cc.Sprite).spriteFrame=this.getSprBigRoad("","cockroad"),this.tbSmallRoad.addChild(s),this.oldSmallRoad.push(s),30===this.HISTORY_LAST_SMALL_COL?this.indexSmallRoad=1:this.indexSmallRoad++}this.SMALL_CHILD=this.oldSmallRoad[this.oldSmallRoad.length-1],this.SMALL_CHILD.addChild(e)}else if(this.SMALL_CHILD=this.oldSmallRoad[this.oldSmallRoad.length-2],this.SMALL_CHILD.addChild(e),this.HISTORY_LAST_SMALL_COL>=30){let t=this.convertArrayIndexToPosition(this.HISTORY_LAST_SMALL_COL-30*(this.indexSmallRoad-1),this.HISTORY_LAST_SMALL_ROW,"SmallRoad");return void e.setPosition(t)}let o=this.convertArrayIndexToPosition(this.HISTORY_LAST_SMALL_COL,this.HISTORY_LAST_SMALL_ROW,"SmallRoad");e.setPosition(o)}setPositionItemCockRoad(t){let e=new cc.Node,i=e.addComponent(cc.Sprite);e.setScale(.5),3!==t&&(i.spriteFrame=this.getSprBigRoad(t,"CockRoad"));var a=this.tbCockRoad.childrenCount;if(e.setAnchorPoint(0,1),this.HISTORY_LAST_COCK_COL>=30*this.indexCockRoad){if(this.HISTORY_LAST_COCK_COL===30*a){var s=new cc.Node;s.setContentSize(355,77),s.setAnchorPoint(0,1),s.addComponent(cc.Sprite).spriteFrame=this.getSprBigRoad("","cockroad"),this.tbCockRoad.addChild(s),this.oldCockRoad.push(s),30===this.HISTORY_LAST_COCK_COL?this.indexCockRoad=1:this.indexCockRoad++}this.COCK_CHILD=this.oldCockRoad[this.oldCockRoad.length-1],this.COCK_CHILD.addChild(e)}else if(this.COCK_CHILD=this.oldCockRoad[this.oldCockRoad.length-2],this.COCK_CHILD.addChild(e),this.HISTORY_LAST_COCK_COL>=30){let t=this.convertArrayIndexToPosition(this.HISTORY_LAST_COCK_COL-30*(this.indexCockRoad-1),this.HISTORY_LAST_COCK_ROW,"CockRoad");return void e.setPosition(t)}let o=this.convertArrayIndexToPosition(this.HISTORY_LAST_COCK_COL,this.HISTORY_LAST_COCK_ROW,"CockRoad");e.setPosition(o)}setup2dArray(){this.historyArray=new Array(6);for(let t=0;t<this.historyArray.length;t++)this.historyArray[t]=new Array(200);for(let t=0;t<6;t++)for(let e=0;e<200;e++)this.historyArray[t][e]=0;this.historyBigEyeArr=new Array(6);for(let t=0;t<this.historyBigEyeArr.length;t++)this.historyBigEyeArr[t]=new Array(200);for(let t=0;t<6;t++)for(let e=0;e<200;e++)this.historyBigEyeArr[t][e]=0;this.historySmallRoad=new Array(6);for(let t=0;t<this.historySmallRoad.length;t++)this.historySmallRoad[t]=new Array(200);for(let t=0;t<6;t++)for(let e=0;e<200;e++)this.historySmallRoad[t][e]=0;this.historyCockRoad=new Array(6);for(let t=0;t<this.historyCockRoad.length;t++)this.historyCockRoad[t]=new Array(200);for(let t=0;t<6;t++)for(let e=0;e<200;e++)this.historyCockRoad[t][e]=0}onlicktesttrang(){this.getPositionCockRoad(1)}onclicktestvang(){this.getPositionCockRoad(2)}};d.instance=null,d.pendingHistories=[],s([h(cc.SpriteAtlas)],d.prototype,"baccaratAtlas",void 0),s([h(cc.Label)],d.prototype,"lbHisPlayerDetail",void 0),s([h(cc.Label)],d.prototype,"lbHisBankerDetail",void 0),s([h(cc.Label)],d.prototype,"lbHisTieDetail",void 0),s([h(cc.Label)],d.prototype,"lbHisPlayerPair",void 0),s([h(cc.Label)],d.prototype,"lbHisBankerPair",void 0),s([h(cc.Node)],d.prototype,"content",void 0),s([h(cc.Node)],d.prototype,"itemBigRoad",void 0),s([h(cc.Node)],d.prototype,"tbBreadRoad",void 0),s([h(cc.Node)],d.prototype,"breadRoad",void 0),s([h(cc.Node)],d.prototype,"tbBigEye",void 0),s([h(cc.Node)],d.prototype,"hisBigEye",void 0),s([h(cc.Node)],d.prototype,"tbSmallRoad",void 0),s([h(cc.Node)],d.prototype,"hisSmallRoad",void 0),s([h(cc.Node)],d.prototype,"tbCockRoad",void 0),s([h(cc.Node)],d.prototype,"hisCockRoad",void 0),d=a=s([c],d),i.default=d,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/GlobalApp":void 0}],BaccaratNetworkTransport:[function(t,e){"use strict";cc._RF.push(e,"fc688XfohpDB6OiFgGtDTD9","BaccaratNetworkTransport");var i=r(t("../../lobby/src/common/ConfigClient")),a=t("../../lobby/src/common/Constants"),s=r(t("../../lobby/src/network/NetworkClient")),o=r(t("../../lobby/src/common/User")),n=r(t("../../lobby/src/common/GlobalApp")),l=r(t("../../lobby/src/chat/ChatPresenter"));function r(t){return t&&t.__esModule?t:{default:t}}var c=cc.Class({extends:cc.Component,properties:{},statics:{instance:null,getInstance:function(){return null==this.instance&&(this.instance=new c,s.default.getInstance().subscribeEventHandler(a.Game.Enum.BACCARAT,this.instance)),this.instance}},matchDataHandler:function(e){var a,s,o,n,l;switch(e.op_code){case i.default.Network.OP_CODE.OPCODE_UPDATE_TABLE:cc.log("OPCODE_UPDATE_TABLE",e.data),null==(a=t("Baccarat").getInstance())||a.updateDesk(e.data);break;case i.default.Network.OP_CODE.OPCODE_UPDATE_DEAL:cc.log("OPCODE_UPDATE_DEAL",e.data),null==(s=t("Baccarat").getInstance())||s.updateDeal(e.data);break;case i.default.Network.OP_CODE.OPCODE_UPDATE_GAME_STATE:this.processUpdateGameState(e);break;case i.default.Network.OP_CODE.OPCODE_UPDATE_FINISH:cc.log("result",e),null==(o=t("Baccarat").getInstance())||o.endGame(e.data);break;case i.default.Network.OP_CODE.OPCODE_UPDATE_WALLET:cc.log("wallet",e),null==(n=t("Baccarat").getInstance())||n.updateGameBalances(e.data);break;case i.default.Network.OP_CODE.OPCODE_KICK_OFF_THE_TABLE:cc.log("kick off",e),this.onQuit();break;case i.default.Network.OP_CODE.OPCODE_LIST_PLAYER:cc.log("OPCODE_LIST_PLAYER",e),null==(l=t("Baccarat").getInstance())||l.reloadListPlayer(e.data);break;default:cc.log("Data code not found ",e)}},processUpdateGameState:function(e){switch(e.data.state){case a.Game.GAME_STATE.PREPARE:var i;if(t("Baccarat").getInstance().gameState==a.Game.GAME_STATE.PREPARE)return;t("Baccarat").getInstance().gameState=a.Game.GAME_STATE.PREPARE,null==(i=t("Baccarat").getInstance())||i.prepare();break;case a.Game.GAME_STATE.RUN:var s;cc.log("GAME_STATE.RUN",e),t("Baccarat").getInstance().gameState=a.Game.GAME_STATE.RUN,null==(s=t("Baccarat").getInstance())||s.countDown(e.data.countDown);break;case a.Game.GAME_STATE.REWARD:var o;cc.log("GAME_STATE.REWARD",e),t("Baccarat").getInstance().gameState=a.Game.GAME_STATE.REWARD,null==(o=t("Baccarat").getInstance())||o.reward();break;case a.Game.GAME_STATE.FINISH:cc.log("GAME_STATE.FINISH",e);break;default:cc.log("Match state not found ",e)}},sendBet:function(t){s.default.getInstance().sendMatchState(n.default.getInstance().matchInfo.match_id,i.default.Network.OP_CODE_REQUEST.OPCODE_BET,t).then(function(t){cc.log("sendBet success ",t)},function(t){cc.log("sendBet err",t)})},getUsers:function(){s.default.getInstance().sendMatchState(n.default.getInstance().matchInfo.match_id,i.default.Network.OP_CODE_REQUEST.OPCODE_LIST_USERS,{}).then(function(){cc.log("list users ")},function(t){cc.log("get list users failed",t)})},onQuit:function(e,a){void 0===e&&(e=function(){}),void 0===a&&(a=!0),s.default.getInstance().leaveMatch(n.default.getInstance().matchInfo.match_id).then(function(s){cc.log("leave match: ",s),t("Baccarat").getInstance().gameState=null,l.default.getInstance().leaveChat(),a&&n.default.getInstance().loadSceneByMainBundle(o.default.vipLevel>0?i.default.AppInfo.SCENE_NAME.TABLELIST:i.default.AppInfo.SCENE_NAME.GAMELIST),e&&e()},function(){cc.log("err when leave match")})}});e.exports=c,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/network/NetworkClient":void 0,Baccarat:"Baccarat"}],BaccaratRuleDialog:[function(t,e,i){"use strict";cc._RF.push(e,"e638eNEqsVKNLJd7MTMt+FF","BaccaratRuleDialog");var a,s=this&&this.__decorate||function(t,e,i,a){var s,o=arguments.length,n=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,a);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(n=(o<3?s(n):o>3?s(e,i,n):s(e,i))||n);return o>3&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(i,"__esModule",{value:!0});const o=t("../../../bundles/lobby/src/common/BaseDialog"),n=t("../../../bundles/lobby/src/common/GlobalApp"),l=t("../../../bundles/lobby/src/common/ConfigClient"),{ccclass:r,property:c}=cc._decorator;let h=a=class extends o.default{static getInstance(){return this.instance}static show(t){null==this.instance||null==this.instance.node?n.default.getInstance().loadPrefabByBundle(l.default.Bundle.BUNDLE_NAME.BACCARAT,"res/prefabs/BaccaratRuleDialog",(e,i)=>{if(null!=e)return void n.default.getInstance().alertDialog.showMessage(e);let s=cc.instantiate(i);s.parent=t,this.instance=s.getComponent(a),this.instance.node.zIndex=1e3,this.instance.show()}):(this.instance.node.zIndex=1e3,this.instance.show())}};h.instance=null,h=a=s([r],h),i.default=h,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}],Baccarat:[function(t,e){"use strict";cc._RF.push(e,"cf31dMfhwVLVKQ4YEdhA9CO","Baccarat");var a=f(t("../../lobby/src/audio/AudioController")),s=f(t("../../lobby/src/game/GamePresenter")),o=f(t("../../lobby/src/common/GlobalApp")),n=f(t("../../lobby/src/language/LanguageController")),l=f(t("../../lobby/src/common/Utils")),r=t("../../lobby/src/dialogs/banner/BannerDialog"),c=t("../../lobby/src/common/Constants"),h=f(t("../../lobby/src/common/User")),d=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=A(void 0);if(e&&e.has(t))return e.get(t);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var o=a?Object.getOwnPropertyDescriptor(t,s):null;o&&(o.get||o.set)?Object.defineProperty(i,s,o):i[s]=t[s]}return i.default=t,e&&e.set(t,i),i}(t("../../lobby/src/dialogs/option/OptionDialog")),_=f(t("../../lobby/src/dialogs/chatingame/ChatInGameDialog")),u=f(t("../../lobby/src/chat/ChatPresenter")),S=f(t("./BaccaratRuleDialog")),T=f(t("./BaccaratHistoryDialog")),R=f(t("../../lobby/src/network/NetworkClient")),C=f(t("../../lobby/src/common/ConfigClient")),p=f(t("../../lobby/src/scripts/ingame/BubbleChat")),L=f(t("../../lobby/src/scripts/ingame/PlayerCasino")),g=f(t("../../lobby/src/scripts/ingame/Card"));function A(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(A=function(t){return t?i:e})(t)}function f(t){return t&&t.__esModule?t:{default:t}}var I=cc.Class({extends:cc.Component,properties:{playerPrefab:{default:null,type:cc.Prefab},bgPlayer:{default:null,type:cc.Node},nodeLbBet:{default:null,type:cc.Node},nodeLbTotalBet:{default:null,type:cc.Node},chipPrefab:{default:null,type:cc.Prefab},nodeUser:{default:null,type:cc.Node},nodeLights:{default:null,type:cc.Node},chips:{default:[],type:cc.Node},user_avt:{default:null,type:cc.Sprite},user_avt_border:{default:null,type:cc.Sprite},user_name:{default:null,type:cc.Label},user_wallet:{default:null,type:cc.Label},anim_clock:{default:null,type:sp.Skeleton},lbClock:{default:null,type:cc.Label},nodeChipBet:{default:null,type:cc.Node},toastBetSuccess:{default:null,type:cc.Node},lbWin:{default:null,type:cc.Label},lbChip:{default:null,type:cc.Label},fontWin:{default:null,type:cc.Font},fontLose:{default:null,type:cc.Font},winPopup:{default:null,type:cc.Node},nodeButtons:{default:null,type:cc.Node},anim_startcompare:{default:null,type:sp.Skeleton},nodePlayer:{default:null,type:cc.Node},nodeBanker:{default:null,type:cc.Node},cardPrefab:{default:null,type:cc.Prefab},nodeBankerCards:{default:null,type:cc.Node},nodePlayerCards:{default:null,type:cc.Node},cardsPosition:{default:[],type:cc.Vec2},nodeCards:{default:null,type:cc.Node},nodeHistory:{default:null,type:cc.Node},bgResult:{default:null,type:cc.Node},animResult:{default:null,type:sp.Skeleton},animResultWin:{default:null,type:sp.SkeletonData},spriteFrameExitMatch:{default:null,type:cc.SpriteFrame},spriteFrameChangeMatch:{default:null,type:cc.SpriteFrame},icBack:{default:null,type:cc.Node},lbInfo:{default:null,type:cc.Label},player:{default:null,type:cc.Node},bubbleChatPrefab:cc.Prefab,bgThrow:{default:null,type:cc.Node},thu_bai_pos:{default:null,type:cc.Node},chia_bai_pos:{default:null,type:cc.Node},thu_chip_pos:{default:null,type:cc.Node},tableAudio:{default:null,type:cc.AudioClip}},statics:{instance:null,getInstance:function(){return this.instance}},onLoad:function(){I.instance=this,t("BaccaratNetworkTransport").getInstance(),localStorage.setItem("isLeave","false"),a.default.getInstance().playMusic(this.tableAudio,!0),this.gameState=null,this.history={bankerWin:0,playerWin:0,tie:0},this.updateHistory(),this.chipBetTemp=new Map,this.allUserBets=new Map,this.left2Right=!0,this.maxPlayer=4,this.listBet=[1e3,2e3,5e3,1e4],this.loadListBet(),this.loadProfile(),this.loadCards(),this.index=0},start:function(){this.setMatchInfo()},loadCards:function(){this.playerCards=[],this.bankerCards=[],this.nodePlayerCards.scale=.4,this.nodeBankerCards.scale=.4;for(var t=0;t<3;t++){var e=cc.instantiate(this.cardPrefab);e.getComponent(g.default).hideCardPusoy(),e.position=this.cardsPosition[t],e.active=!1,this.nodePlayerCards.addChild(e),this.playerCards.push(e);var i=cc.instantiate(this.cardPrefab);i.getComponent(g.default).hideCardPusoy(),i.position=this.cardsPosition[t+3],i.active=!1,this.nodeBankerCards.addChild(i),this.bankerCards.push(i)}},loadListBet:function(){var t=this;this.listBet.forEach(function(e,i){t.chips[i].children[0].getComponent(cc.Label).string=l.default.formatBetNumber(e)}),this.chosenChip=this.listBet[0],this.chips[0].children[1].active=!0},onClickRule:function(){S.default.show(this.node)},loadProfile:function(){this.player.getComponent(L.default).setData({id:h.default.userId,user_name:h.default.displayName,wallet:h.default.accountChip,avatar_id:h.default.avatarId,vipLevel:h.default.vipLevel}),this.user_wallet.string=l.default.formatBetNumber(h.default.accountChip)},onClickHistory:function(){T.default.show(this.node)},onClickChip:function(t,e){var i=this;this.chosenChip=this.listBet[e],this.listBet.forEach(function(t,e){i.chips[e].children[1].active=!1}),this.chips[e].children[1].active=!0},onClickBet:function(e,i){if(this.gameState===c.Game.GAME_STATE.RUN){var a=[];a.push({chips:this.chosenChip,cell:Number(i)}),console.log("bet data: ",{user_id:h.default.userId||"",bets:a}),t("BaccaratNetworkTransport").getInstance().sendBet({user_id:h.default.userId||"",bets:a})}},onRebet:function(){var e;console.log("onRebet",this.gameState),this.gameState===c.Game.GAME_STATE.RUN&&(console.log("onRebet",this.lastBets),null==(e=this.lastBets)||e.forEach(function(e,i){console.log(i),console.log(e),t("BaccaratNetworkTransport").getInstance().sendBet({user_id:h.default.userId||"",bets:[{chips:e,cell:i}]})}))},onDouble:function(){var e;this.gameState===c.Game.GAME_STATE.RUN&&(console.log("double"),console.log(this.isBetted),this.isBetted?this.chipBetTemp.forEach(function(e,i){t("BaccaratNetworkTransport").getInstance().sendBet({user_id:h.default.userId||"",bets:[{chips:e,cell:i}]})}):(console.log("no bet"),null==(e=this.lastBets)||e.forEach(function(e,i){t("BaccaratNetworkTransport").getInstance().sendBet({user_id:h.default.userId||"",bets:[{chips:2*e,cell:i}]})})))},throwChipBet:function(t,e,i){var a=cc.instantiate(this.chipPrefab),s=this.listBet.findIndex(function(t){return t==e});-1==s&&(s=this.listBet.length),console.log(s);var o={spriteIndex:s,chip:e};a.getComponent("BaccaratChip").setData(o),a.position=new cc.Vec2(t.x,t.y),this.nodeChipBet.addChild(a);var n,l,r=this.nodeButtons.getChildByName(i.toString()),c=new cc.Vec2;return n=r.width/2-20-Math.random()*(r.width-40),l=r.height/2-20-Math.random()*(r.height-40)+Math.tan(r.angle*Math.PI/180)*n,c=new cc.Vec2(r.x+n,r.y+l),cc.tween(a).to(.3,{position:c}).start(),a},showToastBet:function(t){var e=this;this.toastBetSuccess.children[0].getComponent(cc.Label).string="Bet "+t+"!",this.toastBetSuccess.opacity=0,this.toastBetSuccess.active=!0,cc.tween(this.toastBetSuccess).to(.2,{opacity:255}).delay(.5).call(function(){e.toastBetSuccess.active=!1}).start()},clearAllData:function(){this.lbClock.string="10",this.allUserBets=new Map,this.nodeChipBet.destroyAllChildren(),this.nodeLights.children.forEach(function(t){t.active=!1}),this.nodeLbBet.children.forEach(function(t){t.active=!1}),this.nodeLbTotalBet.children.forEach(function(t){t.active=!1});for(var t=0;t<3;t++)this.playerCards[t].getComponent(g.default).hideCardPusoy(),this.bankerCards[t].getComponent(g.default).hideCardPusoy(),this.playerCards[t].active=!1,this.bankerCards[t].active=!1;this.nodeBanker.active=!1,this.nodePlayer.active=!1,this.winPopup.active=!1,this.bgResult.active=!1,this.isBetted=!1,this.lastBets=new Map(this.chipBetTemp),this.chipBetTemp=new Map,this.index=0},updateDesk:function(t){var e,i=this;if(t.error)return console.log("updateDesk",t.error),void(1==t.error.errorType&&o.default.getInstance().alertDialog.showMessage(n.default.getInstance().getString("txt_not_enough_money_gl")));if(t.isUpdateDeskCell&&(null==(e=t.deskCells)||e.forEach(function(t){i.nodeLbTotalBet.getChildByName(t.cell.toString()).children[0].getComponent(cc.Label).string=l.default.formatBetNumber(t.chips),i.nodeLbTotalBet.getChildByName(t.cell.toString()).active=!0})),t.isUpdateUserBet){var a,s=this.getPlayer(t.userBet.userId);t.userBet.userId==h.default.userId&&(this.isBetted=!0,this.showToastBet("success"),s=this.nodeUser),null==(a=t.userBet)||a.bets.forEach(function(e){var a=i.throwChipBet(s,e.chips,e.cell);i.chipBetTemp.set(e.cell,(Number(i.chipBetTemp.get(e.cell))||0)+Number(e.chips)),i.nodeLbBet.getChildByName(e.cell.toString()).getComponent(cc.Label).string=l.default.formatBetNumber(i.chipBetTemp.get(e.cell)),i.nodeLbBet.getChildByName(e.cell.toString()).active=!0,i.allUserBets[e.cell]||(i.allUserBets[e.cell]=new Map),i.allUserBets[e.cell][t.userBet.userId]||(i.allUserBets[e.cell][t.userBet.userId]=[]),i.allUserBets[e.cell][t.userBet.userId].push(a)})}},updateDeal:function(t){var e=this;if(t.isPlayer){var i=cc.instantiate(this.cardPrefab);i.getComponent(g.default).hideCardPusoy(),i.position=this.chia_bai_pos.position,i.active=!1,i.scale=.4,i.parent=this.nodeChipBet,i.getComponent(g.default).setData(t.cards[0].rank,t.cards[0].suit),this.playerCards[this.index].getComponent(g.default).setData(t.cards[0].rank,t.cards[0].suit);var a=this.index;cc.tween(i).call(function(){i.position=e.chia_bai_pos.position,i.scaleX=.4,i.angle=68,i.active=!0}).to(.2,{position:cc.v2((this.chia_bai_pos.position.x+this.nodePlayerCards.parent.position.x)/2,(this.chia_bai_pos.position.y+this.nodePlayerCards.parent.position.y)/2),scaleX:0,angle:34}).call(function(){e.playerCards[a].getComponent(g.default).showCardPusoy(),i.getComponent(g.default).showCardPusoy()}).to(.2,{position:this.nodePlayerCards.parent.position,scaleX:.4,angle:0}).call(function(){e.playerCards[a].active=!0,i.destroy()}).start()}else{var s=cc.instantiate(this.cardPrefab);s.getComponent(g.default).hideCardPusoy(),s.position=this.chia_bai_pos.position,s.active=!1,s.scale=.4,s.parent=this.nodeChipBet,s.getComponent(g.default).setData(t.cards[0].rank,t.cards[0].suit);var o=this.index;this.bankerCards[o].getComponent(g.default).setData(t.cards[0].rank,t.cards[0].suit),cc.tween(s).call(function(){s.position=e.chia_bai_pos.position,s.scaleX=.4,s.angle=68,s.active=!0}).to(.2,{position:cc.v2((this.chia_bai_pos.position.x+this.nodeBankerCards.parent.position.x)/2,(this.chia_bai_pos.position.y+this.nodeBankerCards.parent.position.y)/2),scaleX:0,angle:34}).call(function(){e.bankerCards[o].getComponent(g.default).showCardPusoy(),s.getComponent(g.default).showCardPusoy()}).to(.2,{position:this.nodeBankerCards.parent.position,scaleX:.4,angle:0}).call(function(){s.destroy(),e.bankerCards[o].active=!0}).start(),this.index++}},prepare:function(){var t=this;cc.tween(this.node).call(function(){t.clearAllData(),t.leaveMatch()}).delay(.5).call(function(){t.anim_startcompare.animation=null,t.anim_startcompare.node.active=!1;for(var e=0;e<3;e++){var i=cc.instantiate(t.cardPrefab);i.getComponent(g.default).hideCardPusoy(),i.position=t.cardsPosition[e+3],i.active=!1,t.nodeBankerCards.addChild(i),t.bankerCards.push(i)}}).delay(2).call(function(){t.anim_startcompare.node.active=!0,t.anim_startcompare.animation="bettime"}).delay(1).call(function(){t.anim_startcompare.animation=null,t.anim_startcompare.node.active=!1}).start()},countDown:function(t){var e=this;cc.tween(this.node).call(function(){e.anim_clock.node.active=!0,e.anim_clock.animation="animation";var i=t;e.lbClock.string=i,e.anim_clock.loop=i<=5,e.anim_clock.animation="animation"}).start()},reward:function(){var t=this;cc.tween(this.node).call(function(){t.anim_clock.animation=null,t.anim_clock.loop=!1,t.anim_clock.node.active=!1}).start()},updateHistory:function(){this.nodeHistory.getChildByName("banker").children[0].getComponent(cc.Label).string=this.history.bankerWin,this.nodeHistory.getChildByName("player").children[0].getComponent(cc.Label).string=this.history.playerWin,this.nodeHistory.getChildByName("tie").children[0].getComponent(cc.Label).string=this.history.tie},endGame:function(t){var e=this;console.log("end game: ",t),cc.tween(this.node).call(function(){var i=cc.tween(e.node);i.call(function(){e.nodeBanker.children[0].getComponent(cc.Label).string=t.hand.banker.point,e.nodeBanker.active=!0}),i.call(function(){e.nodePlayer.children[0].getComponent(cc.Label).string=t.hand.player.point,e.nodePlayer.active=!0}),i.delay(.5).call(function(){for(var i,a=0;a<(null==(s=t.winCells)?void 0:s.length);a++){var s;T.default.addHistory(t.winCells[a])}null==(i=t.winCells)||i.forEach(function(t){e.nodeLights.getChildByName(t.toString()).active=!0})}),i.start()}).delay(1).call(function(){Object.keys(e.allUserBets).filter(function(e){return!t.winCells.includes(Number(e))}).forEach(function(t){Object.keys(e.allUserBets[t]).forEach(function(i){e.allUserBets[t][i].forEach(function(t){cc.tween(t).to(.45,{position:e.thu_chip_pos.position}).call(function(){t.destroy()}).start()})})})}).delay(.8).call(function(){t.winCells.forEach(function(t){e.allUserBets[t]&&Object.keys(e.allUserBets[t]).forEach(function(i){[].concat(e.allUserBets[t][i]).forEach(function(a){var s=e.throwChipBet(e.thu_chip_pos,a.getComponent("BaccaratChip").chip,t);e.allUserBets[t][i].push(s)})})})}).delay(.8).call(function(){t.winCells.forEach(function(t){e.allUserBets[t]&&Object.keys(e.allUserBets[t]).forEach(function(i){var a=e.getPlayer(i);e.allUserBets[t][i].forEach(function(t){cc.tween(t).to(.5,{position:cc.v2(a.x,a.y)}).delay(.5).call(function(){t.destroy()}).start()}),e.scheduleOnce(function(){var t,s;if(e.balances[i])if(Number(e.balances[i].amountChipAdd)>0)null==(t=a.getComponent(L.default))||t.showEffectWinLose(1),null==(s=a.getComponent(L.default))||s.showEffectFlyMoney2(Number(e.balances[i].amountChipAdd));else if(Number(e.balances[i].amountChipAdd)<0){var o,n;null==(o=a.getComponent(L.default))||o.showEffectWinLose(-1),null==(n=a.getComponent(L.default))||n.showEffectFlyMoney2(Number(e.balances[i].amountChipAdd))}},.6)})})}).delay(2).call(function(){if(e.balances[h.default.userId]){var i=e.balances[h.default.userId]&&Number(e.balances[h.default.userId].amountChipAdd)>0;e.balances[h.default.userId]&&Number(e.balances[h.default.userId].amountChipAdd),e.animResult.skeletonData=e.animResultWin,t.hand.banker.point>t.hand.player.point?(e.animResult.animation="banker",e.history.bankerWin++):t.hand.banker.point<t.hand.player.point?(e.animResult.animation="player",e.history.playerWin++):(e.animResult.animation="tie",e.history.tie++),e.updateHistory(),i&&(e.lbWin.font=e.fontWin,e.lbChip.string="+"+l.default.formatNumberToString(e.balances[h.default.userId].amountChipAdd),e.lbChip.font=e.fontWin,e.bgResult.active=!0)}}).delay(1).call(function(){e.bgResult.active=!1}).delay(.5).call(function(){for(var t=function(t){if(!e.bankerCards[t].active)return"continue";var i=cc.instantiate(e.cardPrefab);i.getComponent(g.default).setData(e.bankerCards[t].getComponent(g.default).data.rank,e.bankerCards[t].getComponent(g.default).data.suit),i.position=e.nodeBankerCards.parent.position,i.parent=e.nodeChipBet,i.scale=.4,i.active=!1,cc.tween(i).delay(.4*t).call(function(){i.position=e.nodeBankerCards.parent.position,i.angle=0,i.active=!0,e.bankerCards[t].active=!1}).to(.2,{position:cc.v2((e.thu_bai_pos.position.x+e.nodeBankerCards.parent.position.x)/2,(e.thu_bai_pos.position.y+e.nodeBankerCards.parent.position.y)/2),scaleX:0,angle:34}).call(function(){i.getComponent(g.default).hideCardPusoy()}).to(.2,{position:e.thu_bai_pos.position,scaleX:.4,angle:68}).call(function(){i.destroy()}).start()},i=2;i>=0;i--)t(i);for(var a=function(t){if(!e.playerCards[t].active)return"continue";var i=cc.instantiate(e.cardPrefab);i.getComponent(g.default).setData(e.playerCards[t].getComponent(g.default).data.rank,e.playerCards[t].getComponent(g.default).data.suit),i.position=e.nodePlayerCards.parent.position,i.parent=e.nodeChipBet,i.active=!1,i.scale=.4,cc.tween(i).delay(1+.4*t).call(function(){i.position=e.nodePlayerCards.parent.position,i.angle=0,i.active=!0,e.playerCards[t].active=!1}).to(.2,{position:cc.v2((e.thu_bai_pos.position.x+e.nodePlayerCards.parent.position.x)/2,(e.thu_bai_pos.position.y+e.nodePlayerCards.parent.position.y)/2),scaleX:0,angle:34}).call(function(){i.getComponent(g.default).hideCardPusoy()}).to(.2,{position:e.thu_bai_pos.position,scaleX:.4,angle:68}).call(function(){i.destroy()}).start()},s=2;s>=0;s--)a(s)}).delay(4).call(function(){e.clearAllData()}).start()},updateGameBalances:function(t){var e=new Map;t.updates.forEach(function(t){e[t.userId]=t}),this.balances=e,this.balances[h.default.userId]&&(this.user_wallet.string=l.default.formatBetNumber(this.balances[h.default.userId].amountChipCurrent),this.userChip=this.balances[h.default.userId].amountChipCurrent)},setMatchInfo:function(){u.default.getInstance().joinChatRoom(o.default.getInstance().matchInfo.match_id,this);var t=JSON.parse(o.default.getInstance().matchInfo.label),e=t.tableId.slice(0,5);t.tableId.length>5&&(e+="..."),this.lbInfo.string="ID: "+e+"\nBertaruh: "+l.default.formatWalletNumber(t.markUnit),localStorage.setItem("isLeave","false"),localStorage.setItem("isChangeMatch","false"),this.listBet=[1,5,10,50,100].map(function(e){return e*t.markUnit}),this.loadListBet()},onMenuClick:function(){d.default.show(this,d.DialogPosition.RIGHT)},leaveMatch:function(){var e=this;"true"===localStorage.getItem("isLeave")?(r.BannerData.setBannerData(c.Banner.ShowType.LEFT_MATCH,!0),t("BaccaratNetworkTransport").getInstance().onQuit()):"true"===localStorage.getItem("isChangeMatch")&&(this.icBack.active=!1,t("BaccaratNetworkTransport").getInstance().onQuit(function(){o.default.getInstance().showProcessing(!0),e.clearAllData(),cc.Tween.stopAllByTarget(e.node),e.unscheduleAllCallbacks(),setTimeout(function(){var t=JSON.parse(o.default.getInstance().matchInfo.label);s.default.changeMatch(t.markUnit,o.default.getInstance().Match)},2)},!1))},getPlayer:function(t){return h.default.userId===t?this.player:this.getPlayerNodeUserId(t)},throwIcons:function(t){var e=this.getPlayer(t.sender_id),a=this.getPlayer(t.throw.to_id);e==a?this.player.active&&this.player.getComponent(L.default).id!==t.sender_id&&this.createIconAndThrow(t.throw.iconIndex,e,i):this.createIconAndThrow(t.throw.iconIndex,e,a)},createIconAndThrow:function(t,e,i){var a=this,s=new cc.Node,o=s.addComponent(cc.Sprite),n=u.default.getInstance().getThrowIcon(t);o.spriteFrame=n,s.setPosition(e.position),this.bgThrow.addChild(s),cc.tween(s).to(.5,{position:i.position}).call(function(){s.destroy();var e=new cc.Node,o=e.addComponent(sp.Skeleton);o.skeletonData=u.default.getInstance().getThrowAnimation(t),o.animation="animation",o.loop=!1,o.premultipliedAlpha=!1,"F"==data.emoji.type?e.scale=1.3:e.scale=2,e.position=cc.v2(0,20),i.addChild(e),a.scheduleOnce(function(){e.destroy()},3)}).start()},onChatClick:function(){this.gameState!==c.Game.GAME_STATE.SPECTATING&&_.default.show()},showChat:function(t){if(t.sender_id===h.default.userId){var e=this.getPlayer(t.sender_id),i=t.message,a=cc.instantiate(this.bubbleChatPrefab);a.getComponent(p.default).setData(i),a.scale=2,a.position=cc.v2(70,0),e.addChild(a),this.scheduleOnce(function(){a.destroy()},3)}},showEmoji:function(t){if(t.sender_id===h.default.userId){var e=u.default.getInstance().getEmojiByTypeAndIndex(t.emoji.type,t.emoji.index).value,i=this.getPlayer(t.sender_id),a=new cc.Node,s=a.addComponent(sp.Skeleton);s.skeletonData=e,s.animation="animation",s.premultipliedAlpha=!1,"F"==t.emoji.type?a.scale=1.3:a.scale=2,a.position=cc.v2(0,20),i.addChild(a),this.scheduleOnce(function(){a.destroy()},2)}},onChangeMatch:function(){var e=this;!this.isBetted||this.gameState!==c.Game.GAME_STATE.RUN&&this.gameState!==c.Game.GAME_STATE.REWARD?t("BaccaratNetworkTransport").getInstance().onQuit(function(){o.default.getInstance().showProcessing(!0),e.clearAllData(),cc.Tween.stopAllByTarget(e.node),e.unscheduleAllCallbacks(),setTimeout(function(){var t=JSON.parse(o.default.getInstance().matchInfo.label);s.default.changeMatch(t.markUnit,o.default.getInstance().Match)},2)},!1):(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameChangeMatch,this.icBack.scale=.5,"true"===localStorage.getItem("isChangeMatch")?(this.icBack.active=!1,localStorage.setItem("isChangeMatch","false"),o.default.getInstance().toast.showToast(n.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isChangeMatch","true"),o.default.getInstance().toast.showToast(n.default.getInstance().getString("wait_game_end_to_leave"))))},onQuit:function(){!this.isBetted||this.gameState!==c.Game.GAME_STATE.RUN&&this.gameState!==c.Game.GAME_STATE.REWARD?((0,r.BannerData)(c.Banner.ShowType.LEFT_MATCH,!0),t("BaccaratNetworkTransport").getInstance().onQuit()):(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameExitMatch,this.icBack.scale=1,"true"===localStorage.getItem("isLeave")?(this.icBack.active=!1,localStorage.setItem("isLeave","false"),o.default.getInstance().showToast(n.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isLeave","true"),o.default.getInstance().showToast(n.default.getInstance().getString("wait_game_end_to_leave"))))},getPlayerNodeUserId:function(t){for(var e=0;e<this.bgPlayer.children.length;e++)if(this.bgPlayer.children[e].active&&this.bgPlayer.children[e].getComponent(L.default)&&this.bgPlayer.children[e].getComponent(L.default).id==t)return this.bgPlayer.children[e];return null},getPlayerInfoByUserId:function(t){for(var e=0;e<this.bgPlayer.children.length;e++)if(this.bgPlayer.children[e].active&&this.bgPlayer.children[e].getComponent(L.default)&&this.bgPlayer.children[e].getComponent(L.default).id==t)return this.bgPlayer.children[e].getComponent(L.default).getInfo();return null},reloadListPlayer:function(t){var e=this,i=this.bgPlayer.children.length-1;this.bgPlayer.children.forEach(function(e,a){if(e.active&&(a!==i||e.getComponent(L.default))){for(var s=0;s<t.players.length;s++)if(t.players[s].id==e.getComponent(L.default).id)return;e.active=!1}}),this.bgPlayer.children[i].active&&!this.bgPlayer.children[i].getComponent(L.default)&&t.players.length<=i+1&&(this.bgPlayer.children[i].active=!1),t.players.forEach(function(i){if(i.id!==h.default.userId){for(var a=!1,s=0;s<e.bgPlayer.children.length;s++){var o;if(e.bgPlayer.children[s].active&&i.id==(null==(o=e.bgPlayer.children[s].getComponent(L.default))?void 0:o.id)){a=!0;break}}a||e.updatePlayer(i,t.players.length)}})},getNextIndex:function(){for(var t=0;t<this.bgPlayer.children.length;t++)if(!this.bgPlayer.children[t].active)return this.bgPlayer.children[t].scale=this.playerScale,t;return-1},updatePlayer:function(t,e){var i=this.getNextIndex();if(-1!=i&&(this.bgPlayer.children[i].active=!0),i==this.bgPlayer.children.length-1||-1==i){if(!this.bgPlayer.children[this.bgPlayer.children.length-1].getComponent(L.default))return i=this.bgPlayer.children.length-1,void(this.bgPlayer.children[i].children[0].getComponent(cc.Label).string="+"+(e-this.bgPlayer.children.length));if(-1==i)return}this.bgPlayer.children[i].getComponent(L.default).setData({id:null==t?void 0:t.id,user_name:null==t?void 0:t.userName,wallet:null==t?void 0:t.wallet,avatar_id:null==t?void 0:t.avatarId,vipLevel:null==t?void 0:t.vipLevel,sId:null==t?void 0:t.sid}),this.bgPlayer.children[i].getChildByName("avatar").getComponent(cc.Button)||(this.bgPlayer.children[i].getChildByName("avatar").addComponent(cc.Button),this.bgPlayer.children[i].getChildByName("avatar").getComponent(cc.Button).target=this.bgPlayer.children[i]);var a=new cc.Component.EventHandler;a.target=this.node,a.component=this.node._name,a.handler="profileClick",a.customEventData=null==t?void 0:t.id,this.bgPlayer.children[i].getChildByName("avatar").getComponent(cc.Button).clickEvents=[a]},profileClick:function(t){t.target.parent.getComponent(L.default).showPlayerInfo()},reloadProfileInfo:function(){R.default.getInstance().rpcCall(C.default.Network.RPC_ID.GET_PROFILE,{}).then(function(t){h.default.init(t.payload)},function(t){cc.log("err when get PROFILE ",t)})}});e.exports=I,cc._RF.pop()},{"../../lobby/src/audio/AudioController":void 0,"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/chatingame/ChatInGameDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/game/GamePresenter":void 0,"../../lobby/src/language/LanguageController":void 0,"../../lobby/src/network/NetworkClient":void 0,"../../lobby/src/scripts/ingame/BubbleChat":void 0,"../../lobby/src/scripts/ingame/Card":void 0,"../../lobby/src/scripts/ingame/PlayerCasino":void 0,"./BaccaratHistoryDialog":"BaccaratHistoryDialog","./BaccaratRuleDialog":"BaccaratRuleDialog",BaccaratNetworkTransport:"BaccaratNetworkTransport"}]},{},["Baccarat","BaccaratChip","BaccaratHistoryDialog","BaccaratNetworkTransport","BaccaratRuleDialog"]);