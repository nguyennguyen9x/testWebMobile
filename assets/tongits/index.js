window.__require=function e(t,r,o){function s(n,a){if(!r[n]){if(!t[n]){var l=n.split("/");if(l=l[l.length-1],!t[l]){var c="function"==typeof __require&&__require;if(!a&&c)return c(l,!0);if(i)return i(l,!0);throw new Error("Cannot find module '"+n+"'")}n=l}var h=r[n]={exports:{}};t[n][0].call(h.exports,function(e){return s(t[n][1][e]||e)},h,h.exports,e,t,r,o)}return r[n].exports}for(var i="function"==typeof __require&&__require,n=0;n<o.length;n++)s(o[n]);return s}({AvatarItem:[function(e,t){"use strict";cc._RF.push(t,"d5746+4yUVMBYmukcnu06w6","AvatarItem");var r=e("GameManager");cc.Class({extends:cc.Component,properties:{avatar:{default:null,type:cc.Sprite},btn_select:{default:null,type:cc.Button},isFirstLoad:!0,curId:0,cors_url:"https://cors-anywhere.herokuapp.com/",isClick:!0,vip:0,border:cc.Sprite},loadTexture:function(t,r,o,s){if(void 0===s&&(s=0),t=t%10==0?10:t%10,this.avatar.spriteFrame=e("UIManager").instance.avt_default,this.curId=t,this.vip=s,t>0&&t<999)e("UIManager").instance.loadTextureAvatar(this.avatar,t);else{var i=e("ConfigManager").getInstance().avatar_fb||"https://graph.facebook.com/v10.0/%fbID%/picture?width=200&height=200&redirect=true&access_token=%token%";if(i=i.replace("%token%",e("GameManager").getInstance().access_token),-1!==r.indexOf("fb.")){var n=r.substring(3,r.length);i=i.replace("%fbID%",n)}else null!==o&&(i=i.replace("%fbID%",o));IS_RUN_INSTANT_FACEBOOK&&(i=FBInstant.player.getPhoto()),this.loadTextureFromUrl(this.avatar,i)}this.setBorder()},setBorder:function(){null!=this.border&&void 0!==this.border&&(this.vip<=2?e("GameManager").getInstance().loadTexture(this.border,cc.js.formatStr(ResDefine.borderVip,1)):this.vip<=4?e("GameManager").getInstance().loadTexture(this.border,cc.js.formatStr(ResDefine.borderVip,2)):this.vip<=6?e("GameManager").getInstance().loadTexture(this.border,cc.js.formatStr(ResDefine.borderVip,3)):this.vip<=8?e("GameManager").getInstance().loadTexture(this.border,cc.js.formatStr(ResDefine.borderVip,4)):e("GameManager").getInstance().loadTexture(this.border,cc.js.formatStr(ResDefine.borderVip,5)))},loadTextureFromUrl:function(e,t){var r=this.cors_url;cc.log("AVATAR",r+t),(cc.sys.isNative||IS_RUN_INSTANT_FACEBOOK)&&(r=""),-1===t.indexOf(".png")?cc.loader.load({url:r+t,type:"png"},function(t,r){if(t||null===e||void 0===e.spriteFrame)cc.NGWlog("loadTextureFromUrl FB error:"+t);else try{e.spriteFrame=new cc.SpriteFrame(r)}catch(o){cc.NGWlog("load avt fail ")}}):cc.loader.load(r+t,function(t,r){if(t||null===e||void 0===e.spriteFrame)cc.NGWlog("Error Load Image");else try{e.spriteFrame=new cc.SpriteFrame(r)}catch(o){cc.NGWlog("load avt fail ")}})},onClickAvatar:function(){this.curId!==r.getInstance().user.avtId&&this.isClick&&(e("SoundManager1").instance.playButton(),e("NetworkManager").getInstance().sendChangeAvatar(this.curId),r.getInstance().user.avtId=this.curId)}}),cc._RF.pop()},{ConfigManager:void 0,GameManager:void 0,NetworkManager:void 0,SoundManager1:void 0,UIManager:void 0}],ButtonManager:[function(e,t,r){"use strict";cc._RF.push(t,"a6d51dhlIdASZQkjTgGXDsB","ButtonManager");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const s=e("../../lobby/src/common/GlobalApp"),i=e("../../lobby/src/common/User"),n=e("./TongitsController"),a=e("./TongitsNetworkTransport"),{ccclass:l,property:c}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.btn_drop=null,this.btn_fight=null,this.btn_group=null,this.btn_dump=null,this.btn_ungroup=null,this.btn_declare=null,this.btn_draw=null,this.btn_tongits=null,this.TongitsController=null}onEnable(){this.TongitsController=this.node.parent.getComponent(n.TongitsController)}onDrawClick(){a.TongitsNetworkTransport.getInstance().sendTgBc(),this.TongitsController.btn_sort.getComponent(cc.Button).interactable=!1}allowDraw(e){this.btn_draw.interactable=e}onDropClick(){const e=this.TongitsController.getCardDropInfo();cc.log("*** drop ",e),!0===e.isValid?a.TongitsNetworkTransport.getInstance().sendTgHc(e.arrD):this.TongitsController.showNoti("Hindi mo maaaring i-drop ang card na ito"),this.enableAllButton(!1)}onFightClick(){if(this.TongitsController.checkIfCanFight())if("off"===cc.sys.localStorage.getItem("tongits_fight_confirm"))a.TongitsNetworkTransport.getInstance().sendTgFight();else{this.TongitsController.calculatePoint();const e="txt_message_confirm";s.default.getInstance().confirmDialog.showMessage(e,()=>{a.TongitsNetworkTransport.getInstance().sendTgFight()})}}onGroupClick(){this.TongitsController.doGroupSelectedCard(),this.enableGroup(!1),this.enableDrop(!1),this.enableDump(!1),this.enableUngroup(!1),this.enableGroup(!1),this.TongitsController.updatePlayerPoint()}onUnGroupClick(){this.TongitsController.doUnGroup(),this.enableDrop(!1),this.enableDump(!1),this.enableUngroup(!1),this.enableGroup(!1),this.TongitsController.updatePlayerPoint()}onDumpClick(){const e=this.TongitsController.getDumpInfo();cc.log("!>, dump",e),e&&(e.isValid?a.TongitsNetworkTransport.getInstance().sendTgDc(e.code):this.TongitsController.showNoti("Hindi mo maaaring itapon ang card na ito"))}showXepBai(){[this.btn_drop,this.btn_dump,this.btn_fight].forEach(e=>e.node.active=!1),this.btn_declare.node.active=!0,this.btn_declare.interactable=!0,this.activeTongits(!1)}showXepBaiBlackList(){[this.btn_drop,this.btn_dump,this.btn_fight].forEach(e=>e.node.active=!1),this.btn_declare.node.active=!0,this.btn_declare.interactable=!1,this.activeTongits(!1)}onDeclareClick(){const e=this.TongitsController.getDeclareData();this.node.stopAllActions(),null!=e&&a.TongitsNetworkTransport.getInstance().sendTgDeclare(e)}enableDump(e){if(this.btn_dump.interactable=e,this.TongitsController){const t=this.TongitsController.calculatePoint(),r=this.TongitsController.getPlayer(i.default.userName).isTurn(),o=this.isDeclare(),s=this.TongitsController.checkValidPhomPure(),n=this.TongitsController.checkDropedCard();this.activeTongits(!e&&0==t&&r&&!o&&(s||n))}else this.activeTongits(!1)}enableGroup(e){!0===e&&(this.enableUngroup(!1),this.TongitsController.playerGroups.length>=6)||(this.btn_group.interactable=e)}enableUngroup(e){}enableDrop(e){this.btn_drop.interactable=e}enableFight(e){this.btn_fight.interactable=e}enableAllButton(e){[this.btn_drop,this.btn_dump,this.btn_fight,this.btn_group].forEach(t=>t.interactable=e),this.activeTongits(!1),this.enableUngroup(!1)}activeAllButton(e){this.node.active=e,[this.btn_drop,this.btn_dump,this.btn_fight,this.btn_group].forEach(e=>e.node.active=!0),this.btn_declare.node.active=!1,this.btn_ungroup.node.active=!1,this.activeTongits(!1),this.enableUngroup(!1)}onTongitsClick(){const e=this.TongitsController.getDeclareData();a.TongitsNetworkTransport.getInstance().sendTgTongits(e)}activeTongits(e){this.btn_tongits.node.active=e}isDeclare(){return this.btn_declare.node.active}};o([c(cc.Button)],h.prototype,"btn_drop",void 0),o([c(cc.Button)],h.prototype,"btn_fight",void 0),o([c(cc.Button)],h.prototype,"btn_group",void 0),o([c(cc.Button)],h.prototype,"btn_dump",void 0),o([c(cc.Button)],h.prototype,"btn_ungroup",void 0),o([c(cc.Button)],h.prototype,"btn_declare",void 0),o([c(cc.Button)],h.prototype,"btn_draw",void 0),o([c(cc.Button)],h.prototype,"btn_tongits",void 0),h=o([l],h),r.default=h,cc._RF.pop()},{"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"./TongitsController":"TongitsController","./TongitsNetworkTransport":"TongitsNetworkTransport"}],CardShan:[function(e,t,r){"use strict";cc._RF.push(t,"f03efpdZ7VL/K2MH+VFwnhe","CardShan");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.upperNode=[],this.lowerNode=[],this.itemSuit=null,this.bigSuit=null,this.suiteParent=null,this.frameSheet=null}setInfo(e,t,r,o,s){t>13&&(t-=13);const i=this.setElementPos(t);if(this.itemSuit.getComponent(cc.Sprite).spriteFrame=o,this.upperNode[0].spriteFrame=s,this.upperNode[1].spriteFrame=o,this.lowerNode[0].spriteFrame=s,this.lowerNode[1].spriteFrame=o,3==e||4==e?(this.upperNode[0].node.color=cc.Color.RED,this.lowerNode[0].node.color=cc.Color.RED):(this.upperNode[0].node.color=cc.Color.BLACK,this.lowerNode[0].node.color=cc.Color.BLACK),this.suiteParent.destroyAllChildren(),t<=10){this.bigSuit.node.active=!1,this.suiteParent.active=!0;for(let e=0;e<t;e++){let t=cc.instantiate(this.itemSuit);t.active=!0,this.suiteParent.addChild(t),t.position=i.pos[e],t.rotation=i.rotate[e]}}else this.bigSuit.node.active=!0,this.bigSuit.spriteFrame=this.frameSheet.getSpriteFrame(t+r),this.suiteParent.active=!1}showCorner(e=!1,t=.6){cc.log("!>>>>> show corner card Shan",e),this.lowerNode[0].node.parent.active=e,this.upperNode[0].node.parent.active=e,this.lowerNode[0].node.parent.opacity=255,this.upperNode[0].node.parent.opacity=255,e&&(this.lowerNode[0].node.parent.opacity=0,this.upperNode[0].node.parent.opacity=0,this.lowerNode[0].node.parent.runAction(cc.fadeIn(t).easing(cc.easeCubicActionOut())),this.upperNode[0].node.parent.runAction(cc.fadeIn(t).easing(cc.easeCubicActionOut())))}setElementPos(e){let t={pos:[],rotate:[]};switch(e){case 1:t.pos=[cc.v3(0,0)],t.rotate=[0];break;case 2:t.pos=[cc.v3(0,70),cc.v3(0,-70)],t.rotate=[0,180];break;case 3:t.pos=[cc.v3(0,70),cc.v3(0,0),cc.v3(0,-70)],t.rotate=[0,180,180];break;case 4:t.pos=[cc.v3(-30,70),cc.v3(30,70),cc.v3(-30,-70),cc.v3(30,-70)],t.rotate=[0,0,180,180];break;case 5:t.pos=[cc.v3(-30,70),cc.v3(30,70),cc.v3(0,0),cc.v3(-30,-70),cc.v3(30,-70)],t.rotate=[0,0,0,180,180];break;case 6:t.pos=[cc.v3(-30,70),cc.v3(30,70),cc.v3(-30,0),cc.v3(30,0),cc.v3(-30,-70),cc.v3(30,-70)],t.rotate=[0,0,0,0,180,180];break;case 7:t.pos=[cc.v3(-30,70),cc.v3(30,70),cc.v3(0,35),cc.v3(-30,0),cc.v3(30,0),cc.v3(-30,-70),cc.v3(30,-70)],t.rotate=[0,0,0,0,0,180,180];break;case 8:t.pos=[cc.v3(-30,70),cc.v3(30,70),cc.v3(0,35),cc.v3(-30,0),cc.v3(30,0),cc.v3(0,-35),cc.v3(-30,-70),cc.v3(30,-70)],t.rotate=[0,0,0,0,0,180,180,180];break;case 9:t.pos=[cc.v3(-30,70),cc.v3(30,70),cc.v3(-30,35),cc.v3(30,35),cc.v3(0,0),cc.v3(-30,-35),cc.v3(30,-35),cc.v3(-30,-70),cc.v3(30,-70)],t.rotate=[0,0,0,0,0,180,180,180,180];break;case 10:t.pos=[cc.v3(-30,70),cc.v3(30,70),cc.v3(0,45),cc.v3(-30,20),cc.v3(30,20),cc.v3(-30,-20),cc.v3(30,-20),cc.v3(0,-45),cc.v3(-30,-70),cc.v3(30,-70)],t.rotate=[0,0,0,0,0,180,180,180,180,180]}return t}};o([i([cc.Sprite])],n.prototype,"upperNode",void 0),o([i([cc.Sprite])],n.prototype,"lowerNode",void 0),o([i(cc.Node)],n.prototype,"itemSuit",void 0),o([i(cc.Sprite)],n.prototype,"bigSuit",void 0),o([i(cc.Node)],n.prototype,"suiteParent",void 0),o([i(cc.SpriteAtlas)],n.prototype,"frameSheet",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],CardTongits:[function(e,t,r){"use strict";cc._RF.push(t,"23adciXBbpA5Ywhb/4KQDwR","CardTongits");var o,s=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0}),function(e){e.card_background="card_bg",e.card_back="card_back_red1",e.card_joker="card_joker",e.card_joker_red="card_joker_red",e.card_joker_black="card_joker_black",e.card_joker_text="card_joker_text",e.card_number_d="card_%d",e.card_suit_s="card_%s",e.card_suit_small_s="card_%s_small",e.card_suit_human_d_s="card_%d_%s"}(o||(o={}));const{ccclass:i,property:n}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.imgBackground=null,this.imgValue=null,this.imgSuitSmall=null,this.imgSuitLarge=null,this.borderCard=null,this.bkgMask=null,this.bg_cardSmall=null,this.listFrameCard=null,this.isJoker=!1,this.code=null,this.nameCard="",this.functionCallback=null,this.isTouch=!0}onLoad(){}setTextureWithCode(e,t=!1,r=!1,s=!1){if(this.code=e,53===this.code.rank||54===this.code.rank)this.decodeCard(this.code),this.imgValue.node.active=!0,this.imgSuitSmall.node.active=!1,this.imgSuitLarge.node.active=!0,this.setJoker(!0),this.imgBackground.spriteFrame=this.listFrameCard.getSpriteFrame(o.card_background),this.imgValue.spriteFrame=this.listFrameCard.getSpriteFrame(o.card_joker_text),53===this.code.rank?(this.imgValue.node.color=cc.Color.RED,this.imgSuitLarge.spriteFrame=this.listFrameCard.getSpriteFrame(o.card_joker_red)):(this.imgValue.node.color=cc.Color.BLACK,this.imgSuitLarge.spriteFrame=this.listFrameCard.getSpriteFrame(o.card_joker_black)),this.imgValue.type=cc.Sprite.Type.SIMPLE,this.imgValue.sizeMode=cc.Sprite.SizeMode.TRIMMED,this.imgSuitLarge.type=cc.Sprite.Type.SIMPLE,this.imgSuitLarge.sizeMode=cc.Sprite.SizeMode.TRIMMED,this.imgValue.node.setScale(1),this.imgSuitSmall.node.setScale(1),this.imgSuitLarge.node.setScale(1);else if(this.code.rank<1||this.code.rank>13)this.imgValue.node.active=!1,this.imgSuitSmall.node.active=!1,this.imgSuitLarge.node.active=!1,this.bg_cardSmall.active=!1,this.imgBackground.spriteFrame=this.listFrameCard.getSpriteFrame(o.card_back);else{this.imgValue.node.active=!0,this.imgSuitSmall.node.active=!0,this.imgSuitLarge.node.active=!0,this.decodeCard(this.code),this.imgBackground.spriteFrame=this.listFrameCard.getSpriteFrame(o.card_background);var i=this.getSuitInVN();this.imgValue.spriteFrame=this.listFrameCard.getSpriteFrame(cc.js.formatStr(o.card_number_d,this.getValue())),this.imgSuitSmall.spriteFrame=this.listFrameCard.getSpriteFrame(cc.js.formatStr(o.card_suit_small_s,i)),this.code.rank>=11&&this.code.rank<=13?this.imgSuitLarge.spriteFrame=this.listFrameCard.getSpriteFrame(cc.js.formatStr(o.card_suit_human_d_s,this.getValue(),i)):this.imgSuitLarge.spriteFrame=this.listFrameCard.getSpriteFrame(cc.js.formatStr(o.card_suit_s,i)),this.imgValue.node.color="tep"===i||"bich"===i?cc.Color.BLACK:cc.Color.RED,this.imgValue.type=cc.Sprite.Type.SIMPLE,this.imgValue.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.imgSuitSmall.type=cc.Sprite.Type.SIMPLE,this.imgSuitSmall.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.imgSuitLarge.type=cc.Sprite.Type.SIMPLE,this.imgSuitLarge.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.imgValue.node.setContentSize(32,50),this.imgSuitSmall.node.setContentSize(38,34),this.imgSuitLarge.node.setContentSize(90,100),this.imgValue.node.setScale(1),this.imgSuitSmall.node.setScale(1),this.imgSuitLarge.node.setScale(1)}let n=this.bg_cardSmall.children[0].getComponent(cc.Sprite),a=this.bg_cardSmall.children[1].getComponent(cc.Sprite);n.spriteFrame=this.imgValue.spriteFrame,n.node.color=this.imgValue.node.color,54==this.code.rank||53==this.code.rank?(a.spriteFrame=this.imgSuitLarge.spriteFrame,n.type=cc.Sprite.Type.SIMPLE,n.sizeMode=cc.Sprite.SizeMode.TRIMMED,a.type=cc.Sprite.Type.SIMPLE,a.sizeMode=cc.Sprite.SizeMode.CUSTOM,a.node.setContentSize(73,79.4),a.node.setPosition(40,-83.2)):(a.spriteFrame=this.imgSuitSmall.spriteFrame,n.type=cc.Sprite.Type.SIMPLE,n.sizeMode=cc.Sprite.SizeMode.CUSTOM,a.type=cc.Sprite.Type.SIMPLE,a.sizeMode=cc.Sprite.SizeMode.CUSTOM,n.node.setContentSize(48.6,64.3),a.node.setContentSize(73,79.4),a.node.setPosition(10.5,-83.2)),this.showSmall(t)}showSmall(e){1==e?(this.bg_cardSmall.active=!0,this.imgBackground.node.active=!1):(this.bg_cardSmall.active=!1,this.imgBackground.node.active=!0)}setDark(e,t=null){this.bkgMask.active=e}setColorCard(e){this.imgBackground.node.color=e}setJoker(e){this.isJoker=e}setBorder(e){this.borderCard.node.width=140,this.borderCard.node.active=e}setCardOpacity(e){this.imgBackground.node.opacity=e}encodeCard(){return 53===this.code.rank||54===this.code.rank?this.code.rank:13*(this.code.suit-1)+this.code.rank-1}decodeCard(e){this.code=e,53!==this.code.rank&&54!==this.code.suit&&(this.nameCard=this.code.rank+this.getSuitInVN())}getValue(){return 53===this.code.rank||54===this.code.rank?this.code.rank:this.code.rank>13?this.code.rank-13:this.code.rank}getSuitInVN(){switch(this.code.suit){case 0:return"bich";case 1:return"tep";case 2:return"ro";case 3:return"co";default:return"joker"}}getContentSize(){return this.imgBackground.node.getContentSize()}setFuncCallback(e){this.functionCallback=e}onClickCard(){null!==this.functionCallback&&this.isTouch&&this.functionCallback()}unuse(){this.node.active=!0,this.node.zIndex=0,this.bkgMask.active=!1,this.node.opacity=255,this.node.stopAllActions(),this.node.rotation=0,this.node.setScale(1),this.node.setAnchorPoint(cc.v2(.5,.5)),this.node.skewY=0,this.setColorCard(cc.Color.WHITE),this.setBorder(!1)}resetCard(){this.setBorder(!1)}};s([n(cc.Sprite)],a.prototype,"imgBackground",void 0),s([n(cc.Sprite)],a.prototype,"imgValue",void 0),s([n(cc.Sprite)],a.prototype,"imgSuitSmall",void 0),s([n(cc.Sprite)],a.prototype,"imgSuitLarge",void 0),s([n(cc.Sprite)],a.prototype,"borderCard",void 0),s([n(cc.Node)],a.prototype,"bkgMask",void 0),s([n(cc.Node)],a.prototype,"bg_cardSmall",void 0),s([n(cc.SpriteAtlas)],a.prototype,"listFrameCard",void 0),a=s([i],a),r.default=a,cc._RF.pop()},{}],Coin:[function(e,t,r){"use strict";cc._RF.push(t,"99357NlNMROQ5HrZBshLG/3","Coin");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.coin_ani=null}};o([i(sp.Skeleton)],n.prototype,"coin_ani",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],FightScene:[function(e,t,r){"use strict";cc._RF.push(t,"5c958iuBAxGxLAP3pfBBcAh","FightScene");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.dark_bg=null,this.fight_ani=null,this.solo_ani=null,this.fight_buttons=null,this.challenger_left=null,this.left_ava=null,this.left_name=null,this.challenger_right=null,this.right_ava=null,this.right_name=null,this.challenger=null,this.challenger_ava=null,this.challenger_name=null,this.your_point=null,this.aniPhao=null,this.imgTime=null,this.bkg_left_type=[],this.bgk_right_type=[],this.fight_type=[],this.fight_type_phi=[],this.fight_left=null,this.fight_right=null,this.fight_down=null,this.listAni=[],this.currentFighterDIndex=null,this.time_turn_cur=0,this.time_turn=0,this.isLeft=!1,this.isRight=!1,this.down=!1}onLoad(){this.TongitsController=this.node.parent.getComponent("TongitsController"),this.languaSave=cc.sys.localStorage.getItem("language_client")}startFight(e,t,r=!0){this.challengerSolo=e,this.time_turn=12,this.fight_left.node.active=!1,this.fight_right.node.active=!1,this.fight_down.node.active=!1,this.isLeft=!1,this.isRight=!1,this.down=!1;const o="EN"!=this.languaSave?"phi":"eng";this.dark_bg.opacity=0,this.fight_ani.setAnimation(0,o,!1),this.challenger_ava.node.getComponent("AvatarItem").loadTexture(e.avatar_id,e.pname,e.fid);let s=e._displayName;s.length>15&&(s=s.substr(0,15)+"..."),this.challenger_name.string=s,this.currentFighterDIndex=e._indexDynamic,this.handleFighterPosition(r,t)}handleFighterPosition(e,t){switch(this.currentFighterDIndex){case 0:this.fight_down.node.active=!0,this.fight_down.setAnimation(0,"EN"!=this.languaSave?"down_fight2":"down_fight",!1),e&&(this.fight_buttons.active=!1,this.dark_bg.opacity=255),this.your_point.node.active=!1,this.down=!0;break;case 1:this.fight_right.node.active=!0,this.fight_right.setAnimation(0,"EN"!=this.languaSave?"right_fight2":"right_fight",!1),this.your_point.string="Your score: "+t,this.isRight=!0;break;case 2:this.fight_left.node.active=!0,this.fight_left.setAnimation(0,"EN"!=this.languaSave?"left_fight2":"left_fight",!1),this.your_point.string="Your score: "+t,this.isLeft=!0}}};o([i(cc.Node)],n.prototype,"dark_bg",void 0),o([i(sp.Skeleton)],n.prototype,"fight_ani",void 0),o([i(sp.Skeleton)],n.prototype,"solo_ani",void 0),o([i(cc.Node)],n.prototype,"fight_buttons",void 0),o([i(cc.Node)],n.prototype,"challenger_left",void 0),o([i(cc.Sprite)],n.prototype,"left_ava",void 0),o([i(cc.Label)],n.prototype,"left_name",void 0),o([i(cc.Node)],n.prototype,"challenger_right",void 0),o([i(cc.Sprite)],n.prototype,"right_ava",void 0),o([i(cc.Label)],n.prototype,"right_name",void 0),o([i(cc.Node)],n.prototype,"challenger",void 0),o([i(cc.Sprite)],n.prototype,"challenger_ava",void 0),o([i(cc.Label)],n.prototype,"challenger_name",void 0),o([i(cc.Label)],n.prototype,"your_point",void 0),o([i(sp.Skeleton)],n.prototype,"aniPhao",void 0),o([i(cc.Sprite)],n.prototype,"imgTime",void 0),o([i([cc.SpriteFrame])],n.prototype,"bkg_left_type",void 0),o([i([cc.SpriteFrame])],n.prototype,"bgk_right_type",void 0),o([i([cc.SpriteFrame])],n.prototype,"fight_type",void 0),o([i([cc.SpriteFrame])],n.prototype,"fight_type_phi",void 0),o([i(sp.Skeleton)],n.prototype,"fight_left",void 0),o([i(sp.Skeleton)],n.prototype,"fight_right",void 0),o([i(sp.Skeleton)],n.prototype,"fight_down",void 0),o([i([sp.SkeletonData])],n.prototype,"listAni",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],FinishTable:[function(e,t,r){"use strict";cc._RF.push(t,"478a6UV/wlEZLvjU72HXLs8","FinishTable");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.dark_bg=null,this.table_label=null,this.player_info=null,this.btn_close=null,this.title=null,this.butasan=null,this.infoPlayers=[]}onLoad(){this.infoPlayers=[]}showTable(e,t){this.butasan.active=!1,this.dark_bg.node.opacity=0,this.dark_bg.node.runAction(cc.fadeTo(.4,200));let r=1;for(let o=0;o<e.length;o++){let s=t[o];1==e[o].rank||2==e[o].rank?setTimeout(()=>{this.node&&(s?this.spawnPlayerInfo(e[o],s).node.position=this.getPlayerInfoPosition(e[o].rank):this.onCloseClick())},300*e[o].rank):3==e[o].rank&&(3==++r?setTimeout(()=>{this.node&&(s?this.spawnPlayerInfo(e[o],s).node.position=this.getPlayerInfoPosition(2):this.onCloseClick())},600):setTimeout(()=>{this.node&&(s?this.spawnPlayerInfo(e[o],s).node.position=e.length<3?this.getPlayerInfoPosition(2):this.getPlayerInfoPosition(e[o].rank):this.onCloseClick())},300*e[o].rank))}cc.log("done showTable finish")}spawnPlayerInfo(e,t){let r=cc.instantiate(this.player_info).getComponent("PlayerInfo");return this.node.addChild(r.node),this.infoPlayers.push(r),r.setInfo(e,t),r}onCloseClick(){this.node.active=!1}hideTable(){}getPlayerInfoPosition(e){switch(cc.log("!>@ rank",e),e){case 1:return cc.v2(0,100);case 2:return cc.v2(0,-50);case 3:return cc.v2(0,-200);default:return cc.v2(0,0)}}};o([i(cc.Button)],n.prototype,"dark_bg",void 0),o([i(cc.Sprite)],n.prototype,"table_label",void 0),o([i(cc.Prefab)],n.prototype,"player_info",void 0),o([i(cc.Button)],n.prototype,"btn_close",void 0),o([i(cc.Label)],n.prototype,"title",void 0),o([i(cc.Node)],n.prototype,"butasan",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],GroupIcon:[function(e,t,r){"use strict";cc._RF.push(t,"dc0deJyHL5LDLwvz0PiymsF","GroupIcon");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.showTrue=null,this.showFalse=null}onLoad(){this.showFalse.node.active=!1,this.showTrue.node.active=!1}setFrame(e){e?(this.showFalse.node.active=!1,this.showTrue.node.active=!0):(this.showFalse.node.active=!0,this.showTrue.node.active=!1)}};o([i(cc.Sprite)],n.prototype,"showTrue",void 0),o([i(cc.Sprite)],n.prototype,"showFalse",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],ItemBetView:[function(e,t,r){"use strict";cc._RF.push(t,"66551cKhYxFnZA54nd89kfA","ItemBetView");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.lbName=null,this.lbBet=null,this.lbNumberPlayerBet=null}init(e){this.setName(e.name),this.lbBet.string=e.totalAgBetted.toString(),this.lbNumberPlayerBet.string=e.numberWatcherBet.toString()}initByName(e){this.setName(e)}setName(e){this.lbName&&(this.lbName.string=e),setTimeout(()=>{this.node&&this.effLbName()},100)}effLbName(){if(this.lbName.node.stopAllActions(),this.lbName.node.width>this.lbName.node.parent.width-10){const e=(this.lbName.node.width-this.lbName.node.parent.width)/2;let t=e/30;const r=cc.moveTo(t,e,this.lbName.node.getPosition().y),o=cc.moveTo(t,-e,this.lbName.node.getPosition().y);t<1&&(t=1),this.lbName.node.anchorX=.5,this.lbName.node.x=-e,this.lbName.node.runAction(cc.repeatForever(cc.sequence(cc.delayTime(1.5),r,cc.delayTime(1.5),o)))}}};o([i(cc.Label)],n.prototype,"lbName",void 0),o([i(cc.Label)],n.prototype,"lbBet",void 0),o([i(cc.Label)],n.prototype,"lbNumberPlayerBet",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],PlayerInfoT:[function(e,t,r){"use strict";cc._RF.push(t,"396fa5IhZ5IVqGdnkGmQrV4","PlayerInfoT");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.back_ground=null,this.score=null,this.profit=null,this.normal_win=null,this.tongits=null,this.secret_melds=null,this.bonus_card=null,this.burned_players=null,this.challenger=null,this.hitpot=null,this.butasan=null,this.ava_player=null,this.name_player=null,this.ribbon_type=null,this.type_bg=[],this.type_ribbon=[],this.type_ribbon_phi=[],this.lb_rabk=null}setInfo(e,t){cc.log("!>? data ",e),cc.log("!>? player ",t);const r=[this.profit,this.normal_win,this.tongits,this.secret_melds,this.bonus_card,this.burned_players,this.challenger,this.hitpot,this.butasan],o=[e.M,e.normalAG,e.tongits,e.secretmelds,e.bonusCards,e.bunnedPlayers,e.challengers,e.HitPot,e.butasan];this.score.string=e.Score;for(let l=0;l<o.length;l++)0==o[l]?r[l].string=0==l||3==l||4==l||8==l?o[l].toString():"-":o[l]<0?(r[l].string="-"+-o[l],r[l].node.color=cc.Color.BLACK.fromHEX("#ed7a01")):o[l]>0&&(r[l].string=o[l],r[l].node.color=cc.Color.BLACK.fromHEX("#17c058"));this.lb_rabk.string=e.rank.toString(),2==e.rank?this.back_ground.spriteFrame=null:this.back_ground.spriteFrame=this.type_bg[1],this.ava_player.node.getComponent("AvatarItem").loadTexture(t.avatar_id,t.pname,t.fid,t.vip);const s=t._displayName.length>8?t._displayName.substring(0,8)+"...":t._displayName;this.name_player.string=s;let i=this.getRibbonType(e.winFightType,e.rank,e.bunnedPlayers);1==i&&e.tongits>0&&(i=8);const n=this.ribbon_type.getComponent(cc.Sprite),a=this.ribbon_type.node.getChildByName("lb").getComponent(cc.Label);switch(0==i||2==i||5==i||6==i?(n.spriteFrame=this.type_ribbon[1],a.node.getComponent(cc.LabelOutline).color=cc.Color.BLACK.fromHEX("#090908")):7==i?n.spriteFrame=this.type_ribbon[2]:(n.spriteFrame=this.type_ribbon[0],a.node.getComponent(cc.LabelOutline).color=cc.Color.BLACK.fromHEX("#3F0000")),a.node.active=7!=i,i){case 0:a.string="show_lb_fold";break;case 1:a.string="txt_win";break;case 2:a.string="txt_lost";break;case 3:a.string="txt_fight";break;case 4:a.string="challenge";break;case 5:a.string="txt_fight";break;case 6:a.string="challenge";break;case 7:a.string="txt_burned";break;case 8:a.string="txt_tongits"}this.butasan.node.parent.active=!1}getRibbonType(e,t,r){switch(e){case-2:return 0;case-1:return 1==t?1:r<0?7:2;case 0:return 3;case 1:return 4;case 2:return 5;case 3:return 6;default:return 0}}};o([i(cc.Sprite)],n.prototype,"back_ground",void 0),o([i(cc.Label)],n.prototype,"score",void 0),o([i(cc.Label)],n.prototype,"profit",void 0),o([i(cc.Label)],n.prototype,"normal_win",void 0),o([i(cc.Label)],n.prototype,"tongits",void 0),o([i(cc.Label)],n.prototype,"secret_melds",void 0),o([i(cc.Label)],n.prototype,"bonus_card",void 0),o([i(cc.Label)],n.prototype,"burned_players",void 0),o([i(cc.Label)],n.prototype,"challenger",void 0),o([i(cc.Label)],n.prototype,"hitpot",void 0),o([i(cc.Label)],n.prototype,"butasan",void 0),o([i(cc.Sprite)],n.prototype,"ava_player",void 0),o([i(cc.Label)],n.prototype,"name_player",void 0),o([i(cc.Sprite)],n.prototype,"ribbon_type",void 0),o([i([cc.SpriteFrame])],n.prototype,"type_bg",void 0),o([i([cc.SpriteFrame])],n.prototype,"type_ribbon",void 0),o([i([cc.SpriteFrame])],n.prototype,"type_ribbon_phi",void 0),o([i(cc.Label)],n.prototype,"lb_rabk",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],PotView:[function(e,t,r){"use strict";cc._RF.push(t,"b4934U/AcVIGqTQJfsNS70o","PotView");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.money=null,this.round=null}setInfo(e,t){this.money.node.runAction(cc.sequence(cc.scaleTo(.2,1.3).easing(cc.easeCubicActionOut()),cc.callFunc(()=>{this.money.string=e.toString()}),cc.scaleTo(.2,1).easing(cc.easeCubicActionIn()))),this.round.node.runAction(cc.sequence(cc.scaleTo(.2,1.3).easing(cc.easeCubicActionOut()),cc.callFunc(()=>{this.round.string="Round "+t}),cc.scaleTo(.2,1).easing(cc.easeCubicActionIn())))}};o([i(cc.Label)],n.prototype,"money",void 0),o([i(cc.Label)],n.prototype,"round",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],ShowGroupBanner:[function(e,t,r){"use strict";cc._RF.push(t,"846cad1+DxJxrpoHUSLXAhW","ShowGroupBanner");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.true_banner=null,this.false_banner=null,this.joker_banner=null,this.specified=null,this.stret=0,this.posX=0,this.groupId=0}onLoad(){this.true_banner.node.active=!1,this.false_banner.node.active=!1,this.joker_banner.node.active=!1}setInfo(e){this.stret=e.stret,this.posX=e.posX,this.groupId=e.gId,!e.isTrue||e.isTrue&&e.isJoker&&!e.isDroped&&!e.isValidPure?this.setFalseGroup():e.isTrue&&e.isJoker&&!e.isDroped&&!e.isValidSpecified&&e.isValidPure?this.setJokerGroup():this.setTrueGroup(),this.specified.position=cc.v3(this.posX,-330),e.isTrue&&(this.specified.active=e.isSpecified)}setTrueGroup(){this.true_banner.node.active=!0,this.false_banner.node.active=!1,this.joker_banner.node.active=!1,this.true_banner.node.width=this.stret,this.true_banner.node.position=cc.v3(this.posX,-320)}setFalseGroup(){this.false_banner.node.active=!0,this.true_banner.node.active=!1,this.joker_banner.node.active=!1,this.false_banner.node.width=this.stret,this.false_banner.node.position=cc.v3(this.posX,-320)}setJokerGroup(){this.false_banner.node.active=!1,this.true_banner.node.active=!1,this.joker_banner.node.active=!0,this.joker_banner.node.width=this.stret,this.joker_banner.node.position=cc.v3(this.posX,-320)}moveBanner(){this.false_banner.node.runAction(cc.moveTo(.2,cc.v2(this.posX,-320))),this.true_banner.node.runAction(cc.moveTo(.2,cc.v2(this.posX,-320)))}};o([i(cc.Sprite)],n.prototype,"true_banner",void 0),o([i(cc.Sprite)],n.prototype,"false_banner",void 0),o([i(cc.Sprite)],n.prototype,"joker_banner",void 0),o([i(cc.Node)],n.prototype,"specified",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],ShowNoti:[function(e,t,r){"use strict";cc._RF.push(t,"f9a5616Yg1PlpAn6/bVIP59","ShowNoti");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.lbl_content=null,this.Bg_background=null}onLoad(){this.node.opacity=0,this.node.setScale(0)}showContent(e){cc.log("!> show noti"),this.node.runAction(cc.spawn(cc.sequence(cc.scaleTo(.6,1.2).easing(cc.easeCubicActionOut()),cc.scaleTo(.3,1).easing(cc.easeCubicActionOut())),cc.fadeIn(.4).easing(cc.easeCubicActionOut()))),this.lbl_content.string=e,this.Bg_background.node.width=60*e.length,setTimeout(()=>{this.node&&this.node.runAction(cc.sequence(cc.fadeOut(.6).easing(cc.easeCubicActionOut()),cc.callFunc(()=>{this.node.destroy()})))},2e3)}};o([i(cc.Label)],n.prototype,"lbl_content",void 0),o([i(cc.Sprite)],n.prototype,"Bg_background",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],ShowNumbOfCard:[function(e,t,r){"use strict";cc._RF.push(t,"a48abRZNRlGOYEwaRsl18Nd","ShowNumbOfCard");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const s=e("./TongitsConst"),{ccclass:i,property:n}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.card_stack=null,this.player_1=null,this.player_2=null,this.Bg=null,this.listGameBg=[],this.currentpl1=null,this.currentpl2=null,this.currentStack=null}onLoad(){this.player_1.node.active=!1,this.player_2.node.active=!1,this.currentpl1=null,this.currentpl2=null,this.currentStack=null}setInfo(e,t){this.Bg.spriteFrame=this.listGameBg[1],this.card_stack.string=e.toString(),this.card_stack.node.parent.active=0!==e,this.player_1.node.zIndex=s.GAME_ZORDER.Z_CARD+50,this.player_2.node.zIndex=s.GAME_ZORDER.Z_CARD+50,this.currentStack=e;for(let r=0;r<t.length;r++)0==r?(this.player_1.string=t[r].toString(),this.player_1.node.active=!0,this.currentpl1=t[r]):(this.player_2.string=t[r].toString(),this.player_2.node.active=!0,this.currentpl2=t[r])}updateCardStack(e,t){this.currentStack=0===t?this.currentStack-e:this.currentStack+e,this.card_stack.string=this.currentStack.toString(),this.card_stack.node.parent.active=0!==this.currentStack}updatePlayer(e,t,r){this.player_1.node.zIndex=s.GAME_ZORDER.Z_CARD+50,this.player_2.node.zIndex=s.GAME_ZORDER.Z_CARD+50,0==r?1==e?(this.currentpl1-=t,this.player_1.string=this.currentpl1.toString()):(this.currentpl2-=t,this.player_2.string=this.currentpl2.toString()):1==e?(this.currentpl1+=t,this.player_1.string=this.currentpl1.toString()):(this.currentpl2+=t,this.player_2.string=this.currentpl2.toString()),0===this.currentpl1&&(this.player_1.node.active=!1),0===this.currentpl2&&(this.player_2.node.active=!1)}};o([n(cc.Label)],a.prototype,"card_stack",void 0),o([n(cc.Label)],a.prototype,"player_1",void 0),o([n(cc.Label)],a.prototype,"player_2",void 0),o([n(cc.Sprite)],a.prototype,"Bg",void 0),o([n([cc.SpriteFrame])],a.prototype,"listGameBg",void 0),a=o([i],a),r.default=a,cc._RF.pop()},{"./TongitsConst":"TongitsConst"}],ShowPlayerAva:[function(e,t,r){"use strict";cc._RF.push(t,"179394HdxVIqJ366GlTYcgu","ShowPlayerAva");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.player_type=null,this.player_name=null,this.player_avatar=null,this.typeList=[]}};o([i(cc.Sprite)],n.prototype,"player_type",void 0),o([i(cc.Label)],n.prototype,"player_name",void 0),o([i(cc.Sprite)],n.prototype,"player_avatar",void 0),o([i([cc.SpriteFrame])],n.prototype,"typeList",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],TongitsBtnLabel:[function(e,t,r){"use strict";cc._RF.push(t,"90f47WLCOZMf4NB23Hu0y+r","TongitsBtnLabel");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{start(){const e=cc.sys.localStorage.getItem("language_client"),t=this.node.getComponent(cc.Label);if(!t)return;let r=t.string;if("EN"!==e){switch(r.toUpperCase()){case"DROP":r="Ihulog";break;case"FIGHT":r="Labanan";break;case"GROUP":r="Grupo";break;case"DUMP":r="Intapon";break;case"DECLARE":r="I-deklara";break;case"FOLD":r="Tiklop";break;case"CHALLENGE":r="Naghahamon";break;case"TONGITS":r="Tongits"}t.string=r}}};n=o([s],n),r.default=n,cc._RF.pop()},{}],TongitsConst:[function(e,t,r){"use strict";cc._RF.push(t,"36967h8OABFnK/zZClEI8DE","TongitsConst"),Object.defineProperty(r,"__esModule",{value:!0}),r.CODE_JOKER_RED=r.CODE_JOKER_BLACK=r.GAME_ID=r.GAME_ZORDER=void 0,function(e){e[e.Z_CARD=100]="Z_CARD",e[e.Z_PLAYER=200]="Z_PLAYER",e[e.Z_MENU_VIEW=300]="Z_MENU_VIEW",e[e.Z_DUMPED_CARD=140]="Z_DUMPED_CARD"}(r.GAME_ZORDER||(r.GAME_ZORDER={})),function(e){e[e.TONGITS=0]="TONGITS",e[e.TONGITS_OLD=1]="TONGITS_OLD",e[e.TONGITS11=2]="TONGITS11",e[e.TONGITS_JOKER=3]="TONGITS_JOKER"}(r.GAME_ID||(r.GAME_ID={})),r.CODE_JOKER_BLACK=53,r.CODE_JOKER_RED=54,cc._RF.pop()},{}],TongitsController:[function(e,t,r){"use strict";cc._RF.push(t,"f83eb7nEZBJDJuO1fL9+ouc","TongitsController");var o,s=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0}),r.TongitsController=void 0;const i=e("../../lobby/src/common/Constants"),n=e("../../lobby/src/common/GlobalApp"),a=e("../../lobby/src/common/User"),l=e("../../lobby/src/dialogs/option/OptionDialog"),c=e("../../lobby/src/language/LanguageController"),h=e("./ButtonManager"),d=e("./CardTongits"),u=e("./TongitsConst"),p=e("./TongitsNetworkTransport"),g=e("./TongitsPlayer"),f=e("./ShowNumbOfCard"),y=e("../../lobby/src/dialogs/banner/BannerDialog");var C=52;const{ccclass:m,property:b}=cc._decorator;let _=o=class extends cc.Component{constructor(){super(...arguments),this.show_noti=null,this.result_table=null,this.fight_scene=null,this.numb_card=null,this.card=null,this.eat_arrow=null,this.burn_ani=null,this.group_banner=null,this.tongits_scene=null,this.coin_hitpot=null,this.lbMatchInfo=null,this.pot=null,this.btn_sort=null,this.game_buttons=null,this.draw_arrow=null,this.player_point=null,this.wait_ani=null,this.start_ani=null,this.hitPot_ani=null,this.other_score=[],this.icon_dimond=[],this.hight_light_player_turn=[],this.gameName=null,this.bg_drop=null,this.players=[],this.cardStack=[],this.selectedCard=null,this.lastCardSelect=null,this.selectedArrC=[],this.isHold=!1,this.currentSort=0,this.currentCodeOrder=[],this.playerGroups=[],this.dumpedCardsArr=[],this.cardsOnDeck=[[],[],[]],this.currenPlayer=null,this.buttonManager=null,this.isDraw=!1,this.GroupIcons=[],this.codeValueArr=[],this.fightObj=null,this.resultTable=null,this.CardNumb=null,this.arrGroupBanner=[],this.canFight=!1,this.blackList=[],this.hintScArray=[],this.cardPool=new cc.NodePool(d.default)}static getInstance(){return this.instance}start(){o.instance=this,p.TongitsNetworkTransport.getInstance().subscribe(),this.cardStack=[],this.selectedCard=null,this.lastCardSelect=null,this.selectedArrC=[],this.isHold=!1,this.currentSort=0,this.currentCodeOrder=[],this.playerGroups=[],this.dumpedCardsArr=[],this.cardsOnDeck=[[],[],[]],this.btn_sort.getComponent(cc.Button).interactable=!1,this.currenPlayer=null,this.buttonManager=this.game_buttons.getComponent(h.default),this.buttonManager.enableAllButton(!1),this.buttonManager.TongitsController=this,this.isDraw=!1,this.GroupIcons=[],this.codeValueArr=[],this.fightObj=null,this.resultTable=null,this.buttonManager.activeAllButton(!1),this.CardNumb=null,this.arrGroupBanner=[],this.canFight=!1,this.blackList=[],this.hintScArray=[],this.players.forEach((e,t)=>{e.indexDynamic=t,e.node.active=!1})}updateTable(e){const t=n.default.getInstance().matchInfo,r=JSON.parse(t.label);this.lbMatchInfo.string=`${c.default.getInstance().getString("txt_id")}: ${r.tableId}\n${c.default.getInstance().getString("txt_bet")}: ${r.markUnit}`,this.player_point.node.parent.active=!1,e.table.joinPlayers.forEach(e=>{this.handleJTable(e)}),e.table.leavePlayers.forEach(e=>{this.handleLTable(e)}),e.table.players.forEach(e=>{const t=this.getPlayer(e.userName);t?t.setData(e):this.handleJTable(e)})}updateDesk(e){}handleLTable(e){this.cleanTable();let t=e.userName;var r=this.getPlayer(t);null!=r&&void 0!==r&&(this.icon_dimond[r.indexDynamic].node.active&&(this.hitPot_ani.node.getChildByName("dimond").active=!1),this.icon_dimond[r.indexDynamic].node.active=!1,t!==a.default.userName&&(""!=r.user_name&&this.addChatLeave(r.user_name),this.removePlayer(t)),this.clearNumbOfCard())}addChatLeave(e){}removePlayer(e,t=!1){let r=this.getPlayer(e);null!==r&&(r.node.active=!1,r=null,t||this.updatePositionPlayerView())}getPlayer(e){return this.players.find(t=>t.user_name===e&&t.node.active)||null}handleCCTable(e){}getPlayerWithId(e){for(var t=0;t<this.players.length;t++)if(e==this.players[t].id)return this.players[t];return null}handleVTable(e){let t=JSON.parse(e);this.player_point.node.parent.active=!1,this.potView(t.HitPot.AG,t.HitPot.rounds,!1);let r=this.hitPot_ani.node.getChildByName("dimond");if(0!=t.HitPot.pid){let e=this.getPlayerWithId(t.HitPot.pid);this.showDimond(e.indexDynamic),null!=r&&(r.active=!0)}else{for(let e=0;e<3;e++)this.icon_dimond[e].node.active=!1;null!=r&&(r.active=!1)}if(1!=t.Finish||null==t.Finish){if(this.viewTable(t),t.T>0)for(let e=0;e<t.ArrP.length;e++)1==t.ArrP[e].isStart&&this.setPlayerTurn(t.ArrP[e].id,t.T);else for(let e=0;e<t.ArrP.length;e++)1==t.ArrP[e].isStart&&this.setPlayerTurn(t.ArrP[e].id,0);this.viewCardOnDeck(t.ArrP)}}handleJTable(e){const t=this.players.find(e=>!e.node.active);t.node.active=!0,t.setData(e)}handleRJTable(e){let t=JSON.parse(e);if(this.cleanTable(),this.potView(t.HitPot.AG,t.HitPot.rounds,!1),0!=t.HitPot.pid){let e=this.getPlayerWithId(t.HitPot.pid);this.showDimond(e.indexDynamic);let r=this.hitPot_ani.node.getChildByName("dimond");null!=r&&(r.active=!0)}t.T>0?this.setPlayerTurn(t.CN,t.T,t.isDaBoc):this.setPlayerTurn(t.CN,0),this.viewTable(t),this.handleCardTouch(),this.viewCardOnDeck(t.ArrP),0==t.isDaBoc&&this.currenPlayer.user_name==a.default.userName&&setTimeout(()=>{this.showArrow(),this.ShowEatHint()},200),this.isDraw=t.isDaBoc;let r=t.statusGame;"WAIT_FOR_START"!=r&&"DECLEARING"!=r&&"FINISH"!=r||(this.buttonManager.activeAllButton(!1),this.hideArrow())}handleSTable(e){this.toggleResultTabel(!0),this.clearNumbOfCard(),this.blackList=[]}viewTable(e){for(let r=0;r<e.ArrP.length;r++)e.ArrP[r].code.rank==a.default.userName&&this.viewHand(e.ArrP[r].arr),e.CN==e.ArrP[r].id&&e.ArrP[r].id==a.default.userId&&1==e.ArrP[r].isFight&&(this.canFight=!0,this.buttonManager.enableFight(!0));setTimeout(()=>{this.btn_sort.getComponent(cc.Button).interactable=!0},600),this.initCardStack(e.cardNoc,!1);for(let r=0;r<e.ArrD.length;r++){let t=this.spawncard();t.setTextureWithCode(e.ArrD[r]),t.node.setScale(.4),this.dumpedCardsArr.push(t.node);let o=this.getDumpedCardsPosition(r);t.node.position=o,t.setDark(!(r==e.ArrD.length-1))}let t=[];for(let r=0;r<this.players.length-1;r++)t.push(12);for(let r=0;r<e.ArrP.length;r++){let o=this.getPlayerWithId(e.ArrP[r].id);if(o.user_name!=a.default.userName){let s=0;for(let t=0;t<e.ArrP[r].arr.length;t++)s+=e.ArrP[r].arr[t].length;t[o.indexDynamic-1]=s}}this.showNumbOfCard(e.cardNoc,t)}viewHand(e){e.length>0?(this.playerGroups=[...e],this.reOrganizeCodeOrderByGroup()):this.currentCodeOrder=[...e],this.codeValueArr=[];const t=this.getPlayer(a.default.userName);t.vectorCard.forEach(e=>{let t=e.getComponent(d.default);this.codeValueArr.push(t)});for(let r=0;r<e.length;r++)for(let o=0;o<e[r].length;o++){let s=this.spawncard(),i=this.getPlayerCardPosition(e[0].length,o);s.node.position=i,s.node.zIndex=u.GAME_ZORDER.Z_CARD+o,s.setTextureWithCode(e[r][o]),this.codeValueArr.push(s),s.node.setScale(.8),t.vectorCard.push(s)}this.autoSortCard(1);for(let r=0;r<this.players.length;r++){let e=this.players[r];if(e!=t){let t=this.getHandPosition(e.indexDynamic),r=this.spawncard();r.node.position=t,r.node.setScale(.3),e.vectorCard.push(r)}}this.buttonManager.activeAllButton(!0)}getPlayerByDynamicIndex(e){for(let t=0;t<this.players.length;t++)if(this.players[t].indexDynamic==e)return this.players[t]}viewCardOnDeck(e){for(let t=0;t<e.length;t++){let r=this.getPlayer(e[t].code.rank),o=e[t].ArrH,s=r.indexDynamic;if(cc.error(s,Array.isArray(o[0]),o),e[t].code.rank!=a.default.userName){let e=this.getHandPosition(s),t=this.spawncard();t.node.position=e,t.node.setScale(.3),r.vectorCard.push(t)}if(1==Array.isArray(o[0]))for(let e=0;e<o.length;e++){let t=[];o[e].length;for(let r=0;r<o[e].length;r++){0!=s&&o[e].sort((e,t)=>(Number((t-1)%13)+2)%14-(Number((e-1)%13)+2)%14);let i=this.spawncard();i.node.setScale(.3),i.setTextureWithCode(o[e][r],!0),t.push(i.node);let n=this.setDropedCardPosition(s,r,e);i.node.position=n,i.node.zIndex=r}this.cardsOnDeck[s].push(t)}else{let e=[];o.length;for(let t=0;t<o.length;t++){let r=this.spawncard();r.node.setScale(.3),r.setTextureWithCode(o[t],!0),e.push(r.node);let i=this.setDropedCardPosition(s,t,0);cc.tween(r.node).to(.3,{position:i}).start(),r.node.zIndex=t}this.cardsOnDeck[s].push(e)}}}getDynamicIndex(e){if(0==e)return 0;var t=e;return 2===this.players.length&&2===e&&(t=1),t}sortByKey(e,t){return e.sort(function(e,r){var o=e[t],s=r[t];return o<s?-1:o>s?1:0})}handleHitpot(e){this.potView(e.ag,e.roundHitPot);let t=this.hitPot_ani.node.getChildByName("dimond");if(0!=e.NameWin){let r=this.getPlayerWithId(e.NameWin);this.showDimond(r.indexDynamic),null!=t&&(t.active=!0)}}showHitPotAni(e){let t=this.hitPot_ani.node.getChildByName("dimond"),r=this.hitPot_ani.node.getChildByName("dimond1"),o=this.hitPot_ani.node.getChildByName("bg"),s=o.getChildByName("skeleton"),i=s.getChildByName("chip");t.setScale(1),r.setScale(1),this.pot.node.zIndex=999,setTimeout(()=>{t.active=!1,r.active=!1},1e3),setTimeout(()=>{s.zIndex=999,o.active=!0,s.getComponent(sp.Skeleton).setAnimation(0,"animation",!1),i.getComponent(cc.Label).string=e},1e3),setTimeout(()=>{o.active=!1;let e=this.pot.getComponent("PotView");e?e.setInfo(0,0):cc.error('loi getComponent("PotView")');for(let t=0;t<3;t++)this.icon_dimond[t].node.active=!1},3500)}showDimondMoveUp(e){let t=this.hitPot_ani.node.getChildByName("dimond1");const r=t.position;let o=cc.v3(0,0);for(let s=0;s<e.length;s++){let t=this.getPlayerWithId(e[s].pid);1==e[s].code.rank&&(o=this.getDimondPos(t.indexDynamic))}for(let s=0;s<3;s++)this.icon_dimond[s].node.active=!1;t.position=this.hitPot_ani.node.convertToNodeSpaceAR(o),t.active=!0,t.setScale(1,1),setTimeout(()=>{t.zIndex=100,t.runAction(cc.spawn(cc.moveTo(1.5,cc.v2(r)).easing(cc.easeCubicActionOut()),cc.scaleTo(1.5,1).easing(cc.easeCubicActionOut())))},1e3)}getDimondPos(e){let t=this.icon_dimond[e].node.position;return this.node.convertToWorldSpaceAR(t)}showCoinHitPot(e){for(let t=0;t<20;t++){let r=cc.instantiate(this.coin_hitpot);this.node.addChild(r),r.zIndex=99;let o=Math.floor(Math.random()*Math.floor(300)),s=Math.floor(Math.random()*Math.floor(40));r.position=cc.v3(0,0);let i=cc.v2(-150+o,-150+s),n=e._playerView.node.position;r.runAction(cc.sequence(cc.jumpTo(.6,i,100,1),cc.delayTime(.4+.05*t),cc.moveTo(.4,n).easing(cc.easeCubicActionOut()),cc.callFunc(()=>{r.destroy()})))}}potView(e,t,r=!0){if(this.pot.getComponent("PotView").setInfo(e,t),0==r)return;const o=JSON.parse(n.default.getInstance().matchInfo.label);for(let s=0;s<this.players.length;s++){let e=this.players[s].wallet-2*o;this.updatePlayerMoney(this.players[s],e),this.players[s].showEffectFlyMoney(0-2*o,40)}}updatePlayerMoney(e,t){e.wallet=t,e.updateWallet(t)}handleUpdateAG(e){const t=this.getPlayerWithId(e.NName);t.wallet=e.M,t.updateWallet(e.M)}hideAllDialog(){}handleDealCard(e){this.stateGame=1,this.hideAllDialog(),this.closeDialogFightConfirm(),this.updateGroupBanner(),this.toggleResultTabel(!0),this.hideWaitAni(),this.showStartAni(),this.initCardStack(C,!0),cc.tween(this.node).delay(1.5).call(()=>this.dealCards(e.hand.cards)).delay(2.5).call(()=>{this.setPlayerTurn(e.currentTurn,16),this.isDraw=!0;const t=Array(this.players.length-1).fill(12),r=this.getPlayerWithId(e.currentTurn);r&&r.indexDynamic>0&&(t[r.indexDynamic-1]=13),this.showNumbOfCard(this.cardStack.length,t)}).start()}setPlayerTurn(e,t,r=!1){this.hideArrow();let o=this.getPlayerWithId(e);for(let s=0;s<this.players.length;s++)this.players[s].setTurn(!1);if(null!=o)if(e==a.default.userId&&(this.getPlayer(a.default.userName).vectorCard.length>12||1==r?(this.isDraw=!0,this.hideArrow()):0==r&&setTimeout(()=>{this.showArrow()},700),1==this.checkIfCanFight()&&this.buttonManager.enableFight(!0)),null!=o)this.currenPlayer=o,o.setTurn(!0,t,!0),this.highLightPlayerArea(o.indexDynamic);else{for(let e=0;e<this.players.length;e++)this.players[e].setTurn(!1);this.highLightPlayerArea(3)}}dealCards(e){if(this.currentCodeOrder=[...e],12==e.length){let e=this.cardStack.pop();this.cardPool.put(e.node)}else this.isDraw=!0;this.hideArrow();const t=this.players.filter(e=>e.node.active);for(let r=0;r<t.length;r++){const o=t[r],s=o.indexDynamic,i=0===s?e.length:12;for(let t=0;t<i;t++){const r=this.cardStack.pop();0===s&&(this.codeValueArr.push(r),r.decodeCard(e[t])),o.vectorCard.push(r),r.node.zIndex=u.GAME_ZORDER.Z_CARD+(0===s?50+i-1-t:t),cc.tween(r.node).delay(.1*t).call(()=>{if(0===s){const o=this.getPlayerCardPosition(i,i-1-t);cc.tween(r.node).bezierTo(.6,cc.v2(-50,r.node.y),cc.v2(100,100),cc.v2(o.x,o.y-80)).to(.2,{position:cc.v3(o.x,o.y+20)}).to(.2,{position:o}).to(.4,{scale:.8}).call(()=>this.foldCardUp(r.node,e[t],.3)).start()}else cc.tween(r.node).to(.4,{position:this.getHandPosition(s),scale:.3}).start()}).start()}}this.scheduleOnce(()=>{this.cardStack.forEach((e,t)=>{cc.tween(e.node).to(.3,{position:cc.v3(t/10-400,60+t/6)}).start()}),this.autoSortCard(1),this.btn_sort.getComponent(cc.Button).interactable=!0,this.handleCardTouch(),this.buttonManager.activeAllButton(!0)},3)}initCardStack(e,t){for(let r=0;r<e;r++){let e=this.spawncard();this.cardStack.push(e),e.node.position=1==t?cc.v3(0+r/10,60+r/6):cc.v3(r/10-400,60+r/6)}1==t&&(this.cardStack.forEach(e=>{let t=this.cardStack.indexOf(e),r=null,o=0,s=0;t%2==0?(r=cc.v3(80+.3*t,130+.3*t),o=-8,s=-16):(r=cc.v3(-80-.3*t,130+.3*t),o=8,s=16),e.node.runAction(cc.spawn(cc.moveTo(.3,r).easing(cc.easeCubicActionOut()),cc.skewTo(.3,o,s)))}),setTimeout(()=>{for(let e=0;e<C;e++)this.cardStack[e].node.runAction(cc.sequence(cc.delayTime(.02*e),cc.spawn(cc.moveTo(.3,cc.v2(0+e/10,100+e/6)).easing(cc.easeCubicActionOut()),cc.skewTo(.3,0,0).easing(cc.easeCubicActionOut()))))},300))}doCardEntranceAni(e,t,r){let o=0;t%2==0?(o=-20,e.node.skewX=20):(o=20,e.node.skewX=-20),e.node.position=cc.v3(o,400),e.node.runAction(cc.sequence(cc.delayTime(.02*t),cc.spawn(cc.moveTo(.2,cc.v2(o,0+t/5)).easing(cc.easeCubicActionOut()),cc.skewTo(.2,0,0),cc.rotateTo(.2,90))))}getPlayerCardPosition(e,t){let r=e>20?15:30,o=this.getHandPosition(0);if(this.playerGroups.length<=1){let s=o.x-(e-1)*r+2*r*t;return cc.v3(s,o.y)}{let s=e>15?this.getGroupOffset(t)/2:this.getGroupOffset(t),i=o.x-(e-1)*r+2*r*t+s;return cc.v3(i,o.y)}}getDumpedCardsPosition(e){return cc.v3(20*e-330,60)}getHandPosition(e){switch(e){case 0:return cc.v3(0,-280);case 1:return cc.v3(460,100);case 2:return cc.v3(-460,100)}}getGroupOffset(e){switch(this.playerGroups.length){case 2:return e<this.playerGroups[0].length?-40:40;case 3:return e<this.playerGroups[0].length?-70:e>=this.playerGroups[0].length&&e<this.playerGroups[0].length+this.playerGroups[1].length?0:70;case 4:return e<this.playerGroups[0].length?-80:e>=this.playerGroups[0].length&&e<this.playerGroups[0].length+this.playerGroups[1].length?-20:e>=this.playerGroups[0].length+this.playerGroups[1].length&&e<this.playerGroups[0].length+this.playerGroups[1].length+this.playerGroups[2].length?40:100;case 5:return e<this.playerGroups[0].length?-110:e>=this.playerGroups[0].length&&e<this.playerGroups[0].length+this.playerGroups[1].length?-50:e>=this.playerGroups[0].length+this.playerGroups[1].length&&e<this.playerGroups[0].length+this.playerGroups[1].length+this.playerGroups[2].length?10:e>=this.playerGroups[0].length+this.playerGroups[1].length+this.playerGroups[2].length&&e<this.playerGroups[0].length+this.playerGroups[1].length+this.playerGroups[2].length+this.playerGroups[3].length?70:130;case 6:return e<this.playerGroups[0].length?-120:e>=this.playerGroups[0].length&&e<this.playerGroups[0].length+this.playerGroups[1].length?-65:e>=this.playerGroups[0].length+this.playerGroups[1].length&&e<this.playerGroups[0].length+this.playerGroups[1].length+this.playerGroups[2].length?-10:e>=this.playerGroups[0].length+this.playerGroups[1].length+this.playerGroups[2].length&&e<this.playerGroups[0].length+this.playerGroups[1].length+this.playerGroups[2].length+this.playerGroups[3].length?45:e>=this.playerGroups[0].length+this.playerGroups[1].length+this.playerGroups[2].length+this.playerGroups[3].length&&e<this.playerGroups[0].length+this.playerGroups[1].length+this.playerGroups[2].length+this.playerGroups[3].length+this.playerGroups[4].length?100:155}}spawncard(){let e=this.getCard();return this.node.addChild(e.node,u.GAME_ZORDER.Z_CARD),e.resetCard(),e.setTextureWithCode({rank:0,suit:0}),e.node.setScale(.4,.4),e.node.position=cc.v3(-340,120),e}getCard(){return(this.cardPool.get()||cc.instantiate(this.card)).getComponent(d.default)}handleCardTouch(){let e=null,t=0;this.node.on("touchstart",t=>{let r=cc.v2(t.touch.getLocation());e=this.findTouchedCard(r);const o=this.getPlayer(a.default.userName);let s=o.vectorCard[e];this.selectedCard=null!=s?s:null;let i=this.dumpedCardsArr[this.dumpedCardsArr.length-1];this.currenPlayer==o&&null!=i&&i.getBoundingBoxToWorld().contains(r)&&(1==this.checkEatCardPosible(i.getComponent(d.default))?this.doEatCard():(cc.log("!> cant eat"),this.handleFail()));let n=this.spotGuiCard(r);n&&1==this.isDraw&&this.doGuiCard(n)},this),this.node.on("touchmove",r=>{let o=r.touch.getDelta();t+=Math.sqrt(Math.pow(o.x,2));const s=this.getPlayer(a.default.userName);if(null!=this.selectedCard){if(this.isHold=!1,this.selectedCard.node.x+=o.x,o.x<0&&null!=s.vectorCard[e-1]&&this.selectedCard.node.x<=s.vectorCard[e-1].node.x+20){let t=s.vectorCard[e-1],r=this.getPlayerCardPosition(s.vectorCard.length,e-1);cc.tween(t.node).to(.2,{position:cc.v3(r.x+60,t.node.y)}).start(),t.node.zIndex++,this.selectedCard.node.zIndex--,this.handleCardSwapPosition(e,e-1),e--}if(o.x>0&&null!=s.vectorCard[e+1]&&this.selectedCard.node.x>=s.vectorCard[e+1].node.x-20){let t=s.vectorCard[e+1],r=this.getPlayerCardPosition(s.vectorCard.length,e+1);cc.tween(t.node).to(.2,{position:cc.v3(r.x-60,t.node.y)}).start(),t.node.zIndex--,this.selectedCard.node.zIndex++,this.handleCardSwapPosition(e,e+1),e++}}if(t>40){this.isHold=!0;for(let e=0;e<this.selectedArrC.length;e++)this.selectedArrC[e]==this.selectedCard&&(this.selectedArrC.splice(e,1),this.lastCardSelect=null);0==this.selectedArrC.length&&this.buttonManager.enableDump(!1),1==this.selectedArrC.length&&1==this.isDraw&&s==this.currenPlayer&&(this.lastCardSelect=this.selectedArrC[0].getComponent(d.default).code,this.buttonManager.enableDump(!0)),this.checkGroupButton(),this.selectedArrC.length>=3&&s==this.currenPlayer&&1==this.isDraw?this.buttonManager.enableDrop(!0):this.buttonManager.enableDrop(!1)}},this),this.node.on("touchend",()=>{t=0;const r=this.getPlayer(a.default.userName);if(null!=this.selectedCard)if(1==this.isHold){let t=this.getPlayerCardPosition(r.vectorCard.length,e);cc.tween(this.selectedCard.node).to(.2,{position:t}).start(),this.isHold=!1}else{this.selectedCard.node.y<=-240&&(this.chooseCard(this.selectedCard,e),this.lastCardSelect=this.selectedCard.getComponent(d.default).code,1==this.selectedArrC.length&&(this.lastCardSelect=this.selectedArrC[0].getComponent(d.default).code));let t=this.checkGroupCard(this.selectedCard);if(null!=t&&1==this.checkSelectedCards()){if(t==this.playerGroups.length-1&&0==this.checkIsGroup(this.playerGroups[t]))return;for(let e=0;e<r.vectorCard.length;e++){let o=r.vectorCard[e];if(this.selectedCard=o,1==this.checkSelectedCards())continue;let s=o.getComponent(d.default).code;for(let r=0;r<this.playerGroups[t].length;r++)s==this.playerGroups[t][r]&&this.chooseCard(o,e)}this.selectedCard=null}}this.selectedCard=null},this),this.node.on("touchcancel",()=>{t=0;const r=this.getPlayer(a.default.userName);if(null!=this.selectedCard)if(1==this.isHold){let t=this.getPlayerCardPosition(r.vectorCard.length,e);cc.tween(this.selectedCard.node).to(.2,{position:t}).start(),this.isHold=!1}else{this.selectedCard.node.y<=-240&&(this.chooseCard(this.selectedCard,e),this.lastCardSelect=this.selectedCard.getComponent(d.default).code,1==this.selectedArrC.length&&(this.lastCardSelect=this.selectedArrC[0].getComponent(d.default).code));let t=this.checkGroupCard(this.selectedCard);if(null!=t&&1==this.checkSelectedCards()){for(let e=0;e<this.selectedArrC.length;e++)this.selectedCard=this.selectedArrC[e],this.unSelectedCard();this.selectedArrC=[],this.selectedCard=null;for(let e=0;e<r.vectorCard.length;e++){let o=r.vectorCard[e],s=o.getComponent(d.default).code;for(let r=0;r<this.playerGroups[t].length;r++)s==this.playerGroups[t][r]&&this.chooseCard(o,e)}}}this.selectedCard=null},this)}chooseCard(e,t){const r=this.getPlayer(a.default.userName);let o=this.getPlayerCardPosition(r.vectorCard.length,t);cc.tween(e.node).to(.2,{position:cc.v3(o.x,-250)},{easing:"quadInOut"}).start(),0==this.checkSelectedCards()?(this.selectedArrC.push(e),1==this.selectedArrC.length&&r==this.currenPlayer&&1==this.isDraw?(this.buttonManager.enableDump(!0),this.buttonManager.enableUngroup(!1),this.buttonManager.enableGroup(!1)):this.buttonManager.enableDump(!1),this.selectedArrC.length>=2&&this.checkGroupButton(),this.selectedArrC.length>=3&&r==this.currenPlayer&&1==this.isDraw&&this.buttonManager.enableDrop(!0)):(this.unSelectedCard(),1==this.selectedArrC.length&&r==this.currenPlayer&&1==this.isDraw?this.buttonManager.enableDump(!0):this.buttonManager.enableDump(!1),this.selectedArrC.length<3&&this.buttonManager.enableDrop(!1)),this.currenPlayer==r&&1==this.isDraw&&this.selectedArrC.length>0&&this.showScHint()}checkSelectedCards(){for(let e=0;e<this.selectedArrC.length;e++)if(this.selectedCard==this.selectedArrC[e])return!0;return!1}unSelectedCard(){for(let t=0;t<this.selectedArrC.length;t++)if(this.selectedCard==this.selectedArrC[t]){this.selectedArrC.splice(t,1);let e=this.selectedCard.node.position;cc.tween(this.selectedCard.node).to(.2,{position:cc.v3(e.x,-280)},{easing:"quadInOut"}).start()}1==this.selectedArrC.length&&1==this.isDraw&&(this.buttonManager.enableDump(!0),this.lastCardSelect=this.selectedArrC[0].getComponent(d.default).code),this.selectedArrC.length>0?this.checkGroupButton():(this.buttonManager.enableDrop(!1),this.buttonManager.enableDump(!1),this.buttonManager.enableGroup(!1));const e=this.getPlayer(a.default.userName);this.currenPlayer==e&&1==this.isDraw&&this.showScHint()}checkGroupButton(){const e=this.getPlayer(a.default.userName);if(0==this.selectedArrC.length)return;this.currenPlayer==e&&1==this.isDraw&&this.showScHint();let t=this.checkGroupCard(this.selectedArrC[0]),r=!0;for(let o=0;o<this.selectedArrC.length;o++)if(this.checkGroupCard(this.selectedArrC[o])!=t){r=!1;break}return(null==t||null==t||void 0===t||null==this.playerGroups[t].length)&&this.selectedArrC.length>1?(this.buttonManager.enableGroup(!0),void this.buttonManager.enableUngroup(!1)):null==this.playerGroups[t]||void 0===this.playerGroups[t]?(this.buttonManager.enableGroup(!1),void this.buttonManager.enableUngroup(!1)):1==r&&this.selectedArrC.length==this.playerGroups[t].length?void(t==this.playerGroups.length-1&&0==this.checkIsGroup(this.playerGroups[t])?(this.buttonManager.enableUngroup(!1),this.buttonManager.enableGroup(!0)):this.buttonManager.enableGroup(!1)):this.selectedArrC.length>1?(this.buttonManager.enableGroup(!0),void this.buttonManager.enableUngroup(!1)):(this.buttonManager.enableGroup(!1),void this.buttonManager.enableUngroup(!1))}checkGroupCard(e){let t=e.getComponent(d.default).code;if(this.playerGroups.length>0)for(let r=0;r<this.playerGroups.length;r++)for(let e=0;e<this.playerGroups[r].length;e++)if(t==this.playerGroups[r][e])return r}handleCardSwapPosition(e,t){const r=this.getPlayer(a.default.userName);let o=r.vectorCard[e];if(r.vectorCard[e]=r.vectorCard[t],r.vectorCard[t]=o,this.playerGroups.length>1){let o=this.getCardGroup(r.vectorCard[e]),s=this.getCardGroup(r.vectorCard[t]);null!=o&&null!=s&&o!=s&&this.moveCardGroup(s,o,this.selectedCard.getComponent(d.default).code);for(let e=0;e<this.playerGroups.length;e++)0==this.playerGroups[e].length&&(this.playerGroups.splice(e,1),this.moveCardPosition())}1==this.playerGroups.length&&(this.playerGroups=[]),this.reSetZOrder()}moveCardGroup(e,t,r){this.updatePlayerPoint();for(let o=0;o<this.playerGroups[e].length;o++)if(r==this.playerGroups[e][o])return this.playerGroups[e].splice(o,1),this.playerGroups[t].push(r),this.updateGroupBanner(),void cc.log("!> this group",this.playerGroups)}getCardGroup(e){for(let t=0;t<this.playerGroups.length;t++)for(let r=0;r<this.playerGroups[t].length;r++)if(e.getComponent(d.default).code==this.playerGroups[t][r])return t}findTouchedCard(e){const t=this.getPlayer(a.default.userName);for(let r=t.vectorCard.length-1;r>=0;r--)if(t.vectorCard[r].node.getBoundingBoxToWorld().contains(e))return r}onMenuClick(){l.default.show(this,l.DialogPosition.LEFT)}onSortClick(){this.btn_sort.getComponent(cc.Button).interactable=!1,this.buttonManager.allowDraw(!1),0===this.currentSort?this.autoSortCard(1):1===this.currentSort?this.autoSortCard(2):2===this.currentSort&&this.autoSortCard(1),this.reOrganizeCodeOrderByGroup(),setTimeout(()=>{this.btn_sort.getComponent(cc.Button).interactable=!0,this.buttonManager.allowDraw(!0)},1e3)}autoSortCard(e){const t=this.getHandPosition(0);this.selectedCard=null,this.selectedArrC=[],this.buttonManager.enableDrop(!1),this.buttonManager.enableDump(!1),this.buttonManager.enableGroup(!1),this.buttonManager.enableUngroup(!1);const r=this.getPlayer(a.default.userName).vectorCard;r.forEach(e=>{cc.tween(e.node).to(.1,{position:t},{easing:"quadInOut"}).start()}),1===e?(this.sortCodeUpByValue(),this.spotGroup()):2===e&&(this.playerGroups=[],this.sortCodeUpByKindsASC()),this.scheduleOnce(()=>{r.forEach((e,t)=>{const o=this.getPlayerCardPosition(r.length,t);e.getComponent(d.default).setTextureWithCode(this.currentCodeOrder[t]),e.node.zIndex=u.GAME_ZORDER.Z_CARD+t,cc.tween(e.node).to(.2,{position:o},{easing:"quadInOut"}).start()}),this.currentSort=e,this.updateGroupBanner(),this.updatePlayerPoint()},.2)}compareValues(e,t="asc"){return function(r,o){let s=r.code?r.code[e]:r[e],i=o.code?o.code[e]:o[e],n=0;return s>i?n=1:s<i&&(n=-1),"desc"===t?-1*n:n}}sortCodeUpByValue(){this.currentCodeOrder=[],this.codeValueArr.sort(this.compareValues("suit")),this.codeValueArr.sort(this.compareValues("rank"));for(let e=0;e<this.codeValueArr.length;e++)this.currentCodeOrder.push(this.codeValueArr[e].code)}sortCodeUpByKindsASC(){this.currentCodeOrder=[],this.codeValueArr.sort(this.compareValues("rank")),this.codeValueArr.sort(this.compareValues("suit"));for(let e=0;e<this.codeValueArr.length;e++)this.currentCodeOrder.push(this.codeValueArr[e].code)}checkIsSuitInDeck(e){for(let t=0;t<this.currentCodeOrder.length;t++)if(this.currentCodeOrder[t]==e)return!0;return!1}findGroup(e=[]){let t=[...e],r=[];for(;t.length>0;){let e=this.spotStraightGroupHightLow(t,0);if(e.arrCode.length>=3)this.playerGroups.push(e.arrCode),this.spliceArray(t,e.arrCard);else{let e=0;for(let r=0;r<t.length;r++)if(t[r].code.rank!=u.CODE_JOKER_BLACK&&t[r].code.rank!=u.CODE_JOKER_RED){e=r;break}let o=t.splice(e,1);r.push(o[0])}}for(t=r.sort(this.compareValues("rank","desc")),r=[];t.length>0;){let e=this.spotSameKindGroup(t,0,!0);if(e.arrCode.length>=3)this.playerGroups.push(e.arrCode),this.spliceArray(t,e.arrCard);else{let e=0;for(let r=0;r<t.length;r++)if(t[r].code.rank!=u.CODE_JOKER_BLACK&&t[r].code.rank!=u.CODE_JOKER_RED){e=r;break}let o=t.splice(e,1);r.push(o[0])}}return r}spotGroup(){this.playerGroups=[];let e=[],t=[];for(let o=0;o<this.codeValueArr.length;o++)this.codeValueArr[o].code.rank!=u.CODE_JOKER_BLACK&&this.codeValueArr[o].code.rank!=u.CODE_JOKER_RED?e.push(this.codeValueArr[o]):t.push(this.codeValueArr[o]);e.sort(this.compareValues("rank")),e.reverse();let r=[...this.findGroup(e)];for(let o=0;o<t.length;o++){let e=[...r,t[o]];r=[...this.findGroup(e)]}r.length>0&&this.playerGroups.length>0&&(r.sort(this.compareValues("rank")),this.playerGroups.push(r.map(e=>e.code)),cc.log("input orgCard",this.playerGroups,"leftOver.map")),this.reOrganizeCodeOrderByGroup()}spliceArray(e,t){for(let r=0;r<t.length;r++)for(let o=0;o<e.length;o++)e[o]==t[r]&&e.splice(o,1);return e}reOrganizeCodeOrderByGroup(){if(this.playerGroups.length>0){this.currentCodeOrder=[];for(let e=0;e<this.playerGroups.length;e++)for(let t=0;t<this.playerGroups[e].length;t++)this.currentCodeOrder.push(this.playerGroups[e][t])}}spotStraightGroup(e,t){let r=[e[t]];if(!e[t]||void 0===e[t])return{arrCode:[],arrCard:[]};let o=1,s=r[0];for(let n=t+1;n<e.length;n++){let t=e[n];s.code.rank+o==t.code.rank&&s.code.suit==t.code.suit&&(r.push(e[n]),o++)}let i=[];for(let n=0;n<r.length;n++)i.push(r[n].code);return{arrCode:i,arrCard:r}}spotStraightGroupHightLow(e,t){e.sort(this.compareValues("rank","desc")),e.sort(this.compareValues("suit"));let r=[e[t]];if(!e[t]||void 0===e[t])return cc.log("StraightGroup => card null ==>",e[t]),{arrCode:[],arrCard:[]};let o=1,s=r[0];for(let n=t+1;n<e.length;n++){let t=e[n];s.code.rank-o==t.code.rank&&s.code.suit==t.code.suit&&(r.push(e[n]),o++)}r.sort(this.compareValues("rank"));let i=[];for(let n=0;n<r.length;n++)i.push(r[n].code);return{arrCode:i,arrCard:r}}isValidPhomOnHand(){return this.cardsOnDeck[0].length>0&&this.cardsOnDeck[0][0].length>0||this.checkValidPhomOnGroup(this.codeValueArr)}spotSameKindGroup(e,t,r=!1){let o=this.isValidPhomOnHand();if(!e[t]||void 0===e[t])return cc.log("SameKindGroup => card null ==>",e[t]),{arrCode:[],arrCard:[]};let s=[e[t]];if(null==s)return;let i=s[0].code.rank;for(let a=t+1;a<e.length;a++)i!=u.CODE_JOKER_BLACK&&i!=u.CODE_JOKER_RED||(i=e[a].code.rank),(e[a].code.rank==i||r&&o&&(e[a].code.rank==u.CODE_JOKER_BLACK||e[a].code.rank==u.CODE_JOKER_RED))&&s.push(e[a]);if(s.length>4){let e=s.length-1;for(;s.length>4;)!s[e]||s[e].code.rank!=u.CODE_JOKER_BLACK&&s[e].code.rank!=u.CODE_JOKER_RED||s.splice(e,1),e--}let n=[];for(let a=0;a<s.length;a++)n.push(s[a].code);return{arrCode:n,arrCard:s}}handleTimeToStart(e){this.stateGame=0,this.cleanTable()}handleDc(e){this.closeDialogFightConfirm(),-1==e.card.rank&&-1==e.card.suit&&(e.card=this.lastCardSelect),this.isDraw=!1;let t=null,r=this.getDumpedCardsPosition(this.dumpedCardsArr.length);this.currenPlayer||(this.currenPlayer=this.getPlayerWithId(e.nextTurn));const o=this.getPlayer(a.default.userName);if(cc.log("!> handle Dc check",o==this.currenPlayer),o==this.currenPlayer){for(let t=0;t<this.codeValueArr.length;t++)if(this.codeValueArr[t].code==e.card){this.codeValueArr.splice(t,1);break}cc.log("!> handle Dc check card ",e.card,o.vectorCard.length);for(let r=0;r<o.vectorCard.length;r++)if(this.compareCardCode(o.vectorCard[r],e.card)){t=o.vectorCard[r],o.vectorCard.splice(r,1),this.removeCode(e.card),cc.log("!> handle Dc check card",t);break}this.selectedArrC=[],this.buttonManager.enableAllButton(!1),this.reOrganizeCardPosition(0),this.turnOffTouchForLimitedTime(600),this.updatePlayerPoint(),this.destroyHintArrow()}else(t=this.spawncard()).node.position=this.getHandPosition(this.currenPlayer.indexDynamic),t.node.setScale(.3),this.foldCardUp(t.node,e.card,.3,.4,.4),this.updateNumbOfCard(this.currenPlayer.indexDynamic,1,0);if(t||cc.error(this),t.node.runAction(cc.scaleTo(.4,.4)),this.dumpedCardsArr.push(t.node),t.node.zIndex=u.GAME_ZORDER.Z_DUMPED_CARD+this.dumpedCardsArr.length,this.setDarkDumpedCard(1),t.setDark(!1),cc.tween(t.node).to(.6,{position:r},{easing:"quadInOut"}).start(),null!=this.getPlayerWithId(e.nextTurn)&&null!=e.nextTurn)this.setPlayerTurn(e.nextTurn,20),e.nextTurn==a.default.userName&&setTimeout(()=>{this.ShowEatHint()},700);else for(let s=0;s<this.players.length;s++)this.players[s].setTurn(!1);this.reSetZOrder(),this.checkAllowTongits()}compareCardCode(e,t){return e.code.rank==t.rank&&e.code.suit==t.suit}reOrganizeCardPosition(e=0){const t=this.getPlayer(a.default.userName);for(let r=0;r<t.vectorCard.length-e;r++){let e=this.getPlayerCardPosition(t.vectorCard.length,r),o=t.vectorCard[r];cc.tween(o.node).to(.2,{position:e},{easing:"quadInOut"}).start()}this.updateGroupBanner(),this.selectedArrC=[],this.selectedCard=null}removeCode(e){for(let r=0;r<this.currentCodeOrder.length;r++)if(e==this.currentCodeOrder[r]){this.currentCodeOrder.splice(r,1);break}if(this.codeValueArr.length>0)for(let r=0;r<this.codeValueArr.length;r++)this.codeValueArr[r].code==e&&this.codeValueArr.splice(r,1);if(this.playerGroups.length>0)for(let r=0;r<this.playerGroups.length;r++)for(let t=0;t<this.playerGroups[r].length;t++)if(e==this.playerGroups[r][t]){this.playerGroups[r].splice(t,1);break}let t=this.playerGroups.length;if(this.playerGroups.length>1)for(let r=0;r<t;r++)if(0==this.playerGroups[r].length){this.playerGroups.splice(r,1);break}this.playerGroups.length<=1&&(this.playerGroups=[])}foldCardUp(e,t,r,o=.8,s=.2){let i=o<.4;cc.tween(e).delay(s).to(r/2,{scaleX:.01,scaleY:o},{easing:"cubicIn"}).call(()=>{e.getComponent(d.default).setTextureWithCode(t,i)}).to(r/2,{scaleX:o,scaleY:o},{easing:"cubicOut"}).start()}handleBc(e){this.closeDialogFightConfirm(),this.updateNumbOfCard(0,1,0),this.isDraw=!0,this.canFight=e.isFight;let t,r=this.cardStack.pop();if(null==r){let e=this.getCard();e.node.position=cc.v3(-400,65),r=e}this.hideArrow();const o=this.getPlayer(a.default.userName);if(o===this.currenPlayer){r.getComponent(d.default).setTextureWithCode(e.card,!1),r.node.runAction(cc.spawn(cc.sequence(cc.scaleTo(.15,.01,.8),cc.scaleTo(.15,.8)),cc.sequence(cc.skewTo(.15,0,-20),cc.callFunc(()=>{r.node.skewY=20}),cc.skewTo(.15,0,0)))),o.vectorCard.push(r),t=this.getPlayerCardPosition(o.vectorCard.length,o.vectorCard.length-1),this.currentCodeOrder.push(e.card),this.playerGroups.length>1&&this.playerGroups[this.playerGroups.length-1].push(e.card),this.codeValueArr.push(r.getComponent(d.default)),this.selectedArrC=[],setTimeout(()=>{this.reOrganizeCardPosition(1)},300),this.buttonManager.enableAllButton(!1),this.updatePlayerPoint();let s=this.node.getChildByName("eatArrow");null!=s&&s.destroy(),this.turnOffTouchForLimitedTime(600),this.destroyHintArrow()}else{this.updateNumbOfCard(this.currenPlayer.indexDynamic,1,1),t=this.getHandPosition(this.currenPlayer.indexDynamic);try{r.node.runAction(cc.scaleTo(.6,.3))}catch(s){cc.log("!> error",s)}setTimeout(()=>{this.cardPool.put(r.node)},600)}o===this.currenPlayer&&cc.log("!> handle bc ==> ",e.card,o.vectorCard.length),this.node.runAction(cc.sequence(cc.callFunc(()=>{r.node.zIndex+=99}),cc.callFunc(()=>{cc.tween(r.node).to(.6,{position:t},{easing:"quadInOut"}).start(),r.node.runAction(cc.sequence(cc.rotateTo(.25,-40),cc.rotateTo(.25,0).easing(cc.easeCubicActionOut()))),this.btn_sort.getComponent(cc.Button).interactable=!1}),cc.delayTime(1),cc.callFunc(()=>{this.btn_sort.getComponent(cc.Button).interactable=!0,o===this.currenPlayer&&(r.node.zIndex=u.GAME_ZORDER.Z_CARD+o.vectorCard.length+1),this.reSetZOrder()})))}getPlayerIndex(e){let t=this.getPlayerWithId(e);for(let r=0;r<this.players.length;r++)if(t===this.players[r])return r}handleBd(e){this.closeDialogFightConfirm();let t=this.getPlayerWithId(e.pid);this.fightObj.playerFight(t,0),this.blackList.push(t)}handleFight(e){cc.log("!> handle fight",e),this.hideArrow(),this.currenPlayer.setTurn(!1),this.showFightScene(e.pid);let t=this.node.getChildByName("eatArrow");null!=t&&t.destroy(),this.highLightPlayerArea(3),this.setDarkDumpedCard(0),this.buttonManager.enableAllButton(!1);let r=this.getDeclareData();p.TongitsNetworkTransport.getInstance().sendTgUpdateCard(r)}showTongitsScene(e,t){let r=cc.instantiate(this.tongits_scene).getComponent("TongitsScene");this.node.addChild(r.node,999),r.node.zIndex=999;let o=this.getPlayerWithId(e);if(!o)return;e==a.default.userId&&(this.player_point.node.parent.active=!1,this.player_point.string="0"),r.startScene(o);let s=JSON.parse(JSON.stringify(this.playerGroups)),i=[...this.currentCodeOrder];this.playerGroups=[],this.playerGroups=[...t];for(let a=0;a<this.playerGroups.length;a++)0==this.playerGroups[a].length&&this.playerGroups.splice(a,1);const n=this.arrGroupBanner.length;for(let a=0;a<n;a++){let e=this.arrGroupBanner.pop();null!=e&&null!=e.node&&e.node.destroy()}this.reOrganizeCodeOrderByGroup();const l=[...this.currentCodeOrder];for(let a=0;a<l.length;a++){let e=this.getCard();r.node.addChild(e.node,100),e.setTextureWithCode({rank:0,suit:0}),e.node.setScale(.5,.5);let t=this.getPlayerCardPosition(this.currentCodeOrder.length,a);e.node.position=t,e.node.zIndex=100,e.setDark(!0),setTimeout(()=>{this.foldCardUp(e.node,l[a],.3),e.node.runAction(cc.scaleTo(.2,.8))},100*a)}setTimeout(()=>{this.playerGroups=[...s],this.currentCodeOrder=[...i]},2e3)}showFightScene(e){let t=cc.instantiate(this.fight_scene).getComponent("FightScene");this.node.addChild(t.node,200,"FightScene"),this.fightObj=t,t.node.zIndex=200;let r=this.getPlayerWithId(e);if(e==a.default.userId){const e=this.getPlayer(a.default.userName);for(let t=0;t<this.players.length;t++)e==this.players[t]||this.checkIfBlackList(this.players[t])||this.players[t].setTurn(!0,12,!0)}let o=this.calculatePoint();t.startFight(r,o),this.resetStateCardAndButton()}showFightDecision(e,t){2!=this.stateGame&&(null!=this.fightObj&&null!=this.fightObj.node?this.fightObj.playerFight(e,t):setTimeout(()=>{this.node&&e&&this.showFightDecision(e,t)},200))}clearFight(){setTimeout(()=>{null!=this.fightObj&&null!=this.fightObj.node&&(this.fightObj.node.destroy(),this.fightObj=null)},1500)}checkIfCanFight(){if(this.cardsOnDeck[0].length>0&&1==this.canFight)return!0}handleAcceptFight(e){let t=this.getPlayerWithId(e.pid);t.setTurn(!1),this.showFightDecision(t,e.type),e.type<2&&this.blackList.push(t)}handleFinish(e){this.blackList=[],this.buttonManager.node.stopAllActions(),this.btn_sort.getComponent(cc.Button).interactable=!1,this.cleanResult();let t=JSON.parse(e.data);this.hideArrow(),this.isDraw=!1,this.highLightPlayerArea(3),this.setDarkDumpedCard(0);let r=3e3,o=!1,s=!1,i=null;for(let l=0;l<this.players.length;l++)this.players[l].setTurn(!1);this.turnOffTouch(),this.buttonManager.activeAllButton(!1);try{this.clearFight()}catch(a){cc.log("!> error ",a)}for(let l=0;l<t.length;l++)if(t[l].tongits>0){this.showTongitsScene(t[l].pid,t[l].arr),o=!0;break}let n=0;for(let l=0;l<t.length;l++)if(t[l].HitPot>0){s=!0,n=t[l].HitPot,i=this.getPlayerWithId(t[l].pid);break}1==s&&0==o?(r=5e3,this.showOtherResult(t),this.showDimondMoveUp(t),setTimeout(()=>{this.showHitPotAni(n)},3e3)):0==s&&1==o?(r=4e3,setTimeout(()=>{this.showOtherResult(t)},4e3)):1==s&&1==o?(r=8e3,setTimeout(()=>{this.showOtherResult(t),this.showDimondMoveUp(t)},4e3),setTimeout(()=>{this.showHitPotAni(n)},6500)):0==s&&0==o&&this.showOtherResult(t),this.clearNumbOfCard(),setTimeout(()=>{this.showWinLoose(t)},r),setTimeout(()=>{this.pot.node.zIndex=99,this.showResultTable(t)},r+3e3)}turnOffTouchForLimitedTime(e){this.turnOffTouch(),setTimeout(()=>{this.handleCardTouch()},e)}turnOffTouch(){this.node.off("touchstart"),this.node.off("touchend"),this.node.off("touchcancel"),this.node.off("touchmove")}showWinLoose(e){for(let t=0;t<e.length;t++){let r=this.getPlayerWithId(e[t].pid);r&&(1==e[t].code.rank?(r.showEffectWinLose(1),(e[t].HitPot<=0||null==e[t].HitPot)&&this.showDimond(r.indexDynamic),e[t].pid,a.default.userId):(r.showEffectWinLose(2),e[t].pid,a.default.userId),r.showEffectFlyMoney(e[t].M,40),e[t].diamond&&setTimeout(()=>{r.effectFlDiamond(e[t].diamond-r.diamond),this.updatePlayerDiamond(r,e[t].diamond)},2e3),this.updatePlayerMoney(r,e[t].AG))}}updatePlayerDiamond(e,t){e.diamond=t,e.diamondLabel.string=t.toString()}showResultTable(e){let t=[];for(let o=0;o<e.length;o++){let r=this.getPlayerWithId(e[o].pid);r&&t.push(r)}let r=cc.instantiate(this.result_table).getComponent("FinishTable");this.resultTable=r,this.node.addChild(r.node,u.GAME_ZORDER.Z_MENU_VIEW+300,"resultTable"),r.showTable(e,t)}toggleResultTabel(e=!1){null!=this.resultTable&&null!=this.resultTable.node&&(1==e?this.resultTable.node.active=!1:0==this.resultTable.node.active?this.resultTable.node.active=!0:this.resultTable.node.active=!1)}cleanResult(){null!=this.resultTable&&null!=this.resultTable.node&&(this.resultTable.node.destroy(),this.resultTable=null)}cleanTable(){this.hideOtherScore(),this.player_point.node.parent.active=!1,this.player_point.string="0";for(let e=0;e<this.players.length;e++){let t=this.players[e].vectorCard.length;for(let r=0;r<t;r++){let t=this.players[e].vectorCard[r];this.cardPool.put(t.node)}this.players[e].vectorCard=[]}for(let e=0;e<this.dumpedCardsArr.length;e++){let t=this.dumpedCardsArr[e];this.cardPool.put(t)}for(let e=0;e<this.cardsOnDeck.length;e++)for(let t=0;t<this.cardsOnDeck[e].length;t++)for(let r=0;r<this.cardsOnDeck[e][t].length;r++){let o=this.cardsOnDeck[e][t][r];this.cardPool.put(o.node)}for(let e=0;e<this.cardStack.length;e++){let t=this.cardStack[e];this.cardPool.put(t.node)}this.codeValueArr=[],this.cardStack=[],this.dumpedCardsArr=[],this.cardsOnDeck=[[],[],[]],this.currentCodeOrder=[],this.playerGroups=[],this.selectedArrC=[],this.selectedCard=null,this.clearNumbOfCard(),this.updateGroupBanner(),this.turnOffTouch(),"true"==cc.sys.localStorage.getItem("isBack")&&p.TongitsNetworkTransport.getInstance().sendExitGame(),this.canFight=!1,this.buttonManager.enableFight(this.canFight)}getDumpInfo(){if(null!=this.lastCardSelect&&1==this.isDraw){let e=JSON.parse(JSON.stringify(this.currentCodeOrder)),t=JSON.parse(JSON.stringify(this.playerGroups));this.removeCode(this.lastCardSelect);let r=[];r=this.playerGroups.length>0?JSON.parse(JSON.stringify(this.playerGroups)):[[...this.currentCodeOrder]];let o={isValid:!this.checkGroupIncludeJoker([this.lastCardSelect]),code:this.lastCardSelect,arrC:r};return this.currentCodeOrder=JSON.parse(JSON.stringify(e)),this.playerGroups=JSON.parse(JSON.stringify(t)),this.codeValueArr=[],this.getPlayer(a.default.userName).vectorCard.forEach(e=>{this.codeValueArr.push(e.getComponent(d.default))}),o}return null}handleHc(e){this.closeDialogFightConfirm();let t=this.getPlayerWithId(e.pid),r=[],o=t.indexDynamic,s=this.cardsOnDeck[o].length,i=this.setDropedCardPosition(o,0,s);if(0!=o){if(0!==e.cardEat){let e=this.dumpedCardsArr.pop();e.runAction(cc.sequence(cc.moveTo(.4,cc.v2(i)).easing(cc.easeCubicActionOut()),cc.callFunc(()=>{this.cardPool.put(e)})))}let t=e.listC.length-1;0!==e.cardEat?this.updateNumbOfCard(o,t,0):this.updateNumbOfCard(o,t+1,0),e.listC.sort((e,t)=>(Number((t-1)%13)+2)%14-(Number((e-1)%13)+2)%14);for(let n=0;n<e.listC.length;n++)setTimeout(()=>{let t=this.spawncard();t.node.setScale(.3),t.node.position=i,t.setTextureWithCode(e.listC[n],!0),r.push(t.node);let a=this.setDropedCardPosition(o,n,s);cc.tween(t.node).to(.3,{position:a},{easing:"quadInOut"}).start(),t.setDark(!0),e.listC[n]==e.cardEat&&0!=e.cardEat&&(t.setBorder(!0),this.showBurnAni(a)),t.node.zIndex=n},400+100*n)}else{if(this.buttonManager.enableAllButton(!1),0!==e.cardEat){this.hideArrow();let e=this.dumpedCardsArr.pop();e.runAction(cc.sequence(cc.moveTo(.4,cc.v2(i)).easing(cc.easeCubicActionOut()),cc.callFunc(()=>{this.cardPool.put(e)})))}e.listC.length;let t=[];const n=this.getPlayer(a.default.userName);for(let r=0;r<e.listC.length;r++)for(let o=0;o<n.vectorCard.length;o++){let s=n.vectorCard[o].getComponent(d.default);s.code==e.listC[r]&&t.push(s.node)}for(let e=0;e<t.length;e++){let r=t[e];r.runAction(cc.spawn(cc.scaleTo(.4,.3),cc.sequence(cc.moveTo(.4,cc.v2(i)).easing(cc.easeCubicActionOut()),cc.callFunc(()=>{this.cardPool.put(r)}))))}this.spliceArray(n.vectorCard,t);let l=[];for(let e=0;e<this.selectedArrC.length;e++)l.push(this.selectedArrC[e].getComponent(d.default));this.spliceArray(this.codeValueArr,l);for(let r=0;r<e.listC.length;r++){let t=e.listC[r];this.removeCode(t)}this.selectedArrC=[];let c=[];for(let r=0;r<e.listC.length;r++){let t=this.spawncard();t.node.setScale(.3),t.node.active=!1,t.setTextureWithCode(e.listC[r],!0),c.push(t);let i=this.setDropedCardPosition(o,r,s);e.listC[r]==e.cardEat&&0!=e.cardEat&&setTimeout(()=>{t.setBorder(!0),this.showBurnAni(i)},400+100*r)}this.sortDropedCard(c,!0,!1);for(let e=0;e<c.length;e++)setTimeout(()=>{let t=c[e];t.node.position=i,t.node.active=!0,r.push(t.node);let n=this.setDropedCardPosition(o,e,s);cc.tween(t.node).to(.3,{position:n},{easing:"quadInOut"}).start(),t.setDark(!0),t.node.zIndex=e},50+100*e);setTimeout(()=>{this.reOrganizeCardPosition(0)},100*c.length),this.turnOffTouchForLimitedTime(600),this.reSetZOrder(),this.updatePlayerPoint();let h=this.node.getChildByName("eatArrow");null!=h&&h.destroy(),this.destroyHintArrow(),this.selectedArrC=[],this.selectedCard=null,this.showScHint()}setTimeout(()=>{this.cardsOnDeck[o].push(r)},0!=o?100:50+100*(e.listC.length-1)),this.reSetZOrder()}reSetZOrder(){const e=this.getPlayer(a.default.userName);for(let t=0;t<e.vectorCard.length;t++)e.vectorCard[t].node.zIndex=u.GAME_ZORDER.Z_CARD+t;for(let t=0;t<this.dumpedCardsArr.length;t++)this.dumpedCardsArr[t].zIndex=u.GAME_ZORDER.Z_CARD+this.dumpedCardsArr.length+t}getPlayersGroupPosition(e){switch(e){case 0:return cc.v3(-405,-30);case 1:return cc.v3(440,220);case 2:return cc.v3(-445,220)}}getOffsetLower(e,t){this.cardsOnDeck[e];let r=this.getPlayersGroupPosition(e),o=this.setDropedCardPosition(e,0,t);return 1==e?r.x-o.x:2==e?r.x-o.x:0}setDropedCardPosition(e,t,r,o=!1,s=0){let i=0;1==o&&(i=this.getOffsetLower(e,e));let n=this.getPlayersGroupPosition(e);if(0==r&&0==o)return 1==e?cc.v3(n.x-25*t,n.y):cc.v3(n.x+25*t,n.y);{let s=t;for(let t=0;t<r;t++)s+=this.cardsOnDeck[e][t].length;return 1==o&&0!=e?cc.v3(n.x+25*s+20*r+i,n.y-70):cc.v3(n.x+25*s+20*r,n.y)}}checkEatCardPosible(e){let t=[];for(let s=0;s<this.selectedArrC.length;s++){let e=this.selectedArrC[s].getComponent(d.default);t.push(e)}t.push(e),t.sort(this.compareValues("rank"));let r=this.spotSameKindGroup(t,0),o=this.spotStraightGroup(t,0);return r.arrCode.length>=3&&r.arrCode.length==t.length||o.arrCode.length>=3&&o.arrCode.length==t.length}spotGuiCard(e){for(let t=0;t<this.cardsOnDeck.length;t++)for(let r=0;r<this.cardsOnDeck[t].length;r++)for(let o=0;o<this.cardsOnDeck[t][r].length;o++)if(this.cardsOnDeck[t][r][o].node.getBoundingBoxToWorld().contains(e))return{indexPl:t,indexGroup:r};return null}converIndexToCode(e,t){let r=[];for(let o=0;o<this.cardsOnDeck[e][t].length;o++){let s=this.cardsOnDeck[e][t][o].getComponent(d.default).code;r.push(s)}return r}convertCodeToIndex(e){for(let t=0;t<3;t++)for(let r=0;r<this.cardsOnDeck[t].length;r++){let o=[];for(let e=0;e<this.cardsOnDeck[t][r].length;e++){let s=this.cardsOnDeck[t][r][e].getComponent(d.default).code;o.push(s)}if(e.length==this.cardsOnDeck[t][r].length&&1==this.compareArr(e,o))return{dynamic:t,index:r}}return{dynamic:-1,index:-1}}compareArr(e,t){let r=0;for(let o=0;o<e.length;o++)for(let s=0;s<t.length;s++)e[o]==t[s]&&r++;return r==e.length&&r==t.length}doGuiCard(e){let t,r=this.converIndexToCode(e.indexPl,e.indexGroup),o=[...this.currentCodeOrder],s=this.playerGroups,i=[];for(let n=0;n<this.selectedArrC.length;n++){let e=this.selectedArrC[n].getComponent(d.default).code;i.push(e)}for(let n=0;n<i.length;n++){let e=i[n];for(let t=0;t<o.length;t++)if(e==o[t]){o.splice(t,1);break}if(s.length>0)for(let t=0;t<s.length;t++)for(let r=0;r<s[t].length;r++)if(e==s[t][r]){s[t].splice(r,1);break}if(s.length>0)for(let t=0;t<s.length;t++)0==s[t].length&&s.splice(t,1)}t=s.length>1?s:[o],p.TongitsNetworkTransport.getInstance().sendTgSc(i,r,t)}checkEatSame(e){let t=e[0],r=0;for(let o=1;o<e.length;o++){let s=e[o];for(let e=1;e<=4;e++)s==t+13*e&&r++}return r==e.length-1}checkEatStraight(e){let t=1,r=e[0],o=0;for(let s=1;s<e.length;s++)e[s]==r+t&&(o++,t++);return o==e.length-1}getCardDropInfo(){let e=[];for(let s=0;s<this.playerGroups.length;s++){let t=[];for(let e=0;e<this.playerGroups[s].length;e++)t.push(this.playerGroups[s][e]);e.push(t)}let t=[];for(let s=0;s<this.selectedArrC.length;s++){let e=this.selectedArrC[s].getComponent(d.default);t.push(e.code)}let r=!1;t.sort(this.compareValues("rank")),1==this.checkEatSame(t)?r=!0:1==this.checkEatStraight(t)&&(r=!0);let o=this.removeCardDrop(t);return this.playerGroups=[...e],o}removeCardDrop(e){let t=JSON.parse(JSON.stringify(this.playerGroups));if(1==Array.isArray(t[0])){for(let r=0;r<e.length;r++)for(let o=0;o<t.length;o++)for(let s=0;s<t[o].length;s++)e[r]==t[o][s]&&t[o].splice(s,1);for(let e=0;e<t.length;e++)0==t[e].length&&t.splice(e,1);return{isValid:!this.checkGroupIncludeJoker(e),arrD:e}}return t=[...this.currentCodeOrder],this.spliceArray(t,e),{isValid:!this.checkGroupIncludeJoker(e),arrD:e}}doEatCard(){let e=[];for(let s=0;s<this.selectedArrC.length;s++){let t=this.selectedArrC[s].getComponent(d.default).code;e.push(t)}let t=JSON.parse(JSON.stringify(this.playerGroups)),r=JSON.parse(JSON.stringify(this.currentCodeOrder));for(let s=0;s<e.length;s++)this.removeCode(e[s]);let o=[];o=this.playerGroups.length>1?JSON.parse(JSON.stringify(this.playerGroups)):[[...this.currentCodeOrder]],this.playerGroups=[],this.currentCodeOrder=[],this.playerGroups=JSON.parse(JSON.stringify(t)),this.currentCodeOrder=JSON.parse(JSON.stringify(r)),p.TongitsNetworkTransport.getInstance().sendTgEc(e,o),this.isDraw=!0}handleSc(e){this.closeDialogFightConfirm();let t=this.getPlayerWithId(e.pid),r=this.convertCodeToIndex(e.arrP),o=r.dynamic,s=r.index,i=this.cardsOnDeck[o];const n=this.getPlayer(a.default.userName);if(t==n){let t=[];for(let r=0;r<e.arrGui.length;r++)for(let o=0;o<n.vectorCard.length;o++){let a=n.vectorCard[o];a.getComponent(d.default).code==e.arrGui[r]&&(t.push(a),i[s].push(a))}for(let e=0;e<t.length;e++)for(let r=0;r<this.codeValueArr.length;r++)this.codeValueArr[r].code==t[e]&&this.codeValueArr.splice(r,1);this.spliceArray(n.vectorCard,t);for(let r=0;r<e.arrGui.length;r++)for(let t=0;t<this.codeValueArr.length;t++)e.arrGui[r]==this.codeValueArr[t].code&&this.codeValueArr.splice(t,1);for(let r=0;r<e.arrGui.length;r++){let t=e.arrGui[r];this.removeCode(t)}this.reOrganizeCardPosition(0),this.selectedCard=null,this.selectedArrC=[],this.buttonManager.enableAllButton(!1),this.updatePlayerPoint(),this.turnOffTouchForLimitedTime(300),this.destroyHintArrow(),this.showScHint()}else{this.updateNumbOfCard(t.indexDynamic,e.arrGui.length,0);for(let r=0;r<e.arrGui.length;r++){let o=this.spawncard();o.node.setScale(.3),o.setTextureWithCode(e.arrGui[r],!0),o.node.position=this.getHandPosition(t.indexDynamic),i[s].push(o)}}for(let a=0;a<i.length;a++){i[a].length,a==s&&this.sortDropedCard(i[a],0==o);for(let e=0;e<i[a].length;e++){let t=i[a][e],r=t.getComponent(d.default);r.setDark(!0),r.showSmall(!0),this.destroyHintArrow();let s=this.setDropedCardPosition(o,e,a);cc.tween(t.node).to(.3,{position:s},{easing:"quadInOut"}).start(),t.node.zIndex=e}}}sortDropedCard(e,t=!0,r=!0){let o=[];if(1==r)for(let i=0;i<e.length;i++){let t=e[i].getComponent(d.default);o.push(t)}else o=[...e];o.sort(this.compareValues("rank",t?"asc":"desc"));let s=[...e];for(let i=0;i<s.length;i++)for(let t=0;t<o.length;t++)s[i].getComponent(d.default).code==o[t].code&&(e[t]=s[i])}handleMsg(e){this.showNoti(e.text),this.reOrganizeCardPosition(0),this.buttonManager.enableAllButton(!1),this.selectedArrC=[],this.selectedCard=null,this.destroyHintArrow();for(let t=0;t<this.players.length;t++){let e=this.cardsOnDeck[t];if(e.length>0)for(let t=0;t<e.length;t++)if(1==Array.isArray(e[t]))for(let r=0;r<e[t].length;r++)e[t][r].getComponent(d.default).setDark(!0)}}sortCodeByArray(e){let t=[],r=this.getPlayer(a.default.userName);for(let s=0;s<e.length;s++)for(let o=0;o<r.vectorCard.length;o++){let i=r.vectorCard[o].getComponent(d.default);e[s]==i.code&&t.push(i)}t.sort(this.compareValues("rank"));let o=[];for(let s=0;s<t.length;s++)o.push(t[s].code);return o}doGroupSelectedCard(){let e=[];if(0==this.playerGroups.length){for(let t=0;t<this.selectedArrC.length;t++)for(let r=0;r<this.currentCodeOrder.length;r++)this.currentCodeOrder[r]==this.selectedArrC[t].getComponent(d.default).code&&(e.push(this.currentCodeOrder[r]),this.currentCodeOrder.splice(r,1));e=[...this.sortCodeByArray(e)],this.playerGroups.push(e),this.playerGroups.push(this.currentCodeOrder)}else{for(let t=0;t<this.selectedArrC.length;t++)for(let r=0;r<this.playerGroups.length;r++)for(let o=0;o<this.playerGroups[r].length;o++)this.playerGroups[r][o]==this.selectedArrC[t].getComponent(d.default).code&&(e.push(this.playerGroups[r][o]),this.playerGroups[r].splice(o,1));e=[...this.sortCodeByArray(e)],this.playerGroups.unshift(e)}for(let r=0;r<this.playerGroups.length;r++)0==this.playerGroups[r].length&&this.playerGroups.splice(r,1);const t=this.getPlayer(a.default.userName);this.spliceArray(t.vectorCard,this.selectedArrC),e=[],e=this.selectedArrC.concat(t.vectorCard),t.vectorCard=[...e],this.reOrganizeCodeOrderByGroup();for(let r=0;r<this.playerGroups.length;r++)0==this.playerGroups[r].length&&this.playerGroups.splice(r,1);this.reOrganizeCardPosition(0);for(let r=0;r<this.selectedArrC.length;r++)t.vectorCard[r].getComponent(d.default).setTextureWithCode(this.currentCodeOrder[r]);this.selectedArrC=[],this.selectedCard=null,this.reSetZOrder()}doUnGroup(){if(this.playerGroups.length<2||this.selectedArrC.length<2)return;let e=this.checkGroupCard(this.selectedArrC[0]);if(null==e)return;let t=this.playerGroups[e];this.playerGroups.splice(e,1);let r=this.playerGroups[this.playerGroups.length-1];if(1==this.checkIsGroup(this.playerGroups.length-1))this.playerGroups.push(t);else for(let s=0;s<t.length;s++)r.push(t[s]);const o=this.getPlayer(a.default.userName);for(let s=0;s<this.selectedArrC.length;s++)for(let e=0;e<o.vectorCard.length;e++)this.selectedArrC[s]==o.vectorCard[e]&&(o.vectorCard.splice(e,1),o.vectorCard.push(this.selectedArrC[s]));this.reSetZOrder(),this.reOrganizeCodeOrderByGroup(),this.reOrganizeCardPosition(0),this.selectedCard=null,this.selectedArrC=[],this.updateGroupBanner()}showNoti(e){let t=cc.instantiate(this.show_noti).getComponent("ShowNoti");t.showContent(e),t.node.position=cc.v3(0,-70),t.node.zIndex=999,this.node.addChild(t.node)}setFrameGroupIcon(){for(let e=0;e<this.playerGroups.length-1;e++)1==this.checkEatSame(this.playerGroups[e])||1==this.checkEatStraight(this.playerGroups[e])?this.GroupIcons[e].getComponent("GroupIcon").setFrame(!0):this.GroupIcons[e].getComponent("GroupIcon").setFrame(!1)}handleXepBai(e){this.resetStateCardAndButton(),this.hideArrow();let t=!0;this.reOrganizeCardPosition(),this.updatePlayerPoint(),this.selectedArrC=[],this.selectedCard=null,this.buttonManager.enableAllButton(!1);const r=this.getPlayer(a.default.userName);for(let o=0;o<this.blackList.length;o++)r==this.blackList[o]&&(t=!1);1==t?this.buttonManager.showXepBai():this.buttonManager.showXepBaiBlackList();for(let o=0;o<this.players.length;o++){let t=this.players[o];t.vectorCard.length>0&&0==this.checkIfBlackList(t)&&t.setTurn(!0,e.time,!0)}1==this.checkIfBlackList(r)&&(this.btn_sort.getComponent(cc.Button).interactable=!1),this.buttonManager.node.runAction(cc.sequence(cc.delayTime(e.time),cc.callFunc(()=>{let e=this.getDeclareData();p.TongitsNetworkTransport.getInstance().sendTgUpdateCard(e)})))}handleBp(e){this.closeDialogFightConfirm();let t=this.getPlayerWithId(e.pid);this.blackList.push(t),e.pid==a.default.userId&&(this.btn_sort.getComponent(cc.Button).interactable=!1,this.hideArrow(),this.setDarkDumpedCard(0),this.buttonManager.activeAllButton(!1))}checkIfBlackList(e){for(let t=0;t<this.blackList.length;t++)if(e==this.blackList[t])return!0;return!1}getDeclareData(){let e=[];return this.playerGroups.length>1?e=this.playerGroups:e.push(this.currentCodeOrder),e}handleDeclare(e){let t=this.getPlayerWithId(e.pid);t.point=e.score,t.setTurn(!1),e.pid==a.default.userId&&(this.buttonManager.activeAllButton(!1),this.btn_sort.getComponent(cc.Button).interactable=!1)}updateGroupBanner(){const e=this.arrGroupBanner.length;for(let t=0;t<e;t++){let e=this.arrGroupBanner.pop();null!=e&&null!=e.node&&e.node.destroy()}for(let t=0;t<this.playerGroups.length;t++)this.showGroupBanner(t)}showGroupBanner(e){let t=cc.instantiate(this.group_banner).getComponent("ShowGroupBanner");this.node.addChild(t.node),t.node.zIndex=150,this.arrGroupBanner.push(t),this.setInfoGroupBanner(e,t)}setInfoGroupBanner(e,t){let r=[];const o=this.getPlayer(a.default.userName);for(let a=0;a<this.playerGroups[e].length;a++)for(let t=0;t<o.vectorCard.length;t++)if(o.vectorCard[t].getComponent(d.default).code==this.playerGroups[e][a]){let e=this.getPlayerCardPosition(o.vectorCard.length,t);r.push(e.x)}let s=this.findMinMax(r),i=this.checkIsGroup(this.playerGroups[e]),n=this.checkValidPhomPure(),l=this.checkGroupIncludeJoker(this.playerGroups[e]),c=this.checkDropedCard(),h=this.checkIsSpecified(this.playerGroups[e]),u=this.checkValidSpecified();if(null!=s&&this.playerGroups[e].length>=3){let r=(s.min+s.max)/2,o=s.max-s.min,a={posX:r,stret:Math.sqrt(Math.pow(o,2))+118.4,isTrue:i,gId:e,isJoker:l,isDroped:c,isSpecified:h,isValidSpecified:u,isValidPure:n};(e!=this.playerGroups.length-1||i)&&t.setInfo(a)}else null!=t&&null!=t.node&&t.node.destroy()}findMinMax(e){let t=e[0],r=e[0];for(let o=0;o<e.length;o++)e[o]>r&&(r=e[o]),e[o]<t&&(t=e[o]);return{min:t,max:r}}showArrow(){setTimeout(()=>{this.buttonManager.allowDraw(!0)},200),this.draw_arrow.node.active=!0,this.draw_arrow.node.zIndex=99,this.draw_arrow.node.stopAllActions(),this.draw_arrow.node.runAction(cc.repeatForever(cc.sequence(cc.moveTo(.3,cc.v2(-395,120)).easing(cc.easeCubicActionIn()),cc.moveTo(.3,cc.v2(-395,140)).easing(cc.easeCubicActionOut()))))}hideArrow(){this.buttonManager.allowDraw(!1),this.draw_arrow.node.active=!1,this.draw_arrow.node.stopAllActions(),this.draw_arrow.node.y=140,this.destroyHintArrow();let e=this.node.getChildByName("eatArrow");null!=e&&e.destroy()}handleFail(){this.showNoti("Hindi mo magagawa iyon"),cc.log("!> Failed",this.playerGroups,this.currentCodeOrder),this.resetStateCardAndButton()}resetStateCardAndButton(){this.reOrganizeCardPosition(0),this.buttonManager.enableAllButton(!1),this.selectedArrC=[],this.selectedCard=null,this.destroyHintArrow(),this.updateGroupBanner();for(let e=0;e<this.players.length;e++){let t=this.cardsOnDeck[e];if(t.length>0)for(let e=0;e<t.length;e++)if(1==Array.isArray(t[e]))for(let r=0;r<t[e].length;r++)t[e][r].getComponent(d.default).setDark(!0)}}showNumbOfCard(e,t){let r=cc.instantiate(this.numb_card).getComponent(f.default);this.node.addChild(r.node,u.GAME_ZORDER.Z_CARD,"NumbOfCard"),r.setInfo(e,t),this.CardNumb=r,this.bg_drop.active=!0}updateNumbOfCard(e,t,r){if(null!=this.CardNumb&&null!=this.CardNumb.node)switch(e){case 0:this.CardNumb.updateCardStack(t,r);break;case 1:case 2:this.CardNumb.updatePlayer(e,t,r)}}clearNumbOfCard(){if(null!=this.CardNumb&&void 0!==this.CardNumb){try{this.CardNumb.node.destroy()}catch(e){cc.log(e)}this.bg_drop.active=!1,this.CardNumb=null}}updatePlayerPoint(){setTimeout(()=>{this.player_point.node.parent.active=!0;let e=this.calculatePoint();cc.log("!>@ update point",e),this.player_point.string=e+"",this.checkAllowTongits()},500)}calculatePoint(){let e=0;cc.log("!>@?",this.codeValueArr);const t=this.getPlayer(a.default.userName);if(0==t.vectorCard.length)return 0;if(this.codeValueArr=[],t.vectorCard.forEach(e=>{this.codeValueArr.push(e.getComponent(d.default))}),this.playerGroups.length>0)for(let r=0;r<this.playerGroups.length;r++){let t=this.playerGroups[r];if(0==this.checkIsGroup(t)||t.length<3){cc.log("!>@? ",t);for(let r=0;r<t.length;r++)for(let o=0;o<this.codeValueArr.length;o++)t[r]==this.codeValueArr[o].code&&(14==this.codeValueArr[o].code.rank?e+=1:this.codeValueArr[o].code.rank==u.CODE_JOKER_BLACK||this.codeValueArr[o].code.rank==u.CODE_JOKER_RED?e+=0:this.codeValueArr[o].code.rank>=10?e+=10:e+=this.codeValueArr[o].code.rank)}}else for(let r=0;r<this.codeValueArr.length;r++)14==this.codeValueArr[r].code.rank?e+=1:this.codeValueArr[r].code.rank==u.CODE_JOKER_BLACK||this.codeValueArr[r].code.rank==u.CODE_JOKER_RED?e+=0:this.codeValueArr[r].code.rank>=10?e+=10:e+=this.codeValueArr[r].code.rank;return e}ShowEatHint(){if(this.removeDuplicate(this.spotEatCard()).length>2){let e=this.dumpedCardsArr[this.dumpedCardsArr.length-1],t=cc.instantiate(this.eat_arrow);t.position=cc.v3(e.x,140),this.node.addChild(t,99,"eatArrow"),t.stopAllActions(),t.runAction(cc.repeatForever(cc.sequence(cc.moveTo(.3,cc.v2(e.x,120)).easing(cc.easeCubicActionIn()),cc.moveTo(.3,cc.v2(e.x,140)).easing(cc.easeCubicActionOut()))))}}removeDuplicate(e){let t=[],r=[...e],o=0;for(;o<r.length;){for(let e=o+1;e<r.length;e++)r[o]==r[e]&&(r[e]=null);o++}for(let s=0;s<r.length;s++)null!=r[s]&&t.push(r[s]);return t}spotEatCard(){let e=[],t=[...this.codeValueArr],r=[],o=[],s=1,i=this.dumpedCardsArr[this.dumpedCardsArr.length-1].getComponent(d.default);for(t.push(i),t.sort(this.compareValues("suit")),t.sort(this.compareValues("rank"));t.length>0;){let r=this.spotSameKindGroup(t,0);r.arrCode.length>=3?(e.push(r.arrCode),this.spliceArray(t,r.arrCard)):(o.push(t[0].code),t.splice(0,1))}for(let n=0;n<e.length;n++)for(let t=0;t<e[n].length;t++)if(e[n][t]==i.code){r=[...e[n]];break}for(e=[],t=[],o=[],s=1,(t=[...this.codeValueArr]).push(i),t.sort(this.compareValues("suit")),t.sort(this.compareValues("rank"));t.length>0;){let r=this.spotStraightGroup(t,0);r.arrCode.length>=3?(e.push(r.arrCode),this.spliceArray(t,r.arrCard)):(o.push(t[0].code),t.splice(0,1))}for(let n=0;n<e.length;n++)for(let t=0;t<e[n].length;t++)if(e[n][t]==i.code){if(0==r.length)r=[...e[n]];else for(let t=0;t<e[n].length;t++)r.push(e[n][t]);break}return r}showOtherResult(e){this.showOtherScore(e),this.clearNumbOfCard();for(let t=0;t<e.length;t++)this.showOtherPlayerCard(e[t])}showOtherPlayerCard(e){let t=this.getPlayerWithId(e.pid);if(!t)return;let r=t.indexDynamic;if(e.pid!=a.default.userId){let o=[],s=e.arr;const i=this.cardsOnDeck[r].length;let n=t.vectorCard.length;for(let e=0;e<n;e++){let e=t.vectorCard.pop();this.cardPool.put(e.node)}for(let e=0;e<s.length;e++){if(this.convertCodeToIndex(s[e]).index>=0)continue;let t=[],n=(s[e].length,this.cardsOnDeck[r].length);for(let a=0;a<s[e].length;a++){let l=this.spawncard();l.node.setScale(.3),l.node.position=this.getHandPosition(r),l.setTextureWithCode(s[e][a],!0);let c=this.setDropedCardPosition(r,a,n,!0,i);cc.tween(l.node).to(.4,{position:c},{easing:"quadInOut"}).start(),t.push(l.node),l.node.zIndex=e,(0==e&&0==a||e==s.length-1&&a==s[e].length-1)&&o.push(c.x)}this.cardsOnDeck[r].push(t)}cc.log("thang",t.user_name,"set xong",t.vectorCard),cc.log("deo biet la gi ",this.cardsOnDeck[r])}}showBurnAni(e){let t=cc.instantiate(this.burn_ani);t.zIndex=99,this.node.addChild(t);let r=t.getChildByName("skeleton");r.position=e,r.getComponent(sp.Skeleton).setAnimation(0,"animation",!1),setTimeout(()=>{t.destroy()},3e3)}checkIsGroup(e){let t=[];if(0==e.length)return!1;for(let o=0;o<e.length;o++)for(let r=0;r<this.codeValueArr.length;r++){let s=this.codeValueArr[r];e[o]==s.code&&t.push(s)}t.sort(this.compareValues("rank"));let r=this.spotSameKindGroup(t,0,!0);return this.spotStraightGroup(t,0).arrCode.length==e.length||r.arrCode.length==e.length}showOtherScore(e){for(let t=0;t<e.length;t++){let r=this.getPlayerWithId(e[t].pid);if(r&&e[t].pid!=a.default.userId){if(1==r.indexDynamic){let r=this.other_score[0].node.getChildByName("score");this.other_score[0].node.active=!0,this.other_score[0].node.zIndex=99,r.getComponent(cc.Label).string="score: "+e[t].Score}if(2==r.indexDynamic){let r=this.other_score[1].node.getChildByName("score");this.other_score[1].node.active=!0,this.other_score[1].node.zIndex=99,r.getComponent(cc.Label).string="score: "+e[t].Score}}}}hideOtherScore(){for(let e=0;e<=1;e++)this.other_score[e].node.active=!1}highLightPlayerArea(e){for(let t=0;t<this.players.length;t++)t==e?1==this.canFight?this.setPlayerDumpedCardDark(t,!1):this.setPlayerDumpedCardDark(t,!0):(this.hight_light_player_turn[t].node.active=!1,this.setPlayerDumpedCardDark(t,!0))}setDarkDumpedCard(e){for(let t=0;t<this.dumpedCardsArr.length-e;t++){let r=this.dumpedCardsArr[t];if(!r)return void cc.log("get card in setDarkDumpedCard err in type = ",e);r.getComponent(d.default).setDark(!0)}}setPlayerDumpedCardDark(e,t){let r=this.cardsOnDeck[e];if(r.length>0)for(let o=0;o<r.length;o++)if(1==Array.isArray(r[o]))for(let e=0;e<r[o].length;e++){let s=r[o][e].getComponent(d.default);s.setDark(t),s.setDark(!0)}}showScHint(){this.destroyHintArrow();for(let e=0;e<this.players.length;e++){let t=this.cardsOnDeck[e];if(t.length>0)for(let e=0;e<t.length;e++)if(1==Array.isArray(t[e]))if(1==this.checkCanGui(t[e]))this.hightLightHintSc(t[e]),cc.log("!> show hintttttt",t[e],this.checkCanGui(t[e]));else for(let r=0;r<t[e].length;r++)t[e][r].getComponent(d.default).setDark(!0)}}checkCanGui(e){let t=[];if(0==this.selectedArrC.length)return!1;for(let s=0;s<e.length;s++){let r=e[s].getComponent(d.default);t.push(r)}for(let s=0;s<this.selectedArrC.length;s++){let e=this.selectedArrC[s].getComponent(d.default);t.push(e)}t.sort(this.compareValues("rank"));let r=this.spotSameKindGroup(t,0),o=this.spotStraightGroup(t,0);return r.arrCode.length==t.length&&t.length>2||o.arrCode.length==t.length&&t.length>2}hightLightHintSc(e){let t=[];if(0==e.length||null==e)return;let r=0;for(let n=0;n<e.length;n++){let o=e[n].getComponent(d.default);r=o.node.y,o.turnHightLightYellow(!0),t.push(o.node.x)}let o=this.findMinMax(t),s=(o.max+o.min)/2,i=cc.instantiate(this.eat_arrow);i.position=cc.v3(s,r+40),this.node.addChild(i,100),this.hintScArray.push(i),i.stopAllActions(),i.runAction(cc.repeatForever(cc.sequence(cc.moveTo(.3,cc.v2(s,r+20)).easing(cc.easeCubicActionIn()),cc.moveTo(.3,cc.v2(s,r+40)).easing(cc.easeCubicActionOut()))))}showWaitAni(){}hideWaitAni(){this.wait_ani.node.active=!1}showStartAni(){}showDimond(e){for(let r=0;r<3;r++)this.icon_dimond[r].node.active=!1;if(null==e)return;this.icon_dimond[e].node.active=!0;let t=this.hitPot_ani.node.getChildByName("dimond");null!=t&&(t.active=!0)}destroyHintArrow(){let e=this.hintScArray.length;for(let t=0;t<e;t++){let e=this.hintScArray.pop();null!=e&&e.destroy()}this.hintScArray=[]}moveCardPosition(){const e=this.getPlayer(a.default.userName);for(let t=0;t<e.vectorCard.length;t++){let r=this.getPlayerCardPosition(e.vectorCard.length,t),o=e.vectorCard[t];o!=this.selectedCard&&(cc.tween(o.node).to(.2,{position:cc.v3(r.x,o.node.y)},{easing:"quadInOut"}).start(),this.updateGroupBanner())}this.reSetZOrder()}cardSwap(e,t){const r=this.getPlayer(a.default.userName);let o=r.vectorCard[e];r.vectorCard[e]=r.vectorCard[t],r.vectorCard[t]=o}showCardOnHandTitle(e){let t=this.node.getChildByName("cardOnHand");try{t.x=(e[1]+e[0])/2,cc.log("!>??????? show card onhand title",t.x,e),t.active=!0,t.zIndex=u.GAME_ZORDER.Z_CARD+20}catch(r){cc.log("!>??????? show card on hand title",r)}}closeDialogFightConfirm(){}updatePositionPlayerView(){let e=null,t=null;for(let r=0;r<3;r++)if(1==this.icon_dimond[r].node.active){e=r,this.icon_dimond[r].node.active=!1;break}if(null!=e)for(let r=0;r<this.players.length;r++)this.players[r].indexDynamic==e&&(t=this.players[r].user_name);cc.log("!> relocate dimond position");for(let r=0;r<this.players.length;r++)this.players[r].user_name==t&&(this.icon_dimond[this.players[r].indexDynamic].node.active=!0);this.getPlayer(a.default.userName).setPosMyThanhBar()}checkGroupIncludeJoker(e){return e.findIndex(e=>e.rank==u.CODE_JOKER_BLACK||e.rank==u.CODE_JOKER_RED)>=0}checkDropedCard(){return this.cardsOnDeck[0].length>0&&this.cardsOnDeck[0][0].length>0}checkIsSpecified(e){let t=[];if(0==e.length)return!1;for(let o=0;o<e.length;o++)for(let r=0;r<this.codeValueArr.length;r++){let s=this.codeValueArr[r];e[o]==s.code&&t.push(s)}t.sort(this.compareValues("rank"));let r=this.spotSameKindGroup(t,0,!0);return this.spotStraightGroup(t,0).arrCode.length==e.length&&e.length>=5||r.arrCode.length==e.length&&e.length>=4&&!this.checkGroupIncludeJoker(e)}checkValidSpecified(){for(let e=0;e<this.playerGroups.length;e++)if(this.checkIsSpecified(this.playerGroups[e]))return!0;return!1}checkAllowTongits(){let e=this.calculatePoint(),t=this.currenPlayer.user_name==a.default.userName,r=this.buttonManager.isDeclare(),o=this.checkValidPhomPure(),s=this.checkDropedCard();this.buttonManager.activeTongits(0==e&&t&&!r&&(o||s))}checkValidPhomPure(){for(let e=0;e<this.playerGroups.length;e++){let t=this.playerGroups[e];if(0==t.length)continue;let r=[];for(let e=0;e<t.length;e++)for(let o=0;o<this.codeValueArr.length;o++){let s=this.codeValueArr[o];t[e]==s.code&&t[e].rank!=u.CODE_JOKER_BLACK&&t[e].rank!=u.CODE_JOKER_RED&&r.push(s)}let o=this.checkValidPhomOnGroup(r),s=this.checkGroupIncludeJoker(t);r.sort(this.compareValues("rank"));let i=this.spotSameKindGroup(r,0,!0),n=this.spotStraightGroup(r,0).arrCode.length==t.length||i.arrCode.length==t.length;if(o&&!s||o&&s&&!n)return!0}return!1}checkValidPhomOnGroup(e){for(var t={},r=0;r<e.length;r++){var o=e[r].code.rank;if(o==u.CODE_JOKER_BLACK||o==u.CODE_JOKER_RED)for(let e=2;e<14;e++)t[e]=t[e]?t[e]+1:1;else t[o]=t[o]?t[o]+1:1}for(const i in t)if(t[i]>=3)return!0;let s=[...e];for(s.sort(this.compareValues("rank"));s.length>0;){if(this.spotStraightGroup(s,0).arrCode.length>=3)return!0;s.shift()}return!1}onQuit(){y.BannerData.setBannerData(i.Banner.ShowType.LEFT_MATCH,!0,i.Game.Enum.TONGITS),p.TongitsNetworkTransport.onQuit()}};_.instance=null,s([b(cc.Prefab)],_.prototype,"show_noti",void 0),s([b(cc.Prefab)],_.prototype,"result_table",void 0),s([b(cc.Prefab)],_.prototype,"fight_scene",void 0),s([b(cc.Prefab)],_.prototype,"numb_card",void 0),s([b(cc.Prefab)],_.prototype,"card",void 0),s([b(cc.Prefab)],_.prototype,"eat_arrow",void 0),s([b(cc.Prefab)],_.prototype,"burn_ani",void 0),s([b(cc.Prefab)],_.prototype,"group_banner",void 0),s([b(cc.Prefab)],_.prototype,"tongits_scene",void 0),s([b(cc.Prefab)],_.prototype,"coin_hitpot",void 0),s([b(cc.Label)],_.prototype,"lbMatchInfo",void 0),s([b(cc.Sprite)],_.prototype,"pot",void 0),s([b(cc.Button)],_.prototype,"btn_sort",void 0),s([b(cc.Node)],_.prototype,"game_buttons",void 0),s([b(cc.Sprite)],_.prototype,"draw_arrow",void 0),s([b(cc.Label)],_.prototype,"player_point",void 0),s([b(sp.Skeleton)],_.prototype,"wait_ani",void 0),s([b(sp.Skeleton)],_.prototype,"start_ani",void 0),s([b(sp.Skeleton)],_.prototype,"hitPot_ani",void 0),s([b([cc.Sprite])],_.prototype,"other_score",void 0),s([b([cc.Sprite])],_.prototype,"icon_dimond",void 0),s([b([cc.Sprite])],_.prototype,"hight_light_player_turn",void 0),s([b(cc.Sprite)],_.prototype,"gameName",void 0),s([b(cc.Node)],_.prototype,"bg_drop",void 0),s([b([g.default])],_.prototype,"players",void 0),_=o=s([m],_),r.TongitsController=_,cc._RF.pop()},{"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/language/LanguageController":void 0,"./ButtonManager":"ButtonManager","./CardTongits":"CardTongits","./ShowNumbOfCard":"ShowNumbOfCard","./TongitsConst":"TongitsConst","./TongitsNetworkTransport":"TongitsNetworkTransport","./TongitsPlayer":"TongitsPlayer"}],TongitsDataModel:[function(e,t,r){"use strict";cc._RF.push(t,"04d1ev919pEkp4eyyCTF8Va","TongitsDataModel"),Object.defineProperty(r,"__esModule",{value:!0}),r.TimeoutData=r.CardMessage=r.PotData=r.PlayCardData=r.DealData=r.UpdateTableData=r.CardData=r.TimeoutDataContent=r.PlayCardDataContent=r.TurnDataContent=r.Hand=r.Card=r.GameDataContent=r.Table=r.Pot=r.ChipUpdates=r.PlayerInfo=r.baseData=void 0;class o{constructor(e={}){this.data=e.data||null,this.match_id=e.match_id||"",this.op_code=e.op_code||0,this.reliable=e.reliable||!1}}r.baseData=o,r.PlayerInfo=class{constructor(e={}){this.id=e.id||"",this.avatarId=e.avatarId||"",this.userName=e.userName||"",this.wallet=Number(e.wallet||"0"),this.isPlaying=e.isPlaying||!1,this.cards=e.cards||[],this.vipLevel=Number(e.vipLevel||"0")}},r.ChipUpdates=class{constructor(e={}){this.chip=Number(e.chip||0),this.userid=e.userid||""}};class s{constructor(e={}){this.ChipUpdates=e.ChipUpdates||[],this.ag=Number(e.ag||"0"),this.uidWinLastMatch=e.uidWinLastMatch||""}}r.Pot=s;class i{constructor(e={}){this.gameState=e.gameState||0,this.joinPlayers=e.joinPlayers||[],this.leavePlayers=e.leavePlayers||[],this.players=e.players||[],this.playingPlayers=e.playingPlayers||[],this.pot=e.pot||new s}}r.Table=i;class n{constructor(e={}){this.hand=e.hand||null,this.isUpdatePlayerHand=e.isUpdatePlayerHand||!1,this.isUpdateTable=e.isUpdateTable||!1,this.isUpdateTurn=e.isUpdateTurn||!1,this.playerTurn=e.playerTurn||"",this.table=e.table||new i,this.remainTime=e.remainTime||"0",this.timePlay=e.timePlay||"0"}}r.GameDataContent=n;class a{constructor(e={}){this.rank=e.rank||0,this.suit=e.suit||0}}r.Card=a;class l{constructor(e={}){this.cards=e.cards||[],this.userId=e.userId||""}}r.Hand=l;class c{constructor(e={}){this.currentTurn=e.currentTurn||"",this.hand=e.hand||new l,this.timeturn=e.timeturn||0}}r.TurnDataContent=c;class h{constructor(e={}){this.card=e.card||new a,this.nextTurn=e.nextTurn||"",this.userId=e.userId||""}}r.PlayCardDataContent=h;class d{constructor(e={}){this.timeout=e.timeout||0}}r.TimeoutDataContent=d;class u{constructor(e={}){this.isFight=!1,this.card=e.card||new a,this.userid=e.userid||""}}r.CardData=u,r.UpdateTableData=class extends o{constructor(e={}){super(e),this.data=e.data||new n}},r.DealData=class extends o{constructor(e={}){super(e),this.data=e.data||new c}},r.PlayCardData=class extends o{constructor(e={}){super(e),this.data=e.data||new h}},r.PotData=class extends o{constructor(e={}){super(e),this.data=e.data||new s}},r.CardMessage=class extends o{constructor(e={}){super(e),this.data=e.data||new u}},r.TimeoutData=class extends o{constructor(e={}){super(e),this.data=e.data||new d}},cc._RF.pop()},{}],TongitsHandleCardThrow:[function(e,t,r){"use strict";cc._RF.push(t,"3a45eWUXmBIuriy7rTp3wN+","TongitsHandleCardThrow");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const s=e("./TongitsController"),i=cc.v2(149,200),n=(cc.size(950,220),cc.size(950,430),cc.size(950,650),cc.v2(.4,.4)),{ccclass:a,property:l}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.bkg_Black=null,this.TongitsController=null,this.sizeBkg=null,this.bkg_posInGameView=null}onLoad(){this.sizeBkg=this.bkg_Black.getContentSize(),this.bkg_Black.setScale(0),this.bkg_posInGameView=this.TongitsController.node.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(this.bkg_Black.position))}start(){}onShowCardThrow(){let e=this.TongitsController.listCardNoc;this.initListPos(e)}initListPos(e){let t=e.length,r=this.TongitsController.cardNoc.position,o=t>11?710/t:i.x*n.x;for(let s=0;s<t;s++){let t=cc.v2(r.x+o*s,r.y);e[s].node.stopAllActions(),e[s].node.runAction(cc.moveTo(.2,t))}}resetCard(e,t){0===t?(e.node.skewX=6,e.node.skewY=6,e.node.rotation=5):(e.node.skewX=8,e.node.skewY=8,e.node.rotation=8)}turnOffCardThrow(){let e=this.TongitsController.listCardNoc;this.bkg_Black.stopAllActions();for(let t=0;t<e.length;t++){let r=e[t];r.node.stopAllActions(),r.node.runAction(cc.moveTo(.1,cc.v2(this.node.position)))}}};o([l(cc.Node)],c.prototype,"bkg_Black",void 0),o([l(s.TongitsController)],c.prototype,"TongitsController",void 0),c=o([a],c),r.default=c,cc._RF.pop()},{"./TongitsController":"TongitsController"}],TongitsMockup:[function(e,t,r){"use strict";cc._RF.push(t,"9e4895vdZVOhbhSk70iT0d3","TongitsMockup");var o,s=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const i=e("../../lobby/src/common/User"),n=e("./TongitsDataModel"),a=e("./TongitsNetworkTransport"),l=["e3c51037-d52e-4cb2-9ebd-678357991a0c","3f08fad6-2359-4de3-aab1-e5d61e2c8875"],c=["haonv9901","haonv9902"],{ccclass:h,property:d}=cc._decorator;let u=o=class extends cc.Component{static Draw(){const e=o.drawCards.pop(),t=new n.CardData({card:e,userid:o.currentTurn});let r=new n.CardMessage({data:t,op_code:a.OP_CODE_RESPONSE.TAKE_CARD});a.TongitsNetworkTransport.getInstance().matchDataHandler(r)}clickDump(){o.Draw(),o.dump()}static dump(){const e=o.players.find(e=>e.info.id===o.currentTurn);o.currentTurn=l.find(e=>e!==o.currentTurn);const t=e.info.cards.pop(),r=new n.PlayCardDataContent({card:t,nextTurn:o.currentTurn,userId:e.info.id});let s=new n.PlayCardData({data:r,op_code:a.OP_CODE_RESPONSE.DISCARD});a.TongitsNetworkTransport.getInstance().matchDataHandler(s)}reset(){o.currentTurn=i.default.userId,o.dumpCards=[],o.drawCards=[];for(let e=0;e<4;e++)for(let t=1;t<=13;t++)o.drawCards.push({rank:t,suit:e});for(let e=o.drawCards.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[o.drawCards[e],o.drawCards[t]]=[o.drawCards[t],o.drawCards[e]]}o.players=[{info:new n.PlayerInfo({id:i.default.userId,userName:i.default.userName,wallet:"20000",isPlaying:!1,cards:o.drawCards.splice(0,13),avatarId:"0",vipLevel:"0"}),groupCard:[]},{info:new n.PlayerInfo({id:l.find(e=>e!==i.default.userId),userName:c.find(e=>e!==i.default.userName),wallet:"20000",isPlaying:!1,cards:o.drawCards.splice(0,13),avatarId:"0",vipLevel:"0"}),groupCard:[]}]}chiaBai(){this.reset();const e=new n.Hand({cards:o.players[0].info.cards,userId:i.default.userId}),t=new n.TurnDataContent({currentTurn:o.currentTurn,hand:e,timeturn:12}),r=new n.DealData({data:t,op_code:a.OP_CODE_RESPONSE.DEAL});a.TongitsNetworkTransport.getInstance().matchDataHandler(r)}joinTable(){const e=[new n.PlayerInfo({id:l.find(e=>e!==i.default.userId),userName:c.find(e=>e!==i.default.userName),wallet:"20000",isPlaying:!1,cards:[],avatarId:"0",vipLevel:"0"})],t=o.players.map(e=>e.info),r=new n.Pot({ChipUpdates:[{chip:2e3,userid:"e3c51037-d52e-4cb2-9ebd-678357991a0c"},{chip:2e3,userid:"3f08fad6-2359-4de3-aab1-e5d61e2c8875"}],ag:"200",uidWinLastMatch:""}),s=new n.Table({gameState:1,joinPlayers:e,leavePlayers:[],players:t,playingPlayers:[],pot:r}),h=new n.GameDataContent({hand:null,isUpdatePlayerHand:!1,isUpdateTable:!0,isUpdateTurn:!1,playerTurn:i.default.userId,table:s,remainTime:"30",timePlay:"120"}),d=new n.UpdateTableData({data:h,op_code:a.OP_CODE_RESPONSE.UPDATE_TABLE});a.TongitsNetworkTransport.getInstance().matchDataHandler(d)}};u.players=[],u.currentTurn="",u.dumpCards=[],u.drawCards=[],u=o=s([h],u),r.default=u,cc._RF.pop()},{"../../lobby/src/common/User":void 0,"./TongitsDataModel":"TongitsDataModel","./TongitsNetworkTransport":"TongitsNetworkTransport"}],TongitsNetworkTransport:[function(e,t,r){"use strict";cc._RF.push(t,"69938oLzqpAa6084NDhTWYv","TongitsNetworkTransport"),Object.defineProperty(r,"__esModule",{value:!0}),r.TongitsNetworkTransport=r.OP_CODE_RESPONSE=void 0;const o=e("../../lobby/src/common/ConfigClient"),s=e("../../lobby/src/common/Constants"),i=e("../../lobby/src/network/NetworkClient"),n=e("../../lobby/src/common/User"),a=e("../../lobby/src/common/GlobalApp"),l=e("../../lobby/src/chat/ChatPresenter"),c=e("./TongitsController"),h=e("../../lobby/src/lobby/GameList");var d;(function(e){e[e.UNDEFINE=0]="UNDEFINE",e[e.UPDATE_TABLE=1]="UPDATE_TABLE",e[e.DEAL=2]="DEAL",e[e.FINISH=3]="FINISH",e[e.TONGITS=4]="TONGITS",e[e.UPDATE_GAME_STATE=5]="UPDATE_GAME_STATE",e[e.UPDATE_WALLET=7]="UPDATE_WALLET",e[e.KICK_OFF_THE_TABLE=8]="KICK_OFF_THE_TABLE",e[e.UPDATE_USER_INFO=9]="UPDATE_USER_INFO",e[e.DISCARD=10]="DISCARD",e[e.SEND_CARD=11]="SEND_CARD",e[e.SHOW_SUIT=12]="SHOW_SUIT",e[e.HIT_CARD=13]="HIT_CARD",e[e.TAKE_CARD=15]="TAKE_CARD",e[e.UPDATE_POT=14]="UPDATE_POT",e[e.DECLARE=16]="DECLARE",e[e.FIGHT=17]="FIGHT",e[e.FIGHT_RESPONSE=18]="FIGHT_RESPONSE"})(d=r.OP_CODE_RESPONSE||(r.OP_CODE_RESPONSE={}));class u{sendTgUpdateCard(e){throw new Error("Method not implemented.")}sendTgEc(e,t){i.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,d.HIT_CARD,{cards:e.map(e=>({rank:e.rank,suit:e.suit})),userid:n.default.userId}).then(e=>{console.log("sendBet success ",e)},e=>{console.log("sendBet err",e)})}sendTgSc(e,t,r){throw new Error("Method not implemented.")}sendExitGame(){throw new Error("Method not implemented.")}sendTgTongits(e){i.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,d.TONGITS,{suits:e.map(e=>e.map(e=>({rank:e.rank,suit:e.suit})))}).then(e=>{console.log("sendBet success ",e)},e=>{console.log("sendBet err",e)})}sendTgDeclare(e){i.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,d.DECLARE,{suits:e.map(e=>e.map(e=>({rank:e.rank,suit:e.suit})))}).then(e=>{console.log("sendBet success ",e)},e=>{console.log("sendBet err",e)})}sendTgDc(e){i.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,d.DISCARD,{userid:n.default.userId,cards:{rank:e.rank,suit:e.suit}}).then(e=>{console.log("sendBet success ",e)},e=>{console.log("sendBet err",e)})}sendTgFight(){i.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,d.FIGHT,{userid:n.default.userId}).then(e=>{console.log("sendBet success ",e)},e=>{console.log("sendBet err",e)})}sendTgHc(e){i.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,d.SHOW_SUIT,{ShowSuit:e.map(e=>({rank:e.rank,suit:e.suit})),userid:n.default.userId}).then(e=>{console.log("sendBet success ",e)},e=>{console.log("sendBet err",e)})}sendTgBc(){i.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,d.TAKE_CARD,{}).then(e=>{console.log("sendBet success ",e)},e=>{console.log("sendBet err",e)})}static getInstance(){return null==this.instance&&(this.instance=new u),this.instance}subscribe(){i.default.getInstance().subscribeEventHandler(s.Game.Enum.TONGITS,u.getInstance())}matchDataHandler(e){switch(e.op_code){case d.UPDATE_TABLE:console.log("OPCODE_UPDATE_TABLE",e.data),c.TongitsController.getInstance().updateTable(e.data);break;case d.DEAL:console.log("OPCODE_DEAL",e.data),c.TongitsController.getInstance().handleDealCard(e.data);break;case d.DISCARD:console.log("OPCODE_DISCARD",e.data),c.TongitsController.getInstance().handleDc(e.data);break;case d.TAKE_CARD:console.log("OPCODE_TAKE_CARD",e.data),c.TongitsController.getInstance().handleBc(e.data);break;case d.DECLARE:console.log("DECLARE",e.data),c.TongitsController.getInstance().updateTable(e.data);break;default:console.log("Data code not found ",e)}}processUpdateGameState(e){switch(e.data.state){case s.Game.GAME_STATE.PREPARE:case s.Game.GAME_STATE.RUN:break;case s.Game.GAME_STATE.REWARD:console.log("GAME_STATE.REWARD",e);break;case s.Game.GAME_STATE.FINISH:break;default:console.log("Match state not found ",e)}}sendBet(e){i.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,o.default.Network.OP_CODE_REQUEST.OPCODE_BET,e).then(e=>{console.log("sendBet success ",e)},e=>{console.log("sendBet err",e)})}getUsers(){i.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,o.default.Network.OP_CODE_REQUEST.OPCODE_LIST_USERS,{}).then(()=>{console.log("list users ")},e=>{console.log("get list users failed",e)})}static onQuit(e=(()=>{})){i.default.getInstance().leaveMatch(a.default.getInstance().matchInfo.match_id).then(t=>{cc.log("leave match: ",t),l.default.getInstance().leaveChat(),cc.sys.isBrowser&&o.default.AppInfo.WEB_NATIVE?(e(),window.location.href="/"):a.default.getInstance().loadSceneByMainBundle(o.default.AppInfo.SCENE_NAME.GAMELIST,()=>{var t;e(),null===(t=h.default.getInstance())||void 0===t||t.setGameType(s.GameType.Enum.TABLE_GAME),c.TongitsController.getInstance().node.destroy()})},()=>{cc.log("err when leave match")})}}r.TongitsNetworkTransport=u,u.instance=null,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/lobby/GameList":void 0,"../../lobby/src/network/NetworkClient":void 0,"./TongitsController":"TongitsController"}],TongitsPlayer:[function(e,t,r){"use strict";cc._RF.push(t,"4803fD88ixNdYmRgeLlJYjr","TongitsPlayer");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const s=e("../../lobby/src/common/GlobalApp"),i=e("../../lobby/src/common/Utils"),{ccclass:n,property:a}=cc._decorator;let l=class extends cc.Component{constructor(){super(...arguments),this.avatar=null,this.border=null,this.lbName=null,this.lbChip=null,this.animDraw=null,this.animLose=null,this.animWin=null,this.fontPlus=null,this.fontSub=null,this.user_name="",this.indexDynamic=-1,this.vectorCard=[],this.diamond=0,this.point=0}isTurn(){return!0}setData(e){this.id=e.id||"",this.user_name=e.userName||"",this.wallet=e.wallet,this.avatar_id=e.avatarId,this.vipLevel=Number(e.vipLevel),this.avatar.spriteFrame=s.default.getInstance().getAvatarById(this.avatar_id),this.border.spriteFrame=s.default.getInstance().getAvatarBorderByVip(this.vipLevel),this.setName(e.userName),this.lbChip.string=i.default.formatBetNumber(Number(e.wallet)||0,100)}getInfo(){return{id:this.id,user_name:this.user_name,wallet:this.wallet,avatar_id:this.avatar_id,vipLevel:this.vipLevel,sid:this.sid}}effLbName(){if(this.lbName.node.stopAllActions(),this.lbName.node.position=cc.v3(0,0),this.lbName.node.width>this.lbName.node.parent.width-10){let e=(this.lbName.node.width-this.lbName.node.parent.width)/2,t=e/30,r=cc.moveTo(t,e,0),o=cc.moveTo(t,-e,0);if(t<1&&(t=1),e<3)return;this.lbName.node.anchorX=.5,this.lbName.node.x=-e,this.lbName.node.runAction(cc.repeatForever(cc.sequence(cc.delayTime(1.5),r,cc.delayTime(1.5),o)))}}setName(e){null!==this.lbName&&(this.lbName.string=e),this.scheduleOnce(()=>{this.effLbName()},.1)}getId(){return this.id}showEffectWinLose(e){let t=()=>{};0===e?(this.animDraw.node.active=!0,this.animDraw.animation="animation",t=()=>{this.scheduleOnce(()=>{this.animDraw.node.active=!1},2)}):1===e?(this.animWin.node.active=!0,this.animWin.animation="win",t=()=>{this.scheduleOnce(()=>{this.animWin.node.active=!1},2)}):(this.animLose.node.active=!0,this.animLose.animation="lose",t=()=>{this.scheduleOnce(()=>{this.animLose.node.active=!1},2)}),t()}showEffectFlyMoney2(e,t=50,r=50,o=0,s=0){if("number"!=typeof e||0==e)return;let n="",a=null;if(e>=0?(n="+",a=this.fontPlus):(n="-",a=this.fontSub),null==this.node)return;let l=new cc.Node("TextFly"),c=l.addComponent(cc.Label);c.string=n+i.default.formatMoney(Math.abs(e)),c.fontSize=t,c.font=a,l.position=cc.v3(o,s),this.node.addChild(l);let h=cc.moveBy(4,cc.v2(0,r)),d=cc.delayTime(h.getDuration()-.5),u=cc.fadeOut(h.getDuration()-d.getDuration()),p=cc.spawn(h,cc.sequence(d,u)),g=cc.sequence(p,cc.callFunc(()=>{null!==c.node&&c.node.destroy()}));c.node.runAction(g)}showEffectFlyMoney(e,t=50,r=50,o=0,s=0){if("number"!=typeof e||0==e)return;let n="",a=null;if(e>=0?(n="+",a=this.fontPlus):(n="-",a=this.fontSub),null==this.node)return;let l=new cc.Node("TextFly"),c=l.addComponent(cc.Label);c.string=n+i.default.formatMoney(Math.abs(e)),c.fontSize=t,c.font=a,l.position=this.node.position.add(cc.v3(o,s)),this.node.addChild(l);let h=cc.moveBy(4,cc.v2(0,r)),d=cc.delayTime(h.getDuration()-.5),u=cc.fadeOut(h.getDuration()-d.getDuration()),p=cc.spawn(h,cc.sequence(d,u)),g=cc.sequence(p,cc.callFunc(()=>{null!==c.node&&c.node.destroy()}));c.node.runAction(g)}updateWallet(e){this.lbChip.string=i.default.formatBetNumber(e,100),this.lbChip.node.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1)))}setTurn(e,t=0,r=!1){}effectFlDiamond(e){}setPosMyThanhBar(){}showPlayerInfo(){}};o([a(cc.Sprite)],l.prototype,"avatar",void 0),o([a(cc.Sprite)],l.prototype,"border",void 0),o([a(cc.Label)],l.prototype,"lbName",void 0),o([a(cc.Label)],l.prototype,"lbChip",void 0),o([a(sp.Skeleton)],l.prototype,"animDraw",void 0),o([a(sp.Skeleton)],l.prototype,"animLose",void 0),o([a(sp.Skeleton)],l.prototype,"animWin",void 0),o([a(cc.Font)],l.prototype,"fontPlus",void 0),o([a(cc.Font)],l.prototype,"fontSub",void 0),l=o([n],l),r.default=l,cc._RF.pop()},{"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/Utils":void 0}],TongitsScene:[function(e,t,r){"use strict";cc._RF.push(t,"362b7CTCstKCoEFOFLQgO7l","TongitsScene");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.dark_bg=null,this.tongits_ani=null,this.challenger=null,this.challenger_ava=null,this.challenger_name=null,this.currentFighterDIndex=null}onLoad(){this.currentFighterDIndex=null}startScene(e){this.tongits_ani.setAnimation(0,"animation",!1),this.dark_bg.node.opacity=0,this.dark_bg.node.runAction(cc.fadeTo(.4,240)),this.challenger_ava.node.getComponent("AvatarItem").loadTexture(e.avatar_id,e.pname,e.fid,e.vip);let t=e._displayName;t.length>15&&(t=t.substr(0,15)+"..."),this.challenger_name.string=t,this.currentFighterDIndex=e._indexDynamic,setTimeout(()=>{this.node&&this.node.destroy()},4e3)}};o([i(cc.Button)],n.prototype,"dark_bg",void 0),o([i(sp.Skeleton)],n.prototype,"tongits_ani",void 0),o([i(cc.Node)],n.prototype,"challenger",void 0),o([i(cc.Sprite)],n.prototype,"challenger_ava",void 0),o([i(cc.Label)],n.prototype,"challenger_name",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}]},{},["AvatarItem","ButtonManager","CardShan","CardTongits","Coin","FightScene","FinishTable","GroupIcon","ItemBetView","PlayerInfoT","PotView","ShowGroupBanner","ShowNoti","ShowNumbOfCard","ShowPlayerAva","TongitsBtnLabel","TongitsConst","TongitsController","TongitsDataModel","TongitsHandleCardThrow","TongitsMockup","TongitsNetworkTransport","TongitsPlayer","TongitsScene"]);