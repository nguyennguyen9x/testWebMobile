window.__require=function t(i,e,n){function s(l,a){if(!e[l]){if(!i[l]){var h=l.split("/");if(h=h[h.length-1],!i[h]){var r="function"==typeof __require&&__require;if(!a&&r)return r(h,!0);if(o)return o(h,!0);throw new Error("Cannot find module '"+l+"'")}l=h}var c=e[l]={exports:{}};i[l][0].call(c.exports,function(t){return s(i[l][1][t]||t)},c,c.exports,t,i,e,n)}return e[l].exports}for(var o="function"==typeof __require&&__require,l=0;l<n.length;l++)s(n[l]);return s}({NoelConstants:[function(t,i,e){"use strict";cc._RF.push(i,"d7e9fijbFtOL5qLPE1eb3qL","NoelConstants"),Object.defineProperty(e,"__esModule",{value:!0}),e.SixiangGame=e.BigWin=e.Symbol=e.SPEED_AUTO=e.SPEED_NORMAL=e.RECT_SIZE=e.TIME_RUN_SPIN_AUTO=e.TIME_RUN_SPIN_NORMAL=e.IDANIM_ITEM8=e.IDANIM_ITEM9=e.IDANIM_ITEM10=e.IDANIM_SCATTER=e.IDANIM_WILD=e.SPRITE_STOP=e.SPRITE_FREESPIN=e.SPRITE_SPIN=e.ZINDEX_LINE=e.ZINDEX_ITEMANIM=void 0,e.ZINDEX_ITEMANIM=30,e.ZINDEX_LINE=10,e.SPRITE_SPIN=0,e.SPRITE_FREESPIN=1,e.SPRITE_STOP=2,e.IDANIM_WILD=0,e.IDANIM_SCATTER=1,e.IDANIM_ITEM10=4,e.IDANIM_ITEM9=3,e.IDANIM_ITEM8=2,e.TIME_RUN_SPIN_NORMAL=2500,e.TIME_RUN_SPIN_AUTO=1800,e.RECT_SIZE=cc.v2(165,129),e.SPEED_NORMAL=.15,e.SPEED_AUTO=.1,e.Symbol={8:0,2:1,16:2,4:3,4608:4,4609:5,4610:7,4611:6,4626:8,4625:9,4624:10,65535:11,512:12},e.BigWin={0:0,5:0,10:2,25:1,50:3},e.SixiangGame={SI_XIANG_GAME_NORMAL:1,SI_XIANG_GAME_NOEL_FREE_GAME:301},cc._RF.pop()},{}],NoelController:[function(t,i,e){"use strict";cc._RF.push(i,"b5662+/w2VGh5pwWmvati6n","NoelController");var n,s=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,l=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,i,e,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(l=(o<3?s(l):o>3?s(i,e,l):s(i,e))||l);return o>3&&l&&Object.defineProperty(i,e,l),l};Object.defineProperty(e,"__esModule",{value:!0});const o=t("../../lobby/src/common/Constants"),l=t("../../lobby/src/common/Utils"),a=t("../../lobby/src/language/LanguageController"),h=t("../../lobby/src/dialogs/banner/BannerDialog"),r=t("../../lobby/src/common/User"),c=t("../../lobby/src/common/GlobalApp"),m=t("../../lobby/src/dialogs/shop/ShopDialog"),p=t("../../lobby/src/dialogs/option/OptionDialog"),d=t("../../lobby/src/chat/ChatPresenter"),u=t("./NoelRuleDialog"),f=t("./NoelNetworkTransport"),g=t("./NoelItemAnimation"),S=t("./NoelItem"),A=t("./NoelConstants"),{ccclass:I,property:b}=cc._decorator;let y=n=class extends cc.Component{constructor(){super(...arguments),this.bg_slot=null,this.itemAnim=null,this.listItemMiniResult=[],this.listSprBtn=[],this.animMask=null,this.sprAtlas=null,this.blackMask=null,this.parentItemNode=null,this.itemMiniResult=null,this.bkg_mid=null,this.bkg_Top=null,this.bkg_Bottom=null,this.btn_Spin=null,this.lb_markBet=null,this.lb_ChipWinRound=null,this.lb_Chip=null,this.lb_Result=null,this.lb_info=null,this.lb_titleWin=null,this.lb_TypeMark=null,this.lb_numLine1=null,this.lb_numLine2=null,this.text_spin=null,this.anim_chip_win=null,this.itemSlot=null,this.noel_items=[],this.itemAnimSlotNoelPrefab=null,this.speedSpinAnim=null,this.slotNoelAnims=[],this.faKindAnim=null,this.freeSpinAnim=null,this.bigMegaAnim=null,this.freeSpinVienBgAnim=null,this.freeSpinBgAnim=null,this.freeNumAnim=null,this.count=0,this.clickSpinCount=0,this.listLineRect=[],this.listPosRect=[],this.listOriginItem=[],this.listCheckStopCol=[!1,!1,!1,!1,!1],this.listColor=["#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE","#920E48","#F277E2","#BC8B15","#AC6456","#E17512","#E8C500","#F0E915","#FD93A1","#C735D4","#FF0C04","#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE","#920E48","#F277E2","#BC8B15","#AC6456","#E17512","#E8C500","#F0E915","#FD93A1","#C735D4","#FF0C04","#69C4C9","#067048","#25A0F0","#6AF28E","#003CC3","#1DC42C","#6C58B1","#97B158","#0F0098","#6700BE"],this.winningLine=[],this.listWinLineNode=[],this.listItemAnim=[],this.listDataAnimLine=[],this.listSpriteId=[],this.listPosItem=[cc.v2(95,227),cc.v2(280,227),cc.v2(466,227),cc.v2(652,227),cc.v2(834,227)],this.listAnimWS=[],this.listAnimBkgFree=[],this.skeData=[],this.listIndexSpr=[],this.listCollum=[],this.listMarkBet=[],this.listScatter=[],this.payLine=[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[0,0,1,2,2],[2,2,1,0,0],[1,0,1,2,1],[1,2,1,0,1],[1,0,0,1,0],[1,2,2,1,2],[0,1,0,0,1],[2,1,2,2,1],[0,2,0,2,0],[2,0,2,0,2],[1,0,2,0,1],[1,2,0,2,1],[0,1,1,1,0],[2,1,1,1,2],[0,2,2,2,0]],this.countUpVip=0,this.speedSpin=A.SPEED_NORMAL,this.agPlayer=0,this.markIndex=0,this.winType=0,this.firstDelay=2,this.scatterCount=0,this.totalWin=0,this.startNum=0,this.endNum=0,this.deltaNum=0,this.timeShow=0,this.curNum=0,this.curJackPotNum=0,this.jackPotEndNum=0,this.timeHoldSpin=0,this.totalAgFSP=0,this.spinCountCheck=0,this.timeRunSpin=0,this.curChip=0,this.initPosItem=null,this.initHeightItem=0,this.resetPosY1=0,this.resetPosY2=0,this.resetPosY3=0,this.posAnimSpeedX=0,this.freeSpinLeft=0,this.curMarkBet=0,this.playerVip=0,this.timeShowBigMega=0,this.countWild=0,this.idMini=-1,this.isClickSpin=!1,this.isHoldSpin=!1,this.isRunJPNum=!1,this.isRunEffPlusMoney=!1,this.isHaveFiveOfaKind=!1,this.isCheckScatterItem3=!1,this.isAutoSpin=!1,this.isHave2Scatter=!1,this.isStop=!0,this.isShowBigWin=!1,this.isShowHugeWin=!1,this.isCountFSPAg=!1,this.canSpin=!1,this.isStarted=!1,this.isFreeSpin=!1,this.isSpinFree=!1,this.isCountAgFreeSpin=!1,this.isWildWinInLine=!1,this.listItem=[],this.firstAnim=null,this.lb_Money=null,this.animBtnSpin=null,this.blackMaskBig=null,this.lbFreeAnim=null,this.finishData=null,this.finishView=[],this.numPerSec=0}static getInstance(){return this.instance}update(t){this.isHoldSpin&&(this.timeHoldSpin+=t,this.timeHoldSpin>=1&&this.isStop&&(this.onClickAutoSpin(),this.setStateSpinBtn(),this.isHoldSpin=!1,this.timeHoldSpin=0))}start(){n.instance=this,f.default.subscribe(),d.default.getInstance().joinChatRoom(c.default.getInstance().matchInfo.match_id,this),h.default.show(o.Game.Enum.NOEL),this.bkg_mid.opacity=0,this.bkg_Bottom.opacity=0,this.bkg_Top.opacity=0,this.initPosItem=cc.v2(this.parentItemNode.width/10,this.parentItemNode.height/2),this.animBtnSpin=this.btn_Spin.node.getChildByName("ItemAnimation").getComponent(g.default),this.blackMaskBig=this.node.getChildByName("bkg_black"),this.btn_Spin.node.on("touchstart",t=>{this.btn_Spin.node.getBoundingBoxToWorld().contains(t.getLocation())&&(this.timeHoldSpin=0,this.isHoldSpin=!0)}),this.btn_Spin.node.on("touchend",t=>{this.isHoldSpin&&(this.btn_Spin.node.getBoundingBoxToWorld().contains(t.getLocation())&&(this.isHoldSpin=!1,this.timeHoldSpin<1&&this.onClickSpin()),this.timeHoldSpin=0)})}onEnable(){this.lb_TypeMark.string=a.default.getInstance().getString("txt_pok_to"),this.lb_titleWin.string=a.default.getInstance().getString("txt_win")}startEffect(){this.bkg_Top.stopAllActions(),this.bkg_Bottom.stopAllActions(),this.bkg_mid.stopAllActions(),this.bkg_Top.runAction(cc.sequence(cc.fadeTo(.5,255),cc.delayTime(.01))),this.bkg_Bottom.runAction(cc.sequence(cc.fadeTo(.5,255),cc.delayTime(.01))),this.bkg_mid.runAction(cc.sequence(cc.fadeTo(.5,255),cc.callFunc(()=>{this.canSpin=!0})))}handleCTable(t){var i,e,n,s;if(this.isStarted){t.slotViews=[];for(let i=0;i<t.matrix.cols;i++){let e=[];for(let n=0;n<t.matrix.lists.length;n++)n%t.matrix.cols===i&&e.push(A.Symbol[t.matrix.lists[n]]);t.slotViews.push(e)}this.handleSpin(Object.assign(Object.assign({},t),{freeSpinLeft:Number(t.numSpinLeft)>=0||Number(null===(i=null==t?void 0:t.gameConfig)||void 0===i?void 0:i.numFreeSpin)?Number(t.numSpinLeft)>0?Number(t.numSpinLeft):Number(null===(e=null==t?void 0:t.gameConfig)||void 0===e?void 0:e.numFreeSpin):0,freeSpin:t.currentSixiangGame===A.SixiangGame.SI_XIANG_GAME_NOEL_FREE_GAME,isFreeSpin:t.nextSixiangGame===A.SixiangGame.SI_XIANG_GAME_NOEL_FREE_GAME,winType:A.BigWin[t.bigWin],agWin:t.gameReward.totalChipsWinByGame}))}else{this.isStarted=!0,t.views=[];for(let i=0;i<t.matrix.cols;i++){let e=[];for(let n=0;n<t.matrix.lists.length;n++)n%t.matrix.cols===i&&e.push(A.Symbol[t.matrix.lists[n]]);t.views.push(e)}this.initItemSlot(t.views),this.freeSpinLeft=Number(t.numSpinLeft)>=0||Number(null===(n=null==t?void 0:t.gameConfig)||void 0===n?void 0:n.numFreeSpin)?Number(t.numSpinLeft)>0?Number(t.numSpinLeft):Number(null===(s=null==t?void 0:t.gameConfig)||void 0===s?void 0:s.numFreeSpin):0,this.isFreeSpin=t.nextSixiangGame===A.SixiangGame.SI_XIANG_GAME_NOEL_FREE_GAME,this.lb_numLine1.string=this.payLine.length.toString(),this.lb_numLine2.string=this.payLine.length.toString(),this.listMarkBet=[],this.freeSpinLeft>0&&0===this.listAnimBkgFree.length&&this.showAnimBkgFreeSpin(),this.setStateSpinBtn(),this.lb_ChipWinRound.string=t.gameReward.totalChipsWinByGame.toString(),this.agPlayer=Number(t.gameReward.balanceChipsWalletAfter),this.listMarkBet=t.betLevels,this.curMarkBet=Number(t.chipsMcb);for(let i=0;i<t.betLevels.length;i++)if(Number(t.betLevels[i])===Number(t.chipsMcb)){this.markIndex=i;break}this.lb_markBet.string=l.default.formatNumber(this.curMarkBet),this.lb_Chip.string=l.default.formatNumber(this.agPlayer),this.playerVip=r.default.vipLevel}}initItemSlot(t){let i=0;this.listCollum=[];for(let e=0;e<this.listItem.length;e++)this.listItem[e].destroy();this.listItem=[];for(let e=0;e<15;e++){let n=cc.instantiate(this.itemSlot).getComponent(S.default),s=cc.instantiate(this.itemSlot).getComponent(S.default),o=cc.instantiate(this.itemSlot).getComponent(S.default);if(this.initHeightItem=n.node.height,n.node.position=cc.v3(this.listPosItem[i].x,this.initPosItem.y,0),this.parentItemNode.addChild(n.node),n.typeItem=1,n.numCol=i,n.setSpriteListItem(t[i]),this.resetPosY1=this.initPosItem.y,3===i){let t=this.parentItemNode.convertToWorldSpaceAR(n.node.position);this.posAnimSpeedX=this.bkg_mid.convertToNodeSpaceAR(t).x}s.node.position=cc.v3(n.node.x,n.node.position.y+n.node.height,0),this.parentItemNode.addChild(s.node),s.typeItem=2,s.numCol=i,s.setSpriteListItem(t[i]),this.resetPosY2=s.node.position.y,o.node.position=cc.v3(n.node.x,s.node.position.y+s.node.height,0),this.parentItemNode.addChild(o.node),o.typeItem=3,o.numCol=i,o.setSpriteListItem(t[i]),this.resetPosY3=o.node.position.y;let l=[];l.push(n.node,s.node,o.node),this.listCollum.push(l),this.listItem.push(n.node,s.node,o.node),i++,e+=2}this.startEffect(),this.initItemAnim()}initItemAnim(){for(let t=0;t<5;t++){let t=cc.instantiate(this.itemAnimSlotNoelPrefab).getComponent(g.default);this.node.addChild(t.node,A.ZINDEX_ITEMANIM),t.node.active=!1,this.listItemAnim.push(t)}this.firstAnim=cc.instantiate(this.itemAnimSlotNoelPrefab).getComponent(g.default),this.node.addChild(this.firstAnim.node,A.ZINDEX_ITEMANIM),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null}onClickSpin(t,i){if((this.canSpin||this.isAutoSpin)&&!(this.clickSpinCount>1)&&(this.isStop||!this.isFreeSpin)){if(this.lb_titleWin.string=this.isFreeSpin?a.default.getInstance().getString("txt_total_win"):a.default.getInstance().getString("txt_last_win"),this.clickSpinCount>0)return this.isAutoSpin=!1,this.setStateSpinBtn(),void(this.isStop&&this.resetForNextSpin());if((0===this.listMarkBet.length||this.agPlayer<this.listMarkBet[0])&&this.freeSpinLeft<=0)return this.lb_info.string=a.default.getInstance().getString("not_enought_gold"),this.text_spin.active=!1,void c.default.getInstance().alertDialog.showMessage(a.default.getInstance().getString("txt_not_enough_money_gl"));this.isSpinFree=this.isFreeSpin,this.playSoundEff("clickspin"),this.isFreeSpin?(0===this.listAnimBkgFree.length&&this.showAnimBkgFreeSpin(),void 0!==this.finishData&&(this.lbFreeAnim?this.lbFreeAnim.string=this.finishData.freeSpinLeft+" "+a.default.getInstance().getString("txt_freespin"):this.showAnimFreeNum())):(this.curChip=this.agPlayer,l.default.runNumber(this.lb_Chip,this.curChip-this.curMarkBet,1),this.agPlayer-=this.curMarkBet,this.curChip=this.agPlayer),this.clickSpinCount++,f.default.sendSpin({chips:this.curMarkBet}),this.isStop=!1,this.setStateSpinBtn(),this.blackMask.active=!1;for(let t=0;t<this.listCheckStopCol.length;t++)this.listCheckStopCol[t]=!1;this.lb_info.node.active=!0,this.lb_info.string=a.default.getInstance().getString("txt_playing_lines").replace("%d","20"),this.text_spin.active=!1,this.playSoundEff("wheelspin"),this.listCollum.forEach((t,i)=>{t.forEach(t=>{let e=t.getComponent(S.default);cc.Tween.stopAllByTarget(t);var n=()=>{if(e.typeItem--,this.listCheckStopCol[i]||e.numCol!=i){if(this.listCheckStopCol[i]&&e.numCol==i){let n=0;e.typeItem<0&&(t.y=this.resetPosY2,e.typeItem=2,e.setSpriteListItem(this.finishView[i],!1),this.listOriginItem.push(t)),0==e.typeItem&&(t.y=this.resetPosY3,e.typeItem=3),this.isAutoSpin,2==i&&this.isCheckScatterItem3&&(this.speedSpin=A.SPEED_AUTO,n=1,this.firstAnim&&this.firstAnim.node&&(this.setInfoAnim(this.firstAnim,this.speedSpinAnim,cc.v3(this.posAnimSpeedX,20),cc.v3(1,1)),this.firstAnim.node.parent=this.bkg_mid,this.firstAnim.node.zIndex=this.parentItemNode.zIndex+1,this.firstAnim.playAnimation2("animation",!0))),e.setSpriteListItem(e.listIdView,!1),cc.tween(t).to(.2,{y:t.y-this.initHeightItem},{easing:cc.easing.backOut}).delay(this.isCheckScatterItem3?n:0).call(()=>{this.listCheckStopCol[i+1]=!0,this.playSoundEff("stopspin"),this.canSpin=!1}).call(()=>{4==i&&2==e.typeItem&&(this.getOriginItem(),this.winningLine.forEach(t=>{this.initLineWin(t.lineWin,t.color)}),this.checkWildWinInLine(),this.acShowWinLine(),this.freeSpinLeft>0&&(0===this.listAnimBkgFree.length?this.showAnimBkgFreeSpin():this.lbFreeAnim.string=this.freeSpinLeft+" Sisa Putaran Gratis")),e.typeItem--,3==i&&this.isCheckScatterItem3&&(this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null),this.isAutoSpin||(this.listCheckStopCol[i+1]=!0)}).start()}}else{e.typeItem<0&&(t.y=this.resetPosY2,e.typeItem=2,this.isCheckScatterItem3&&e.numCol>2&&e.setRandomId(!1));let s=this.speedSpin;4==i&&!this.isAutoSpin&&this.isCheckScatterItem3&&(s=A.SPEED_NORMAL),cc.tween(t).to(s,{y:t.y-this.initHeightItem}).call(n).start()}};cc.tween(t).to(.15,{y:e.node.position.y+60},{easing:cc.easing.sineOut}).call(()=>{e.setSpriteListItem(e.listIdView,!0)}).to(this.speedSpin,{y:t.y-this.initHeightItem}).call(n).start()})})}}setStateSpinBtn(t=null){let i;switch(this.isStop?i=this.isFreeSpin?"freespinOn":"spinOn":(i=this.isAutoSpin?"autoSpin":"spinOff",i=this.isFreeSpin?"freespinOff":i),null!==t&&(i=t),i){case"spinOn":this.animBtnSpin.playAnimation2("autospin2");break;case"spinOff":this.animBtnSpin.node.active=!0,this.animBtnSpin.playAnimation2("autospin2");break;case"freespinOn":case"freespinOff":this.animBtnSpin.node.active=!0,this.animBtnSpin.playAnimation2("freespin2");break;case"autoSpin":this.animBtnSpin.node.active=!0,this.animBtnSpin.playAnimation2("stop2")}}onClickAutoSpin(){console.log("SlotINCA:on click auto spin"),this.isAutoSpin=!this.isAutoSpin,this.setStateSpinBtn(),this.isStop&&(this.speedSpin=A.SPEED_AUTO,this.onClickSpin())}handleSpin(t){console.log("HandleSpin: ",t),this.finishData=t,this.finishView=t.slotViews,this.isCheckScatterItem3=!1,this.finishView[1].includes(12)&&this.finishView[2].includes(12)&&(this.isCheckScatterItem3=!0),this.getLineWin(t),this.scheduleOnce(()=>{this.node&&this.onStopSpin()},.5),this.totalWin=Number(t.gameReward.totalChipsWinByGame),this.totalAgFSP=Number(t.gameReward.totalChipsWinByGame),this.agPlayer=Number(t.gameReward.balanceChipsWalletAfter),this.freeSpinLeft=t.freeSpinLeft,this.winType=t.winType,this.freeSpinLeft=t.freeSpinLeft,this.isFreeSpin=0!==t.freeSpinLeft,this.isCountAgFreeSpin=this.isFreeSpin,this.listMarkBet=t.betLevels,this.curMarkBet=Number(t.chipsMcb);for(let i=0;i<t.betLevels.length;i++)if(Number(t.betLevels[i])===Number(t.chipsMcb)){this.markIndex=i;break}this.freeSpinLeft<=0&&(this.lb_markBet.string=l.default.formatNumber(this.curMarkBet),this.isSpinFree=!1)}showAnimScatter(){this.playSoundEff("wildscatter");for(let t=0;t<this.listScatter.length;t++){let i=this.listScatter[t],e=this.getAnimFromPool(this.listAnimWS);this.setInfoAnim(e,this.slotNoelAnims[12],i.pos,.8),this.node.addChild(e.node),e.playAnimation2("animation",!0)}}setInfoAnim(t,i,e,n,s=!1,o=!1){t.node.active=!0,t.node.zIndex=A.ZINDEX_ITEMANIM,"number"==typeof n?t.animation.node.setScale(n):t.animation.node.setScale(n.x,n.y),t.node.position=cc.v3(e.x,e.y,0),t.initAnimation(i),t.node.getChildByName("lb_Money").active=o}showAnimOneWinLine(){if(this.blackMaskBig.active=!1,this.btn_Spin.interactable=!this.isAutoSpin,0===this.listWinLineNode.length||this.isAutoSpin&&this.listWinLineNode.length>1)return this.canSpin=!0,this.setStateSpinBtn(),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.firstAnim.node.getChildByName("lb_Money").active=!1,void this.resetForNextSpin();if(this.isAutoSpin?this.canSpin=!0:this.scheduleOnce(()=>{this.node&&(this.canSpin=!0,this.setStateSpinBtn())},.5),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.firstAnim.node.getChildByName("lb_Money").active=!1,2===this.clickSpinCount)return;let t=this.listWinLineNode.length,i=cc.callFunc(()=>{(this.isAutoSpin||this.finishData.freeSpin&&0!==this.finishData.freeSpinLeft)&&this.resetForNextSpin()});for(let e=0;e<t;e++)this.node.runAction(cc.sequence(cc.delayTime(1.5*e),cc.callFunc(()=>{for(let e=0;e<this.listWinLineNode.length;e++)this.listWinLineNode[e].node.active=!1;this.playSoundEff("showline"),this.turnOffAnim(),this.turnOffMiniResult();for(let e=0;e<this.listIndexSpr.length;e++)this.listOriginItem[e].getComponent(S.default).setStateSpr(this.listIndexSpr[e],!0);this.listIndexSpr=[];for(let e=0;e<this.listLineRect.length;e++)this.listLineRect[e].active=!1;let t=this.winningLine[e].lineWin;this.listPosRect=[];let i=[],n=[];for(let e=0;e<t.length;e++){let s=this.listOriginItem[e].getComponent(S.default),o=t[e],l=s.getWordPosItem(s.listItem[o]);n.push(l);let a=s.listIdView[o];i.push(a)}this.idMini=-1,this.showListAnim(n,i,this.winningLine[e].color,this.winningLine[e].pays,t)}),cc.delayTime(1.07),i))}showAllWinLine(){if(this.updateMoney(),this.blackMaskBig.active=!1,0!==this.listWinLineNode.length&&(this.blackMask.active=!0),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.listWinLineNode.length>1)for(let t=0;t<this.listWinLineNode.length;t++)this.node.runAction(cc.sequence(cc.delayTime(A.SPEED_NORMAL*t),cc.callFunc(()=>{this.listWinLineNode[t].node.active=!0})));this.turnOffAnim(),this.turnOffMiniResult(),this.isStop=!0}showAnim5OfAkind(){this.blackMaskBig.active=!0,this.firstAnim.node.active=!0,this.firstAnim.animation.skeletonData=null,this.setInfoAnim(this.firstAnim,this.faKindAnim,cc.v3(0,0),cc.v3(1,1)),this.firstAnim.node.parent=this.node,this.firstAnim.node.zIndex=900,this.firstAnim.playAnimation2("animation",!0)}showAnimFreeSpin(){this.playSoundEff("freespin"),this.blackMaskBig.active=!0,this.turnOffAnim(),this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.setStateSpinBtn(),this.setInfoAnim(this.firstAnim,this.freeSpinAnim,cc.v3(0,0),cc.v3(1,1)),this.firstAnim.node.parent=this.node,this.firstAnim.node.zIndex=900,this.firstAnim.playAnimation2("cam",!0)}showAnimAllWild(){this.playSoundEff("wildscatter");let t=[];for(let i=0;i<this.winningLine.length;i++){let e={lineWinId:[],lineWin:[]},n=this.winningLine[i].lineWinId;n.includes(11)&&(e.lineWinId=n,e.lineWin=this.winningLine[i].lineWin),t.push(e)}for(let i=0;i<t.length;i++){let e=t[i],n=this.checkIndexToShowAnim(e.lineWinId);for(let t=0;t<=n;t++){let i=this.listOriginItem[t].getComponent(S.default);if(11===e.lineWinId[t]){let n=i.getWordPosItem(i.listItem[e.lineWin[t]]),s=this.getAnimFromPool(this.listAnimWS);this.setInfoAnim(s,this.slotNoelAnims[11],n,.8),this.node.addChild(s.node,A.ZINDEX_ITEMANIM),s.playAnimation2("animation",!0)}}}}showAnimBigWin(){this.playSoundEff("bigwin"),this.blackMaskBig.active=!0,this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.setInfoAnim(this.firstAnim,this.bigMegaAnim,cc.v3(0,0),cc.v3(1,1)),this.firstAnim.node.parent=this.node,this.firstAnim.node.zIndex=900,this.firstAnim.playAnimation2("big2",!0);let t=this.firstAnim.node.getChildByName("lb_Money");this.firstAnim.node.getChildByName("lb_Money").active=!0,t.opacity=255,t.scale=.8,this.lb_Money=t.getComponent(cc.Label),this.lb_Money.node.position=cc.v3(0,-180,0);let i=Number(this.finishData.gameReward.totalChipsWinByGame);this.createEffNumRun(t.getComponent(cc.Label),0,i,this.timeShowBigMega-1),t.runAction(cc.sequence(cc.scaleTo(this.timeShowBigMega-1,1.2),cc.scaleTo(.5,1).easing(cc.easeBackOut()),cc.delayTime(.1),cc.scaleTo(.1,0)))}showAnimHugeWin(){this.playSoundEff("megawin"),this.blackMaskBig.active=!0,this.firstAnim.node.active=!1,this.firstAnim.animation.skeletonData=null,this.setInfoAnim(this.firstAnim,this.bigMegaAnim,cc.v3(0,0),cc.v3(1,1)),this.firstAnim.node.parent=this.node,this.firstAnim.node.zIndex=900,this.firstAnim.playAnimation2("mega2",!0);let t=this.firstAnim.node.getChildByName("lb_Money");t.active=!0,t.opacity=255,this.lb_Money=t.getComponent(cc.Label),this.lb_Money.fontSize=80,this.lb_Money.node.position=cc.v3(0,-180,0);let i=Number(this.finishData.gameReward.totalChipsWinByGame);this.createEffNumRun(t.getComponent(cc.Label),0,i,this.timeShowBigMega-1),t.runAction(cc.sequence(cc.scaleTo(this.timeShowBigMega-1,1.2),cc.scaleTo(.5,1).easing(cc.easeBackOut()),cc.delayTime(.1),cc.scaleTo(.1,0)))}showAnimBkgFreeSpin(){let t=this.bkg_mid.getChildByName("bg_spin").zIndex-1,i=this.getAnimFromPool(this.listAnimBkgFree);this.setInfoAnim(i,this.freeSpinBgAnim,cc.v3(0,0),cc.v3(cc.winSize.height/1280*1,.75)),this.bkg_mid.addChild(i.node,t),i.playAnimation2("animation",!0);let e=this.getAnimFromPool(this.listAnimBkgFree);this.setInfoAnim(e,this.freeSpinVienBgAnim,cc.v3(0,0),cc.v3(.98,.98)),this.bkg_mid.addChild(e.node),e.playAnimation2("animation",!0),this.showAnimFreeNum()}showAnimFreeNum(){let t=this.parentItemNode.zIndex+1,i=this.getAnimFromPool(this.listAnimBkgFree);this.setInfoAnim(i,this.freeNumAnim,cc.v3(0,254),cc.v3(.9,1),!0),this.lbFreeAnim=i.node.getChildByName("lb_Money").getComponent(cc.Label),this.lbFreeAnim.node.position=cc.v3(0,0,0),this.lbFreeAnim.node.active=!0;let e=this.freeSpinLeft;this.lbFreeAnim.string=e+" "+a.default.getInstance().getString("txt_freespin"),this.lbFreeAnim.node.color=new cc.Color(252,255,0,255),this.lbFreeAnim.useSystemFont=!0,this.lbFreeAnim.fontSize=35,this.lbFreeAnim.lineHeight=35,this.node.addChild(i.node,t),i.playAnimation2("animation",!0)}onStopSpin(){this.listOriginItem=[],this.listCheckStopCol[0]=!0,this.isCheckScatterItem3,this.timeRunSpin}onClickBack(){p.default.show(this,p.DialogPosition.LEFT)}getOriginItem(){this.listScatter=[];for(let t=0;t<this.listItem.length;t++){let i=this.listItem[t].getComponent(S.default);i.node.position.y>this.initPosItem.y-100&&i.node.position.y<this.initPosItem.y+10?i.getScatterItem():i.setRandomId(!1)}this.isHave2Scatter=this.scatterCount>1}initLineWin(t,i){let e=[];for(let n=0;n<t.length;n++){let i=this.listOriginItem[n].getComponent(S.default),s=i.getWordPosItem(i.listItem[t[n]]);e.push(s)}this.drawLine(e,i)}getLineWin(t){t.paylines.forEach(i=>{let e={lineWin:[],lineWinId:[],color:null,pays:null},n=i.indices.map(i=>A.Symbol[t.matrix.lists[i]]);e.lineWin=this.payLine[Number(i.id)-1],e.color=this.listColor[this.getRanNum(0,this.listColor.length-1)],e.pays=Number(i.chips),e.lineWinId=n,this.winningLine.push(e)}),this.checkFiveOfaKind()}acShowWinLine(){if(!this.isFreeSpin&&(this.totalAgFSP>=20*this.curMarkBet&&(this.isShowBigWin=!0),this.totalAgFSP>=50*this.curMarkBet&&(this.isShowHugeWin=!0),this.finishData.freeSpin)){for(let t=0;t<this.listAnimBkgFree.length;t++)this.listAnimBkgFree[t].node.destroy();this.listAnimBkgFree=[]}!this.isFreeSpin&&this.finishData.freeSpin&&(this.totalWin=this.totalAgFSP),this.finishData.freeSpin?this.lb_ChipWinRound.string=l.default.formatNumber(this.totalAgFSP):this.lb_ChipWinRound.string=l.default.formatNumber(this.totalWin),0===this.finishData.agWin||this.finishData.freeSpin||(this.lb_titleWin.string=a.default.getInstance().getString("txt_win")),this.finishData.freeSpin&&(this.lb_titleWin.string=a.default.getInstance().getString("txt_total_win"));let t=0,i=0,e=1.5*this.listWinLineNode.length,n=0,s=0,o=0,h=0;this.listWinLineNode.length>1&&(h=this.listWinLineNode.length*A.SPEED_NORMAL+.7),this.isHaveFiveOfaKind&&(s=2),(this.isWildWinInLine||this.isHave2Scatter)&&(o=1.3);let r=[100,101,102];r.includes(this.winType)&&(n=2),((r=[1,101]).includes(this.winType)&&!this.finishData.freeSpin||this.isShowBigWin)&&(t=3),((r=[2,102]).includes(this.winType)&&!this.finishData.freeSpin||this.isShowHugeWin)&&(t=0,i=6),this.timeShowBigMega=t+i;let c=cc.callFunc(()=>{this.showAllWinLine()}),m=cc.callFunc(()=>{this.node.runAction(cc.repeatForever(cc.sequence(cc.callFunc(()=>{this.showAnimOneWinLine()}),cc.delayTime(e))))}),p=cc.callFunc(()=>{this.isHave2Scatter&&this.showAnimScatter()}),d=cc.callFunc(()=>{this.isHaveFiveOfaKind&&this.showAnim5OfAkind()}),u=cc.callFunc(()=>{[100,101,102].includes(this.winType)&&this.showAnimFreeSpin()}),f=cc.callFunc(()=>{this.isWildWinInLine&&this.showAnimAllWild()}),g=cc.callFunc(()=>{([1,101].includes(this.winType)&&!this.finishData.freeSpin||this.isShowBigWin)&&this.showAnimBigWin()}),S=cc.callFunc(()=>{([2,102].includes(this.winType)&&!this.finishData.freeSpin||this.isShowHugeWin)&&this.showAnimHugeWin()}),I=cc.sequence(p,f,cc.delayTime(o),c,cc.delayTime(h),u,cc.delayTime(n),d,cc.delayTime(s),g,cc.delayTime(t),S,cc.delayTime(i),m);this.node.runAction(I),this.lb_info.node.active=!1}drawLine(t,i){let e=this.createLine(i);e.moveTo(t[0].x-90,t[0].y),e.lineTo(t[0].x,t[0].y);let n=t.length;for(let s=1;s<n;s++)e.lineJoin=cc.Graphics.LineJoin.ROUND,e.lineTo(t[s].x,t[s].y);e.lineTo(t[n-1].x+90,t[n-1].y),e.stroke(),e.node.active=!1,this.listWinLineNode.push(e)}drawLineLast(t,i){let e=this.createLine(i),n=this.getCrossPoint(t[0],t[1]);e.moveTo(n.x,n.y);let s=t.length;for(let o=1;o<s;o++)e.lineJoin=cc.Graphics.LineJoin.ROUND,e.lineTo(t[o].x,t[o].y);e.lineTo(t[s-1].x+90,t[s-1].y),e.stroke(),this.listLineRect.push(e.node)}createLine(t,i,e=5){let n=(new cc.Node).addComponent(cc.Graphics);return n.lineWidth=e,n.lineCap=cc.Graphics.LineCap.ROUND,n.strokeColor=(new cc.Color).fromHEX(t),n.node.active=!0,this.node.addChild(n.node,A.ZINDEX_LINE),i&&(n.node.zIndex=A.ZINDEX_ITEMANIM+1),n}showListAnim(t,i,e,n,s){console.log("showListAnim",t);let o=this.checkIndexToShowAnim(i);for(let l=0;l<=o;l++){this.showItemAnim(l,t[l],i[l],n,s),this.turnOffItemSpr(l,s[l]);let a=t[l],h=!1;if(o<4&&l===o&&(h=!0),l+1<=o&&(t[l].y>t[l+1].y+290||t[l].y<t[l+1].y-290)){let i=this.getCrossPoint(t[l],t[l+1]),n=this.getCrossPoint(t[l+1],t[l]),s=this.createLine(e);s.moveTo(i.x,i.y),s.lineTo(n.x,n.y),s.stroke(),this.listLineRect.push(s.node)}this.drawRect(a,e,h,o,t)}}turnOffItemSpr(t,i){this.listIndexSpr.push(i),this.listOriginItem[t].getComponent(S.default).setStateSpr(i,!1)}getCrossPoint(t,i){let e=t.y>i.y?-1:1,n=cc.v2(t.x-A.RECT_SIZE.x,t.y+A.RECT_SIZE.y/2*e),s=cc.v2(n.x+A.RECT_SIZE.x,n.y);return Math.abs(t.y-i.y)<1&&(n=cc.v2(t.x+A.RECT_SIZE.x/2,t.y+A.RECT_SIZE.y/2),s=cc.v2(t.x+A.RECT_SIZE.x/2,t.y-A.RECT_SIZE.y/2)),l.default.pIntersectPoint(n,s,t,i)}checkIndexToShowAnim(t){let i=0,e=t[0];for(let n=1;n<t.length;n++)if(11!==e){if(t[n]!==e&&11!==t[n])break;i++}else e=t[n],i++;return i}showItemAnim(t,i,e,n,s){this.setItemMiniResult(e,t,n);let o=this.listItemAnim[t],l=1;12==e&&(l=.8),o.initAnimation(this.noel_items[e]),o.node.position=cc.v3(i.x,i.y,0),o.node.active=!0,o.animation.node.scale=l,o.playAnimation2("animation",!0)}setItemMiniResult(t,i,e){if(11!==t){this.idMini=t;for(let e=0;e<i;e++)this.listItemMiniResult[e].spriteFrame=this.sprAtlas.getSpriteFrame(t.toString())}11===t&&-1!==this.idMini&&(t=this.idMini),this.listItemMiniResult[i].node.active=!0,this.listItemMiniResult[i].spriteFrame=this.sprAtlas.getSpriteFrame(t.toString()),this.lb_Result.string=a.default.getInstance().getString("txt_pays_chip").replace("%s",l.default.formatMoney(e)),this.itemMiniResult.active=!0}turnOffMiniResult(){for(let t=0;t<this.listItemMiniResult.length;t++)this.listItemMiniResult[t].node.active=!1}turnOffAnim(){for(let t=0;t<this.listAnimWS.length;t++)this.listAnimWS[t].node.destroy();this.listAnimWS=[];for(let t=0;t<this.listItemAnim.length;t++)this.listItemAnim[t].node.active=!1,this.listItemAnim[t].animation.skeletonData=null}checkFiveOfaKind(){this.isHaveFiveOfaKind=!1;let t=0;for(let i=0;i<this.winningLine.length;i++){let e=[],n=this.winningLine[i].lineWin;for(let t=0;t<n.length;t++)e.push(this.finishView[t][n[t]]);if(4===(t=this.checkIndexToShowAnim(e)))return void(this.isHaveFiveOfaKind=!0)}}checkWildWinInLine(){let t=[];this.isWildWinInLine=!1;for(let i=0;i<this.winningLine.length;i++){let e=this.winningLine[i].lineWin;for(let i=0;i<e.length;i++)t.push(this.finishView[i][e[i]])}this.countWild=this.checkIndexToShowAnim(t);for(let i=0;i<=this.countWild;i++)11===t[i]&&(this.isWildWinInLine=!0)}checkScatterItem(){}drawRect(t,i,e,n,s){let o=this.createLine(i,!0,5),l=cc.v2(t.x-A.RECT_SIZE.x/2,t.y-A.RECT_SIZE.y/2);if(o.moveTo(l.x,l.y),o.rect(l.x,l.y,A.RECT_SIZE.x,A.RECT_SIZE.y),this.listLineRect.push(o.node),o.stroke(),e){let t=s.slice(n,5);t&&t.length>=2&&this.drawLineLast(t,i)}}resetForNextSpin(){for(let t=0;t<this.listIndexSpr.length;t++)this.listOriginItem[t].getComponent(S.default).setStateSpr(this.listIndexSpr[t],!0);this.listIndexSpr=[],this.node.stopAllActions(),this.canSpin=!0,this.blackMask.active=!1;for(let t=0;t<this.listWinLineNode.length;t++)this.listWinLineNode[t].node.destroy();this.turnOffAnim();for(let t=0;t<this.listLineRect.length;t++)this.listLineRect[t].destroy();if(this.listLineRect=[],this.listWinLineNode=[],this.winningLine=[],this.clickSpinCount=0,this.scatterCount=0,this.isShowBigWin=!1,this.isShowHugeWin=!1,this.blackMaskBig.active=!1,this.isFreeSpin||(this.totalAgFSP=0),this.finishData.freeSpin||this.isAutoSpin?this.speedSpin=A.SPEED_AUTO:this.speedSpin=A.SPEED_NORMAL,this.setStateSpinBtn(),this.agPlayer<this.listMarkBet[0]&&(this.btn_Spin.interactable=!1),this.itemMiniResult.active=!1,this.firstDelay=2,this.lb_info.node.active=!0,!(this.agPlayer>=this.listMarkBet[0]||this.finishData.freeSpin))return this.parentItemNode.getComponent(cc.Button).interactable=!1,this.btn_Spin.interactable=!1,this.btn_Spin.interactable=!1,this.text_spin.active=!1,this.lb_info.string=a.default.getInstance().getString("not_enought_gold"),void c.default.getInstance().alertDialog.showMessage(a.default.getInstance().getString("txt_not_enough_money_gl"));this.parentItemNode.getComponent(cc.Button).interactable=!0,this.isAutoSpin?(this.lb_info.string=a.default.getInstance().getString("txt_playing_lines").replace("%d","20"),this.text_spin.active=!1):this.lb_info.string=a.default.getInstance().getString("txt_press_spin_to_play"),(this.isAutoSpin||this.isSpinFree)&&this.onClickSpin()}onClickPlusMarkBet(){!this.isStop||this.isFreeSpin||this.markIndex<0||this.isAutoSpin||(this.markIndex<this.listMarkBet.filter(t=>t<=this.agPlayer/20).length-1?(this.markIndex++,this.markIndex===this.listMarkBet.length-1&&(this.lb_TypeMark.string=a.default.getInstance().getString("shan2_maxbet"))):(this.markIndex=0,this.lb_TypeMark.string=a.default.getInstance().getString("txt_bet")),this.curMarkBet=this.listMarkBet[this.markIndex],this.lb_markBet.string=l.default.formatMoney(this.curMarkBet))}onClickMinusMarkBet(){if(!(!this.isStop||this.isFreeSpin||this.markIndex<0||this.isAutoSpin)){if(this.markIndex>0)this.markIndex--,this.lb_TypeMark.string=a.default.getInstance().getString("txt_bet");else{let t=this.listMarkBet.filter(t=>t<=this.agPlayer/20).sort((t,i)=>t-i).pop();this.markIndex=this.listMarkBet.indexOf(t),this.lb_TypeMark.string=a.default.getInstance().getString("shan2_maxbet")}this.curMarkBet=this.listMarkBet[this.markIndex],this.lb_markBet.string=l.default.formatMoney(this.curMarkBet)}}onClickMaxBet(){if(this.agPlayer<this.listMarkBet[0])return;if(!this.isStop||this.isFreeSpin||this.markIndex<0||this.isAutoSpin)return;this.lb_TypeMark.string=a.default.getInstance().getString("shan2_maxbet");let t=this.listMarkBet.filter(t=>t<=this.agPlayer/20).sort((t,i)=>t-i).pop();this.markIndex=this.listMarkBet.indexOf(t),this.curMarkBet=this.listMarkBet[this.markIndex],this.lb_markBet.string=l.default.formatNumber(this.curMarkBet)}getRanNum(t,i){let e=Math.random()*(i-t)+t;return Math.floor(e)}createEffNumRun(t,i,e,n){t.node.active=!0,this.endNum=e,this.deltaNum=this.endNum-this.startNum,this.numPerSec=this.deltaNum/n,this.curNum=i,this.isRunEffPlusMoney=!0,this.effRunNumber(n,t,this.curNum,this.endNum,this.numPerSec)}effRunNumber(t,i,e,n,s){let o=s/20;o<0&&(o=1);let a=cc.callFunc(()=>{(e+=o)>=n&&(e=n),i.string=l.default.formatNumber(Math.ceil(e))}),h=cc.callFunc(()=>{e>=n&&i.node.stopActionByTag(0)}),r=cc.repeat(cc.sequence(a,cc.delayTime(.05),h),20*t);i.node.runAction(r)}updateMoney(){0!==this.finishData.freeSpinLeft&&1==this.finishData.freeSpin||(this.curChip===this.agPlayer?this.lb_Chip.string=l.default.formatNumber(this.agPlayer):(this.anim_chip_win.setAnimation(0,"animation",!1),this.anim_chip_win.node.active=!0,this.scheduleOnce(()=>{l.default.runNumber(this.lb_Chip,this.agPlayer,.8)},1.5)),0!==this.finishData.agWin&&(this.lb_titleWin.string=a.default.getInstance().getString("txt_win")),this.lb_ChipWinRound.string=l.default.formatNumber(this.totalWin))}onClickShop(){this.isStop&&m.default.show()}getAnimFromPool(t){let i=cc.instantiate(this.itemAnim).getComponent(g.default);return t.push(i),i}playSoundEff(t){}stopSoundEff(){}onClickRule(){u.default.show(this.node)}onQuit(){h.BannerData.setBannerData(o.Banner.ShowType.LEFT_MATCH,!0,o.Game.Enum.NOEL),f.default.onQuit()}};y.instance=null,s([b(cc.Node)],y.prototype,"bg_slot",void 0),s([b(cc.Prefab)],y.prototype,"itemAnim",void 0),s([b([cc.Sprite])],y.prototype,"listItemMiniResult",void 0),s([b([cc.SpriteFrame])],y.prototype,"listSprBtn",void 0),s([b(cc.SpriteFrame)],y.prototype,"animMask",void 0),s([b(cc.SpriteAtlas)],y.prototype,"sprAtlas",void 0),s([b(cc.Node)],y.prototype,"blackMask",void 0),s([b(cc.Node)],y.prototype,"parentItemNode",void 0),s([b(cc.Node)],y.prototype,"itemMiniResult",void 0),s([b(cc.Node)],y.prototype,"bkg_mid",void 0),s([b(cc.Node)],y.prototype,"bkg_Top",void 0),s([b(cc.Node)],y.prototype,"bkg_Bottom",void 0),s([b(cc.Button)],y.prototype,"btn_Spin",void 0),s([b(cc.Label)],y.prototype,"lb_markBet",void 0),s([b(cc.Label)],y.prototype,"lb_ChipWinRound",void 0),s([b(cc.Label)],y.prototype,"lb_Chip",void 0),s([b(cc.Label)],y.prototype,"lb_Result",void 0),s([b(cc.Label)],y.prototype,"lb_info",void 0),s([b(cc.Label)],y.prototype,"lb_titleWin",void 0),s([b(cc.Label)],y.prototype,"lb_TypeMark",void 0),s([b(cc.Label)],y.prototype,"lb_numLine1",void 0),s([b(cc.Label)],y.prototype,"lb_numLine2",void 0),s([b(cc.Node)],y.prototype,"text_spin",void 0),s([b(sp.Skeleton)],y.prototype,"anim_chip_win",void 0),s([b(cc.Prefab)],y.prototype,"itemSlot",void 0),s([b([sp.SkeletonData])],y.prototype,"noel_items",void 0),s([b(cc.Prefab)],y.prototype,"itemAnimSlotNoelPrefab",void 0),s([b(sp.SkeletonData)],y.prototype,"speedSpinAnim",void 0),s([b([sp.SkeletonData])],y.prototype,"slotNoelAnims",void 0),s([b(sp.SkeletonData)],y.prototype,"faKindAnim",void 0),s([b(sp.SkeletonData)],y.prototype,"freeSpinAnim",void 0),s([b(sp.SkeletonData)],y.prototype,"bigMegaAnim",void 0),s([b(sp.SkeletonData)],y.prototype,"freeSpinVienBgAnim",void 0),s([b(sp.SkeletonData)],y.prototype,"freeSpinBgAnim",void 0),s([b(sp.SkeletonData)],y.prototype,"freeNumAnim",void 0),y=n=s([I],y),e.default=y,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/dialogs/shop/ShopDialog":void 0,"../../lobby/src/language/LanguageController":void 0,"./NoelConstants":"NoelConstants","./NoelItem":"NoelItem","./NoelItemAnimation":"NoelItemAnimation","./NoelNetworkTransport":"NoelNetworkTransport","./NoelRuleDialog":"NoelRuleDialog"}],NoelItemAnimation:[function(t,i,e){"use strict";cc._RF.push(i,"f3e8dmie2xOX4qbHC0+T1pr","NoelItemAnimation");var n=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,l=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,i,e,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(l=(o<3?s(l):o>3?s(i,e,l):s(i,e))||l);return o>3&&l&&Object.defineProperty(i,e,l),l};Object.defineProperty(e,"__esModule",{value:!0});const{ccclass:s,property:o}=cc._decorator;let l=class extends cc.Component{constructor(){super(...arguments),this.animation=null}initAnimation(t){this.animation.skeletonData=t,this.animation.premultipliedAlpha=!1,this.animation.animation="animation"}playAnimation(t="animation",i=!1,e=!0,n=!1){this.animation.node.active=!0,this.animation.paused=!1,this.animation.setAnimation(0,t,i),n||this.animation.node.runAction(cc.sequence(cc.delayTime(3.5),cc.removeSelf()))}playAnimation2(t="animation",i=!1){this.animation.node.active=!0,this.animation.paused=!1,this.animation.setAnimation(0,t,i)}playAnimBinh(t="animation",i=!1){this.animation.node.opacity=255,this.animation.setAnimation(0,t,i)}setMultiAlpha(t){this.animation.premultipliedAlpha=t}stopAnimation(){this.animation.node.active=!1,this.animation.paused=!0}};n([o(sp.Skeleton)],l.prototype,"animation",void 0),l=n([s],l),e.default=l,cc._RF.pop()},{}],NoelItem:[function(t,i,e){"use strict";cc._RF.push(i,"487bdATHmdMKo3eVjNsQmYV","NoelItem");var n=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,l=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,i,e,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(l=(o<3?s(l):o>3?s(i,e,l):s(i,e))||l);return o>3&&l&&Object.defineProperty(i,e,l),l};Object.defineProperty(e,"__esModule",{value:!0});const s=t("./NoelController"),{ccclass:o,property:l}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.sprAtlas=null,this.listItem=[],this.itemBlur=[],this.itemMain=[],this.numCol=null,this.typeItem=null,this.listIdView=[]}getRanNum(t,i){let e=Math.random()*(i-t)+t;return Math.floor(e)}setRandomId(t){let i=[this.getRanNum(0,13),this.getRanNum(0,13),this.getRanNum(0,13)];this.setSpriteListItem(i,t)}setSpriteListItem(t,i=!1){for(let e=0;e<this.listItem.length;e++){let n=t[e];this.setSprSonItem(e,n,i)}this.listIdView=t.slice()}setSprSonItem(t,i,e){let n=this.itemMain[t];n.getComponent(cc.Sprite).spriteFrame=this.sprAtlas.getSpriteFrame(i.toString()),11!==i&&12!==i||n.setContentSize(cc.size(158,132))}getWordPosItemList(){let t=[];for(let i=0;i<this.listItem.length;i++){let e=this.getWordPosItem(this.listItem[i]);t.push(e)}return t}getWordPosItem(t){let i=this.node.convertToWorldSpaceAR(t.position);return s.default.getInstance().node.convertToNodeSpaceAR(i)}getScatterItem(){for(let t=0;t<this.listIdView.length;t++){let i=this.listIdView[t];if(12===i){let e={pos:this.getWordPosItem(this.listItem[t]),id:i};s.default.getInstance().scatterCount++,s.default.getInstance().listScatter.push(e)}}}getItemWithId(t){let i=[];for(let e=0;e<this.listIdView.length;e++)this.listIdView[e]===t&&i.push(this.listItem[e]);return i}setStateSpr(t,i){this.itemMain[t].active=i}};n([l(cc.SpriteAtlas)],a.prototype,"sprAtlas",void 0),n([l([cc.Node])],a.prototype,"listItem",void 0),n([l([cc.Node])],a.prototype,"itemBlur",void 0),n([l([cc.Node])],a.prototype,"itemMain",void 0),a=n([o],a),e.default=a,cc._RF.pop()},{"./NoelController":"NoelController"}],NoelNetworkTransport:[function(t,i,e){"use strict";cc._RF.push(i,"c8a9bLjXX9Ki5weLzpLXG1+","NoelNetworkTransport"),Object.defineProperty(e,"__esModule",{value:!0});const n=t("../../lobby/src/network/NetworkClient"),s=t("../../lobby/src/common/ConfigClient"),o=t("../../lobby/src/common/Constants"),l=t("../../lobby/src/chat/ChatPresenter"),a=t("../../lobby/src/common/GlobalApp"),h=t("./NoelController"),r=t("../../lobby/src/lobby/GameList");class c{static subscribe(){n.default.getInstance().subscribeEventHandler(o.Game.Enum.NOEL,this)}static matchDataHandler(t){switch(t.op_code){case s.default.Network.OP_CODE.OPCODE_UPDATE_TABLE:cc.log("OPCODE_UPDATE_TABLE",t.data),h.default.getInstance().handleCTable(t.data);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_DEAL:cc.log("OPCODE_UPDATE_DEAL",t.data);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_GAME_STATE:c.processUpdateGameState(t);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_FINISH:cc.log("result",t);break;case s.default.Network.OP_CODE.OPCODE_UPDATE_WALLET:cc.log("wallet",t);break;case s.default.Network.OP_CODE.OPCODE_KICK_OFF_THE_TABLE:cc.log("kick off",t),c.onQuit();break;default:cc.log("Data code not found ",t)}}static processUpdateGameState(t){switch(t.data.state){case o.Game.GAME_STATE.PREPARE:break;case o.Game.GAME_STATE.RUN:cc.log("GAME_STATE.RUN",t);break;case o.Game.GAME_STATE.REWARD:cc.log("GAME_STATE.REWARD",t);break;case o.Game.GAME_STATE.FINISH:cc.log("GAME_STATE.FINISH",t);break;default:cc.log("Match state not found ",t)}}static sendSpin(t){n.default.getInstance().sendMatchState(a.default.getInstance().matchInfo.match_id,s.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_SPIN,t).then(t=>{cc.log("sendSpin success ",t)},t=>{cc.log("sendSpin err",t)})}static onQuit(t=(()=>{})){n.default.getInstance().leaveMatch(a.default.getInstance().matchInfo.match_id).then(i=>{cc.log("leave match: ",i),l.default.getInstance().leaveChat(),cc.sys.isBrowser&&s.default.AppInfo.WEB_NATIVE?(t(),window.location.href="/"):a.default.getInstance().loadSceneByMainBundle(s.default.AppInfo.SCENE_NAME.GAMELIST,()=>{var i;t(),null===(i=r.default.getInstance())||void 0===i||i.setGameType(o.GameType.Enum.SLOT_GAME),h.default.getInstance().node.destroy()})},t=>{cc.log("err when leave match",t)})}}e.default=c,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/lobby/GameList":void 0,"../../lobby/src/network/NetworkClient":void 0,"./NoelController":"NoelController"}],NoelRuleDialog:[function(t,i,e){"use strict";cc._RF.push(i,"30d08uzcQhJq6YnDcgRx3LV","NoelRuleDialog");var n,s=this&&this.__decorate||function(t,i,e,n){var s,o=arguments.length,l=o<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,i,e,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(l=(o<3?s(l):o>3?s(i,e,l):s(i,e))||l);return o>3&&l&&Object.defineProperty(i,e,l),l};Object.defineProperty(e,"__esModule",{value:!0});const o=t("../../../bundles/lobby/src/common/BaseDialog"),l=t("../../../bundles/lobby/src/common/GlobalApp"),a=t("../../../bundles/lobby/src/common/ConfigClient"),{ccclass:h,property:r}=cc._decorator;let c=n=class extends o.default{constructor(){super(...arguments),this.ruleSprites=[],this.ruleContent=null,this.spriteIndex=0,this.isAnimating=!1}static getInstance(){return this.instance}actionNext(){this.ruleSprites.length<=0||this.isAnimating||(this.spriteIndex++,this.spriteIndex>=this.ruleSprites.length&&(this.spriteIndex=0),this.playPageTurnEffect(!0))}actionPrevious(){this.ruleSprites.length<=0||this.isAnimating||(this.spriteIndex--,this.spriteIndex<0&&(this.spriteIndex=this.ruleSprites.length-1),this.playPageTurnEffect(!1))}updateRuleDisplay(){this.ruleContent&&this.ruleSprites.length>0&&(this.ruleContent.spriteFrame=this.ruleSprites[this.spriteIndex])}playPageTurnEffect(t){if(!this.ruleContent||!this.ruleContent.node)return;this.isAnimating=!0;const i=this.ruleContent.node.scale,e=this.ruleContent.node.position,n=this.ruleContent.node.opacity;this.ruleContent.node.opacity=0,this.ruleContent.node.scale=.8*i,this.ruleContent.node.x=t?e.x+50:e.x-50,this.updateRuleDisplay(),cc.tween(this.ruleContent.node).to(.05,{opacity:100}).to(.25,{scale:i,x:e.x,opacity:n},{easing:"quartOut"}).call(()=>{this.isAnimating=!1}).start()}static show(t){null==this.instance||null==this.instance.node?l.default.getInstance().loadPrefabByBundle(a.default.Bundle.BUNDLE_NAME.NOEL,"res/prefabs/NoelRuleDialog",(i,e)=>{if(null!=i)return void l.default.getInstance().alertDialog.showMessage(i);let s=cc.instantiate(e);s.parent=t,this.instance=s.getComponent(n),this.instance.node.zIndex=1e3,this.instance.show()}):(this.instance.node.zIndex=1e3,this.instance.show())}show(){super.show(),this.spriteIndex=0,this.updateRuleDisplay()}};c.instance=null,s([r([cc.SpriteFrame])],c.prototype,"ruleSprites",void 0),s([r(cc.Sprite)],c.prototype,"ruleContent",void 0),c=n=s([h],c),e.default=c,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}]},{},["NoelConstants","NoelController","NoelItem","NoelItemAnimation","NoelNetworkTransport","NoelRuleDialog"]);