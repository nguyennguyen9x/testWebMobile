window.__require=function t(e,a,n){function i(r,l){if(!a[r]){if(!e[r]){var s=r.split("/");if(s=s[s.length-1],!e[s]){var c="function"==typeof __require&&__require;if(!l&&c)return c(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+r+"'")}r=s}var d=a[r]={exports:{}};e[r][0].call(d.exports,function(t){return i(e[r][1][t]||t)},d,d.exports,t,e,a,n)}return a[r].exports}for(var o="function"==typeof __require&&__require,r=0;r<n.length;r++)i(n[r]);return i}({DragonTigerChip:[function(t,e){"use strict";cc._RF.push(e,"4d2a0754PlPs4ue9Ve8wTME","DragonTigerChip");var a,n=(a=t("../../lobby/src/common/Utils"))&&a.__esModule?a:{default:a};cc.Class({extends:cc.Component,properties:{sprite:{default:null,type:cc.Sprite},label:{default:null,type:cc.Label},chipSprites:{default:[],type:cc.SpriteFrame},chip:0},setData:function(t){this.sprite.spriteFrame=this.chipSprites[t.spriteIndex],this.label.string=n.default.formatBetNumber(t.chip)||0,this.chip=t.chip||0}}),cc._RF.pop()},{"../../lobby/src/common/Utils":void 0}],DragonTigerHistoryDialog:[function(t,e,a){"use strict";cc._RF.push(e,"47a74rXN05Gtokpgr0Z0aMB","DragonTigerHistoryDialog");var n,i=this&&this.__decorate||function(t,e,a,n){var i,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,a,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(r=(o<3?i(r):o>3?i(e,a,r):i(e,a))||r);return o>3&&r&&Object.defineProperty(e,a,r),r};Object.defineProperty(a,"__esModule",{value:!0});const o=t("../../../bundles/lobby/src/common/GlobalApp"),r=t("../../../bundles/lobby/src/common/ConfigClient"),l=t("../../../bundles/lobby/src/common/BaseDialog"),{ccclass:s,property:c}=cc._decorator;let d=n=class extends l.default{constructor(){super(...arguments),this.listSprItemHistory=[],this.listItemTop=null,this.sprDragon=null,this.sprTiger=null,this.listviewContent=null,this.numDragon=null,this.numTiger=null,this.numTie=null,this.numDragonBig=null,this.numDragonSmall=null,this.numTigerBig=null,this.numTigerSmall=null,this.listHistoryTypeWin=[],this.HISTORY_LAST_VALUE=null,this.HISTORY_LAST_RESULT_COL=0,this.HISTORY_LAST_RESULT_ROW=0,this.HISTORY_STREAK=1,this.HISTORY_STATE_IS_VERTICAL=!1,this.historyArray=[]}static getInstance(){return this.instance}static show(t,e){null==this.instance||null==this.instance.node?o.default.getInstance().loadPrefabByBundle(r.default.Bundle.BUNDLE_NAME.DRAGONTIGER,"res/prefabs/DragonTigerHistoryDialog",(a,i)=>{if(null!=a)return void o.default.getInstance().alertDialog.showMessage(a);let r=cc.instantiate(i);r.parent=t,this.instance=r.getComponent(n),this.instance.node.zIndex=1e3,this.instance.showHistory(e)}):(this.instance.node.zIndex=1e3,this.instance.showHistory(e))}showHistory(t){this.show(),this.updateData(t)}start(){this.listHistoryTypeWin=[],this.setup2dArray(),this.HISTORY_LAST_VALUE=null,this.HISTORY_LAST_RESULT_COL=0,this.HISTORY_LAST_RESULT_ROW=0,this.HISTORY_STREAK=1,this.HISTORY_STATE_IS_VERTICAL=!1}updateFillRange(t,e){if(0==t&&0==e)return;let a=t/(t+e)*100,n=e/(t+e)*100;this.sprTiger.fillRange=Math.round(n)/100,this.sprDragon.node.getChildByName("lb_dragon").getComponent(cc.Label).string=Math.round(a).toString()+"%",this.sprTiger.node.getChildByName("lb_tiger").getComponent(cc.Label).string=Math.round(n).toString()+"%"}updateData(t){this.listHistoryTypeWin=t.arrHistory,this.updateHistory(),this.updateListTop(),this.updateFillRange(t.dragon,t.tiger),this.numDragon.string=t.dragon.toString(),this.numTiger.string=t.tiger.toString(),this.numTie.string=t.tie.toString(),this.numDragonBig.string=t.dragonWinBig.toString(),this.numDragonSmall.string=t.dragonWinSmail.toString(),this.numTigerBig.string=t.tigerWinBig.toString(),this.numTigerSmall.string=t.tigerWinSmail.toString()}updateHistory(){let t=[],e=0;if(0===this.listHistoryTypeWin.length)return;t.push([this.listHistoryTypeWin[0]]);let a=this.listHistoryTypeWin[0];for(let i=1;i<this.listHistoryTypeWin.length;i++){let n=this.listHistoryTypeWin[i];a==n?t[e].length>=5?(e++,t.push([n])):t[e].push(n):(a=n,e++,t.push([n]))}t=t.slice(Math.max(0,t.length-20),t.length);for(let i=0;i<this.listviewContent.childrenCount;i++)this.listviewContent.children[i].active=!1;let n=0;for(let i=0;i<t.length;i++)for(let e=0;e<t[i].length;e++){let a,o,r=t[i][e];n>this.listviewContent.childrenCount-1?((a=new cc.Node("item")).width=46,a.height=46,(o=new cc.Node("item").addComponent(cc.Sprite)).node.parent=a,a.parent=this.listviewContent):o=(a=this.listviewContent.children[n]).getComponentInChildren(cc.Sprite),a.active=!0,o.spriteFrame=this.listSprItemHistory[r],a.x=(i-9.5)*a.width,a.y=(2-e)*a.height-1.75,n++}}updateListTop(){for(let t=0;t<this.listItemTop.childrenCount;t++)this.listItemTop.children[t].active=!1;for(let t=Math.max(0,this.listHistoryTypeWin.length-20);t<this.listHistoryTypeWin.length;t++){let e=this.listHistoryTypeWin[t],a=null,n=null;t<this.listItemTop.childrenCount?n=(a=this.listItemTop.children[t]).getComponentInChildren(cc.Sprite):((a=new cc.Node("item")).width=46.25,a.height=47.2,(n=new cc.Node("item_sp").addComponent(cc.Sprite)).node.parent=a,a.parent=this.listItemTop),a.active=!0,n.spriteFrame=this.listSprItemHistory[e]}}getPositionToInsertSprite(t){if(null==this.HISTORY_LAST_VALUE)this.HISTORY_LAST_RESULT_ROW=0,this.HISTORY_LAST_RESULT_COL=0,this.HISTORY_LAST_VALUE=t,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1;else if(t==this.HISTORY_LAST_VALUE)1==this.HISTORY_STREAK&&(this.HISTORY_STATE_IS_VERTICAL=!0),this.HISTORY_STREAK++,this.HISTORY_STATE_IS_VERTICAL?this.HISTORY_LAST_RESULT_ROW>=4||1==this.historyArray[this.HISTORY_LAST_RESULT_ROW+1][this.HISTORY_LAST_RESULT_COL]?(this.HISTORY_STATE_IS_VERTICAL=!1,this.HISTORY_LAST_RESULT_COL++,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1):1==this.historyArray[this.HISTORY_LAST_RESULT_ROW+1][this.HISTORY_LAST_RESULT_COL]?(this.HISTORY_STATE_IS_VERTICAL=!1,this.HISTORY_LAST_RESULT_COL++,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1):(this.HISTORY_LAST_RESULT_ROW++,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1):(this.HISTORY_LAST_RESULT_COL+=1,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1),this.HISTORY_LAST_VALUE=t;else{for(let t=0;t<this.historyArray[0].length;t++)if(0==this.historyArray[0][t]){this.HISTORY_LAST_RESULT_COL=t;break}this.HISTORY_LAST_RESULT_ROW=0,this.HISTORY_STREAK=1,this.HISTORY_LAST_VALUE=t,this.historyArray[this.HISTORY_LAST_RESULT_ROW][this.HISTORY_LAST_RESULT_COL]=1}}setup2dArray(){this.historyArray=new Array(5);for(let t=0;t<this.historyArray.length;t++)this.historyArray[t]=new Array(200);for(let t=0;t<5;t++)for(let e=0;e<200;e++)this.historyArray[t][e]=0}convertArrayIndexToPosition(t,e){return 0===t&&0===e?cc.v2(48*t+10,-47*e-31):1===t&&0===e?cc.v2(47*t+10,-47*e-31):0===t&&1===e?cc.v2(47*t+10,-47*e-31):1===t&&1===e?cc.v2(48*t+10,-47*e-31):cc.v2(11+45.9*t,-46*e-31)}};d.instance=null,i([c([cc.SpriteFrame])],d.prototype,"listSprItemHistory",void 0),i([c(cc.Node)],d.prototype,"listItemTop",void 0),i([c(cc.Sprite)],d.prototype,"sprDragon",void 0),i([c(cc.Sprite)],d.prototype,"sprTiger",void 0),i([c(cc.Node)],d.prototype,"listviewContent",void 0),i([c(cc.Label)],d.prototype,"numDragon",void 0),i([c(cc.Label)],d.prototype,"numTiger",void 0),i([c(cc.Label)],d.prototype,"numTie",void 0),i([c(cc.Label)],d.prototype,"numDragonBig",void 0),i([c(cc.Label)],d.prototype,"numDragonSmall",void 0),i([c(cc.Label)],d.prototype,"numTigerBig",void 0),i([c(cc.Label)],d.prototype,"numTigerSmall",void 0),d=n=i([s],d),a.default=d,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}],DragonTigerNetworkTransport:[function(t,e){"use strict";cc._RF.push(e,"dd7e1cwPnZMOrIaZzJv+N5l","DragonTigerNetworkTransport");var a=s(t("../../lobby/src/network/NetworkClient")),n=s(t("../../lobby/src/common/ConfigClient")),i=t("../../lobby/src/common/Constants"),o=s(t("../../lobby/src/common/User")),r=s(t("../../lobby/src/common/GlobalApp")),l=s(t("../../lobby/src/chat/ChatPresenter"));function s(t){return t&&t.__esModule?t:{default:t}}var c=cc.Class({extends:cc.Component,properties:{instance:null},statics:{getInstance:function(){return null==this.instance&&(this.instance=new c,a.default.getInstance().subscribeEventHandler(i.Game.Enum.DRAGON_TIGER,this.instance)),this.instance}},matchDataHandler:function(e){switch(e.op_code){case n.default.Network.OP_CODE.OPCODE_UPDATE_TABLE:cc.log("OPCODE_UPDATE_TABLE",e.data),t("DragonTiger").getInstance().updateDesk(e.data);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_GAME_STATE:this.processUpdateGameState(e);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_FINISH:cc.log("result",e),t("DragonTiger").getInstance().endGame(e.data);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_WALLET:cc.log("wallet",e),t("DragonTiger").getInstance().updateGameBalances(e.data);break;case n.default.Network.OP_CODE.OPCODE_KICK_OFF_THE_TABLE:cc.log("kick off",e),this.onQuit();break;case n.default.Network.OP_CODE.OPCODE_LIST_PLAYER:cc.log("OPCODE_LIST_PLAYER",e),t("DragonTiger").getInstance().reloadListPlayer(e.data);break;default:cc.log("Data code not found ",e)}},processUpdateGameState:function(e){switch(e.data.state){case i.Game.GAME_STATE.PREPARE:if(t("DragonTiger").getInstance().gameState==i.Game.GAME_STATE.PREPARE)return;t("DragonTiger").getInstance().gameState=i.Game.GAME_STATE.PREPARE,t("DragonTiger").getInstance().prepare();break;case i.Game.GAME_STATE.RUN:cc.log("GAME_STATE.RUN",e),t("DragonTiger").getInstance().gameState=i.Game.GAME_STATE.RUN,t("DragonTiger").getInstance().countDown(e.data.countDown);break;case i.Game.GAME_STATE.REWARD:cc.log("GAME_STATE.REWARD",e),t("DragonTiger").getInstance().gameState=i.Game.GAME_STATE.REWARD,t("DragonTiger").getInstance().reward();break;case i.Game.GAME_STATE.FINISH:cc.log("GAME_STATE.FINISH",e);break;default:cc.log("Match state not found ",e)}},sendBet:function(t){a.default.getInstance().sendMatchState(r.default.getInstance().matchInfo.match_id,n.default.Network.OP_CODE_REQUEST.OPCODE_BET,t).then(function(t){cc.log("sendBet success ",t)},function(t){cc.log("sendBet err",t)})},getUsers:function(){a.default.getInstance().sendMatchState(r.default.getInstance().matchInfo.match_id,n.default.Network.OP_CODE_REQUEST.OPCODE_LIST_USERS,{}).then(function(){cc.log("list users ")},function(t){cc.log("get list users failed",t)})},getUserById:function(t){return a.default.getInstance().getUsers(t)},onQuit:function(e,i){void 0===e&&(e=function(){}),void 0===i&&(i=!0),a.default.getInstance().leaveMatch(r.default.getInstance().matchInfo.match_id).then(function(a){cc.log("leave match: ",a),t("DragonTiger").getInstance().gameState=null,l.default.getInstance().leaveChat(),i&&r.default.getInstance().loadSceneByMainBundle(o.default.vipLevel>0?n.default.AppInfo.SCENE_NAME.TABLELIST:n.default.AppInfo.SCENE_NAME.GAMELIST),e&&e()},function(){cc.log("err when leave match")})}});e.exports=c,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/network/NetworkClient":void 0,DragonTiger:"DragonTiger"}],DragonTigerPresenter:[function(t,e){"use strict";cc._RF.push(e,"ab484iMsjpMrrbrDB/cASFI","DragonTigerPresenter"),cc.Class({extends:cc.Component,statics:{},properties:{}}),cc._RF.pop()},{}],DragonTiger:[function(t,e){"use strict";cc._RF.push(e,"3ec64vj1MFEOIPBTl/0ZViR","DragonTiger");var a=_(t("../../lobby/src/audio/AudioController")),n=_(t("../../lobby/src/common/GlobalApp")),i=_(t("../../lobby/src/language/LanguageController")),o=_(t("../../lobby/src/common/Utils")),r=t("../../lobby/src/dialogs/banner/BannerDialog"),l=t("../../lobby/src/common/Constants"),s=_(t("../../lobby/src/game/GamePresenter")),c=_(t("../../lobby/src/common/User")),d=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var e=T(void 0);if(e&&e.has(t))return e.get(t);var a={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if("default"!==i&&Object.prototype.hasOwnProperty.call(t,i)){var o=n?Object.getOwnPropertyDescriptor(t,i):null;o&&(o.get||o.set)?Object.defineProperty(a,i,o):a[i]=t[i]}return a.default=t,e&&e.set(t,a),a}(t("../../lobby/src/dialogs/option/OptionDialog")),u=_(t("../../lobby/src/dialogs/chatingame/ChatInGameDialog")),h=_(t("../../lobby/src/chat/ChatPresenter")),g=_(t("./DragonTigerHistoryDialog")),p=_(t("../../lobby/src/network/NetworkClient")),f=_(t("../../lobby/src/common/ConfigClient")),m=_(t("../../lobby/src/scripts/ingame/BubbleChat")),y=_(t("../../lobby/src/scripts/ingame/PlayerCasino")),b=_(t("../../lobby/src/scripts/ingame/Card"));function T(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,a=new WeakMap;return(T=function(t){return t?a:e})(t)}function _(t){return t&&t.__esModule?t:{default:t}}var S=cc.Class({extends:cc.Component,properties:{lbBet:{default:[],type:cc.Node},lbTotalBet:{default:[],type:cc.Label},chipPrefab:{default:null,type:cc.Prefab},nodeUser:{default:null,type:cc.Node},lightLayers:{default:[],type:cc.Node},chips:{default:[],type:cc.Node},user_avt:{default:null,type:cc.Sprite},user_avt_border:{default:null,type:cc.Sprite},user_name:{default:null,type:cc.Label},user_wallet:{default:null,type:cc.Label},anim_startcompare:{default:null,type:sp.Skeleton},anim_vs:{default:null,type:sp.Skeleton},anim_dragon:{default:null,type:sp.Skeleton},anim_tigger:{default:null,type:sp.Skeleton},anim_dealer:{default:null,type:sp.Skeleton},anim_clock:{default:null,type:sp.Skeleton},lbClock:{default:null,type:cc.Label},cardPrefab:{default:null,type:cc.Prefab},cardsPosition:{default:[],type:cc.Vec2},nodeCard:{default:null,type:cc.Node},nodeChipBet:{default:null,type:cc.Node},toastBetSuccess:{default:null,type:cc.Node},chipBetPosition:{default:[],type:cc.Vec2},lbWin:{default:null,type:cc.Label},lbChip:{default:null,type:cc.Label},fontWin:{default:null,type:cc.Font},fontLose:{default:null,type:cc.Font},winPopup:{default:null,type:cc.Node},playerResultLayout:{default:null,type:cc.Node},playerResultItem:{default:null,type:cc.Prefab},bgResult:{default:null,type:cc.Node},animResult:{default:null,type:sp.Skeleton},animResultWin:{default:null,type:sp.SkeletonData},animResultLose:{default:null,type:sp.SkeletonData},spriteFrameExitMatch:{default:null,type:cc.SpriteFrame},spriteFrameChangeMatch:{default:null,type:cc.SpriteFrame},icBack:{default:null,type:cc.Node},listResult:{default:null,type:cc.ScrollView},listSpriteHistory:{default:[],type:[cc.SpriteFrame]},bubbleChatPrefab:cc.Prefab,bgThrow:{default:null,type:cc.Node},nodePlayers:{default:[],type:cc.Node},lbInfo:{default:null,type:cc.Label},tableAudio:{default:null,type:cc.AudioClip},playerPrefab:{default:null,type:cc.Prefab},bgPlayer:{default:null,type:cc.Node},playerScale:{default:.8,type:cc.Float},totalBetted:{default:0,type:cc.Float},betData:{default:{},type:cc.Json}},statics:{instance:null,getInstance:function(){return this.instance}},onLoad:function(){S.instance=this,t("DragonTigerNetworkTransport").getInstance(),localStorage.setItem("isLeave","false"),a.default.getInstance().playMusic(this.tableAudio,!0),this.gameState=null,this.popupHistory=null,this.dataHistory={},this.dataHistory.arrHistory=[],this.dataHistory.dragon=0,this.dataHistory.tiger=0,this.dataHistory.tie=0,this.dataHistory.dragonWinBig=0,this.dataHistory.dragonWinSmail=0,this.dataHistory.tigerWinBig=0,this.dataHistory.tigerWinSmail=0,this.chipBetTemp=new Map,this.allUserBets=new Map,this.listBet=[1e3,2e3,5e3,1e4],this.loadListBet(),this.loadProfile(),this.loadCards()},start:function(){this.setMatchInfo()},loadCards:function(){this.card1=cc.instantiate(this.cardPrefab),this.card2=cc.instantiate(this.cardPrefab),this.card1.getComponent(b.default).hideCardPusoy(),this.card2.getComponent(b.default).hideCardPusoy(),this.card1.position=this.cardsPosition[0],this.card2.position=this.cardsPosition[1],this.card1.scale=.4,this.card2.scale=.4,this.card1.active=!1,this.card2.active=!1,this.nodeCard.addChild(this.card1),this.nodeCard.addChild(this.card2)},onClickRule:function(){console.log("onClickRule")},loadListBet:function(){var t=this;this.listBet.forEach(function(e,a){t.chips[a].children[0].getComponent(cc.Label).string=o.default.formatBetNumber(e)}),this.chosenChip=this.listBet[0],this.chips[0].children[1].active=!0},onClickHistory:function(){g.default.show(this.node,this.dataHistory)},loadProfile:function(){this.nodePlayers[0].getComponent(y.default).setData({id:c.default.userId,user_name:c.default.displayName,wallet:c.default.accountChip,avatar_id:c.default.avatarId,vipLevel:c.default.vipLevel}),this.user_wallet.string=o.default.formatBetNumber(c.default.accountChip),this.userChip=c.default.accountChip},throwChipBet:function(t,e,a){var n=cc.instantiate(this.chipPrefab),i=this.listBet.findIndex(function(t){return t==e});-1==i&&(i=this.listBet.length),console.log(i);var o={spriteIndex:i,chip:e};n.getComponent("DragonTigerChip").setData(o),n.position=new cc.Vec2(t.x,t.y+187.728),this.nodeChipBet.addChild(n);var r,l,s=this.chipBetPosition[a-1],c=new cc.Vec2;return r=50-100*Math.random(),l=50-100*Math.random(),c=new cc.Vec2(s.x+r,s.y+l),cc.tween(n).to(.3,{position:c}).start(),n},onClickBet:function(e,a){if(this.gameState===l.Game.GAME_STATE.RUN){var n=[];n.push({chips:this.chosenChip,cell:Number(a)}),console.log("bet data: ",{user_id:c.default.userId||"",bets:n}),t("DragonTigerNetworkTransport").getInstance().sendBet({user_id:c.default.userId||"",bets:n})}},onClickChip:function(t,e){var a=this;this.chosenChip=this.listBet[e],this.listBet.forEach(function(t,e){a.chips[e].children[1].active=!1}),this.chips[e].children[1].active=!0},onRebet:function(){var e;this.gameState===l.Game.GAME_STATE.RUN&&(null==(e=this.lastBets)||e.forEach(function(e,a){console.log(a),console.log(e),t("DragonTigerNetworkTransport").getInstance().sendBet({user_id:c.default.userId||"",bets:[{chips:e,cell:a}]})}))},onDouble:function(){var e;this.gameState===l.Game.GAME_STATE.RUN&&(console.log("double"),console.log(this.isBetted),this.isBetted?this.chipBetTemp.forEach(function(e,a){t("DragonTigerNetworkTransport").getInstance().sendBet({user_id:c.default.userId||"",bets:[{chips:e,cell:a}]})}):(console.log("no bet"),null==(e=this.lastBets)||e.forEach(function(e,a){t("DragonTigerNetworkTransport").getInstance().sendBet({user_id:c.default.userId||"",bets:[{chips:2*e,cell:a}]})})))},clearAllData:function(){this.anim_clock.animation=null,this.lbClock.string="15",this.allUserBets=new Map,this.card1.getComponent(b.default).hideCardPusoy(),this.card2.getComponent(b.default).hideCardPusoy(),this.card1.active=!1,this.card2.active=!1,this.nodeChipBet.destroyAllChildren(),this.lbBet.forEach(function(t){t.active=!1}),this.lbTotalBet.forEach(function(t){t.node.active=!1}),this.lightLayers.forEach(function(t){t.active=!1}),this.winPopup.active=!1,this.bgResult.active=!1,this.isBetted=!1,this.lastBets=new Map(this.chipBetTemp),this.chipBetTemp=new Map},showToastBet:function(t){var e=this;this.toastBetSuccess.children[0].getComponent(cc.Label).string="Bet "+this.chosenChip+" "+(Number(this.chosenChip)>0?"chips":"chip")+" "+t+"!",this.toastBetSuccess.opacity=0,this.toastBetSuccess.active=!0,cc.tween(this.toastBetSuccess).to(.2,{opacity:255}).delay(.5).call(function(){e.toastBetSuccess.active=!1}).start()},updateDesk:function(t){var e,a,r=this;if(t.error)return 1==t.error.errorType&&n.default.getInstance().alertDialog.showMessage(i.default.getInstance().getString("txt_not_enough_money_gl")),void console.log("updateDesk",t.error);if(t.isUpdateDeskCell&&(null==(e=t.deskCell)||null==(a=e.list)||a.forEach(function(t){r.lbTotalBet[t.cell-1].string=o.default.formatBetNumber(t.chips,1e4),r.lbTotalBet[t.cell-1].node.active=!0})),t.isUpdateUserBet){var l,s=this.getPlayer(t.userBet.userId);t.userBet.userId==c.default.userId&&(this.isBetted=!0,this.showToastBet("success"),s=this.nodeUser),null==(l=t.userBet)||l.bets.forEach(function(e){t.userBet.userId==c.default.userId&&(r.chipBetTemp.set(e.cell,(Number(r.chipBetTemp.get(e.cell))||0)+Number(e.chips)),r.lbBet[e.cell-1].children[0].getComponent(cc.Label).string=o.default.formatBetNumber(r.chipBetTemp.get(e.cell),1e4),r.lbBet[e.cell-1].active=!0);var a=r.throwChipBet(s,e.chips,e.cell);r.allUserBets[e.cell]||(r.allUserBets[e.cell]=new Map),r.allUserBets[e.cell][t.userBet.userId]||(r.allUserBets[e.cell][t.userBet.userId]=[]),r.allUserBets[e.cell][t.userBet.userId].push(a)})}},prepare:function(){var t=this;cc.tween(this.node).call(function(){t.clearAllData(),t.leaveMatch()}).delay(.5).call(function(){var e=t.anim_dragon.node.position;cc.tween(t.anim_dragon.node).call(function(){t.anim_dragon.node.active=!0,t.anim_dragon.node.position=cc.v2(0,187.728)}).call(function(){t.anim_vs.node.active=!0,t.anim_dragon.animation="challenge",t.anim_dragon.node.active=!0}).delay(1).call(function(){t.anim_vs.node.active=!1,t.anim_dragon.animation="normal"}).to(.5,{position:e}).start();var a=t.anim_tigger.node.position;cc.tween(t.anim_tigger.node).call(function(){t.anim_tigger.node.active=!0,t.anim_tigger.node.position=cc.v2(0,187.728)}).call(function(){t.anim_tigger.animation="challenge",t.anim_tigger.node.active=!0}).delay(1).call(function(){t.anim_tigger.animation="normal"}).to(.5,{position:a}).start()}).delay(2).call(function(){t.anim_dealer.animation="chiabai",t.anim_dealer.loop=!1,t.anim_startcompare.animation=null,t.anim_startcompare.node.active=!1;var e=t.card1.position,a=t.card1.scale,n=t.card2.position,i=t.card2.scale;t.card1.position=t.anim_dealer.node.position,t.card1.opacity=0,t.card1.scale=0,t.card2.position=t.anim_dealer.node.position,t.card2.opacity=0,t.card2.scale=0,t.card1.active=!0,t.card2.active=!0,cc.tween(t.card1).to(.3,{opacity:255,scale:a,position:e}).start(),t.scheduleOnce(function(){cc.tween(t.card2).to(.3,{opacity:255,scale:i,position:n}).start()},.3),t.scheduleOnce(function(){t.anim_dealer.loop=!0,t.anim_dealer.animation="normal"},.6)}).delay(2).call(function(){t.anim_startcompare.node.active=!0,t.anim_startcompare.animation="bettime"}).delay(1).call(function(){t.anim_startcompare.animation=null,t.anim_startcompare.node.active=!1}).start()},countDown:function(t){var e=this;cc.tween(this.node).call(function(){e.card1.active=!0,e.card2.active=!0,e.anim_clock.node.active=!0,e.anim_clock.animation="animation";var a=t;e.lbClock.string=a,e.anim_clock.loop=a<=5,e.anim_clock.animation="animation"}).start()},reward:function(){var t=this;cc.tween(this.node).call(function(){t.anim_clock.animation=null,t.anim_clock.loop=!1,t.anim_clock.node.active=!1}).start()},endGame:function(t){var e=this;console.log("end game: ",t),cc.tween(this.node).call(function(){e.anim_startcompare.node.active=!0,e.anim_startcompare.animation="compare"}).delay(1).call(function(){var a,n,i,o;e.anim_startcompare.animation=null,e.anim_startcompare.node.active=!1,e.card1.getComponent(b.default).setData(t.hand.dragon.rank,t.hand.dragon.suit),e.card2.getComponent(b.default).setData(t.hand.tiger.rank,t.hand.tiger.suit),e.card1.getComponent(b.default).showCardAnimPusoy(),e.card2.getComponent(b.default).showCardAnimPusoy(),null==(a=t.winCells)||a.forEach(function(t){e.lightLayers[t-1].active=!0});var r=0,l=0,s=0;null==(n=t.winCells)||n.forEach(function(t){[1].includes(t)?l++:[2].includes(t)?r++:[3].includes(t)&&s++});var c=0;r>l?c=2:l>r?c=1:s>0&&(c=3);var d=new cc.Node;d.addComponent(cc.Sprite),d.getComponent(cc.Sprite).spriteFrame=e.listSpriteHistory[c],7==e.listResult.content.children.length&&e.listResult.content.children[0].destroy(),e.listResult.content.addChild(d),e.dataHistory.arrHistory.push(c);var u=!1,h=!1;null==(i=t.winCells)||i.forEach(function(t){switch(t){case 1:u=!0,e.dataHistory.dragon+=1;break;case 2:h=!0,e.dataHistory.tiger+=1;break;case 3:e.dataHistory.tie+=1;break;case 4:e.dataHistory.dragonWinSmail+=1;break;case 5:e.dataHistory.dragonWinBig+=1;break;case 6:e.dataHistory.tigerWinSmail+=1;break;case 7:e.dataHistory.tigerWinBig+=1}}),u?(cc.tween(e.anim_dragon.node).call(function(){e.anim_dragon.animation="win"}).delay(2).call(function(){e.anim_dragon.animation="normal"}).start(),cc.tween(e.anim_tigger.node).call(function(){e.anim_tigger.animation="lose"}).delay(2).call(function(){e.anim_tigger.animation="normal"}).start()):h&&(cc.tween(e.anim_tigger.node).call(function(){e.anim_tigger.animation="win"}).delay(2).call(function(){e.anim_tigger.animation="normal"}).start(),cc.tween(e.anim_dragon.node).call(function(){e.anim_dragon.animation="lose"}).delay(2).call(function(){e.anim_dragon.animation="normal"}).start()),null==(o=g.default.getInstance())||o.updateData(e.dataHistory)}).delay(2).call(function(){Object.keys(e.allUserBets).filter(function(e){return!t.winCells.includes(Number(e))}).forEach(function(t){Object.keys(e.allUserBets[t]).forEach(function(a){e.allUserBets[t][a].forEach(function(t){cc.tween(t).to(.45,{position:e.anim_dealer.node.position}).call(function(){t.destroy()}).start()})})})}).delay(.8).call(function(){t.winCells.forEach(function(t){e.allUserBets[t]&&Object.keys(e.allUserBets[t]).forEach(function(a){[].concat(e.allUserBets[t][a]).forEach(function(n){var i=e.throwChipBet(e.anim_dealer.node,n.getComponent("DragonTigerChip").chip,t);e.allUserBets[t][a].push(i)})})})}).delay(.8).call(function(){t.winCells.forEach(function(t){e.allUserBets[t]&&Object.keys(e.allUserBets[t]).forEach(function(a){if(e.balances[a]){var n,i,o=e.getPlayer(a);if(Number(e.balances[a].amountChipAdd)>0)null==(n=o.getComponent(y.default))||n.showEffectWinLose(1),null==(i=o.getComponent(y.default))||i.showEffectFlyMoney2(Number(e.balances[a].amountChipAdd));else if(Number(e.balances[a].amountChipAdd)<0){var r,l;null==(r=o.getComponent(y.default))||r.showEffectWinLose(-1),null==(l=o.getComponent(y.default))||l.showEffectFlyMoney2(Number(e.balances[a].amountChipAdd))}e.allUserBets[t][a].forEach(function(t){cc.tween(t).to(.5,{position:cc.v2(o.x,o.y+187.728)}).delay(.5).call(function(){t.destroy()}).start()})}})})}).delay(1).call(function(){if(e.allUserBets=new Map,e.balances[c.default.userId]){var t=Number(e.balances[c.default.userId].amountChipAdd)>0,a=Number(e.balances[c.default.userId].amountChipAdd)<0;t?(e.lbWin.font=e.fontWin,e.lbChip.string="+"+o.default.formatNumberToString(e.balances[c.default.userId].amountChipAdd),e.bgResult.active=!0,e.animResult.skeletonData=e.animResultWin,e.animResult.animation="animation"):a&&(e.lbWin.font=e.fontLose,e.lbChip.string=""+o.default.formatNumberToString(e.balances[c.default.userId].amountChipAdd),e.bgResult.active=!0,e.animResult.skeletonData=e.animResultLose,e.animResult.animation="animation")}}).delay(3).call(function(){e.bgResult.active=!1,e.clearAllData()}).start()},updateGameBalances:function(t){console.log("balance: ",t);var e=new Map;t.updates.forEach(function(t){e[t.userId]=t}),this.balances=e,this.balances[c.default.userId]&&(this.user_wallet.string=o.default.formatBetNumber(this.balances[c.default.userId].amountChipCurrent),this.userChip=this.balances[c.default.userId].amountChipCurrent)},setMatchInfo:function(){var t=JSON.parse(n.default.getInstance().matchInfo.label),e=t.tableId.slice(0,5);t.tableId.length>5&&(e+="..."),this.lbInfo.string="ID: "+e+"\nBertaruh: "+o.default.formatWalletNumber(t.markUnit),h.default.getInstance().joinChatRoom(n.default.getInstance().matchInfo.match_id,this),localStorage.setItem("isLeave","false"),localStorage.setItem("isChangeMatch","false"),this.listBet=[1,5,10,50,100].map(function(e){return e*t.markUnit}),this.loadListBet()},onMenuClick:function(){d.default.show(this,d.DialogPosition.RIGHT)},leaveMatch:function(){var e=this;"true"===localStorage.getItem("isLeave")?(r.BannerData.setBannerData(l.Banner.ShowType.LEFT_MATCH,!0),t("DragonTigerNetworkTransport").getInstance().onQuit()):"true"===localStorage.getItem("isChangeMatch")&&t("DragonTigerNetworkTransport").getInstance().onQuit(function(){e.clearAllData(),cc.Tween.stopAllByTarget(e.node),e.unscheduleAllCallbacks(),setTimeout(function(){var t=JSON.parse(n.default.getInstance().matchInfo.label);s.default.changeMatch(t.markUnit,n.default.getInstance().matchInfo)},2)},!1)},onChangeMatch:function(){var e=this;!this.isBetted||this.gameState!==l.Game.GAME_STATE.RUN&&this.gameState!==l.Game.GAME_STATE.REWARD?t("DragonTigerNetworkTransport").getInstance().onQuit(function(){e.clearAllData(),cc.Tween.stopAllByTarget(e.node),e.unscheduleAllCallbacks(),setTimeout(function(){var t=JSON.parse(n.default.getInstance().matchInfo.label);s.default.changeMatch(t.markUnit,n.default.getInstance().matchInfo)},2)},!1):(this.icBack.scale=.5,this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameChangeMatch,"true"===localStorage.getItem("isChangeMatch")?(this.icBack.active=!1,localStorage.setItem("isChangeMatch","false"),n.default.getInstance().toast.showToast(i.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isChangeMatch","true"),n.default.getInstance().toast.showToast(i.default.getInstance().getString("wait_game_end_to_leave"))))},onQuit:function(){!this.isBetted||this.gameState!==l.Game.GAME_STATE.RUN&&this.gameState!==l.Game.GAME_STATE.REWARD?(r.BannerData.setBannerData(l.Banner.ShowType.LEFT_MATCH,!0),t("DragonTigerNetworkTransport").getInstance().onQuit()):(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameExitMatch,this.icBack.scale=1,"true"===localStorage.getItem("isLeave")?(this.icBack.active=!1,localStorage.setItem("isLeave","false"),n.default.getInstance().toast.showToast(i.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isLeave","true"),n.default.getInstance().toast.showToast(i.default.getInstance().getString("wait_game_end_to_leave"))))},getPlayer:function(t){for(var e=0;e<this.nodePlayers.length;e++)if(this.nodePlayers[e].active&&this.nodePlayers[e].getComponent(y.default).id===t)return this.nodePlayers[e];return this.getPlayerNodeUserId(t)},throwIcons:function(t){var e=this,a=this.getPlayer(t.sender_id),n=this.getPlayer(t.throw.to_id);a==n?this.nodePlayers.forEach(function(n,i){n.active&&n.id!==t.sender_id&&e.createIconAndThrow(t.throw.iconIndex,a,i)}):this.createIconAndThrow(t.throw.iconIndex,a,n)},createIconAndThrow:function(t,e,a){var n=this,i=new cc.Node,o=i.addComponent(cc.Sprite),r=h.default.getInstance().getThrowIcon(t);o.spriteFrame=r,i.setPosition(e.position),this.bgThrow.addChild(i),cc.tween(i).to(.5,{position:a.position}).call(function(){i.destroy();var e=new cc.Node,o=e.addComponent(sp.Skeleton);o.skeletonData=h.default.getInstance().getThrowAnimation(t),o.animation="animation",o.loop=!1,o.premultipliedAlpha=!1,a.addChild(e),n.scheduleOnce(function(){e.destroy()},3)}).start()},onChatClick:function(){this.gameState!==l.Game.GAME_STATE.SPECTATING&&u.default.show()},showChat:function(t){var e=this.getPlayer(t.sender_id),a=t.message,n=cc.instantiate(this.bubbleChatPrefab);n.getComponent(m.default).setData(a),n.scale=2,n.position=cc.v2(70,0),e.addChild(n),this.scheduleOnce(function(){n.destroy()},3)},showEmoji:function(t){var e=h.default.getInstance().getEmojiByTypeAndIndex(t.emoji.type,t.emoji.index).value,a=this.getPlayer(t.sender_id),n=new cc.Node,i=n.addComponent(sp.Skeleton);i.skeletonData=e,i.animation="animation",i.premultipliedAlpha=!1,"F"==t.emoji.type?n.scale=1.3:n.scale=2,a.addChild(n),this.scheduleOnce(function(){n.destroy()},2)},getPlayerNodeUserId:function(t){for(var e=0;e<this.bgPlayer.children.length;e++)if(this.bgPlayer.children[e].active&&this.bgPlayer.children[e].getComponent(y.default)&&this.bgPlayer.children[e].getComponent(y.default).id==t)return this.bgPlayer.children[e];return null},getPlayerInfoByUserId:function(t){for(var e=0;e<this.bgPlayer.children.length;e++)if(this.bgPlayer.children[e].active&&this.bgPlayer.children[e].getComponent(y.default)&&this.bgPlayer.children[e].getComponent(y.default).id==t)return this.bgPlayer.children[e].getComponent(y.default).getInfo();return null},reloadListPlayer:function(t){var e=this,a=this.bgPlayer.children.length-1;this.bgPlayer.children.forEach(function(e,n){if(e.active&&(n!==a||e.getComponent(y.default))){for(var i=0;i<t.players.length;i++)if(t.players[i].id==e.getComponent(y.default).id)return;e.active=!1}}),this.bgPlayer.children[a].active&&!this.bgPlayer.children[a].getComponent(y.default)&&t.players.length<=a+1&&(this.bgPlayer.children[a].active=!1),t.players.forEach(function(a){if(a.id!==c.default.userId){for(var n=!1,i=0;i<e.bgPlayer.children.length;i++){var o;if(e.bgPlayer.children[i].active&&a.id==(null==(o=e.bgPlayer.children[i].getComponent(y.default))?void 0:o.id)){n=!0;break}}n||e.updatePlayer(a,t.players.length)}})},getNextIndex:function(){for(var t=0;t<this.bgPlayer.children.length;t++)if(!this.bgPlayer.children[t].active)return this.bgPlayer.children[t].scale=this.playerScale,t;return-1},updatePlayer:function(t,e){var a=this.getNextIndex();if(console.log("updatePlayer",a,t),-1!=a&&(this.bgPlayer.children[a].active=!0),a==this.bgPlayer.children.length-1||-1==a){if(!this.bgPlayer.children[this.bgPlayer.children.length-1].getComponent(y.default))return a=this.bgPlayer.children.length-1,void(this.bgPlayer.children[a].children[0].getComponent(cc.Label).string="+"+(e-this.bgPlayer.children.length));if(-1==a)return}this.bgPlayer.children[a].getComponent(y.default).setData({id:null==t?void 0:t.id,user_name:null==t?void 0:t.userName,wallet:null==t?void 0:t.wallet,avatar_id:null==t?void 0:t.avatarId,vipLevel:null==t?void 0:t.vipLevel,sId:null==t?void 0:t.sid}),this.bgPlayer.children[a].getChildByName("avatar").getComponent(cc.Button)||(this.bgPlayer.children[a].getChildByName("avatar").addComponent(cc.Button),this.bgPlayer.children[a].getChildByName("avatar").getComponent(cc.Button).target=this.bgPlayer.children[a]);var n=new cc.Component.EventHandler;n.target=this.node,n.component=this.node._name,n.handler="profileClick",n.customEventData=null==t?void 0:t.id,this.bgPlayer.children[a].getChildByName("avatar").getComponent(cc.Button).clickEvents=[n]},profileClick:function(t){t.target.parent.getComponent(y.default).showPlayerInfo()},reloadProfileInfo:function(){p.default.getInstance().rpcCall(f.default.Network.RPC_ID.GET_PROFILE,{}).then(function(t){console.log("profile: ",t.payload),c.default.init(t.payload)},function(t){console.log("err when get PROFILE ",t)})}});cc._RF.pop()},{"../../lobby/src/audio/AudioController":void 0,"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/chatingame/ChatInGameDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/game/GamePresenter":void 0,"../../lobby/src/language/LanguageController":void 0,"../../lobby/src/network/NetworkClient":void 0,"../../lobby/src/scripts/ingame/BubbleChat":void 0,"../../lobby/src/scripts/ingame/Card":void 0,"../../lobby/src/scripts/ingame/PlayerCasino":void 0,"./DragonTigerHistoryDialog":"DragonTigerHistoryDialog",DragonTigerNetworkTransport:"DragonTigerNetworkTransport"}],ResultItemCasino:[function(t,e){"use strict";cc._RF.push(e,"b388crCQqBFervKRRf5hDPX","ResultItemCasino");var a=i(t("../../lobby/src/common/GlobalApp")),n=i(t("../../lobby/src/common/Utils"));function i(t){return t&&t.__esModule?t:{default:t}}cc.Class({extends:cc.Component,properties:{top:{default:null,type:cc.Sprite},avt:{default:null,type:cc.Sprite},border:{default:null,type:cc.Sprite},userName:{default:null,type:cc.Label},chip:{default:null,type:cc.Label},topFrames:{default:[],type:cc.SpriteFrame}},setData:function(t){this.top.spriteFrame=this.topFrames[t.top],this.avt.spriteFrame=a.default.getInstance().getAvatarById(t.avatarId),this.border.spriteFrame=a.default.getInstance().getAvatarBorderByVip(t.vipLevel),this.userName.string=t.name,this.chip.string=n.default.formatNumber(t.chips||0)}}),cc._RF.pop()},{"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/Utils":void 0}]},{},["DragonTiger","DragonTigerChip","DragonTigerHistoryDialog","DragonTigerNetworkTransport","DragonTigerPresenter","ResultItemCasino"]);