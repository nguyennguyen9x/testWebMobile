window.__require=function e(t,n,a){function i(l,c){if(!n[l]){if(!t[l]){var s=l.split("/");if(s=s[s.length-1],!t[s]){var r="function"==typeof __require&&__require;if(!c&&r)return r(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+l+"'")}l=s}var d=n[l]={exports:{}};t[l][0].call(d.exports,function(e){return i(t[l][1][e]||e)},d,d.exports,e,t,n,a)}return n[l].exports}for(var o="function"==typeof __require&&__require,l=0;l<a.length;l++)i(a[l]);return i}({BandaChip:[function(e,t){"use strict";cc._RF.push(t,"e4f75lcz9xPebmfCIqdhswZ","BandaChip");var n,a=(n=e("../../lobby/src/common/Utils"))&&n.__esModule?n:{default:n};cc.Class({extends:cc.Component,properties:{sprite:{default:null,type:cc.Sprite},label:{default:null,type:cc.Label},chipSprites:{default:[],type:cc.SpriteFrame},chip:0},setData:function(e){this.sprite.spriteFrame=this.chipSprites[e.spriteIndex],this.label.string=a.default.formatBetNumber(e.chip)||0,this.chip=Number(e.chip)||0}}),cc._RF.pop()},{"../../lobby/src/common/Utils":void 0}],BandaQQConstants:[function(e,t,n){"use strict";cc._RF.push(t,"f6c0eZhGIBCMYFRnpYNsDxB","BandaQQConstants"),Object.defineProperty(n,"__esModule",{value:!0}),n.BandaQQHandsTypeString=n.BandaQQHandsType=void 0,function(e){e[e.NONE=0]="NONE",e[e.Q=1]="Q",e[e.S=2]="S",e[e.T=3]="T"}(n.BandaQQHandsType||(n.BandaQQHandsType={})),function(e){e.NONE="",e.QIU="QIU",e.SIX="SIX",e.TWIN="TWIN"}(n.BandaQQHandsTypeString||(n.BandaQQHandsTypeString={})),cc._RF.pop()},{}],BandaQQNetworkTransport:[function(e,t){"use strict";cc._RF.push(t,"923fdR9C1NPjamgMDiP2Byd","BandaQQNetworkTransport");var n=s(e("../../lobby/src/common/ConfigClient")),a=e("../../lobby/src/common/Constants"),i=s(e("../../lobby/src/network/NetworkClient")),o=s(e("../../lobby/src/common/User")),l=s(e("../../lobby/src/common/GlobalApp")),c=s(e("../../lobby/src/chat/ChatPresenter"));function s(e){return e&&e.__esModule?e:{default:e}}var r=cc.Class({extends:cc.Component,properties:{instance:null},statics:{getInstance:function(){return null==this.instance&&(this.instance=new r,i.default.getInstance().subscribeEventHandler(a.Game.Enum.BANDAQQ,this.instance)),this.instance}},matchDataHandler:function(t){switch(t.op_code){case n.default.Network.OP_CODE.OPCODE_UPDATE_TABLE:cc.log("OPCODE_UPDATE_TABLE",t.data),e("BandaQQ").getInstance().updateDesk(t.data);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_GAME_STATE:this.processUpdateGameState(t);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_FINISH:cc.log("result",t),e("BandaQQ").getInstance().endGame(t.data);break;case n.default.Network.OP_CODE.OPCODE_UPDATE_WALLET:cc.log("wallet",t),e("BandaQQ").getInstance().updateGameBalances(t.data);break;case n.default.Network.OP_CODE.OPCODE_KICK_OFF_THE_TABLE:cc.log("kick off",t),this.onQuit();break;case n.default.Network.OP_CODE.OPCODE_LIST_PLAYER:cc.log("OPCODE_LIST_PLAYER",t),e("BandaQQ").getInstance().reloadListPlayer(t.data);break;default:cc.log("Data code not found ",t)}},processUpdateGameState:function(t){switch(t.data.state){case a.Game.GAME_STATE.PREPARE:if(e("BandaQQ").getInstance().gameState==a.Game.GAME_STATE.PREPARE)return;e("BandaQQ").getInstance().gameState=a.Game.GAME_STATE.PREPARE,e("BandaQQ").getInstance().prepare();break;case a.Game.GAME_STATE.RUN:e("BandaQQ").getInstance().gameState=a.Game.GAME_STATE.RUN,e("BandaQQ").getInstance().countDown(t.data.countDown);break;case a.Game.GAME_STATE.REWARD:cc.log("GAME_STATE.REWARD",t),e("BandaQQ").getInstance().gameState=a.Game.GAME_STATE.REWARD,e("BandaQQ").getInstance().reward();break;case a.Game.GAME_STATE.FINISH:break;default:cc.log("Match state not found ",t)}},sendBet:function(e){i.default.getInstance().sendMatchState(l.default.getInstance().matchInfo.match_id,n.default.Network.OP_CODE_REQUEST.OPCODE_BET,e).then(function(e){cc.log("sendBet success ",e)},function(e){cc.log("sendBet err",e)})},getUsers:function(){i.default.getInstance().sendMatchState(l.default.getInstance().matchInfo.match_id,n.default.Network.OP_CODE_REQUEST.OPCODE_LIST_USERS,{}).then(function(){cc.log("list users ")},function(e){cc.log("get list users failed",e)})},onQuit:function(t,a){void 0===t&&(t=function(){}),void 0===a&&(a=!0),i.default.getInstance().leaveMatch(l.default.getInstance().matchInfo.match_id).then(function(i){cc.log("leave match: ",i),e("BandaQQ").getInstance().gameState=null,c.default.getInstance().leaveChat(),a&&l.default.getInstance().loadSceneByMainBundle(o.default.vipLevel>0?n.default.AppInfo.SCENE_NAME.TABLELIST:n.default.AppInfo.SCENE_NAME.GAMELIST),t&&t()},function(e){cc.log("err when leave match",e)})}});t.exports=r,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/network/NetworkClient":void 0,BandaQQ:"BandaQQ"}],BandaQQPresenter:[function(e,t){"use strict";cc._RF.push(t,"af54arTX9tHiYk9qV7Z5j93","BandaQQPresenter");var n=i(e("../../lobby/src/network/NetworkClient")),a=i(e("../../lobby/src/common/ConfigClient"));function i(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,statics:{},properties:{},tip:function(e){n.default.getInstance().sendMatchState(GlobalApp.getInstance().matchInfo.match_id,a.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_TIP_INGAME,{chips:e}).then(function(){cc.log("tip success ",e)},function(e){cc.log("tip err",e)})}}),cc._RF.pop()},{"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/network/NetworkClient":void 0}],BandaQQRuleDialog:[function(e,t,n){"use strict";cc._RF.push(t,"acac2u0iORJ767XMhT0DLqr","BandaQQRuleDialog");var a,i=this&&this.__decorate||function(e,t,n,a){var i,o=arguments.length,l=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,a);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(l=(o<3?i(l):o>3?i(t,n,l):i(t,n))||l);return o>3&&l&&Object.defineProperty(t,n,l),l};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../../../bundles/lobby/src/common/BaseDialog"),l=e("../../../bundles/lobby/src/common/GlobalApp"),c=e("../../../bundles/lobby/src/common/ConfigClient"),{ccclass:s,property:r}=cc._decorator;let d=a=class extends o.default{static getInstance(){return this.instance}static show(e){null==this.instance||null==this.instance.node?l.default.getInstance().loadPrefabByBundle(c.default.Bundle.BUNDLE_NAME.BANDARQQ,"res/prefabs/BandaQQRuleDialog",(t,n)=>{if(null!=t)return void l.default.getInstance().alertDialog.showMessage(t);let i=cc.instantiate(n);i.parent=e,this.instance=i.getComponent(a),this.instance.node.zIndex=1e3,this.instance.show()}):(this.instance.node.zIndex=1e3,this.instance.show())}};d.instance=null,d=a=i([s],d),n.default=d,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}],BandaQQ:[function(e,t){"use strict";cc._RF.push(t,"56ccf4z++xDqIR99NED8mKh","BandaQQ");var n=_(e("../../lobby/src/audio/AudioController")),a=_(e("../../lobby/src/common/GlobalApp")),i=_(e("../../lobby/src/language/LanguageController")),o=_(e("../../lobby/src/common/Utils")),l=e("../../lobby/src/dialogs/banner/BannerDialog"),c=e("../../lobby/src/common/Constants"),s=_(e("../../lobby/src/game/GamePresenter")),r=_(e("../../lobby/src/common/User")),d=e("./BandaQQConstants"),u=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=B(void 0);if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=a?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}(e("../../lobby/src/dialogs/option/OptionDialog")),h=_(e("../../lobby/src/dialogs/chatingame/ChatInGameDialog")),p=_(e("../../lobby/src/chat/ChatPresenter")),f=_(e("../../lobby/src/common/BaseDialog")),m=_(e("./BandaQQRuleDialog")),g=_(e("../../lobby/src/network/NetworkClient")),b=_(e("../../lobby/src/common/ConfigClient")),y=_(e("../../lobby/src/scripts/ingame/BubbleChat")),v=_(e("../../lobby/src/scripts/ingame/PlayerCasino"));function B(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(B=function(e){return e?n:t})(e)}function _(e){return e&&e.__esModule?e:{default:e}}var C=e("BandaQQPresenter"),I=cc.Class({extends:cc.Component,properties:{playerPrefab:{default:null,type:cc.Prefab},bgPlayer:{default:null,type:cc.Node},trendCross:{default:null,type:cc.SpriteFrame},trendList:{default:null,type:cc.ScrollView},trendListView:{default:null,type:cc.Node},trendItemPrefab:{default:null,type:cc.Prefab},trend_bg:{default:null,type:cc.Node},trend_mask:{default:null,type:cc.Node},chips:{default:[],type:cc.Node},resultNode:{default:null,type:cc.Node},dot_red:{default:null,type:cc.SpriteFrame},dot_blue:{default:null,type:cc.SpriteFrame},dot_green:{default:null,type:cc.SpriteFrame},dominoPrefab:{default:null,type:cc.Prefab},anim_startgame:{default:null,type:sp.Skeleton},anim_vs:{default:null,type:sp.Skeleton},anim_clock:{default:null,type:sp.Skeleton},lbClock:{default:null,type:cc.Label},anim_dealer:{default:null,type:sp.Skeleton},dominoStartPosition:{default:[],type:cc.Vec2},dominoComparePosition:{default:[],type:cc.Vec2},node_domino:{default:null,type:cc.Node},toastBetSuccess:{default:null,type:cc.Node},chipPrefab:{default:null,type:cc.Prefab},buttonsBet:{default:[],type:cc.Node},nodeUser:{default:null,type:cc.Node},nodeBgChipBet:{default:null,type:cc.Node},win_rounds:{default:null,type:cc.Node},user_wallet:{default:null,type:cc.Label},lbBet:{default:[],type:cc.Node},lbTotalBet:{default:[],type:cc.Label},lbRedPoint:{default:null,type:cc.Label},lbBluePoint:{default:null,type:cc.Label},animGlowRed:{default:null,type:sp.Skeleton},animGlowBlue:{default:null,type:sp.Skeleton},lbSpecialRed:{default:null,type:cc.Label},lbSpecialBlue:{default:null,type:cc.Label},popupTopWin:{default:null,type:f.default},lbChip:{default:null,type:cc.Label},scaleDomino:0,scaleCompareDomino:0,listItemResult:[cc.Node],playerScale:{default:.8,type:cc.Float},totalBetted:{default:0,type:cc.Float},betData:{default:{},type:cc.Json},spriteFrameExitMatch:{default:null,type:cc.SpriteFrame},spriteFrameChangeMatch:{default:null,type:cc.SpriteFrame},icBack:{default:null,type:cc.Node},bubbleChatPrefab:cc.Prefab,bgThrow:{default:null,type:cc.Node},players:{default:[],type:[cc.Node]},lbInfo:{default:null,type:cc.Label},listResult:{default:null,type:cc.ScrollView},listSpriteHistory:{default:[],type:[cc.SpriteFrame]},tipMessage:{default:null,type:cc.Node},notificationPanel:{default:null,type:cc.Node},tableAudio:{default:null,type:cc.AudioClip}},statics:{instance:null,getInstance:function(){return this.instance}},onLoad:function(){I.instance=this,e("BandaQQNetworkTransport").getInstance(),localStorage.setItem("isLeave","false"),n.default.getInstance().playMusic(this.tableAudio,!0),this.gameState=null,this.left2Right=!1,this.maxPlayer=6,this.chipBetTemp=new Map,this.listBet=[100,200,500,1e3,5e3],this.loadListBet(),this.loadProfile(),this.isBet=!1,this.allUserBets=new Map},start:function(){this.setMatchInfo()},loadProfile:function(){this.players[0].getComponent(v.default).setData({id:r.default.userId,user_name:r.default.displayName,wallet:r.default.accountChip,avatar_id:r.default.avatarId,vipLevel:r.default.vipLevel}),this.user_wallet.string=o.default.formatBetNumber(r.default.accountChip)},onClickRule:function(){m.default.show(this.node)},getPlayer:function(e){for(var t=0;t<this.players.length;t++)if(this.players[t].active&&this.players[t].getComponent(v.default).id===e)return this.players[t];return this.getPlayerNodeUserId(e)},throwIcons:function(e){var t=this,n=this.getPlayer(e.sender_id),a=this.getPlayer(e.throw.to_id);n==a?this.players.forEach(function(a,i){a.active&&a.id!==e.sender_id&&t.createIconAndThrow(e.throw.iconIndex,n,i)}):this.createIconAndThrow(e.throw.iconIndex,n,a)},createIconAndThrow:function(e,t,n){var a=this,i=new cc.Node,o=i.addComponent(cc.Sprite),l=p.default.getInstance().getThrowIcon(e);o.spriteFrame=l,i.setPosition(t.position),this.bgThrow.addChild(i),cc.tween(i).to(.5,{position:n.position}).call(function(){i.destroy();var t=new cc.Node,o=t.addComponent(sp.Skeleton);o.skeletonData=p.default.getInstance().getThrowAnimation(e),o.animation="animation",o.loop=!1,o.premultipliedAlpha=!1,n.addChild(t),a.scheduleOnce(function(){t.destroy()},3)}).start()},onChatClick:function(){this.gameState!==c.Game.GAME_STATE.SPECTATING&&h.default.show()},showChat:function(e){var t=this.getPlayer(e.sender_id),n=e.message,a=cc.instantiate(this.bubbleChatPrefab);a.getComponent(y.default).setData(n),a.scale=2,a.position=cc.v2(70,0),t.addChild(a),this.scheduleOnce(function(){a.destroy()},3)},showEmoji:function(e){var t=p.default.getInstance().getEmojiByTypeAndIndex(e.emoji.type,e.emoji.index).value,n=this.getPlayer(e.sender_id),a=new cc.Node,i=a.addComponent(sp.Skeleton);i.skeletonData=t,i.animation="animation",i.premultipliedAlpha=!1,"F"==e.emoji.type?a.scale=1.3:a.scale=2,a.position=cc.v2(0,50),n.addChild(a),this.scheduleOnce(function(){a.destroy()},2)},loadDomino:function(){for(var e=0;e<4;e++){var t=cc.instantiate(this.dominoPrefab);t.scale=this.scaleDomino,t.position=this.dominoStartPosition[e],this.node_domino.addChild(t)}},setDominoData:function(e,t){e.getComponent("Domino").setData(t)},loadListBet:function(){var e=this;this.listBet.forEach(function(t,n){e.chips[n].children[0].getComponent(cc.Label).string=o.default.formatBetNumber(t),e.chips[n].children[1].active=!1}),this.chosenChip=this.listBet[0],this.chips[0].children[1].active=!0},addTrend:function(e){var t=this;console.log("addTrend",e);var n,a=e.redHand.point,i=e.blueHand.point;n=a>i?0:a<i?2:1;var o=new cc.Node;o.addComponent(cc.Sprite),o.getComponent(cc.Sprite).spriteFrame=this.listSpriteHistory[n],7==this.listResult.content.children.length&&this.listResult.content.children[0].destroy(),this.listResult.content.addChild(o);var l=cc.instantiate(this.trendItemPrefab);l.getComponent("TrendItem").setData(e),this.trendList.content.addChild(l),this.scheduleOnce(function(){if(t.trendList.content.children.length>=2){var e=l,n=t.trendList.content.children[t.trendList.content.children.length-2],a=n.getComponent("TrendItem").nodeToDraw,i=e.getComponent("TrendItem").nodeToDraw,o={x:(a.x+i.x)/2,y:(i.y+e.y-(a.y+n.y))/2,angle:180*Math.atan2(a.x-i.x,i.y+e.y-(a.y+n.y))/Math.PI,height:Math.sqrt(Math.pow(a.x-i.x,2)+Math.pow(a.y+n.y-(e.y+i.y),2))};n.getComponent("TrendItem").setGach(o)}},.01)},onClickBet:function(t,n){if(this.gameState===c.Game.GAME_STATE.RUN){this.cellBet=n;var a=[];a.push({chips:this.chosenChip,cell:Number(n)}),console.log("bet data: ",{user_id:r.default.userId||"",bets:a}),e("BandaQQNetworkTransport").getInstance().sendBet({user_id:r.default.userId||"",bets:a})}},throwChipBet:function(e,t,n){var a=cc.instantiate(this.chipPrefab),i={spriteIndex:this.listBet.findIndex(function(e){return e==t}),chip:t};a.getComponent("BandaChip").setData(i),a.position=new cc.Vec2(e.x,e.y+169.14),this.nodeBgChipBet.addChild(a);var o=this.buttonsBet[n].position,l=new cc.Vec2,c=0,s=0;return 0==n||3==n?(c=293/3-200*Math.random(),s=178-20*Math.random(),l=new cc.Vec2(o.x+c,o.y+s)):1==n||2==n||4==n||5==n?(c=140/3-100*Math.random(),s=95+10*Math.random(),l=new cc.Vec2(o.x+c,o.y+s)):(c=329/3-240*Math.random(),s=120+10*Math.random(),l=new cc.Vec2(o.x+c,o.y+s)),cc.tween(a).to(.3,{position:l}).start(),a},onClickChip:function(e,t){var n=this;console.log(this.listBet[t]),this.chosenChip=this.listBet[t],this.listBet.forEach(function(e,t){n.chips[t].children[1].active=!1}),this.chosenChip=this.listBet[t],this.chips[t].children[1].active=!0},onClickTrend:function(){var e=this;this.isMovingTrend||(this.isMovingTrend=!0,this.isShowTrend?cc.tween(this.trend_bg).by(.2,{x:248}).call(function(){e.isShowTrend=!1,e.isMovingTrend=!1,e.trend_mask.active=!1}).start():cc.tween(this.trend_bg).by(.2,{x:-248}).call(function(){e.isShowTrend=!0,e.isMovingTrend=!1,e.trend_mask.active=!0}).start())},showToastBet:function(e){var t=this;this.toastBetSuccess.children[0].getComponent(cc.Label).string="Bet "+this.chosenChip+" "+(Number(this.chosenChip)>0?"chips":"chip")+" "+e+"!",this.toastBetSuccess.opacity=0,this.toastBetSuccess.active=!0,cc.tween(this.toastBetSuccess).to(.2,{opacity:255}).delay(.5).call(function(){t.toastBetSuccess.active=!1}).start()},resetData:function(){this.chipBetTemp=new Map,this.isBet=!1},resetUI:function(){this.hideAllDomino(),this.hideAllBetLabels(),this.hideAllChipBet(),this.hideAllRounds(),this.hideAllTotalBetLabels(),this.hideAllPoint(),this.hideAllResult()},hideAllResult:function(){this.hideNotification(),this.popupTopWin.close()},hideAllPoint:function(){this.lbRedPoint.node.active=!1,this.lbBluePoint.node.active=!1,this.animGlowRed.animation=null,this.animGlowRed.node.active=!1,this.animGlowBlue.animation=null,this.animGlowBlue.node.active=!1,this.lbSpecialRed.node.active=!1,this.lbSpecialBlue.node.active=!1},hideAllDomino:function(){this.node_domino.active=!1,this.node_domino.children.forEach(function(e){e.destroy()})},hideAllChipBet:function(){this.nodeBgChipBet.destroyAllChildren()},hideAllBetLabels:function(){this.lbBet.forEach(function(e){return e.active=!1})},hideAllTotalBetLabels:function(){this.lbTotalBet.forEach(function(e){return e.node.active=!1})},hideAllRounds:function(){this.win_rounds.children.forEach(function(e){return e.active=!1})},onTipClick:function(){var e=this,t=JSON.parse(a.default.getInstance().matchInfo.label),n=t.markUnit;t.markUnit>=1e5&&(n=1e5),Number(r.default.accountChip)<n?a.default.getInstance().alertDialog.showMessage(i.default.getInstance().getString("txt_not_enough_money_gl")):((new C).tip(n),this.createIconAndThrow(5,this.players[0],this.anim_dealer.node),this.scheduleOnce(function(){e.tipMessage.children[0].getComponent(cc.Label).string=n+" Chips";var t=r.default.displayName;t.length>10&&(t=t.substr(0,10)+"..."),e.tipMessage.children[1].getComponent(cc.Label).string=t+", Thank you!",e.tipMessage.active=!0,e.anim_dealer.animation="kiss",e.scheduleOnce(function(){e.tipMessage.active=!1,r.default.accountChip-=n,e.loadProfile(),e.anim_dealer.animation="normal"},1.5)},1))},updateDesk:function(e){var t,n,l=this;if(e.error)return 1==e.error.errorType&&a.default.getInstance().alertDialog.showMessage(i.default.getInstance().getString("txt_not_enough_money_gl")),void console.log("updateDesk",e.error);if(e.updateCellBets&&(null==(t=e.listCellBet)||null==(n=t.listCellBet)||n.forEach(function(e){l.lbTotalBet[e.cell].string=o.default.formatBetNumber(e.chips,1e4),l.lbTotalBet[e.cell].node.active=!0})),e.updateUserBets){var c,s=this.getPlayer(e.userBets.userId);e.userBets.userId==r.default.userId&&(this.isBet=!0,this.showToastBet("success"),s=this.nodeUser),null==(c=e.userBets)||c.bets.forEach(function(t){e.userBets.userId==r.default.userId&&(l.chipBetTemp.set(t.cell,(Number(l.chipBetTemp.get(t.cell))||0)+Number(t.chips)),l.lbBet[t.cell].children[0].getComponent(cc.Label).string=o.default.formatBetNumber(l.chipBetTemp.get(t.cell),1e4),l.lbBet[t.cell].active=!0,l.lbBet[t.cell].children[0].active=!0);var n=l.throwChipBet(s,t.chips,t.cell);l.allUserBets[t.cell]||(l.allUserBets[t.cell]=new Map),l.allUserBets[t.cell][e.userBets.userId]||(l.allUserBets[t.cell][e.userBets.userId]=[]),l.allUserBets[t.cell][e.userBets.userId].push(n)})}},cloneCard:function(e,t){var n=cc.instantiate(this.dominoPrefab);return n.scale=this.scaleDomino,n.position=t,n.angle=0,n.active=!0,n.opacity=255,n.parent=this.node_domino,n},prepare:function(){var e=this;cc.tween(this.node).call(function(){e.resetData(),e.resetUI(),e.leaveMatch()}).delay(.2).call(function(){e.anim_startgame.node.active=!0,e.anim_startgame.animation="startgame"}).delay(1).call(function(){e.anim_startgame.animation=null,e.anim_startgame.node.active=!1,e.node_domino.active=!0;for(var t=cc.v2(-cc.winSize.width/2,cc.winSize.height/2),n=0;n<20;n++)e.cloneCard(-1,t);for(var a=0;a<20;a++){var i=a;cc.tween(e.node_domino.children[i]).delay(.02*a).to(.2,{position:cc.v2(260*(Math.ceil(i/2)-5)/5,-e.node_domino.parent.position.y),opacity:255}).call(function(){}).start()}}).delay(.7).call(function(){var t=Math.floor(5*Math.random()),n={bg:"up_tren",number1:-1,number2:-1};e.node_domino.children.forEach(function(a,i){i===t||i===t+5||i===t+10||i===t+15?e.setDominoData(a,n):cc.tween(a).to(.3,{opacity:0}).call(function(){a.destroy()}).start()}),e.scheduleOnce(function(){e.node_domino.children.forEach(function(t,n){cc.tween(t).to(.5,{opacity:255}).delay(1).to(.5,{position:e.dominoStartPosition[n],scale:e.scaleDomino}).start()})},.5)}).delay(2.5).call(function(){e.anim_startgame.node.active=!0,e.anim_startgame.animation="bettime",e.anim_dealer.animation="chiabai",e.anim_dealer.loop=!1}).delay(1).call(function(){e.anim_startgame.animation=null,e.anim_startgame.node.active=!1,e.anim_dealer.loop=!0,e.anim_dealer.animation="normal"}).start()},countDown:function(e){var t=this;cc.tween(this.node).call(function(){t.node_domino.active=!0,t.anim_clock.node.active=!0,t.anim_clock.animation="animation";var n=e;t.lbClock.string=n,t.anim_clock.loop=n<=5,t.anim_clock.animation="animation"}).start()},reward:function(){var e=this;cc.tween(this.node).call(function(){e.node_domino.active=!0,e.anim_clock.animation=null,e.anim_clock.loop=!1,e.anim_clock.node.active=!1}).start()},endGame:function(e){var t=this;console.log("end game: ",e),this.lastBets=new Map(this.chipBetTemp),this.chipBetTemp=new Map,cc.tween(this.node).call(function(){t.anim_startgame.node.active=!0,t.anim_startgame.animation="compare"}).delay(1).call(function(){t.anim_startgame.animation=null,t.anim_startgame.node.active=!1,t.anim_vs.node.active=!0,t.anim_vs.animation="animation";var n=t.scaleCompareDomino,a=[].concat(e.hands.redHand.dominos).concat(e.hands.blueHand.dominos);t.node_domino.children.forEach(function(e,i){cc.tween(e).to(.5,{position:t.dominoComparePosition[i],scale:n}).delay(1).to(.2,{scaleX:0}).call(function(){var n={bg:"tren",number1:a[i].top,number2:a[i].bottom};t.setDominoData(e,n)}).to(.2,{scaleX:n}).start()})}).delay(2).call(function(){t.addTrend(e.hands),e.winCells.forEach(function(e){t.win_rounds.getChildByName(e.toString()).active=!0})}).delay(1).call(function(){t.anim_vs.animation=null,t.anim_vs.node.active=!1,t.node_domino.children.forEach(function(e,n){cc.tween(e).to(.5,{position:t.dominoStartPosition[n],scale:t.scaleDomino}).start()})}).delay(.5).call(function(){t.lbRedPoint.string=e.hands.redHand.point,t.lbBluePoint.string=e.hands.blueHand.point,t.lbRedPoint.node.active=!0,t.lbBluePoint.node.active=!0,e.hands.redHand.point>e.hands.blueHand.point?(t.animGlowRed.animation="animation",t.animGlowRed.node.active=!0):e.hands.redHand.point<e.hands.blueHand.point&&(t.animGlowBlue.animation="animation",t.animGlowBlue.node.active=!0),t.lbSpecialRed.string=d.BandaQQHandsTypeString[e.hands.redHand.type],t.lbSpecialBlue.string=d.BandaQQHandsTypeString[e.hands.blueHand.type],t.lbSpecialRed.node.active=!0,t.lbSpecialBlue.node.active=!0}).delay(.5).call(function(){Object.keys(t.allUserBets).filter(function(t){return!e.winCells.includes(Number(t))}).forEach(function(e){Object.keys(t.allUserBets[e]).forEach(function(n){t.allUserBets[e][n].forEach(function(e){cc.tween(e).to(.5,{position:t.anim_dealer.node.position}).call(function(){e.destroy()}).start()})})})}).delay(.8).call(function(){e.winCells.forEach(function(e){t.allUserBets[e]&&Object.keys(t.allUserBets[e]).forEach(function(n){[].concat(t.allUserBets[e][n]).forEach(function(a){var i=t.throwChipBet(t.anim_dealer.node,a.getComponent("BandaChip").chip,e);t.allUserBets[e][n].push(i)})})})}).delay(.8).call(function(){e.winCells.forEach(function(n){t.allUserBets[n]&&Object.keys(t.allUserBets[n]).forEach(function(a){var i,o,l=t.getPlayer(a);if(Number(e.playersWinAmount[a])>0)null==(i=l.getComponent(v.default))||i.showEffectWinLose(1),null==(o=l.getComponent(v.default))||o.showEffectFlyMoney2(Number(e.playersWinAmount[a]));else if(Number(e.playersWinAmount[a])<0){var c,s;null==(c=l.getComponent(v.default))||c.showEffectWinLose(-1),null==(s=l.getComponent(v.default))||s.showEffectFlyMoney2(Number(e.playersWinAmount[a]))}t.allUserBets[n][a].forEach(function(e){cc.tween(e).to(.5,{position:cc.v2(l.x,l.y+169.14)}).delay(.5).call(function(){e.destroy()}).start()})})})}).delay(2).call(function(){var n;t.allUserBets=new Map;var a=[];Object.keys(e.playersWinAmount).forEach(function(t){Number(e.playersWinAmount[t])>0&&a.push({userId:t,amount:Number(e.playersWinAmount[t])})}),a.sort(function(e,t){return t.amount-e.amount}),t.listItemResult.forEach(function(e){e.active=!1});for(var i=0;i<3;i++){var l,c,s,d=a[i];if(!d)break;var u=i;t.listItemResult[u].active=!0;var h;h=d.userId===r.default.userId?{id:r.default.userId,user_name:r.default.displayName,wallet:r.default.accountChip,avatar_id:r.default.avatarId,vipLevel:r.default.vipLevel}:t.getPlayerInfoByUserId(d.userId),t.listItemResult[u].getComponentInChildren("AvatarItem").setData({avatarId:null==(l=h)?void 0:l.avatar_id,vipLevel:null==(c=h)?void 0:c.vipLevel}),t.listItemResult[u].getChildByName("chip").getComponent(cc.Label).string="+"+o.default.formatNumberToString(d.amount),t.listItemResult[u].getChildByName("name").getComponent(cc.Label).string=(null==(s=h)?void 0:s.user_name)||""}Number(null==(n=t.balances)?void 0:n.amountChipAdd)>0&&(t.lbChip.string="+"+o.default.formatNumberToString(t.balances.amountChipAdd),t.popupTopWin.show())}).delay(2).call(function(){t.popupTopWin.close(),t.showNotification(i.default.getInstance().getString("binh_wait_for_next_game"))}).start()},showNotification:function(e){this.notificationPanel.active=!0;var t=this.notificationPanel.getComponentInChildren(cc.Label),n="";cc.Tween.stopAllByTarget(this.notificationPanel),cc.tween(this.notificationPanel).repeatForever(cc.tween().call(function(){n=".",t.string=e+n}).delay(1).call(function(){n="..",t.string=e+n}).delay(1).call(function(){n="...",t.string=e+n}).delay(1)).start()},hideNotification:function(){cc.Tween.stopAllByTarget(this.notificationPanel),this.notificationPanel.active=!1},showPopupTopWin:function(){this.popupTopWin.show()},hidePopupTopWin:function(){this.popupTopWin.close()},updateGameBalances:function(e){var t;this.balances=e.updates[0],this.balances&&(this.user_wallet.string=o.default.formatBetNumber(null==(t=this.balances)?void 0:t.amountChipCurrent),this.userChip=this.balances.amountChipCurrent)},setMatchInfo:function(){p.default.getInstance().joinChatRoom(a.default.getInstance().matchInfo.match_id,this),localStorage.setItem("isLeave","false"),localStorage.setItem("isChangeMatch","false");var e,t=JSON.parse(a.default.getInstance().matchInfo.label),n=t.tableId.slice(0,5);t.tableId.length>5&&(n+="..."),this.lbInfo.string="ID: "+n+"\nBertaruh: "+o.default.formatWalletNumber(t.markUnit),this.listBet=[1,5,10,50,100].map(function(e){return e*t.markUnit}),this.loadListBet(),(t.gameState===c.Game.GAME_STATE.RUN||c.Game.GAME_STATE.PREPARE)&&(this.loadDomino(),this.isPlaying=(null==t?void 0:null==(e=t.playingPlayers)?void 0:e.findIndex(function(e){return e===r.default.userId}))>=0,s.default.syncTable())},onMenuClick:function(){u.default.show(this,u.DialogPosition.RIGHT)},leaveMatch:function(){var t=this;"true"===localStorage.getItem("isLeave")?(l.BannerData.setBannerData(c.Banner.ShowType.LEFT_MATCH,!0),e("BandaQQNetworkTransport").getInstance().onQuit()):"true"===localStorage.getItem("isChangeMatch")&&(this.icBack.active=!1,e("BandaQQNetworkTransport").getInstance().onQuit(function(){t.resetData(),t.resetUI(),cc.Tween.stopAllByTarget(t.node),t.unscheduleAllCallbacks(),setTimeout(function(){var e=JSON.parse(a.default.getInstance().matchInfo.label);s.default.changeMatch(e.markUnit,a.default.getInstance().matchInfo)},2)},!1))},onChangeMatch:function(){var t=this;!this.isBet||this.gameState!==c.Game.GAME_STATE.RUN&&this.gameState!==c.Game.GAME_STATE.REWARD?e("BandaQQNetworkTransport").getInstance().onQuit(function(){t.icBack.active=!1,t.resetData(),t.resetUI(),cc.Tween.stopAllByTarget(t.node),t.unscheduleAllCallbacks(),setTimeout(function(){var e=JSON.parse(a.default.getInstance().matchInfo.label);s.default.changeMatch(e.markUnit,a.default.getInstance().matchInfo)},2)},!1):(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameChangeMatch,this.icBack.scale=.5,"true"===localStorage.getItem("isChangeMatch")?(this.icBack.active=!1,localStorage.setItem("isChangeMatch","false"),a.default.getInstance().toast.showToast(i.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isChangeMatch","true"),a.default.getInstance().toast.showToast(i.default.getInstance().getString("wait_game_end_to_leave"))))},onRebet:function(){var t;this.gameState===c.Game.GAME_STATE.RUN&&(console.log("onRebet",this.lastBets),null==(t=this.lastBets)||t.forEach(function(t,n){e("BandaQQNetworkTransport").getInstance().sendBet({user_id:r.default.userId||"",bets:[{chips:t,cell:n}]})}))},onDouble:function(){var t;this.gameState===c.Game.GAME_STATE.RUN&&(this.isBet?this.chipBetTemp.forEach(function(t,n){e("BandaQQNetworkTransport").getInstance().sendBet({user_id:r.default.userId||"",bets:[{chips:t,cell:n}]})}):(console.log("no bet"),null==(t=this.lastBets)||t.forEach(function(t,n){e("BandaQQNetworkTransport").getInstance().sendBet({user_id:r.default.userId||"",bets:[{chips:2*t,cell:n}]})})))},onQuit:function(){!this.isBet||this.gameState!==c.Game.GAME_STATE.RUN&&this.gameState!==c.Game.GAME_STATE.REWARD?(l.BannerData.setBannerData(c.Banner.ShowType.LEFT_MATCH,!0),e("BandaQQNetworkTransport").getInstance().onQuit()):(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameExitMatch,this.icBack.scale=1,"true"===localStorage.getItem("isLeave")?(this.icBack.active=!1,localStorage.setItem("isLeave","false"),a.default.getInstance().toast.showToast(i.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isLeave","true"),a.default.getInstance().toast.showToast(i.default.getInstance().getString("wait_game_end_to_leave"))))},getPlayerNodeUserId:function(e){for(var t=0;t<this.bgPlayer.children.length;t++)if(this.bgPlayer.children[t].active&&this.bgPlayer.children[t].getComponent(v.default)&&this.bgPlayer.children[t].getComponent(v.default).id==e)return this.bgPlayer.children[t];return null},getPlayerInfoByUserId:function(e){for(var t=0;t<this.bgPlayer.children.length;t++)if(this.bgPlayer.children[t].active&&this.bgPlayer.children[t].getComponent(v.default)&&this.bgPlayer.children[t].getComponent(v.default).id==e)return this.bgPlayer.children[t].getComponent(v.default).getInfo();return null},reloadListPlayer:function(e){var t=this,n=this.bgPlayer.children.length-1;this.bgPlayer.children.forEach(function(t,a){if(t.active&&(a!==n||t.getComponent(v.default))){for(var i=0;i<e.players.length;i++)if(e.players[i].id==t.getComponent(v.default).id)return;t.active=!1}}),this.bgPlayer.children[n].active&&!this.bgPlayer.children[n].getComponent(v.default)&&e.players.length<=n+1&&(this.bgPlayer.children[n].active=!1),e.players.forEach(function(n){if(n.id!==r.default.userId){for(var a=!1,i=0;i<t.bgPlayer.children.length;i++){var o;if(t.bgPlayer.children[i].active&&n.id==(null==(o=t.bgPlayer.children[i].getComponent(v.default))?void 0:o.id)){a=!0;break}}a||t.updatePlayer(n,e.players.length)}})},getNextIndex:function(){for(var e=0;e<this.bgPlayer.children.length;e++)if(!this.bgPlayer.children[e].active)return this.bgPlayer.children[e].scale=this.playerScale,e;return-1},updatePlayer:function(e,t){var n=this.getNextIndex();if(console.log("updatePlayer",n,e),-1!=n&&(this.bgPlayer.children[n].active=!0),n==this.bgPlayer.children.length-1||-1==n){if(!this.bgPlayer.children[this.bgPlayer.children.length-1].getComponent(v.default))return n=this.bgPlayer.children.length-1,void(this.bgPlayer.children[n].children[0].getComponent(cc.Label).string="+"+(t-this.bgPlayer.children.length));if(-1==n)return}this.bgPlayer.children[n].getComponent(v.default).setData({id:null==e?void 0:e.id,user_name:null==e?void 0:e.userName,wallet:null==e?void 0:e.wallet,avatar_id:null==e?void 0:e.avatarId,vipLevel:null==e?void 0:e.vipLevel,sId:null==e?void 0:e.sid}),this.bgPlayer.children[n].getChildByName("avatar").getComponent(cc.Button)||(this.bgPlayer.children[n].getChildByName("avatar").addComponent(cc.Button),this.bgPlayer.children[n].getChildByName("avatar").getComponent(cc.Button).target=this.bgPlayer.children[n]);var a=new cc.Component.EventHandler;a.target=this.node,a.component=this.node._name,a.handler="profileClick",a.customEventData=null==e?void 0:e.id,this.bgPlayer.children[n].getChildByName("avatar").getComponent(cc.Button).clickEvents=[a]},profileClick:function(e){e.target.parent.getComponent(v.default).showPlayerInfo()},reloadProfileInfo:function(){g.default.getInstance().rpcCall(b.default.Network.RPC_ID.GET_PROFILE,{}).then(function(e){console.log("profile: ",e.payload),r.default.init(e.payload)},function(e){console.log("err when get PROFILE ",e)})}});cc._RF.pop()},{"../../lobby/src/audio/AudioController":void 0,"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/BaseDialog":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/chatingame/ChatInGameDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/game/GamePresenter":void 0,"../../lobby/src/language/LanguageController":void 0,"../../lobby/src/network/NetworkClient":void 0,"../../lobby/src/scripts/ingame/BubbleChat":void 0,"../../lobby/src/scripts/ingame/PlayerCasino":void 0,"./BandaQQConstants":"BandaQQConstants","./BandaQQRuleDialog":"BandaQQRuleDialog",BandaQQNetworkTransport:"BandaQQNetworkTransport",BandaQQPresenter:"BandaQQPresenter"}],Domino:[function(e,t){"use strict";cc._RF.push(t,"a54eanxJm1BJZHxtrHP6r7y","Domino"),cc.Class({extends:cc.Component,properties:{spriteList:{default:null,type:cc.SpriteAtlas},bg:{default:null,type:cc.Sprite},number1:{default:null,type:cc.Sprite},number2:{default:null,type:cc.Sprite}},start:function(){},setData:function(e){this.bg.spriteFrame=this.spriteList.getSpriteFrame(e.bg),this.number1.spriteFrame=this.spriteList.getSpriteFrame(e.number1)||null,this.number2.spriteFrame=this.spriteList.getSpriteFrame(e.number2)||null}}),cc._RF.pop()},{}],TrendItem:[function(e,t){"use strict";cc._RF.push(t,"66917uLpEJLrZgscmDt2MKp","TrendItem");var n=e("./BandaQQConstants");cc.Class({extends:cc.Component,properties:{node1:{default:null,type:cc.Sprite},node2:{default:null,type:cc.Sprite},lbNode1:{default:null,type:cc.Label},lbNode2:{default:null,type:cc.Label},nodeDraw:{default:null,type:cc.Node},type_red:{default:null,type:cc.Label},type_blue:{default:null,type:cc.Label},dot_trend_red:{default:null,type:cc.SpriteFrame},dot_trend_blue:{default:null,type:cc.SpriteFrame},dot_trend_lose:{default:null,type:cc.SpriteFrame},node_gach:{default:null,type:cc.Node},gach:{default:null,type:cc.Sprite}},setData:function(e){var t=e.redHand.point,a=e.blueHand.point;this.lbNode1.string=t||0,this.lbNode2.string=a||0,t>a?(this.node1.spriteFrame=this.dot_trend_red,this.node2.spriteFrame=this.dot_trend_lose,this.nodeToDraw=this.node1.node):t<a?(this.node2.spriteFrame=this.dot_trend_blue,this.node1.spriteFrame=this.dot_trend_lose,this.nodeToDraw=this.node2.node):(this.nodeDraw.active=!0,this.node1.spriteFrame=this.dot_trend_lose,this.node2.spriteFrame=this.dot_trend_lose,this.nodeToDraw=this.nodeDraw),this.type_red.string=n.BandaQQHandsType[e.redHand.type],this.type_blue.string=n.BandaQQHandsType[e.blueHand.type]},setGach:function(e){this.node_gach.active=!0,this.node_gach.x=e.x,this.node_gach.y=e.y,this.node_gach.angle=e.angle,this.gach.node.height=e.height},start:function(){}}),cc._RF.pop()},{"./BandaQQConstants":"BandaQQConstants"}]},{},["BandaChip","BandaQQ","BandaQQConstants","BandaQQNetworkTransport","BandaQQPresenter","BandaQQRuleDialog","Domino","TrendItem"]);