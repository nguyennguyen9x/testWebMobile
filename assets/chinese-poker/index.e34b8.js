window.__require=function e(t,a,i){function r(n,o){if(!a[n]){if(!t[n]){var l=n.split("/");if(l=l[l.length-1],!t[l]){var c="function"==typeof __require&&__require;if(!o&&c)return c(l,!0);if(s)return s(l,!0);throw new Error("Cannot find module '"+n+"'")}n=l}var h=a[n]={exports:{}};t[n][0].call(h.exports,function(e){return r(t[n][1][e]||e)},h,h.exports,e,t,a,i)}return a[n].exports}for(var s="function"==typeof __require&&__require,n=0;n<i.length;n++)r(i[n]);return r}({PusoyCard:[function(e,t,a){"use strict";cc._RF.push(t,"cd401+jJFpJGb5nI1mFcEZt","PusoyCard");var i=this&&this.__decorate||function(e,t,a,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,a,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(n=(s<3?r(n):s>3?r(t,a,n):r(t,a))||n);return s>3&&n&&Object.defineProperty(t,a,n),n};Object.defineProperty(a,"__esModule",{value:!0});const{ccclass:r,property:s}=cc._decorator,n={1:"co",2:"ro",3:"tep",4:"bich"};let o=class extends cc.Component{constructor(){super(...arguments),this.imgBackground=null,this.starPusoy=null,this.redBg=null,this.darkBg=null,this.value=null,this.iconSmall=null,this.iconLarge=null,this.imageSpritesPusoy=null,this.cardBorder=null,this.animLapLanh=null,this.data=null,this.tweenLapLanh=null}onLoad(){this.tweenLapLanh=null}setData(e,t){this.data={rank:e,suit:t},this.value.node.color=1===t||2===t?new cc.Color(211,6,25):new cc.Color(0,0,0);let a=e;14===Number(a)&&(a=1),this.value.spriteFrame=this.imageSpritesPusoy.getSpriteFrame(`card_${a}`),this.iconSmall.spriteFrame=this.imageSpritesPusoy.getSpriteFrame(`card_${n[t]}_small`),this.iconLarge.spriteFrame=this.imageSpritesPusoy.getSpriteFrame(`card${a>10?"_"+a:""}_${n[t]}`)}hideCardPusoy(){this.redBg.node.active=!0}showCardPusoy(){this.redBg.node.active=!1}isShow(){return!this.redBg.node.active}hideCardAnimPusoy(){let e=this.node.scaleX;cc.tween(this.node).to(.1,{scaleX:0}).call(()=>{this.redBg.node.active=!0}).to(.3,{scaleX:e}).start()}showCardAnimPusoy(){cc.tween(this.node).to(.1,{scaleX:0}).call(()=>{this.redBg.node.active=!1}).to(.3,{scaleX:this.node.scaleX}).start()}showShadowCard(){this.darkBg.node.active=!0}hideShadowCard(){this.darkBg.node.active=!1}setDark(e){this.darkBg.node.active=e}setBorder(e){this.cardBorder.node.active=e}setColorCard(e){this.imgBackground.node.color=e}setOpacity(e){this.imgBackground.node.opacity=e}isDark(){return this.darkBg.node.active}stopLapLanh(){this.animLapLanh.node.active=!1}showLapLanh(){this.darkBg.node.active||(this.node.getActionByTag(1)&&this.node.stopActionByTag(1),cc.tween(this.node).tag(1).call(()=>{this.animLapLanh.node.active=!0,this.animLapLanh.animation="animation"}).delay(1).call(()=>{this.stopLapLanh()}).start())}showStarPusoy(){this.starPusoy.node.active=!0,this.starPusoy.node.stopAllActions(),this.starPusoy.node.scale=10,this.starPusoy.node.opacity=0,this.starPusoy.node.angle=180,cc.tween(this.starPusoy.node).parallel(cc.tween().to(.5,{scale:1},{easing:"cubicOut"}),cc.tween().to(.5,{angle:0},{easing:"cubicOut"}),cc.tween().to(.3,{opacity:255})).start()}hideStarPusoy(){this.starPusoy.node.active=!1}setStarPusoyColor(e){this.starPusoy.node.color=e}};i([s(cc.Sprite)],o.prototype,"imgBackground",void 0),i([s(cc.Sprite)],o.prototype,"starPusoy",void 0),i([s(cc.Sprite)],o.prototype,"redBg",void 0),i([s(cc.Sprite)],o.prototype,"darkBg",void 0),i([s(cc.Sprite)],o.prototype,"value",void 0),i([s(cc.Sprite)],o.prototype,"iconSmall",void 0),i([s(cc.Sprite)],o.prototype,"iconLarge",void 0),i([s(cc.SpriteAtlas)],o.prototype,"imageSpritesPusoy",void 0),i([s(cc.Sprite)],o.prototype,"cardBorder",void 0),i([s(sp.Skeleton)],o.prototype,"animLapLanh",void 0),o=i([r],o),a.default=o,cc._RF.pop()},{}],PusoyChip:[function(e,t,a){"use strict";cc._RF.push(t,"d91acn1mZVChpYACAiCzKJX","PusoyChip");var i=this&&this.__decorate||function(e,t,a,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,a,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(n=(s<3?r(n):s>3?r(t,a,n):r(t,a))||n);return s>3&&n&&Object.defineProperty(t,a,n),n};Object.defineProperty(a,"__esModule",{value:!0});const r=e("../../lobby/src/common/Utils"),{ccclass:s,property:n}=cc._decorator;let o=class extends cc.Component{constructor(){super(...arguments),this.sprite=null,this.label=null,this.chipSprites=[]}setData(e){this.sprite.spriteFrame=this.chipSprites[e.spriteIndex],this.label.string=r.default.formatBetNumber(e.chip)||"0"}};i([n(cc.Sprite)],o.prototype,"sprite",void 0),i([n(cc.Label)],o.prototype,"label",void 0),i([n([cc.SpriteFrame])],o.prototype,"chipSprites",void 0),o=i([s],o),a.default=o,cc._RF.pop()},{"../../lobby/src/common/Utils":void 0}],PusoyConstants:[function(e,t,a){"use strict";cc._RF.push(t,"047d5Q1YYhJVK7SBaODODdk","PusoyConstants"),Object.defineProperty(a,"__esModule",{value:!0}),a.DeckOfCards=a.HandBonusType=a.HandRanking=a.PointType=a.SpecialCardAnimationName=a.SpecialCardFrameName=a.CardTypeFrameName=a.CardTypeValue=a.CardTypeString=a.CardTypeCode=void 0,function(e){e[e.HIGH_CARD=-1]="HIGH_CARD",e[e.PAIR=0]="PAIR",e[e.TWO_PAIRS=1]="TWO_PAIRS",e[e.THREE_OF_A_KIND=2]="THREE_OF_A_KIND",e[e.STRAIGHT=3]="STRAIGHT",e[e.FLUSH=4]="FLUSH",e[e.FULL_HOUSE=5]="FULL_HOUSE",e[e.FOUR_OF_A_KIND=6]="FOUR_OF_A_KIND",e[e.STRAIGHT_FLUSH=7]="STRAIGHT_FLUSH"}(a.CardTypeCode||(a.CardTypeCode={})),function(e){e.HIGH_CARD="High Card",e.PAIR="Pair",e.TWO_PAIRS="Two pairs",e.THREE_OF_A_KIND="Three of a kind",e.STRAIGHT="Straight",e.FLUSH="Flush",e.FULL_HOUSE="Full house",e.FOUR_OF_A_KIND="Four of a kind",e.STRAIGHT_FLUSH="Straight flush"}(a.CardTypeString||(a.CardTypeString={})),function(e){e[e.HIGH_CARD=-1e5]="HIGH_CARD",e[e.PAIR=0]="PAIR",e[e.TWO_PAIRS=1e5]="TWO_PAIRS",e[e.THREE_OF_A_KIND=2e5]="THREE_OF_A_KIND",e[e.STRAIGHT=3e5]="STRAIGHT",e[e.FLUSH=4e5]="FLUSH",e[e.FULL_HOUSE=5e5]="FULL_HOUSE",e[e.FOUR_OF_A_KIND=6e5]="FOUR_OF_A_KIND",e[e.STRAIGHT_FLUSH=7e5]="STRAIGHT_FLUSH"}(a.CardTypeValue||(a.CardTypeValue={})),function(e){e.HIGH_CARD_WIN="highcard_3",e.PAIR_WIN="pair_3",e.TWO_PAIRS_WIN="two_pair_3",e.THREE_OF_A_KIND_WIN="three_of_a_kind_3",e.STRAIGHT_WIN="straight_3",e.FLUSH_WIN="flush_3",e.FULL_HOUSE_WIN="fullhouse_3",e.FOUR_OF_A_KIND_WIN="four_of_a_kind_3",e.STRAIGHT_FLUSH_WIN="straight_flush_3",e.HIGH_CARD_LOSE="highcard_4",e.PAIR_LOSE="pair_4",e.TWO_PAIRS_LOSE="two_pair_4",e.THREE_OF_A_KIND_LOSE="three_of_a_kind_4",e.STRAIGHT_LOSE="straight_4",e.FLUSH_LOSE="flush_4",e.FULL_HOUSE_LOSE="fullhouse_4",e.FOUR_OF_A_KIND_LOSE="four_of_a_kind_4",e.STRAIGHT_FLUSH_LOSE="straight_flush_4"}(a.CardTypeFrameName||(a.CardTypeFrameName={})),function(e){e.GRAND_DRAGON="Grand_Dragon",e.DRAGON="Dragon",e.SAME_COLOR="Same_Colors",e.SIX_PAIRS="Six_Pairs",e.THREE_FLUSHES="Three_Flushes",e.THREE_STRAIGHT="three_straight"}(a.SpecialCardFrameName||(a.SpecialCardFrameName={})),function(e){e.GRAND_DRAGON="granddragon",e.DRAGON="dragon",e.SAME_COLOR="samecolour",e.SIX_PAIRS="6pairs",e.THREE_FLUSHES="3flushes",e.THREE_STRAIGHT="3straights"}(a.SpecialCardAnimationName||(a.SpecialCardAnimationName={})),function(e){e[e.Point_Normal=0]="Point_Normal",e[e.Point_Mis_Set=-1]="Point_Mis_Set",e[e.Point_Natural=1]="Point_Natural"}(a.PointType||(a.PointType={})),function(e){e[e.StraightFlush=0]="StraightFlush",e[e.FourOfAKind=1]="FourOfAKind",e[e.FullHouse=2]="FullHouse",e[e.Flush=3]="Flush",e[e.Straight=4]="Straight",e[e.ThreeOfAKind=5]="ThreeOfAKind",e[e.TwoPairs=6]="TwoPairs",e[e.Pair=7]="Pair",e[e.HighCard=8]="HighCard",e[e.NaturalThreeStraights=101]="NaturalThreeStraights",e[e.NaturalThreeOfFlushes=102]="NaturalThreeOfFlushes",e[e.NaturalSixPairs=103]="NaturalSixPairs",e[e.NaturalFullColors=104]="NaturalFullColors",e[e.NaturalDragon=105]="NaturalDragon",e[e.NaturalCleanDragon=106]="NaturalCleanDragon"}(a.HandRanking||(a.HandRanking={})),function(e){e[e.None=0]="None",e[e.MisSet=1]="MisSet",e[e.Scoop=2]="Scoop",e[e.ScoopAll=3]="ScoopAll",e[e.BonusFullHouseMidHand=101]="BonusFullHouseMidHand",e[e.BonusThreeOfAKindFrontHand=102]="BonusThreeOfAKindFrontHand",e[e.BonusFourOfAKindBackHand=103]="BonusFourOfAKindBackHand",e[e.BonusStraightFlushBackHand=104]="BonusStraightFlushBackHand",e[e.BonusFourOfAKindMidHand=105]="BonusFourOfAKindMidHand",e[e.BonusStraightFlushMidHand=106]="BonusStraightFlushMidHand",e[e.BonusNaturalThreeStraights=201]="BonusNaturalThreeStraights",e[e.BonusNaturalThreeOfFlushes=202]="BonusNaturalThreeOfFlushes",e[e.BonusNaturalSixPairs=203]="BonusNaturalSixPairs",e[e.BonusNaturalFullColors=204]="BonusNaturalFullColors",e[e.BonusNaturalDragon=205]="BonusNaturalDragon",e[e.BonusNaturalCleanDragon=206]="BonusNaturalCleanDragon"}(a.HandBonusType||(a.HandBonusType={})),a.DeckOfCards=[{rank:2,suit:1},{rank:3,suit:1},{rank:4,suit:1},{rank:5,suit:1},{rank:6,suit:1},{rank:7,suit:1},{rank:8,suit:1},{rank:9,suit:1},{rank:10,suit:1},{rank:11,suit:1},{rank:12,suit:1},{rank:13,suit:1},{rank:14,suit:1},{rank:2,suit:2},{rank:3,suit:2},{rank:4,suit:2},{rank:5,suit:2},{rank:6,suit:2},{rank:7,suit:2},{rank:8,suit:2},{rank:9,suit:2},{rank:10,suit:2},{rank:11,suit:2},{rank:12,suit:2},{rank:13,suit:2},{rank:14,suit:2},{rank:2,suit:3},{rank:3,suit:3},{rank:4,suit:3},{rank:5,suit:3},{rank:6,suit:3},{rank:7,suit:3},{rank:8,suit:3},{rank:9,suit:3},{rank:10,suit:3},{rank:11,suit:3},{rank:12,suit:3},{rank:13,suit:3},{rank:14,suit:3},{rank:2,suit:4},{rank:3,suit:4},{rank:4,suit:4},{rank:5,suit:4},{rank:6,suit:4},{rank:7,suit:4},{rank:8,suit:4},{rank:9,suit:4},{rank:10,suit:4},{rank:11,suit:4},{rank:12,suit:4},{rank:13,suit:4},{rank:14,suit:4}],cc._RF.pop()},{}],PusoyController:[function(e,t,a){"use strict";cc._RF.push(t,"ec1eaDl/zhOyaBA8S2MCoE1","PusoyController");var i,r=this&&this.__decorate||function(e,t,a,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,a,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(n=(s<3?r(n):s>3?r(t,a,n):r(t,a))||n);return s>3&&n&&Object.defineProperty(t,a,n),n};Object.defineProperty(a,"__esModule",{value:!0});const s=e("../../lobby/src/audio/AudioController"),n=e("../../lobby/src/common/GlobalApp"),o=e("../../lobby/src/language/LanguageController"),l=e("../../lobby/src/common/Utils"),c=e("../../lobby/src/dialogs/banner/BannerDialog"),h=e("../../lobby/src/common/Constants"),d=e("../../lobby/src/game/GamePresenter"),u=e("../../lobby/src/common/User"),p=e("../../lobby/src/dialogs/playerinfo/PlayerInfoDialog"),g=e("../../lobby/src/dialogs/option/OptionDialog"),C=e("../../lobby/src/dialogs/chatingame/ChatInGameDialog"),f=e("../../lobby/src/chat/ChatPresenter"),m=e("./PusoyRuleDialog"),y=e("../../lobby/src/scripts/ingame/BubbleChat"),k=e("../../lobby/src/scripts/ingame/PlayerCasino"),S=e("./PusoyLogic"),T=e("./PusoyNetworkTransport"),v=e("./PusoyUtils"),b=e("./PusoyJackpot"),A=e("./PusoyHandCards"),P=e("./PusoyConstants"),_=e("./PusoyChip"),{ccclass:I,property:E}=cc._decorator;let D=i=class extends cc.Component{constructor(){super(...arguments),this.table=null,this.players=[],this.bgSortCard=null,this.playerCards=[],this.cardsPrefab=null,this.playerStates=[],this.btnCombine=null,this.zoomInPos=[],this.lbTIme=null,this.animStartCompare=null,this.timeLine=null,this.lbTimeLine=null,this.dongHo=null,this.lbDongHo=null,this.playerStateSprites=null,this.playerTotal=[],this.myScore=[],this.playerAnim=[],this.burnCardAnim=[],this.iconBomb=null,this.playerCasinoPrefab=null,this.hintBtns=[],this.hintBtnStar=null,this.bubbleChatPrefab=null,this.lbTextChi=[],this.iconMarkChi=[],this.iconMarkSprites=[],this.bgChiSprites=[],this.lbInfo=null,this.specialCard=null,this.btnDeclare=null,this.icBack=null,this.bgSpecial=null,this.playerBinhSpecial=[],this.animationBomb=null,this.animationBurnCard=null,this.animationSapCaLang=null,this.animationTank=null,this.burnCardSprite=null,this.bgThrow=null,this.jackpotNode=null,this.jackpotPrefab=null,this.binhSpecialAvt=null,this.binhSpecialName=null,this.bgJackpot=null,this.jackpotChipWin=null,this.animJackpot=null,this.spriteFrameExitMatch=null,this.spriteFrameChangeMatch=null,this.chipPrefab=null,this.notificationPanel=null,this.tableAudio=null,this.presences=[],this.tmpPresenceCards=[],this.gameState=null,this.countdownTime=5,this.startAnimEndCountDown=!1,this.timelineValue=0,this.timelineprogress=0,this.isArranging=!1,this.isZooming=!1,this.isRewarded=!1,this.isGameEnded=!1,this.gameResult=null,this.gameJackpot=null,this.jpTreasure=null,this.gameBonus=null,this.gameBalances=null,this.targetCards=[],this.isMoving=!1,this.isCombine=!1,this.holdingCardPos=null,this.currentHoldingCard=-1,this.destPos=[],this.isTappedAgain=!1,this.isTouchOnCard=!1,this.isSwapping=!1,this.isInitMovingCards=!1,this.updateTableCallStack=[],this.cardData=Array(4).fill([]),this.isPlaying=!1}static getInstance(){return this.instance}onLoad(){i.instance=this,T.default.subscribe(),s.default.getInstance().playMusic(this.tableAudio,!0),this.presences=[],this.tmpPresenceCards=[],this.gameState=null,this.countdownTime=5,this.startAnimEndCountDown=!1,this.timelineValue=0,this.timelineprogress=0,this.isArranging=!1,this.isZooming=!1,this.isRewarded=!1,this.isGameEnded=!1,this.gameResult=null,this.gameJackpot=null,this.jpTreasure=null,this.gameBonus=null,this.gameBalances=null,this.targetCards=[],this.isMoving=!1,this.isCombine=!1,this.holdingCardPos=null,this.currentHoldingCard=-1,this.destPos=[],this.isTappedAgain=!1,this.isTouchOnCard=!1,this.isSwapping=!1,this.isInitMovingCards=!1,this.updateTableCallStack=[],this.cardData=Array(4).fill([]),this.setupTouchEvents()}setupTouchEvents(){this.bgSortCard.on(cc.Node.EventType.TOUCH_START,e=>{if(this.isSwapping)return;if(!this.isArranging)return;let t=cc.v3(e.getLocation().x-this.playerCards[0].x-cc.winSize.width/2,e.getLocation().y-this.playerCards[0].y-cc.winSize.height/2);this.isTouchOnCard=!1,this.playerCards[0].children[0].children.forEach((e,a)=>{e.getBoundingBox().contains(cc.v2(t))&&(this.isTouchOnCard=!0,this.holdingCardPos=t,this.currentHoldingCard=a,-1===this.targetCards.findIndex(e=>e===a)?(5===this.targetCards.length&&(this.getPlayerCards(0).setDark(this.targetCards,!1),this.getPlayerCards(0).setBorder(this.targetCards,!1),this.getPlayerCards(0).setOpacity(this.targetCards,255),this.targetCards=[]),this.targetCards.push(a)):this.isTappedAgain=!0,this.getPlayerCards(0).setDark(this.targetCards,!0),this.getPlayerCards(0).setBorder(this.targetCards,!0),this.getPlayerCards(0).setOpacity(this.targetCards,255))})},this),this.bgSortCard.on(cc.Node.EventType.TOUCH_MOVE,e=>{if(this.isSwapping)return;if(!this.isTouchOnCard)return;let t,a=cc.v3(e.getLocation().x-this.playerCards[0].x-cc.winSize.width/2,e.getLocation().y-this.playerCards[0].y-cc.winSize.height/2).sub(this.holdingCardPos);if(a.mag()<=10)return;this.isInitMovingCards||(this.getPlayerCards(0).initMovingCards(this.targetCards),this.isInitMovingCards=!0),this.isMoving=!0,this.getPlayerCards(0).moveCards(this.targetCards,a),this.getPlayerCards(0).hideAllCardEffect(),this.getPlayerCards(0).setDark(this.targetCards,!0),this.getPlayerCards(0).setBorder(this.targetCards,!0),this.getPlayerCards(0).setOpacity(this.targetCards,127);let i=this.targetCards.length;this.destPos=[];for(let r=12;r>=0;r--){let e=r;if(this.playerCards[0].children[0].children[r].getBoundingBox().contains(cc.v2(this.getPlayerCards(0).getCenterMovingCard()))){if((t=1===this.getChi(r)?3:5)<i)return;this.destPos=this.getListPickCard(this.targetCards,this.currentHoldingCard,e),this.getPlayerCards(0).hideAllCardEffect(),this.getPlayerCards(0).setDark(this.targetCards,!0),this.getPlayerCards(0).setBorder(this.targetCards,!1),this.getPlayerCards(0).setOpacity(this.targetCards,127);for(let e=0;e<this.destPos.length;e++){let t=this.destPos[e];-1===this.targetCards.indexOf(t)?(this.getPlayerCards(0).setDark([t],!0),this.getPlayerCards(0).setBorder([t],!0),this.getPlayerCards(0).setOpacity([t],255)):(this.getPlayerCards(0).setDark([t],!0),this.getPlayerCards(0).setBorder([t],!0),this.getPlayerCards(0).setOpacity([t],127))}break}}},this),this.bgSortCard.on(cc.Node.EventType.TOUCH_END,e=>{if(this.isSwapping)return;if(!this.isTouchOnCard)return;T.default.sendActionSignal();let t=cc.v2(e.getLocation().x-this.playerCards[0].x-cc.winSize.width/2,e.getLocation().y-this.playerCards[0].y-cc.winSize.height/2);if(this.targetCards.length>0&&this.destPos.length>0){if(0===this.targetCards.filter(e=>-1===this.destPos.findIndex(t=>t===e)).length)return this.isMoving&&(this.getPlayerCards(0).hideAllCardEffect(),this.targetCards=[],this.isMoving=!1),this.getPlayerCards(0).destroyMovingCards(),this.isInitMovingCards=!1,this.holdingCardPos=null,this.currentHoldingCard=-1,this.destPos=[],this.isTouchOnCard=!1,this.isTappedAgain=!1,void this.checkAndSetChi();this.isSwapping=!0,this.swapCards()}else{if(this.isMoving)this.getPlayerCards(0).hideAllCardEffect(),this.targetCards=[],this.isMoving=!1,this.isTappedAgain=!1;else for(let e=12;e>=0;e--)if(this.playerCards[0].children[0].children[e].getBoundingBox().contains(t)){let t=this.targetCards.findIndex(t=>t===e);-1!==t&&this.isTappedAgain&&(this.getPlayerCards(0).setDark([e],!1),this.getPlayerCards(0).setBorder([e],!1),this.getPlayerCards(0).setOpacity([e],255),this.targetCards.splice(t,1),this.isTappedAgain=!1)}this.getPlayerCards(0).destroyMovingCards(),this.isInitMovingCards=!1,this.holdingCardPos=null,this.currentHoldingCard=-1,this.destPos=[],this.isTouchOnCard=!1,this.checkAndSetChi()}},this)}update(e){this.timelineprogress>1&&this.players.forEach((e,t)=>{var a,i;if(e.active){if(!(null===(a=e.getChildByName("player"))||void 0===a?void 0:a.getComponent(k.default).isArranging)||e.getChildByName("player").getComponent(k.default).id===n.default.getInstance().matchInfo.self.user_id||!this.getPlayerCards(t))return;null===(i=this.getPlayerCards(t))||void 0===i||i.swapCardAnim(this.timelineprogress)}}),this.isArranging&&this.timelineprogress>.1&&(this.timelineprogress<=1&&this.isCombine&&this.onShowCard(),this.timelineprogress-=e,this.lbTimeLine.string=Math.floor(this.timelineprogress)+"",this.lbDongHo.string=Math.floor(this.timelineprogress)+"",Math.floor(this.timelineprogress)<10&&(this.lbDongHo.node.color=cc.Color.RED,this.lbTimeLine.node.color=cc.Color.RED,this.startAnimEndCountDown||(this.startAnimEndCountDown=!0,this.triggerEndTimeAnim(this.lbDongHo.node),this.triggerEndTimeAnim(this.lbTimeLine.node))),this.timeLine.progress=this.timelineprogress/this.timelineValue)}start(){this.setMatchInfo()}setMatchInfo(){var e;f.default.getInstance().joinChatRoom(n.default.getInstance().matchInfo.match_id,this);let t=JSON.parse(n.default.getInstance().matchInfo.label),a=t.tableId.slice(0,5);t.tableId.length>5&&(a+="..."),this.lbInfo.string=`ID: ${a}\nBertaruh: ${l.default.formatWalletNumber(t.markUnit)}`,localStorage.setItem("isLeave","false"),localStorage.setItem("isChangeMatch","false"),t.gameState!==h.Game.GAME_STATE.RUN&&t.gameState!==h.Game.GAME_STATE.PREPARE||(n.default.getInstance().isReconnected=t.gameState===h.Game.GAME_STATE.RUN,this.isPlaying=(null===(e=null==t?void 0:t.playingPlayers)||void 0===e?void 0:e.findIndex(e=>e===u.default.userId))>=0,d.default.syncTable())}onClickRule(){m.default.show(this.node)}loadJackpot(e){if(!e)return;if(this.jackpotNode.children[0])return void this.jackpotNode.children[0].getComponent(b.default).setData(e.chips);let t=cc.instantiate(this.jackpotPrefab);t.getComponent(b.default).setData(e.chips),this.jackpotNode.addChild(t)}getPlayerCards(e){var t,a;return null===(a=null===(t=this.playerCards[e])||void 0===t?void 0:t.children[0])||void 0===a?void 0:a.getComponent(A.default)}randomCard(){let e=[],t=[].concat(P.DeckOfCards);for(let a=0;a<13;a++){let a=Math.floor(Math.random()*(t.length-1));e.push(t.splice(a,1)[0])}return e}removePresences(e){}addPresences(e){if(this.gameState===h.Game.GAME_STATE.RUN)for(let t=0;t<e.length;t++){let a=this.players.find(e=>!1===e.active);a.active=!0;let i=cc.instantiate(this.playerCasinoPrefab);i.scale=.8;let r={id:e[t].id,user_name:e[t].userName,wallet:e[t].wallet,avatar_id:e[t].avatarId,vipLevel:e[t].vipLevel,sId:e[t].sid};i.getComponent(k.default).setData(r),a.addChild(i,0,"player")}}showNotification(e){this.notificationPanel.active=!0;let t=this.notificationPanel.getComponentInChildren(cc.Label),a="";cc.Tween.stopAllByTarget(this.notificationPanel),cc.tween(this.notificationPanel).repeatForever(cc.tween().call(()=>{a=".",t.string=e+a}).delay(1).call(()=>{a="..",t.string=e+a}).delay(1).call(()=>{a="...",t.string=e+a}).delay(1)).start()}hideNotification(){cc.Tween.stopAllByTarget(this.notificationPanel),this.notificationPanel.active=!1}loadPlayingGame(e){e.gameState>h.Game.GAME_STATE.RUN&&-1===e.players.findIndex(e=>!0===e.isPlaying&&e.id===n.default.getInstance().matchInfo.self.user_id)?this.showNotification(o.default.getInstance().getString("binh_wait_for_next_game")):(this.isArranging=!0,this.timeLine.node.active=!0,this.timelineValue=e.remainTime,this.lbTimeLine.string=e.remainTime,this.lbDongHo.string=e.remainTime,this.startAnimEndCountDown=!1,this.dongHo.active=!0,this.timelineprogress=e.remainTime,e.players.filter(e=>!0===e.isPlaying&&e.id!==n.default.getInstance().matchInfo.self.user_id).forEach(t=>{switch(t.cardStatus){case h.Game.CARD_EVENT.COMBINE:this.updateGameState([t.id],"arranging");break;case h.Game.CARD_EVENT.SHOW:case h.Game.CARD_EVENT.DECLARE:this.updateGameState([t.id],"ready");break;default:this.updateGameState([t.id],"arranging"),console.log("State update card not found ",e)}}))}loadSpectatingGame(e){if(-1===e.players.findIndex(e=>!0===e.isPlaying&&e.id===n.default.getInstance().matchInfo.self.user_id)){if(e.gameState>h.Game.GAME_STATE.RUN)return void this.showNotification(o.default.getInstance().getString("binh_wait_for_next_game"));this.showNotification(o.default.getInstance().getString("txt_view_table"))}this.isArranging=!0,this.timeLine.node.active=!0,this.timelineValue=e.remainTime,this.lbTimeLine.string=e.remainTime,this.lbDongHo.string=e.remainTime,this.timelineprogress=e.remainTime,this.dongHo.active=!0,this.startAnimEndCountDown=!1,e.players.filter(e=>!0===e.isPlaying).forEach(t=>{if(t.id===n.default.getInstance().matchInfo.self.user_id)return;let a=this.players.findIndex(e=>e.getChildByName("player").getComponent(k.default).id===t.id);if(-1!=a){this.playerCards[a].destroyAllChildren();let e=cc.instantiate(this.cardsPrefab);e.getComponent(A.default).generateCards([]),e.getComponent(A.default).hideCards(),e.getComponent(A.default).setScale(),this.playerCards[a].addChild(e),this.playerCards[a].active=!0}switch(t.cardStatus){case h.Game.CARD_EVENT.COMBINE:this.updateGameState([t.id],"arranging");break;case h.Game.CARD_EVENT.SHOW:case h.Game.CARD_EVENT.DECLARE:this.updateGameState([t.id],"ready");break;default:this.updateGameState([t.id],"arranging"),console.log("State update card not found ",e)}})}loadPresences(e){console.log("load presences----------------------------",e),this.hideNotification();let t=[].concat(e.players);this.players.forEach(e=>{var t;null===(t=e.getChildByName("player"))||void 0===t||t.destroy(),e.active=!1});let a=t.findIndex(e=>e.id===n.default.getInstance().matchInfo.self.user_id);if(a>=0){this.players[0].active=!0;let e=cc.instantiate(this.playerCasinoPrefab);e.scale=.8;let i={id:t[a].id,user_name:t[a].userName,wallet:t[a].wallet,avatar_id:t[a].avatarId,vipLevel:t[a].vipLevel,sId:t[a].sid};e.getComponent(k.default).setData(i),this.players[0].addChild(e,0,"player")}t.splice(a,1),e.gameState>=h.Game.GAME_STATE.RUN&&(t=t.filter(e=>!0===e.isPlaying));for(let i=0;i<t.length;i++){let e=this.players.find(e=>!1===e.active);e.active=!0;let a=cc.instantiate(this.playerCasinoPrefab);a.scale=.8;let r={id:t[i].id,user_name:t[i].userName,wallet:t[i].wallet,avatar_id:t[i].avatarId,vipLevel:t[i].vipLevel,sId:t[i].sid};a.getComponent(k.default).setData(r),e.addChild(a,0,"player")}}loadReconnectPresenceCard(e,t){console.log("loadReconnectPresenceCard",e,t),n.default.getInstance().isReconnected=null,this.scheduleOnce(()=>{this.hideAllPlayerCards(),this.cardData||(this.cardData=Array(4).fill([])),this.players.forEach((a,i)=>{if(this.playerCards[i].destroyAllChildren(),a.active){a.getChildByName("player").getComponent(k.default).id===e&&(this.cardData[i]=t.cards.map(e=>1===e.rank?{rank:14,suit:e.suit}:{rank:e.rank,suit:e.suit}));let r=cc.instantiate(this.cardsPrefab);r.getComponent(A.default).generateCards(this.cardData[i]),r.getComponent(A.default).setScale(),r.getComponent(A.default).showCards(),a.getChildByName("player").getComponent(k.default).id!==e&&r.getComponent(A.default).hideCards(),this.playerCards[i].addChild(r)}}),this.showAllPlayerCards()},.5),e===n.default.getInstance().matchInfo.self.user_id&&this.scheduleOnce(()=>{this.startArrangeCards()},1)}setPresenceCard(e,t){this.tmpPresenceCards.push({userId:e,presenceCard:t})}loadPresenceCard(e,t){console.log("loadPresenceCard",e,t),this.scheduleOnce(()=>{this.hideAllPlayerCards(),this.cardData||(this.cardData=Array(4).fill([])),this.players.forEach((a,i)=>{if(this.playerCards[i].destroyAllChildren(),a.active){a.getChildByName("player").getComponent(k.default).id===e&&(this.cardData[i]=t.cards.map(e=>1===e.rank?{rank:14,suit:e.suit}:{rank:e.rank,suit:e.suit}));let r=cc.instantiate(this.cardsPrefab);r.getComponent(A.default).generateCards(this.cardData[i]),this.playerCards[i].addChild(r),r.getComponent(A.default).showCards(),a.getChildByName("player").getComponent(k.default).id!==e&&r.getComponent(A.default).hideCards(),r.getComponent(A.default).setScale()}}),this.showAllPlayerCards(),this.players.forEach((t,a)=>{if(t.active){let i=!1;t.getChildByName("player").getComponent(k.default).id===e&&(i=!0),this.playerCards[a].children[0].getComponent(A.default).expandCards(i)}})},.5),e===n.default.getInstance().matchInfo.self.user_id&&this.scheduleOnce(()=>{this.startArrangeCards()},2)}swapCards(){let e=[].concat(this.targetCards),t=[].concat(this.destPos);this.getPlayerCards(0).swapCards(e,t)}changeAndCheckCards(){this.swapCardsData(),this.checkAndSetChi(),this.showLapLanh()}swapCardsData(){let e=this.targetCards;this.targetCards=this.targetCards.filter(e=>-1===this.destPos.findIndex(t=>t===e)),this.destPos=this.destPos.filter(t=>-1===e.findIndex(e=>e===t)),this.targetCards.forEach((e,t)=>{let a=this.cardData[0][e];this.cardData[0][e]=this.cardData[0][this.destPos[t]],this.cardData[0][this.destPos[t]]=a}),this.getPlayerCards(0).hideAllCardEffect(),this.isInitMovingCards=!1,this.isMoving=!1,this.holdingCardPos=null,this.currentHoldingCard=-1,this.isTappedAgain=!1,this.isTouchOnCard=!1,this.isSwapping=!1}onSwapChi(){this.isSwapping||(this.targetCards=[3,4,5,6,7],this.destPos=[8,9,10,11,12],this.isInitMovingCards||(this.getPlayerCards(0).initMovingCards(this.targetCards),this.isInitMovingCards=!0),this.isSwapping=!0,this.swapCards())}showLapLanh(){let e=[];this.targetCards.forEach(t=>{let a=this.getChi(t);-1===e.findIndex(e=>e===a)&&e.push(a)}),this.destPos.forEach(t=>{let a=this.getChi(t);-1===e.findIndex(e=>e===a)&&e.push(a)}),e.forEach(e=>{1===e?this.getChiValue(e-1)>0&&this.getPlayerCards(0).showLapLanh([0,1,2]):2===e?this.getChiValue(e-1)>P.CardTypeValue.STRAIGHT&&this.getPlayerCards(0).showLapLanh([3,4,5,6,7]):this.getChiValue(e-1)>P.CardTypeValue.STRAIGHT&&this.getPlayerCards(0).showLapLanh([8,9,10,11,12])}),this.targetCards=[],this.destPos=[]}checkSpecial(){let e=[];for(let t=0;t<3;t++){let a=-2,i=this.getChiCards(t);-2!==(a=this.getBiggestTypeCode(i))&&e.push(a)}if(S.default.checkBinhGrandDragon(this.cardData[0]))return console.log("grand dragon"),this.playerBinhSpecial[0].active=!0,this.playerBinhSpecial[0].getComponent(cc.Sprite).spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.GRAND_DRAGON),!0;if(S.default.checkBinhDragon(this.cardData[0]))return console.log("dragon"),this.playerBinhSpecial[0].active=!0,this.playerBinhSpecial[0].getComponent(cc.Sprite).spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.DRAGON),!0;if(S.default.checkBinhSameColor(this.cardData[0]))return console.log("same color"),this.playerBinhSpecial[0].active=!0,this.playerBinhSpecial[0].getComponent(cc.Sprite).spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.SAME_COLOR),!0;if(console.log(" this.cardData[0]",this.cardData[0]),S.default.checkBinhSixPairs(this.cardData[0]))return console.log("six pairs"),this.playerBinhSpecial[0].active=!0,this.playerBinhSpecial[0].getComponent(cc.Sprite).spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.SIX_PAIRS),!0;if(e[0]===P.CardTypeCode.FLUSH&&e[1]===P.CardTypeCode.FLUSH&&e[2]===P.CardTypeCode.FLUSH)return console.log("three flushes"),this.playerBinhSpecial[0].active=!0,this.playerBinhSpecial[0].getComponent(cc.Sprite).spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.THREE_FLUSHES),!0;if(e[1]===P.CardTypeCode.STRAIGHT&&e[2]===P.CardTypeCode.STRAIGHT){if(e[0]===P.CardTypeCode.STRAIGHT)return console.log("three straight"),this.playerBinhSpecial[0].active=!0,this.playerBinhSpecial[0].getComponent(cc.Sprite).spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.THREE_STRAIGHT),!0;if(e[0]===P.CardTypeCode.FLUSH&&v.default.getStraight(this.cardData[0].slice(0,3))[0])return console.log("three straight"),this.playerBinhSpecial[0].active=!0,this.playerBinhSpecial[0].getComponent(cc.Sprite).spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.THREE_STRAIGHT),!0}return!1}checkAndSetChi(){let e=[],t=!1;for(let a=0;a<3;a++){let i=-2,r=this.getChiCards(a);if(-2===(i=this.getBiggestTypeCode(r)))continue;e.push(i);let s=this.getCardTypeString(i,a);this.playerCards[0].children[0].getComponent(A.default).setColorCardChi(a,i,r);let n=s;switch(s){case P.CardTypeString.STRAIGHT_FLUSH:1===a&&(n=s+"(+9)"),2===a&&(n=s+"(+4)");break;case P.CardTypeString.FOUR_OF_A_KIND:1===a&&(n=s+"(+7)"),2===a&&(n=s+"(+3)");break;case P.CardTypeString.FULL_HOUSE:1===a&&(n=s+"(+1)");break;case P.CardTypeString.THREE_OF_A_KIND:0===a&&(n=s+"(+2)")}this.lbTextChi[a].string=n,this.iconMarkChi[a].spriteFrame=this.iconMarkSprites[0],this.zoomInPos[a].getComponent(cc.Sprite).spriteFrame=this.bgChiSprites[0],a<2&&this.getChiValue(a)>this.getChiValue(a+1)&&(t=!0,this.iconMarkChi[a].spriteFrame=this.iconMarkSprites[1],this.zoomInPos[a].getComponent(cc.Sprite).spriteFrame=this.bgChiSprites[1],0===a?(this.getPlayerCards(0).setDark([0,1,2],!0),this.getPlayerCards(0).setOpacity([0,1,2],255)):(this.getPlayerCards(0).setDark([3,4,5,6,7],!0),this.getPlayerCards(0).setOpacity([3,4,5,6,7],255)))}if(this.specialCard.spriteFrame=null,this.btnDeclare.node.active=!1,S.default.checkBinhGrandDragon(this.cardData[0]))return console.log("grand dragon"),this.specialCard.node.active=!0,this.specialCard.spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.GRAND_DRAGON),this.btnDeclare.node.active=!0,!0;if(S.default.checkBinhDragon(this.cardData[0]))return console.log("dragon"),this.specialCard.node.active=!0,this.specialCard.spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.DRAGON),this.btnDeclare.node.active=!0,!0;if(S.default.checkBinhSameColor(this.cardData[0]))return console.log("same color"),this.specialCard.node.active=!0,this.specialCard.spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.SAME_COLOR),this.btnDeclare.node.active=!0,!0;if(console.log(" this.cardData[0]",this.cardData[0]),S.default.checkBinhSixPairs(this.cardData[0]))return console.log("six pairs"),this.specialCard.node.active=!0,this.specialCard.spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.SIX_PAIRS),this.btnDeclare.node.active=!0,!0;if(e[0]===P.CardTypeCode.FLUSH&&e[1]===P.CardTypeCode.FLUSH&&e[2]===P.CardTypeCode.FLUSH)return console.log("three flushes"),this.specialCard.node.active=!0,this.specialCard.spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.THREE_FLUSHES),this.btnDeclare.node.active=!0,!0;if(e[1]===P.CardTypeCode.STRAIGHT&&e[2]===P.CardTypeCode.STRAIGHT){if(e[0]===P.CardTypeCode.STRAIGHT)return console.log("three straight"),this.specialCard.node.active=!0,this.specialCard.spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.THREE_STRAIGHT),this.btnDeclare.node.active=!0,!0;if(e[0]===P.CardTypeCode.FLUSH&&v.default.getStraight(this.cardData[0].slice(0,3))[0])return console.log("three straight"),this.specialCard.node.active=!0,this.specialCard.spriteFrame=this.playerStateSprites.getSpriteFrame(P.SpecialCardFrameName.THREE_STRAIGHT),this.btnDeclare.node.active=!0,!0}return!1}getChiValue(e){var t;let a=0,i=-2;switch(i=this.getBiggestTypeCode(this.getChiCards(e))){case P.CardTypeCode.STRAIGHT_FLUSH:a=P.CardTypeValue.STRAIGHT_FLUSH;let r=v.default.getStraightFlush(this.getChiCards(e))[0];if(14===r[0].rank){a+=100;break}a+=r[0].rank;break;case P.CardTypeCode.FOUR_OF_A_KIND:a=P.CardTypeValue.FOUR_OF_A_KIND;let s=v.default.get4ofAKind(this.getChiCards(e))[0];if(14===s[0].rank){a+=100;break}a+=s[0].rank;break;case P.CardTypeCode.FULL_HOUSE:a=P.CardTypeValue.FULL_HOUSE;let n=v.default.get3ofAKind(this.getChiCards(e))[0];if(14===n[0].rank){a+=100;break}a+=n[0].rank;break;case P.CardTypeCode.FLUSH:if(0===e){a=P.CardTypeValue.HIGH_CARD;let t=this.getChiCards(e).sort((e,t)=>t.rank-e.rank);14===t[t.length-1].rank&&(t=t.splice(t.length-1,1).concat(t));for(let e=0;e<t.length;e++)14!==t[e].rank?a+=100*t[e].rank/Math.pow(100,e):a+=1e4/Math.pow(100,e);break}{a=P.CardTypeValue.FLUSH;let t=v.default.getFlush(this.getChiCards(e))[0];for(let e=0;e<t.length;e++)14!==t[e].rank?a+=100*t[e].rank/Math.pow(100,e):a+=1e4/Math.pow(100,e);break}case P.CardTypeCode.STRAIGHT:if(0===e){a=P.CardTypeValue.HIGH_CARD;let t=this.getChiCards(e).sort((e,t)=>t.rank-e.rank);14===t[t.length-1].rank&&(t=t.splice(t.length-1,1).concat(t));for(let e=0;e<t.length;e++)14!==t[e].rank?a+=100*t[e].rank/Math.pow(100,e):a+=1e4/Math.pow(100,e);break}{a=P.CardTypeValue.STRAIGHT;let t=v.default.getStraight(this.getChiCards(e))[0];if(14===t[0].rank){a+=100;break}a+=t[0].rank;break}case P.CardTypeCode.THREE_OF_A_KIND:a=P.CardTypeValue.THREE_OF_A_KIND;let o=v.default.get3ofAKind(this.getChiCards(e))[0];if(14===o[0].rank){a+=100;break}a+=o[0].rank;break;case P.CardTypeCode.TWO_PAIRS:a=P.CardTypeValue.TWO_PAIRS;let l=S.default.listDoi(this.getChiCards(e))[0],c=S.default.listDoi(this.getChiCards(e))[1],h=[l[0]].concat([c[0]]).sort((e,t)=>t.rank-e.rank);14===h[1].rank&&(h=h.splice(1,1).concat(h));let d=this.getChiCards(e).find(e=>e.rank!==h[0].rank&&e.rank!==h[1].rank);h.push(d);for(let e=0;e<h.length;e++)14!==h[e].rank?a+=100*h[e].rank/Math.pow(100,e):a+=1e4/Math.pow(100,e);break;case P.CardTypeCode.PAIR:a=P.CardTypeValue.PAIR;let u=[].concat(this.getChiCards(e)),p=S.default.listDoi(u)[0];p.forEach(e=>{let t=u.findIndex(t=>t.rank===e.rank);-1!==t&&u.splice(t,1)}),u.sort((e,t)=>t.rank-e.rank),14===u[u.length-1].rank&&(u=u.splice(u.length-1,1).concat(u));let g=[p[0]].concat(u);for(let e=0;e<g.length;e++)14!==g[e].rank?a+=100*g[e].rank/Math.pow(100,e):a+=1e4/Math.pow(100,e);break;case P.CardTypeCode.HIGH_CARD:a=P.CardTypeValue.HIGH_CARD;let C=this.getChiCards(e).sort((e,t)=>t.rank-e.rank);14===(null===(t=C[C.length-1])||void 0===t?void 0:t.rank)&&(C=C.splice(C.length-1,1).concat(C));for(let e=0;e<C.length;e++)14!==C[e].rank?a+=100*C[e].rank/Math.pow(100,e):a+=1e4/Math.pow(100,e)}return a}getChiCards(e){switch(e){case 0:return this.cardData[0].slice(0,3);case 1:return this.cardData[0].slice(3,8);case 2:return this.cardData[0].slice(8,13)}return[]}getChi(e){return e<3?1:e>7?3:2}getListPickCard(e,t,a){let i,r,s,n=[],o=e.length,l=this.getChi(a);1===l?(i=0,r=2):2===l?(i=3,r=7):(i=8,r=12);for(let c=0;c<o;c++)if(e[c]===t){(s=a-c>=i?a-c:i)+o-1>r&&(s=r-o+1);for(let e=0;e<o;e++)n.push(e+s);break}return n}executeGame(){this.countdown(this.countdownTime)}countdown(e){this.lbTIme.string=e,cc.tween(this.lbTIme.node).repeat(1,cc.tween().to(.2,{scale:1}).delay(.8).call(()=>{this.lbTIme.node.scale=0})).call(()=>{}).start()}startGame(e){this.isPlaying=!0,cc.tween(this.animStartCompare.node).call(()=>{this.animStartCompare.node.active=!0,this.animStartCompare.animation="start",this.tmpPresenceCards.forEach(e=>{this.loadPresenceCard(e.userId,e.presenceCard)}),this.tmpPresenceCards=[]}).delay(1).call(()=>{this.animStartCompare.node.active=!1,this.dongHo.active=!0,this.isArranging=!0,this.timeLine.node.active=!0,this.startAnimEndCountDown=!1,this.timelineValue=e,this.timelineprogress=e,this.lbDongHo.string=e+"",this.lbDongHo.node.color=(new cc.Color).fromHEX("#915407"),this.lbTimeLine.string=e+"",this.lbTimeLine.node.color=cc.Color.YELLOW,cc.Tween.stopAllByTarget(this.lbDongHo.node),cc.Tween.stopAllByTarget(this.lbTimeLine.node)}).start()}matching(){n.default.getInstance().isReconnected=!1,this.hideNotification()}leaveMatch(){"true"===localStorage.getItem("isLeave")?(c.BannerData.setBannerData(h.Banner.ShowType.LEFT_MATCH,!0),T.default.onQuit()):"true"===localStorage.getItem("isChangeMatch")&&(this.icBack.active=!1,T.default.onQuit(()=>{n.default.getInstance().showProcessing(!0),this.hideAll(),cc.Tween.stopAllByTarget(this.node),this.unscheduleAllCallbacks(),setTimeout(()=>{let e=JSON.parse(n.default.getInstance().matchInfo.label);d.default.changeMatch(e.markUnit,n.default.getInstance().matchInfo)},2)},!1))}processReward(e){this.isArranging=!1,this.timeLine.node.active=!1,this.dongHo.active=!1,this.btnCombine.node.active=!1,this.isCombine&&this.onShowCard(),this.hideNotification(),this.animStartCompare.node.active=!0,this.animStartCompare.animation="compare",cc.tween(this.node).delay(1).call(()=>{this.animStartCompare.node.active=!1;for(let e=1;e<4;e++)this.playerStates[e].node.active=!1}).delay(.5).call(()=>{var t;null==e||e.forEach(e=>{if(e.presence){let t=this.players.findIndex(t=>t.active&&t.getChildByName("player").getComponent(k.default).id===e.presence),a=e.cards.map(e=>1===e.rank?{rank:14,suit:e.suit}:{rank:e.rank,suit:e.suit});if(-1!=t){if(!1===this.playerCards[t].active){this.playerCards[t].destroyAllChildren();let e=cc.instantiate(this.cardsPrefab);e.getComponent(A.default).generateCards(a),a=e.getComponent(A.default).sortChi(a),e.getComponent(A.default).updateCards(a),e.getComponent(A.default).hideCards(),e.getComponent(A.default).setScale(),this.playerCards[t].addChild(e),this.playerCards[t].active=!0}else 0!=t&&(this.getPlayerCards(t).hideCards(),this.getPlayerCards(t).setScale()),this.getPlayerCards(t).updateCards(a),a=[...this.getPlayerCards(t).sortChi(a)],this.getPlayerCards(t).updateCards(a);this.cardData[t]=a}}}),null===(t=this.getPlayerCards(0))||void 0===t||t.hideCardsAnim(),this.isGameEnded?(this.isGameEnded=!1,this.startCompare()):this.isRewarded=!0}).start()}endGame(e){this.loadJackpot(e.jpTreasure),this.gameResult=e.results,this.gameJackpot=e.jackpot,this.gameBonus=e.bonuses||[],cc.tween(this.node).delay(1).call(()=>{this.isRewarded?(this.isRewarded=!1,this.startCompare()):this.isGameEnded=!0}).start()}updateGameBalances(e){this.gameBalances=null==e?void 0:e.updates}setTimeUpdateWallet(){let e=0;for(let t=0;t<this.gameBalances.length;t++)if(this.gameBalances[t].amountChipAdd<0&&0===e)e=2;else if(this.gameBalances[t].amountChipAdd>0){e=4;break}return e}processUpdateWallet(){let e=this.gameBalances.filter(e=>parseInt(e.amountChipAdd)<0),t=this.gameBalances.filter(e=>parseInt(e.amountChipAdd)>0),a=cc.tween(this.node).delay(.1),i=JSON.parse(n.default.getInstance().matchInfo.label);e.length>0&&a.call(()=>{e.forEach(e=>{let t=this.getPlayerIndex(e.userId);this.flyChips(-parseInt(e.amountChipAdd)/i.markUnit,this.players[t].position,cc.v2(0,0),2.01,0)})}),t.length>0&&a.delay(2).call(()=>{t.forEach(e=>{let t=this.getPlayerIndex(e.userId);this.flyChips(parseInt(e.amountChipAdd)/i.markUnit,cc.v2(0,0),this.players[t].position,0,0)})}),a.delay(.1).call(()=>{e.forEach(e=>{var t,a,i;let r=this.getPlayerIndex(e.userId);null===(i=null===(a=null===(t=this.players[r])||void 0===t?void 0:t.getChildByName("player"))||void 0===a?void 0:a.getComponent(k.default))||void 0===i||i.showEffectWinLose(-1),this.scheduleOnce(()=>{var t,a,i,s,n,o;null===(i=null===(a=null===(t=this.players[r])||void 0===t?void 0:t.getChildByName("player"))||void 0===a?void 0:a.getComponent(k.default))||void 0===i||i.showEffectFlyMoney(parseInt(e.amountChipAdd)),null===(o=null===(n=null===(s=this.players[r])||void 0===s?void 0:s.getChildByName("player"))||void 0===n?void 0:n.getComponent(k.default))||void 0===o||o.updateWallet(e.amountChipCurrent)},.2)}),t.forEach(e=>{var t,a,i;let r=this.getPlayerIndex(e.userId);null===(i=null===(a=null===(t=this.players[r])||void 0===t?void 0:t.getChildByName("player"))||void 0===a?void 0:a.getComponent(k.default))||void 0===i||i.showEffectWinLose(1),this.scheduleOnce(()=>{var t,a,i,s,n,o;null===(i=null===(a=null===(t=this.players[r])||void 0===t?void 0:t.getChildByName("player"))||void 0===a?void 0:a.getComponent(k.default))||void 0===i||i.showEffectFlyMoney(parseInt(e.amountChipAdd)),null===(o=null===(n=null===(s=this.players[r])||void 0===s?void 0:s.getChildByName("player"))||void 0===n?void 0:n.getComponent(k.default))||void 0===o||o.updateWallet(e.amountChipCurrent)},.2)})}),a.start()}startCompare(){var e,t,a,i;let r=["frontFactor","middleFactor","backFactor"],s=["frontBonusFactor","middleBonusFactor","backBonusFactor"],l=null===(e=this.gameResult)||void 0===e?void 0:e.find(e=>e.userId===n.default.getInstance().matchInfo.self.user_id),c=this.gameJackpot,h=null===(t=this.gameResult)||void 0===t?void 0:t.filter(e=>-1===e.pointResult.type),d=null===(a=this.gameResult)||void 0===a?void 0:a.filter(e=>1===e.pointResult.type),u=null===(i=this.gameResult)||void 0===i?void 0:i.filter(e=>!e.pointResult.type||0===e.pointResult.type),p=this.gameBonus.filter(e=>e.type===P.HandBonusType.ScoopAll),g=this.gameBonus.filter(e=>e.type===P.HandBonusType.MisSet),C=this.gameBonus.filter(e=>e.type===P.HandBonusType.Scoop),f=this.setTimeUpdateWallet(),m=cc.tween(this.node).call(()=>{this.playerTotal.forEach(e=>{e.string="0"})}).delay(1);if(c&&m.call(()=>{this.processJackpot(c)}).delay(2),h.length>0&&m.call(()=>{this.processMisSet(h)}).delay(2),d.length>0&&m.call(()=>{this.processNatural(d)}).delay(2),u.length>1?m.call(()=>{this.setTotal(u,r,s,2),this.compareBlock(2,u),this.showScore(l,r,s,2)}).delay(3.5).call(()=>{this.setTotal(u,r,s,1),this.compareBlock(1,u),this.showScore(l,r,s,1)}).delay(3.5).call(()=>{this.setTotal(u,r,s,0),this.compareBlock(0,u),this.showScore(l,r,s,0)}).delay(3.5).call(()=>{this.hideAllPlayerShadowCards();for(let e=0;e<u.length;e++){let t=this.getPlayerIndex(u[e].userId);this.hideState(t)}}):1===u.length&&m.call(()=>{let e=this.getPlayerIndex(u[0].userId);this.getPlayerCards(e).showCardsAnim()}).delay(2),p.length>0){let e=[];for(let t=0;t<this.playerAnim.length;t++)e.push(this.playerAnim[t].node.y);m.call(()=>{this.processSapCaLang(p)}).delay(5).call(()=>{for(let t=0;t<this.playerAnim.length;t++)this.playerAnim[t].node.y=e[t]})}if(g.length>0){let e=2*g.length;m.call(()=>{this.processSapHam(g)}).delay(e)}if(C.length>0){let e=2*C.length;m.call(()=>{this.processSapHam(C)}).delay(e)}m.call(()=>{this.playerTotal.forEach((e,t)=>{!0===this.playerCards[t].active&&(e.node.parent.active=!0),this.gameResult.forEach(e=>{let t=this.getPlayerIndex(e.userId);e.scoreResult.totalFactor>=0?(this.playerTotal[t].string=`+${e.scoreResult.totalFactor}`,this.playerTotal[t].node.color=cc.Color.YELLOW):(this.playerTotal[t].string=`${e.scoreResult.totalFactor}`,this.playerTotal[t].node.color=cc.Color.WHITE)})})}).delay(2).call(()=>{this.hideAll(),this.processUpdateWallet()}).delay(f).call(()=>{for(let e=0;e<4;e++)this.hidePlayerAnimation(e);this.showNotification(o.default.getInstance().getString("binh_wait_for_next_game"))}).start()}showScore(e,t,a,i){if(!e)return;this.myScore[i].parent.active=!0,this.myScore[i].active=!0,e.scoreResult[t[i]]?e.scoreResult[t[i]]>0?this.myScore[i].getChildByName(`lbScore_${i+1}`).getComponent(cc.Label).string=`+${e.scoreResult[t[i]]}`:this.myScore[i].getChildByName(`lbScore_${i+1}`).getComponent(cc.Label).string=`${e.scoreResult[t[i]]}`:this.myScore[i].getChildByName(`lbScore_${i+1}`).getComponent(cc.Label).string="0",e.scoreResult[a[i]]>0?this.myScore[i].getChildByName(`lbScore_${i+1}`).getComponent(cc.Label).string+=` (+${e.scoreResult[a[i]]})`:e.scoreResult[a[i]]<0&&(this.myScore[i].getChildByName(`lbScore_${i+1}`).getComponent(cc.Label).string+=` (${e.scoreResult[a[i]]})`),(parseInt(e.scoreResult[t[i]])||0)+(parseInt(e.scoreResult[a[i]])||0)>0?this.myScore[i].getChildByName(`lbScore_${i+1}`).color=cc.Color.YELLOW:this.myScore[i].getChildByName(`lbScore_${i+1}`).color=cc.Color.WHITE;let r=this.getBiggestTypeCode(this.getChiCards(i)),s=this.getCardTypeString(r,i);this.myScore[i].getChildByName(`lbText_${i+1}`).getComponent(cc.Label).string=s}setTotal(e,t,a,i){null==e||e.forEach(e=>{let r=this.getPlayerIndex(e.userId),s=(parseInt(e.scoreResult[t[i]])||0)+(parseInt(e.scoreResult[a[i]])||0);this.addTotal(r,s)})}processJackpot(e){0===this.getPlayerIndex(e.userId)&&(this.bgJackpot.active=!0,this.jackpotChipWin.string=l.default.formatWalletNumber(e.chips),this.animJackpot.animation="animation",this.scheduleOnce(()=>{this.bgJackpot.active=!1},2))}processMisSet(e){null==e||e.forEach(e=>{let t=this.getPlayerIndex(e.userId);this.getPlayerCards(t).showCardsAnim(),this.playerAnim[t].node.active=!0,this.playerAnim[t].skeletonData=this.animationBurnCard,this.playerAnim[t].animation="animation",this.playerStates[t].spriteFrame=this.burnCardSprite,this.scheduleOnce(()=>{this.playerAnim[t].skeletonData=null,this.playerAnim[t].node.active=!1},1)})}processNatural(e){null==e||e.forEach(e=>{var t,a;let i=this.getPlayerIndex(e.userId);if(0===i){let a=this.getNaturalAnimationPath(null===(t=e.pointResult.natural)||void 0===t?void 0:t.ranking);this.bgSpecial.active=!0,this.bgSpecial.children[0].getComponent(sp.Skeleton).animation=a,this.binhSpecialAvt.spriteFrame=n.default.getInstance().getAvatarById(u.default.avatarId),this.binhSpecialName.string=u.default.displayName,this.scheduleOnce(()=>{this.bgSpecial.active=!1},2)}let r=this.getNaturalSpritePath(null===(a=e.pointResult.natural)||void 0===a?void 0:a.ranking),s=this.playerStateSprites.getSpriteFrame(r);this.playerBinhSpecial[i].active=!0,this.playerBinhSpecial[i].getComponent(cc.Sprite).spriteFrame=s,console.log(i),this.getPlayerCards(i).showCardsAnim()}),this.setNaturalTotal(this.gameResult)}setNaturalTotal(e){e.forEach(e=>{let t=this.getPlayerIndex(e.userId);this.playerTotal[t].node.parent.active=!1;let a=1===e.pointResult.type?parseInt(e.scoreResult.naturalFactor||0):0;a>0?(this.playerTotal[t].node.color=cc.Color.YELLOW,this.playerTotal[t].string=`+${a}`):(this.playerTotal[t].node.color=cc.Color.WHITE,this.playerTotal[t].string=`${a}`),this.playerTotal[t].node.parent.active=!0})}getNaturalAnimationPath(e){let t=null;switch(e){case P.HandRanking.NaturalThreeStraights:t=P.SpecialCardAnimationName.THREE_STRAIGHT;break;case P.HandRanking.NaturalThreeOfFlushes:t=P.SpecialCardAnimationName.THREE_FLUSHES;break;case P.HandRanking.NaturalSixPairs:t=P.SpecialCardAnimationName.SIX_PAIRS;break;case P.HandRanking.NaturalFullColors:t=P.SpecialCardAnimationName.SAME_COLOR;break;case P.HandRanking.NaturalDragon:t=P.SpecialCardAnimationName.DRAGON;break;case P.HandRanking.NaturalCleanDragon:t=P.SpecialCardAnimationName.GRAND_DRAGON}return t}getNaturalSpritePath(e){let t=null;switch(e){case P.HandRanking.NaturalThreeStraights:t=P.SpecialCardFrameName.THREE_STRAIGHT;break;case P.HandRanking.NaturalThreeOfFlushes:t=P.SpecialCardFrameName.THREE_FLUSHES;break;case P.HandRanking.NaturalSixPairs:t=P.SpecialCardFrameName.SIX_PAIRS;break;case P.HandRanking.NaturalFullColors:t=P.SpecialCardFrameName.SAME_COLOR;break;case P.HandRanking.NaturalDragon:t=P.SpecialCardFrameName.DRAGON;break;case P.HandRanking.NaturalCleanDragon:t=P.SpecialCardFrameName.GRAND_DRAGON}return t}processSapCaLang(e){let t=0;e.forEach((a,i)=>{let r=this.getPlayerIndex(a.lose);this.playerAnim[r].node.active=!0,1!==r&&2!==r||(this.playerAnim[r].node.angle=0),this.playerAnim[r].skeletonData=this.animationSapCaLang,this.playerAnim[r].animation="animation",this.scheduleOnce(()=>{this.playerAnim[r].node.active=!1,this.playerAnim[r].skeletonData=null},3),this.addTotal(r,0-(parseInt(a.factor)||0)),t+=parseInt(a.factor)||0,i===e.length-1&&this.addTotal(this.getPlayerIndex(a.win),t)})}processSapHam(e){let t=cc.tween(this.node).delay(0);e.forEach(e=>{let a=this.getPlayerIndex(e.win),i=this.getPlayerIndex(e.lose),r=parseInt(e.factor)||0;t.call(()=>{this.createTankAndBombAnimation(a,i,r)}).delay(2)}),t.start()}createTankAndBombAnimation(e,t,a){this.playerAnim[e].node.active=!1,this.playerAnim[e].node.angle=0,this.playerAnim[t].node.active=!0;let i=cc.tween(this.node),r="";if(0===e)switch(t){case 3:r="A1";break;case 2:r="A2";break;case 1:r="A3"}else if(1===e)switch(this.playerAnim[e].node.angle=-180,t){case 0:this.playerAnim[e].node.angle=-155,r="D4";break;case 3:r="D5";break;case 2:r="D6"}else if(2===e)switch(this.playerAnim[e].node.angle=-180,t){case 1:r="A1";break;case 0:r="A2";break;case 3:this.playerAnim[e].node.angle=-195,r="A3"}else switch(t){case 2:r="D4";break;case 1:r="D5";break;case 0:r="D6"}i.call(()=>{this.playerAnim[e].node.active=!0,this.playerAnim[e].skeletonData=this.animationTank,this.playerAnim[e].animation=r}).delay(1).call(()=>{let i=new cc.Node,r=i.addComponent(cc.Sprite),s=this.iconBomb;r.spriteFrame=s,i.setPosition(this.playerAnim[e].node.position),this.playerAnim[e].node.zIndex=2,this.table.addChild(i,0),cc.tween(i).to(.5,{position:this.playerAnim[t].node.position}).call(()=>{i.destroy(),this.playerAnim[t].node.active=!0,this.playerAnim[t].skeletonData=this.animationBomb,this.playerAnim[t].animation="animation",console.log("bomb animation"),this.scheduleOnce(()=>{console.log("bomb animation end "),this.playerAnim[t].node.active=!1,this.playerAnim[t].skeletonData=null},3),this.addTotal(e,a),this.addTotal(t,0-a)}).start()}).delay(1),i.start()}getPlayerId(e){var t;return null===(t=this.players[e].getChildByName("player"))||void 0===t?void 0:t.getComponent(k.default).id}getPlayerIndex(e){var t;let a=-1;for(let i=0;i<this.players.length;i++)(null===(t=this.players[i].getChildByName("player"))||void 0===t?void 0:t.getComponent(k.default).id)===e&&(a=i);return a}getCardTypeString(e,t){let a=P.CardTypeString.HIGH_CARD;switch(e){case P.CardTypeCode.HIGH_CARD:a=P.CardTypeString.HIGH_CARD;break;case P.CardTypeCode.PAIR:a=P.CardTypeString.PAIR;break;case P.CardTypeCode.TWO_PAIRS:a=P.CardTypeString.TWO_PAIRS;break;case P.CardTypeCode.THREE_OF_A_KIND:a=P.CardTypeString.THREE_OF_A_KIND;break;case P.CardTypeCode.STRAIGHT:if(0===t){a=P.CardTypeString.HIGH_CARD;break}a=P.CardTypeString.STRAIGHT;break;case P.CardTypeCode.FLUSH:if(0===t){a=P.CardTypeString.HIGH_CARD;break}a=P.CardTypeString.FLUSH;break;case P.CardTypeCode.FULL_HOUSE:break;case P.CardTypeCode.STRAIGHT_FLUSH:a=P.CardTypeString.STRAIGHT_FLUSH}return a}hideAll(){var e,t;this.bgSortCard.active=!1,null===(t=null===(e=this.playerCards[0])||void 0===e?void 0:e.children[0])||void 0===t||t.getComponent(A.default).resetColorCardChi(),this.hideAllPlayerShadowCards();for(let a=0;a<4;a++)this.hideState(a),this.playerBinhSpecial[a].active=!1;this.myScore[0].parent.active=!1;for(let a=0;a<this.myScore.length;a++)this.hideMyScore(a);this.hideTotal(),this.hideAllPlayerCards(),this.removeAllPlayerCards()}expandCards(){var e,t,a,i,r,s;this.showAllPlayerCards();for(let n=0;n<4;n++)this.players[n].active&&(null===(a=null===(t=null===(e=this.playerCards[n])||void 0===e?void 0:e.children[0])||void 0===t?void 0:t.getComponent(A.default))||void 0===a||a.expandCards(!1));null===(s=null===(r=null===(i=this.playerCards[0])||void 0===i?void 0:i.children[0])||void 0===r?void 0:r.getComponent(A.default))||void 0===s||s.expandCards(!0)}setPlayerState(e,t,a){this.players[e].getChildByName("player").getComponent(k.default).isArranging="arranging"==t,this.playerStates[e].node.active=!0,this.playerStates[e].spriteFrame=this.playerStateSprites.getSpriteFrame(t),this.playerStates[e].node.y+=a}updateGameState(e,t){e&&this.players&&0!==this.players.length&&(null==e||e.forEach(e=>{if(e!==n.default.getInstance().matchInfo.self.user_id)for(let a=0;a<this.players.length;a++)this.players[a].active&&this.players[a].getChildByName("player").getComponent(k.default).id===e&&(this.players[a].getChildByName("player").getComponent(k.default).isArranging="arranging"==t,this.setPlayerState(a,t,0))}))}startArrangeCards(){this.checkSpecial()?T.default.sendShowCards(this.cardData[0]):this.onCombine()}endArrangeCards(){this.isArranging=!1,this.timeLine.node.active=!1,this.dongHo.active=!1,this.onShowCard(),this.btnCombine.node.active=!1,this.animStartCompare.node.active=!0,this.animStartCompare.animation="compare",cc.tween(this.node).delay(1).call(()=>{this.animStartCompare.node.active=!1;for(let e=1;e<4;e++)this.playerStates[e].node.active=!1}).delay(.5).call(()=>{this.getPlayerCards(0).hideCardsAnim()}).delay(2).call(()=>{this.getPlayerCards(0).showCardsAnim()}).start()}compareCards(){this.schedule(()=>{},3,2,1)}compareBlock(e,t){this.showShadowChi(e+1,t),this.showChi(e,t);for(let a=0;a<t.length;a++){let i=this.getPlayerIndex(t[a].userId);1===e?this.setPlayerState(i,this.getBlockTypeText(t[a],e),70):0===e?this.setPlayerState(i,this.getBlockTypeText(t[a],e),-70):this.setPlayerState(i,this.getBlockTypeText(t[a],e),0)}}getBlockTypeText(e,t){var a;let i="",r=["front","middle","back"],s=(parseInt(e.scoreResult[["frontFactor","middleFactor","backFactor"][t]])||0)+(parseInt(e.scoreResult[["frontBonusFactor","middleBonusFactor","backBonusFactor"][t]])||0);switch(null===(a=e.pointResult[r[t]])||void 0===a?void 0:a.ranking){case P.HandRanking.StraightFlush:if(0===t){i=P.CardTypeFrameName[`HIGH_CARD_${s>0?"WIN":"LOSE"}`];break}i=P.CardTypeFrameName[`STRAIGHT_FLUSH_${s>0?"WIN":"LOSE"}`];break;case P.HandRanking.FourOfAKind:i=P.CardTypeFrameName[`FOUR_OF_A_KIND_${s>0?"WIN":"LOSE"}`];break;case P.HandRanking.FullHouse:i=P.CardTypeFrameName[`FULL_HOUSE_${s>0?"WIN":"LOSE"}`];break;case P.HandRanking.Flush:if(0===t){i=P.CardTypeFrameName[`HIGH_CARD_${s>0?"WIN":"LOSE"}`];break}i=P.CardTypeFrameName[`FLUSH_${s>0?"WIN":"LOSE"}`];break;case P.HandRanking.Straight:if(0===t){i=P.CardTypeFrameName[`HIGH_CARD_${s>0?"WIN":"LOSE"}`];break}i=P.CardTypeFrameName[`STRAIGHT_${s>0?"WIN":"LOSE"}`];break;case P.HandRanking.ThreeOfAKind:i=P.CardTypeFrameName[`THREE_OF_A_KIND_${s>0?"WIN":"LOSE"}`];break;case P.HandRanking.TwoPairs:i=P.CardTypeFrameName[`TWO_PAIRS_${s>0?"WIN":"LOSE"}`];break;case P.HandRanking.Pair:i=P.CardTypeFrameName[`PAIR_${s>0?"WIN":"LOSE"}`];break;case P.HandRanking.HighCard:i=P.CardTypeFrameName[`HIGH_CARD_${s>0?"WIN":"LOSE"}`]}return i}showShadowChi(e,t){var a,i,r;for(let s=0;s<t.length;s++){let n=this.getPlayerIndex(t[s].userId);null===(r=null===(i=null===(a=this.playerCards[n])||void 0===a?void 0:a.children[0])||void 0===i?void 0:i.getComponent(A.default))||void 0===r||r.showShadowChi(e)}}hideShadowChi(e){var t,a,i;for(let r=0;r<4;r++)null===(i=null===(a=null===(t=this.playerCards[r])||void 0===t?void 0:t.children[0])||void 0===a?void 0:a.getComponent(A.default))||void 0===i||i.hideShadowChi(e)}hideAllPlayerShadowCards(){for(let e=0;e<3;e++)this.hideShadowChi(e)}showAllPlayerCards(){for(let e=0;e<this.playerCards.length;e++)this.players[e].active&&(this.playerCards[e].active=!0)}hideAllPlayerCards(){for(let e=0;e<this.playerCards.length;e++)this.playerCards[e].active=!1}removeAllPlayerCards(){for(let e=0;e<this.playerCards.length;e++)this.playerCards[e].destroyAllChildren()}hideTotal(){for(let e=0;e<this.playerTotal.length;e++)this.playerTotal[e].node.parent.active=!1}showChi(e,t){for(let a=0;a<t.length;a++){let i=this.getPlayerIndex(t[a].userId);this.players[i].active&&this.playerCards[i].children[0]&&this.playerCards[i].children[0].getComponent(A.default).showChi(e)}}showState(e,t){this.playerStates[e].node.active=!0,this.playerStates[e].spriteFrame=this.playerStateSprites.getSpriteFrame(t)}hideState(e){this.playerStates[e].node.active=!1}hidePlayerAnimation(e){this.playerAnim[e].node.active=!1,this.playerAnim[e].skeletonData=null}showTotal(){for(let e=0;e<4;e++)this.players[e].active&&cc.tween(this.playerTotal[e].node).to(.1,{scale:1.5}).to(.1,{scale:1}).start()}addTotal(e,t){!1===this.playerTotal[e].node.parent.active&&(this.playerTotal[e].node.parent.active=!0);let a=parseInt(this.playerTotal[e].string)||0;(a+=t)>=0?(this.playerTotal[e].string=`+${a}`,this.playerTotal[e].node.color=cc.Color.YELLOW):(this.playerTotal[e].string=`${a}`,this.playerTotal[e].node.color=cc.Color.WHITE),cc.tween(this.playerTotal[e].node).to(.2,{scale:1.5},{easing:"cubicOut"}).to(.2,{scale:1}).start()}showMyScore(e){this.myScore[e].active=!0}hideMyScore(e){this.myScore[e].active=!1}getBiggestTypeCode(e){let t=v.default.getStraightFlush(e).length,a=v.default.get4ofAKind(e).length,i=v.default.getFullHouse(e).length,r=v.default.getFlush(e).length,s=v.default.getStraight(e).length,n=v.default.get3ofAKind(e).length,o=S.default.listDoi(e).length,l=P.CardTypeCode.HIGH_CARD;return o&&1===o&&(l=P.CardTypeCode.PAIR),o&&2===o&&(l=P.CardTypeCode.TWO_PAIRS),n&&(l=P.CardTypeCode.THREE_OF_A_KIND),s&&(l=P.CardTypeCode.STRAIGHT),r&&(l=P.CardTypeCode.FLUSH),i&&(l=P.CardTypeCode.FULL_HOUSE),a&&(l=P.CardTypeCode.FOUR_OF_A_KIND),t&&(l=P.CardTypeCode.STRAIGHT_FLUSH),l}onCombine(){if(this.isZooming)return;this.isCombine=!0,this.isZooming=!0,this.hintBtns.forEach(e=>{e.node.active=!1});let e=v.default.getStraightFlush(this.cardData[0]).length,t=v.default.get4ofAKind(this.cardData[0]).length,a=v.default.getFullHouse(this.cardData[0]).length,i=v.default.getFlush(this.cardData[0]).length,r=-1;v.default.getStraight(this.cardData[0]).length&&(this.hintBtns[4].node.active=!0,r=4),i&&(this.hintBtns[3].node.active=!0,r=3),a&&(this.hintBtns[2].node.active=!0,r=2),t&&(this.hintBtns[1].node.active=!0,r=1),e&&(this.hintBtns[0].node.active=!0,r=0),this.hintBtnStar.node.active=!1,-1!==r&&this.onHintBtnClick(null,r),this.zoomIn(),this.dongHo.active=!1,this.bgSortCard.active=!0,this.btnCombine.node.active=!1,this.checkAndSetChi(),T.default.sendCombineCards()}onHintBtnClick(e,t){this.hintBtnStar.node.position=cc.v3(this.hintBtns[t].node.getBoundingBox().x-20,this.hintBtns[t].node.y),this.hintBtnStar.node.active=!0,this.playStarAction();let a=[];switch(parseInt(t)){case 0:a=v.default.getStraightFlush(this.cardData[0]);break;case 1:a=v.default.get4ofAKind(this.cardData[0]);break;case 2:a=v.default.getFullHouse(this.cardData[0]);break;case 3:a=v.default.getFlush(this.cardData[0]);break;case 4:a=v.default.getStraight(this.cardData[0])}this.getPlayerCards(0).showStars(this.cardData[0],a)}playStarAction(){this.hintBtnStar.node.stopAllActions(),this.hintBtnStar.node.scale=10,this.hintBtnStar.node.opacity=0,this.hintBtnStar.node.angle=180,cc.tween(this.hintBtnStar.node).parallel(cc.tween().to(.5,{scale:1},{easing:"cubicOut"}),cc.tween().to(.5,{angle:0},{easing:"cubicOut"}),cc.tween().to(.3,{opacity:255})).start()}onClickShowCard(){T.default.sendActionSignal(),this.onShowCard()}onClickCombine(){T.default.sendActionSignal(),this.onCombine()}onClickDeclare(){T.default.sendActionSignal(),this.onDeclare()}onShowCard(){this.isZooming||this.isSwapping||(this.isCombine=!1,this.isZooming=!0,this.getPlayerCards(0).destroyMovingCards(),this.getPlayerCards(0).hideAllCardEffect(),this.getPlayerCards(0).hideAllStars(),this.isInitMovingCards=!1,this.targetCards=[],this.isMoving=!1,this.holdingCardPos=null,this.currentHoldingCard=-1,this.destPos=[],this.isTappedAgain=!1,this.isTouchOnCard=!1,this.isSwapping=!1,this.playerCards[0].children[0].getComponent(A.default).resetColorCardChi(),this.dongHo.active=!0,this.bgSortCard.active=!1,this.isArranging&&(this.btnCombine.node.active=!0),this.cardData[0]=this.playerCards[0].children[0].getComponent(A.default).sortChi(this.cardData[0]),this.playerCards[0].children[0].getComponent(A.default).updateCards(this.cardData[0]),this.zoomOut(),T.default.sendShowCards(this.cardData[0]))}onDeclare(){this.isZooming||this.isSwapping||(this.isCombine=!1,this.isZooming=!0,this.getPlayerCards(0).destroyMovingCards(),this.getPlayerCards(0).hideAllCardEffect(),this.getPlayerCards(0).hideAllStars(),this.isInitMovingCards=!1,this.targetCards=[],this.isMoving=!1,this.holdingCardPos=null,this.currentHoldingCard=-1,this.destPos=[],this.isTappedAgain=!1,this.isTouchOnCard=!1,this.isSwapping=!1,this.playerCards[0].children[0].getComponent(A.default).resetColorCardChi(),this.dongHo.active=!0,this.bgSortCard.active=!1,this.isArranging&&(this.btnCombine.node.active=!0),this.zoomOut(),T.default.sendDeclareCards(this.cardData[0]))}zoomIn(){let e=[];this.zoomInPos.forEach(t=>{e.push({x:t.x-this.playerCards[0].x,y:t.y-this.playerCards[0].y})}),this.playerCards[0].children[0].getComponent(A.default).zoomIn(e)}zoomOut(){this.playerCards[0].children[0].getComponent(A.default).zoomOut()}onMenuClick(){g.default.show(this,g.DialogPosition.RIGHT)}onChatClick(){this.gameState!==h.Game.GAME_STATE.SPECTATING&&C.default.show()}onAvtClick(e,t){var a,i,r,s,n;this.gameState!==h.Game.GAME_STATE.SPECTATING&&p.default.show(p.PlayerInfo.toPlayerInfo(this.getPlayerId(t),null===(a=this.players[t].getChildByName("player"))||void 0===a?void 0:a.getComponent(k.default).user_name,null===(i=this.players[t].getChildByName("player"))||void 0===i?void 0:i.getComponent(k.default).wallet,(null===(r=this.players[t].getChildByName("player"))||void 0===r?void 0:r.getComponent(k.default).avatar_id)+"",(null===(s=this.players[t].getChildByName("player"))||void 0===s?void 0:s.getComponent(k.default).vipLevel)||0,(null===(n=this.players[t].getChildByName("player"))||void 0===n?void 0:n.getComponent(k.default).sid)||""))}throwIcons(e){let t=this.getPlayerIndex(e.sender_id),a=this.getPlayerIndex(e.throw.to_id);t==a?this.players.forEach((a,i)=>{var r;a.active&&(null===(r=a.getChildByName("player"))||void 0===r?void 0:r.getComponent(k.default).id)!==e.sender_id&&this.createIconAndThrow(e.throw.iconIndex,t,i)}):this.createIconAndThrow(e.throw.iconIndex,t,a)}createIconAndThrow(e,t,a){let i=new cc.Node,r=i.addComponent(cc.Sprite),s=f.default.getInstance().getThrowIcon(e);r.spriteFrame=s,i.setPosition(this.players[t].position),this.bgThrow.addChild(i),cc.tween(i).to(.5,{position:this.players[a].position}).call(()=>{i.destroy();let t=new cc.Node,r=t.addComponent(sp.Skeleton);r.skeletonData=f.default.getInstance().getThrowAnimation(e),r.animation="animation",r.loop=!1,r.premultipliedAlpha=!1,this.players[a].addChild(t),this.scheduleOnce(()=>{t.destroy()},3)}).start()}showChat(e){let t=this.getPlayerIndex(e.sender_id),a=e.message,i=cc.instantiate(this.bubbleChatPrefab);i.getComponent(y.default).setData(a),this.players[t].addChild(i),this.scheduleOnce(()=>{i.destroy()},3)}showEmoji(e){let t=f.default.getInstance().getEmojiByTypeAndIndex(e.emoji.type,e.emoji.index).value,a=this.getPlayerIndex(e.sender_id),i=new cc.Node,r=i.addComponent(sp.Skeleton);r.skeletonData=t,r.animation="animation",r.premultipliedAlpha=!1,"F"==e.emoji.type&&(i.scale=.6),this.players[a].addChild(i),this.scheduleOnce(()=>{i.destroy()},2)}onChangeMatch(){!this.isPlaying||this.gameState!==h.Game.GAME_STATE.RUN&&this.gameState!==h.Game.GAME_STATE.REWARD?T.default.onQuit(()=>{n.default.getInstance().showProcessing(!0),this.hideAll(),cc.Tween.stopAllByTarget(this.node),this.unscheduleAllCallbacks(),setTimeout(()=>{let e=JSON.parse(n.default.getInstance().matchInfo.label);d.default.changeMatch(e.markUnit,n.default.getInstance().matchInfo)},2)},!1):(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameChangeMatch,this.icBack.scale=.5,"true"===localStorage.getItem("isChangeMatch")?(this.icBack.active=!1,localStorage.setItem("isChangeMatch","false"),n.default.getInstance().toast.showToast(o.default.getInstance().getString("minidice_unsign_leave_table"))):(this.icBack.active=!0,localStorage.setItem("isChangeMatch","true"),n.default.getInstance().toast.showToast(o.default.getInstance().getString("wait_game_end_to_leave"))))}refreshView(){T.default.onQuit(()=>{n.default.getInstance().showProcessing(!0),this.hideAll(),cc.Tween.stopAllByTarget(this.node),this.unscheduleAllCallbacks(),setTimeout(()=>{d.default.reloadMatch(n.default.getInstance().matchInfo)},2)},!1)}onQuit(){this.isPlaying&&this.gameState===h.Game.GAME_STATE.RUN?(this.icBack.getComponent(cc.Sprite).spriteFrame=this.spriteFrameExitMatch,this.icBack.scale=1,"true"===localStorage.getItem("isLeave")?(this.icBack.active=!1,localStorage.setItem("isLeave","false")):(this.icBack.active=!0,localStorage.setItem("isLeave","true"),n.default.getInstance().toast.showToast(o.default.getInstance().getString("wait_game_end_to_leave")))):(this.gameState=null,c.BannerData.setBannerData(h.Banner.ShowType.LEFT_MATCH,!0),T.default.onQuit())}flyChips(e,t,a,i,r=.1){e<0&&(e*=-1),e>10&&(e=10);for(let s=0;s<=e;s++)cc.tween(this.node).delay(s*r).call(()=>{let e=a;0===a.x&&0===a.y&&(e=cc.v2(Math.floor(100*Math.random()),Math.floor(100*Math.random())));let r=t;0===t.x&&0===t.y&&(r=cc.v2(Math.floor(100*Math.random()),Math.floor(100*Math.random()))),this.createChips(.5,r,e,i)}).start()}createChips(e,t,a,i=.1){let r=cc.instantiate(this.chipPrefab);r.setPosition(t),r.scale=1,r.zIndex=40;let s=JSON.parse(n.default.getInstance().matchInfo.label);r.getComponent(_.default).setData({spriteIndex:0,chip:Number(s.markUnit)}),this.bgThrow.addChild(r),cc.tween(r).to(e/2-.05,{position:a}).delay(i).call(()=>{r.destroy()}).start()}triggerEndTimeAnim(e){const t=e.position;let a=0,i=7;0!=e.rotation&&(a=7,i=0);const r=cc.tween().to(.1,{position:cc.v2(t.x+a,t.y+i)}),s=cc.tween().to(.1,{position:cc.v2(t.x-a,t.y-i)}),n=cc.tween().sequence(r,s),o=cc.tween().repeatForever(n);cc.tween(e).then(o).start()}};D.instance=null,r([E(cc.Node)],D.prototype,"table",void 0),r([E([cc.Node])],D.prototype,"players",void 0),r([E(cc.Node)],D.prototype,"bgSortCard",void 0),r([E([cc.Node])],D.prototype,"playerCards",void 0),r([E(cc.Prefab)],D.prototype,"cardsPrefab",void 0),r([E([cc.Sprite])],D.prototype,"playerStates",void 0),r([E(cc.Button)],D.prototype,"btnCombine",void 0),r([E([cc.Node])],D.prototype,"zoomInPos",void 0),r([E(cc.Label)],D.prototype,"lbTIme",void 0),r([E(sp.Skeleton)],D.prototype,"animStartCompare",void 0),r([E(cc.ProgressBar)],D.prototype,"timeLine",void 0),r([E(cc.Label)],D.prototype,"lbTimeLine",void 0),r([E(cc.Node)],D.prototype,"dongHo",void 0),r([E(cc.Label)],D.prototype,"lbDongHo",void 0),r([E(cc.SpriteAtlas)],D.prototype,"playerStateSprites",void 0),r([E([cc.Label])],D.prototype,"playerTotal",void 0),r([E([cc.Node])],D.prototype,"myScore",void 0),r([E([sp.Skeleton])],D.prototype,"playerAnim",void 0),r([E([sp.SkeletonData])],D.prototype,"burnCardAnim",void 0),r([E(cc.SpriteFrame)],D.prototype,"iconBomb",void 0),r([E(cc.Prefab)],D.prototype,"playerCasinoPrefab",void 0),r([E([cc.Button])],D.prototype,"hintBtns",void 0),r([E(cc.Sprite)],D.prototype,"hintBtnStar",void 0),r([E(cc.Prefab)],D.prototype,"bubbleChatPrefab",void 0),r([E([cc.Label])],D.prototype,"lbTextChi",void 0),r([E([cc.Sprite])],D.prototype,"iconMarkChi",void 0),r([E([cc.SpriteFrame])],D.prototype,"iconMarkSprites",void 0),r([E([cc.SpriteFrame])],D.prototype,"bgChiSprites",void 0),r([E(cc.Label)],D.prototype,"lbInfo",void 0),r([E(cc.Sprite)],D.prototype,"specialCard",void 0),r([E(cc.Button)],D.prototype,"btnDeclare",void 0),r([E(cc.Node)],D.prototype,"icBack",void 0),r([E(cc.Node)],D.prototype,"bgSpecial",void 0),r([E([cc.Node])],D.prototype,"playerBinhSpecial",void 0),r([E(sp.SkeletonData)],D.prototype,"animationBomb",void 0),r([E(sp.SkeletonData)],D.prototype,"animationBurnCard",void 0),r([E(sp.SkeletonData)],D.prototype,"animationSapCaLang",void 0),r([E(sp.SkeletonData)],D.prototype,"animationTank",void 0),r([E(cc.SpriteFrame)],D.prototype,"burnCardSprite",void 0),r([E(cc.Node)],D.prototype,"bgThrow",void 0),r([E(cc.Node)],D.prototype,"jackpotNode",void 0),r([E(cc.Prefab)],D.prototype,"jackpotPrefab",void 0),r([E(cc.Sprite)],D.prototype,"binhSpecialAvt",void 0),r([E(cc.Label)],D.prototype,"binhSpecialName",void 0),r([E(cc.Node)],D.prototype,"bgJackpot",void 0),r([E(cc.Label)],D.prototype,"jackpotChipWin",void 0),r([E(sp.Skeleton)],D.prototype,"animJackpot",void 0),r([E(cc.SpriteFrame)],D.prototype,"spriteFrameExitMatch",void 0),r([E(cc.SpriteFrame)],D.prototype,"spriteFrameChangeMatch",void 0),r([E(cc.Prefab)],D.prototype,"chipPrefab",void 0),r([E(cc.Node)],D.prototype,"notificationPanel",void 0),r([E(cc.AudioClip)],D.prototype,"tableAudio",void 0),D=i=r([I],D),a.default=D,cc._RF.pop()},{"../../lobby/src/audio/AudioController":void 0,"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/common/Utils":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/dialogs/chatingame/ChatInGameDialog":void 0,"../../lobby/src/dialogs/option/OptionDialog":void 0,"../../lobby/src/dialogs/playerinfo/PlayerInfoDialog":void 0,"../../lobby/src/game/GamePresenter":void 0,"../../lobby/src/language/LanguageController":void 0,"../../lobby/src/scripts/ingame/BubbleChat":void 0,"../../lobby/src/scripts/ingame/PlayerCasino":void 0,"./PusoyChip":"PusoyChip","./PusoyConstants":"PusoyConstants","./PusoyHandCards":"PusoyHandCards","./PusoyJackpot":"PusoyJackpot","./PusoyLogic":"PusoyLogic","./PusoyNetworkTransport":"PusoyNetworkTransport","./PusoyRuleDialog":"PusoyRuleDialog","./PusoyUtils":"PusoyUtils"}],PusoyHandCards:[function(e,t,a){"use strict";cc._RF.push(t,"d56b8oNEiFHCbADOezRW4fV","PusoyHandCards");var i=this&&this.__decorate||function(e,t,a,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,a,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(n=(s<3?r(n):s>3?r(t,a,n):r(t,a))||n);return s>3&&n&&Object.defineProperty(t,a,n),n};Object.defineProperty(a,"__esModule",{value:!0});const r=e("./PusoyCard"),s=e("./PusoyConstants"),n=e("./PusoyController"),o=e("./PusoyLogic"),l=[new cc.Color(255,255,255),new cc.Color(0,255,0),new cc.Color(0,0,255)],{ccclass:c,property:h}=cc._decorator;let d=class extends cc.Component{constructor(){super(...arguments),this.cards=[],this.cardPrefab=null,this.nodeScale=.67,this.cardScale=.6,this.blockNumberCards=[3,5,5],this.cardsOriginalPosition=[],this.movingCards=[],this.timeSwapCard=0}onLoad(){this.blockNumberCards=[3,5,5],this.cardsOriginalPosition=[],this.movingCards=[]}generateCards(e){for(let t=0;t<this.cards.length;t++){let a=cc.instantiate(this.cardPrefab);e.length>0&&a.getComponent(r.default).setData(e[t].rank,e[t].suit),a.scale=this.cardScale,this.cards[t].addChild(a)}}updateCards(e){var t,a;for(let i=0;i<this.cards.length;i++)null===(a=null===(t=this.cards[i])||void 0===t?void 0:t.children[0])||void 0===a||a.getComponent(r.default).setData(e[i].rank,e[i].suit)}setScale(){this.node.scale=this.nodeScale}expandCards(e){this.node.scale=this.nodeScale,e||this.hideCards();for(let t=0;t<this.cards.length;t++)this.cards[t].opacity=0;for(let t=0;t<3;t++)this.expandBlock(t)}hideCards(){for(let e=0;e<this.cards.length;e++)this.cards[e].children[0].getComponent(r.default).hideCardPusoy()}showCards(){for(let e=0;e<this.cards.length;e++)this.cards[e].children[0].getComponent(r.default).showCardPusoy()}hideCardsAnim(){for(let e=0;e<this.cards.length;e++)this.cards[e].children[0].getComponent(r.default).hideCardAnimPusoy()}showCardsAnim(){for(let e=0;e<this.cards.length;e++)this.cards[e].children[0].getComponent(r.default).showCardAnimPusoy()}getCardOfBlock(e){let t=[],a=e+e*(e+1);for(let i=a;i<a+this.blockNumberCards[e];i++)t.push(this.cards[i]);return t}getValueCardOfBlock(e){let t=[],a=e+e*(e+1);for(let i=a;i<a+this.blockNumberCards[e];i++)t.push(this.cards[i].children[0].getComponent(r.default).data);return t}expandBlock(e){let t=e+e*(e+1),a=[];for(let r=t;r<t+this.blockNumberCards[e];r++)a.push({position:this.cards[r].position,angle:this.cards[r].angle}),this.cards[r].position=this.cards[8].position,this.cards[r].angle=this.cards[8].angle;let i=0;this.schedule(function(){cc.tween(this.cards[t]).parallel(cc.tween().to(.25,{opacity:255},{easing:"sineInOut"}),cc.tween().to(.2,{position:a[i].position,angle:a[i].angle},{easing:"cubicInOut"}),cc.tween().to(.2,{scale:1.2},{easing:"sineInOut"}).to(.1,{scale:1},{easing:"sineInOut"})).start(),t++,i++},.02,this.blockNumberCards[e]-1,.5)}zoomIn(e){this.cardsOriginalPosition=[];for(let t=0;t<this.cards.length;t++)this.cardsOriginalPosition.push({position:this.cards[t].position,angle:this.cards[t].angle});cc.tween(this.node).to(.2,{scale:1}).start();for(let t=0;t<3;t++)cc.tween(this.cards[t]).to(.2,{position:cc.v3(e[0].x+(this.cards[t].width+20)*t+70,e[0].y),angle:0,scale:1.3}).start();for(let t=3;t<8;t++)cc.tween(this.cards[t]).to(.2,{position:cc.v3(e[1].x+(this.cards[t].width+20)*(t-3)+70,e[1].y),angle:0,scale:1.3}).start();for(let t=8;t<13;t++)cc.tween(this.cards[t]).to(.2,{position:cc.v3(e[2].x+(this.cards[t].width+20)*(t-8)+70,e[2].y),angle:0,scale:1.3}).call(()=>{12===t&&(n.default.getInstance().isZooming=!1)}).start()}zoomOut(){cc.tween(this.node).to(.1,{scale:this.nodeScale}).start();for(let e=0;e<this.cards.length;e++)cc.tween(this.cards[e]).to(.2,{position:cc.v3(this.cardsOriginalPosition[e].position.x,this.cardsOriginalPosition[e].position.y-50,this.cardsOriginalPosition[e].position.z),scale:this.nodeScale,angle:this.cardsOriginalPosition[e].angle}).to(.3,{position:this.cardsOriginalPosition[e].position,scale:1},{easing:"backOut"}).call(()=>{e===this.cards.length-1&&(n.default.getInstance().isZooming=!1)}).start()}initMovingCards(e){this.destroyMovingCards(),e.forEach(e=>{let t=cc.instantiate(this.cards[e]);t.children[0].getComponent(r.default).setDark(!1),t.children[0].getComponent(r.default).setBorder(!1),t.children[0].getComponent(r.default).setOpacity(255),this.node.addChild(t),this.movingCards.push(t)})}moveCards(e,t){this.movingCards.forEach((a,i)=>{a.position=this.cards[e[i]].position.add(t)})}getCenterMovingCard(){let e=cc.v3(0,0,0);for(let t=0;t<this.movingCards.length;t++)e=e.add(this.movingCards[t].position);return e.div(this.movingCards.length)}destroyMovingCards(){this.movingCards.forEach(e=>{e.destroy()}),this.movingCards=[]}swapCards(e,t){this.movingCards.forEach((e,a)=>{cc.tween(e).to(.1,{position:this.cards[t[a]].position}).call(()=>{e.destroy(),a===this.movingCards.length-1&&(this.movingCards=[])}).start()});let a=e;e=e.filter(e=>-1===t.findIndex(t=>t===e)),(t=t.filter(e=>-1===a.findIndex(t=>t===e))).forEach((a,i)=>{let r=this.cards[a].position;cc.tween(this.cards[a]).to(.1,{position:this.cards[e[i]].position}).call(()=>{this.cards[a].position=r,this.cards[a].children[0].parent=this.cards[e[i]],this.cards[e[i]].children[0].parent=this.cards[a],i===t.length-1&&n.default.getInstance().changeAndCheckCards()}).start()})}showShadowChi(e){let t=e+e*(e+1);if(t<=8)for(let a=t;a<t+this.blockNumberCards[e];a++)this.cards[a].children[0].getComponent(r.default).showShadowCard()}swapCardAnim(e){if(console.log("swapCardAnim",e),0==this.timeSwapCard||this.cards[0].getNumberOfRunningActions()>0)this.timeSwapCard=e-Math.floor(4*Math.random())+1;else if(e<=this.timeSwapCard){this.timeSwapCard=e-Math.floor(4*Math.random())+1;var t=[];for(let e=0;e<13;e++)t.push(e);var a=Math.floor(4*Math.random())+1;t.sort(function(){return.5-Math.random()});for(let e=0;e<2*a;e++)t.pop();for(let e=0;e<Math.floor(t.length/2);e++){let a=this.cards[t[2*e]],s=this.cards[t[2*e+1]];var i=cc.sequence(cc.spawn(cc.moveTo(.2,cc.v2(s.position.x,s.position.y)).easing(cc.easeCubicActionInOut()),cc.rotateTo(.2,s.rotation).easing(cc.easeCubicActionInOut())),cc.spawn(cc.moveTo(0,cc.v2(a.position.x,a.position.y)).easing(cc.easeCubicActionInOut()),cc.rotateTo(0,a.rotation).easing(cc.easeCubicActionInOut()))),r=cc.sequence(cc.spawn(cc.moveTo(.2,cc.v2(a.position.x,a.position.y)).easing(cc.easeCubicActionInOut()),cc.rotateTo(.2,a.rotation).easing(cc.easeCubicActionInOut())),cc.spawn(cc.moveTo(0,cc.v2(s.position.x,s.position.y)).easing(cc.easeCubicActionInOut()),cc.rotateTo(0,s.rotation).easing(cc.easeCubicActionInOut())));a.runAction(i),s.runAction(r)}}}hideShadowChi(e){let t=e+e*(e+1);if(t<=8)for(let a=t;a<t+this.blockNumberCards[e];a++)this.cards[a].children[0].getComponent(r.default).hideShadowCard()}showChi(e){this.setZindex(e,e+10);let t=e+e*(e+1),a=t+Math.floor(this.blockNumberCards[e]/2);for(let i=t;i<t+this.blockNumberCards[e];i++){let t=this.cards[i].position,s=this.cards[i].angle;this.cards[i].position=this.cards[a].position,this.cards[i].angle=this.cards[a].angle,this.cards[i].children[0].getComponent(r.default).showCardPusoy(),cc.tween(this.cards[i]).to(.2,{x:(i-a)*this.cards[i].width/1.5}).delay(2).to(.1,{x:(i-a)*(this.cards[i].width/1.5+10)}).call(()=>{this.setZindex(e,e)}).to(.1,{position:t,angle:s}).call(()=>{}).start()}}setZindex(e,t){let a=e+e*(e+1);for(let i=a;i<a+this.blockNumberCards[e];i++)this.cards[i].zIndex=t}setDark(e,t){for(let a=0;a<e.length;a++)this.cards[e[a]].children[0].getComponent(r.default).setDark(t)}setBorder(e,t){for(let a=0;a<e.length;a++)this.cards[e[a]].children[0].getComponent(r.default).setBorder(t)}setOpacity(e,t){for(let a=0;a<e.length;a++)this.cards[e[a]].children[0].getComponent(r.default).setOpacity(t)}showLapLanh(e){for(let a=0;a<e.length;a++)this.cards[e[a]].children[0].getComponent(r.default).stopLapLanh();if(this.cards[e[0]].children[0].getComponent(r.default).isDark())return;let t=0;this.schedule(()=>{this.cards[e[t]].children[0].getComponent(r.default).showLapLanh(),t++},.15,e.length-1,0)}hideAllCardEffect(){for(let e=0;e<this.cards.length;e++)this.cards[e].children[0].getComponent(r.default).setDark(!1),this.cards[e].children[0].getComponent(r.default).setBorder(!1),this.cards[e].children[0].getComponent(r.default).setOpacity(255)}showTotal(){n.default.getInstance().showTotal()}showMyScore(e){n.default.getInstance().showMyScore(e)}showStars(e,t){for(let a=0;a<this.cards.length;a++)this.cards[a].children[0].getComponent(r.default).hideStarPusoy(),t.forEach((t,i)=>{t.forEach(t=>{t.rank===e[a].rank&&t.suit===e[a].suit&&(this.cards[a].children[0].getComponent(r.default).setStarPusoyColor(l[i]),this.cards[a].children[0].getComponent(r.default).showStarPusoy())})})}hideAllStars(){for(let e=0;e<this.cards.length;e++)this.cards[e].children[0].getComponent(r.default).hideStarPusoy()}sortChi(e){console.log("sortChi",[...e]);let t=[],a=[],i=[];for(let s=0;s<e.length;s++)s<3?t.push(e[s]):s<8?a.push(e[s]):i.push(e[s]);t.sort((e,t)=>t.rank-e.rank),a.sort((e,t)=>t.rank-e.rank),i.sort((e,t)=>t.rank-e.rank);let r="0";return o.default.checkDoi(t)&&(r="listDoi",t=o.default.listSortDoi(t)),o.default.checkThungPhaSanh(a)?(r="ThungPhaSanh",a=o.default.listThungPhaSanh(a)):o.default.checkTuQuy(a)?(r="listTuQuy",a=o.default.listTuQuy(a)):o.default.checkCulu(a)?(r="listCuLu",a=o.default.listCuLu(a)):o.default.checkThung(a)?(r="listThung",a=o.default.listThung(a)):o.default.checkSanh(a)?(r="listSanh",a=o.default.listSanh(a)):o.default.checkXam(a)?(r="listSamCo",a=o.default.listSamCo(a)):o.default.checkThu(a)?(r="listThu",a=o.default.listThu(a)):o.default.checkDoi(a)&&(r="listDoi",a=o.default.listSortDoi(a)),o.default.checkThungPhaSanh(i)?(r="ThungPhaSanh",i=o.default.listThungPhaSanh(i)):o.default.checkTuQuy(i)?(r="listTuQuy",i=o.default.listTuQuy(i)):o.default.checkCulu(i)?(r="listCuLu",i=o.default.listCuLu(i)):o.default.checkThung(i)?(r="listThung",i=o.default.listThung(i)):o.default.checkSanh(i)?(r="listSanh",i=o.default.listSanh(i)):o.default.checkXam(i)?(r="listSamCo",i=o.default.listSamCo(i)):o.default.checkThu(i)?(r="listThu",i=o.default.listThu(i)):o.default.checkDoi(i)&&(r="listDoi",i=o.default.listSortDoi(i)),[...t,...a,...i]}resetColorCardChi(){for(let e=0;e<this.cards.length;e++)this.cards[e].children[0].getComponent(r.default).setColorCard(cc.Color.WHITE)}getListCardValue(e){var t=[];3==e.length&&(t.push(-3),t.push(-2));for(let a=0;a<e.length;a++)t.push(e[a].rank);return t.sort((e,t)=>e-t),t}setColorCardChi(e,t,a){let i=this.getCardOfBlock(e),n=this.getValueCardOfBlock(e);for(let s=0;s<i.length;s++)i[s].children[0].getComponent(r.default).setColorCard(cc.Color.WHITE);let o=new cc.Color(255,253,205);if(0===e){if(t===s.CardTypeCode.HIGH_CARD){let e=0,t=0;for(let a=0;a<i.length;a++)n[a].rank>t&&(t=n[a].rank,e=a);i[e].children[0].getComponent(r.default).setColorCard(o)}else if(t>=s.CardTypeCode.PAIR){let e=this.getListCardValue(n),t=0;for(let a=0;a<e.length-1;a++)if(e[a]===e[a+1]){t=e[a];break}for(let a=0;a<i.length;a++)n[a].rank===t&&i[a].children[0].getComponent(r.default).setColorCard(o)}}else if(1===e||2===e)if(t===s.CardTypeCode.HIGH_CARD){let e=0,t=0;for(let a=0;a<i.length;a++)n[a].rank>t&&(t=n[a].rank,e=a);i[e].children[0].getComponent(r.default).setColorCard(o)}else if(t===s.CardTypeCode.PAIR||t===s.CardTypeCode.THREE_OF_A_KIND){let e=this.getListCardValue(n),t=0;for(let a=0;a<e.length-1;a++)if(e[a]===e[a+1]){t=e[a];break}for(let a=0;a<i.length;a++)n[a].rank===t&&i[a].children[0].getComponent(r.default).setColorCard(o)}else if(t===s.CardTypeCode.TWO_PAIRS||t===s.CardTypeCode.FOUR_OF_A_KIND){let e=this.getListCardValue(n),t=[];for(let a=0;a<e.length-1;a++)e[a]===e[a+1]&&(t.push(e[a]),a+=1);for(let a=0;a<i.length;a++)for(let e=0;e<t.length;e++)n[a].rank===t[e]&&i[a].children[0].getComponent(r.default).setColorCard(o)}else if(t>=s.CardTypeCode.STRAIGHT&&t!==s.CardTypeCode.FOUR_OF_A_KIND)for(let s=0;s<i.length;s++)i[s].children[0].getComponent(r.default).setColorCard(o)}};i([h([cc.Node])],d.prototype,"cards",void 0),i([h(cc.Prefab)],d.prototype,"cardPrefab",void 0),i([h],d.prototype,"nodeScale",void 0),i([h],d.prototype,"cardScale",void 0),d=i([c],d),a.default=d,cc._RF.pop()},{"./PusoyCard":"PusoyCard","./PusoyConstants":"PusoyConstants","./PusoyController":"PusoyController","./PusoyLogic":"PusoyLogic"}],PusoyJackpot:[function(e,t,a){"use strict";cc._RF.push(t,"d34aa94A0FNQ6LlgYrfJ2ru","PusoyJackpot");var i=this&&this.__decorate||function(e,t,a,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,a,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(n=(s<3?r(n):s>3?r(t,a,n):r(t,a))||n);return s>3&&n&&Object.defineProperty(t,a,n),n};Object.defineProperty(a,"__esModule",{value:!0});const r=e("../../lobby/src/dialogs/jackpot/JackpotDialog"),{ccclass:s,property:n}=cc._decorator;let o=class extends cc.Component{constructor(){super(...arguments),this.lbNumbers=[]}setData(e){for(let t=0;t<11;t++)this.lbNumbers[10-t].string=e.toString().split("").reverse()[t]||"0"}onClick(){r.default.show()}};i([n([cc.Label])],o.prototype,"lbNumbers",void 0),o=i([s],o),a.default=o,cc._RF.pop()},{"../../lobby/src/dialogs/jackpot/JackpotDialog":void 0}],PusoyLogic:[function(e,t,a){"use strict";cc._RF.push(t,"3dcd8i5zuRAj5K3bL3p742u","PusoyLogic"),Object.defineProperty(a,"__esModule",{value:!0});const i={MAU_THAU:0,DOI:1,THU:2,XAM:3,SANH:4,THUNG:5,CU_LU:6,TU_QUY:7,THUNG_PHA_SANH:8},r={NONE:0,JOKER:1,SET:2,IMPURE:3,TCR_PURE:4},s=52,n=53,o=function(e,t){let a=e.rank,i=t.rank;return a>13&&(a-=13),i>13&&(i-=13),a>i||a===i&&e.suit>t.suit?1:-1},l=function(e,t){let a=e.rank,i=t.rank;return a>i||a===i&&e.suit>t.suit?1:-1},c=function(e,t){return e.suit>t.suit?1:-1};class h{static checkListGetScore(t,a=0){const i=[...t],s=e("BurmesePokerView");s.isInvalid=!1;let n=0,o=0;for(n=0;n<i.length;n++){const e=h.getTypeCardRummy(i[n]);e!==r.TCR_PURE&&e!==r.IMPURE||o++}if(o>=a)for(s.isInvalid=!0,n=0;n<i.length;n++){const e=h.getTypeCardRummy(i[n]);e!==r.TCR_PURE&&e!==r.IMPURE||(i.splice(n,1),n--)}let l=0;if(s.isInvalid)for(n=0;n<i.length;n++)h.getTypeCardRummy(i[n])===r.NONE&&(l+=h.getScore(i[n]));else for(n=0;n<i.length;n++)l+=h.getScore(i[n]);return l>=80&&(l=80),l}static getTypeCardRummy(e){const t=[...e];return h.checkJoker(t)?t.length>2?r.IMPURE:r.JOKER:h.checkPure_Xam(t)||h.checkPure_TPS(t)?r.TCR_PURE:h.checkImpure(t)?r.IMPURE:h.checkSet(t)?r.SET:r.NONE}static checkPure_Xam(e){const t=[...e];return 3===t.length&&!h.checkDoubleEat(t)&&t[0].code===t[1].code&&t[0].code===t[2].code}static checkPure_TPS(e){const t=[...e];return!(t.length<3||t.length>4)&&!h.checkDoubleEat(t)&&(t.sort(o),h.checkThungPhaSanh(t,t.length))}static checkImpure(e){const t=[...e];if(t.length<3||t.length>4)return!1;if(h.checkDoubleEat(t))return!1;let a;for(a=0;a<t.length-1;a++)for(let e=a+1;e<t.length;e++){if(t[a].code===t[e].code&&!t[a].isJoker)return!1;if(t[a].isJoker)break;if(!t[e].isJoker&&t[a].suit!==t[e].suit)return!1}let i=[],r=[];for(a=0;a<t.length;a++)(t[a].isJoker||t[a].code===s||t[a].code===n)&&(i.push(t[a]),r.push(t[a]),t.splice(a,1),a--);if(t.length<=0)return!1;if(1===t.length)return!0;let c=!1;t.sort(o);let d=t[0].rank,u=-1;for(14===d&&(u=1),a=1;a<t.length;a++)if(d===t[a].rank-1||u===t[a].rank-1)c=!0,d=t[a].rank;else{if(!(i.length>0)){c=!1;break}c=!0,i.splice(0,1),d>=14&&u++,d++,a>1?a--:a=0}if(!1===c)for(t.sort(l),u=-1,14===(d=t[0].rank)&&(u=1),a=1;a<t.length;a++)if(d===t[a].rank-1||u===t[a].rank-1)c=!0,d=t[a].rank;else{if(!(r.length>0)){c=!1;break}c=!0,r.splice(0,1),d++,a>1?a--:a=0}return c}static checkSet(e){const t=[...e];if(t.length<3||t.length>4)return!1;if(h.checkDoubleEat(t))return!1;let a;for(a=0;a<t.length-1;a++)for(let e=a+1;e<t.length;e++)if(t[a].rank!=t[e].rank&&!t[a].isJoker&&!t[e].isJoker)return!1;for(a=0;a<t.length;a++)t[a].isJoker&&(t.splice(a,1),a--);if(t.length<=1)return!1;const i=t[0];let r=!1;for(a=1;a<t.length;a++){if(i.rank!==t[a].rank){r=!1;break}r=!0}return r}static checkJoker(e){const t=[...e];if(t.length<3||t.length>4)return!1;if(h.checkDoubleEat(t))return!1;let a=!1;for(let i=0;i<t.length;i++){if(!t[i].isJoker){a=!1;break}a=!0}return a}static checkDoubleEat(e){const t=[...e];let a=0;for(let i=0;i<t.length;i++)t[i].getIsEat&&t[i].getIsEat()&&a++;return a>=2}static getScore(e){const t=[...e];let a=0;for(let i=0;i<t.length;i++){const e=t[i];e.isJoker||(e.rank>=14?a+=1:e.rank>=1&&e.rank<=9?a+=e.rank:e.rank>=10&&e.rank<14&&(a+=10))}return a}static sortImpure(e,t){const a=[...e];if(a.length<=0)return;let i,r=[],h=[],d=!1;for(i=0;i<a.length;i++)13===a[i].rank&&(d=!0),(a[i].isJoker||a[i].code===s||a[i].code===n)&&(r.push(a[i]),h.push(a[i]),a.splice(i,1),i--);if(r.sort(c),a.length<=0&&r.length>0){for(i=0;i<r.length;i++)a.push(r[i]);return}if(h.sort(c),1==a.length){for(i=0;i<r.length;i++)0===i?a.splice(0,0,r[i]):a.push(r[i]);return}let u=!1;t?a.sort(o):a.sort(l);let p=a[0].rank,g=-1;for(14===p&&(g=1),i=1;i<a.length;i++)if(p===a[i].rank-1||g===a[i].rank-1)u=!0,p=a[i].rank;else{if(!(r.length>0)){u=!1;break}u=!0,a.splice(i,0,r[0]),r.splice(0,1),p>=14&&g++,p++,i>1?i--:i=1}if(r.length>0)if(d&&a.length>0)for(i=0;i<r.length;i++)a.splice(0,0,r[i]);else for(i=0;i<r.length;i++)a.push(r[i])}static getTypeCard(e,t=5){return h.checkThungPhaSanh(e,t)?i.THUNG_PHA_SANH:h.checkTuQuy(e)?i.TU_QUY:h.checkCulu(e)?i.CU_LU:h.checkThung(e,t)?i.THUNG:h.checkSanh(e,t)?i.SANH:h.checkXam(e)?i.XAM:h.checkThu(e)?i.THU:h.checkDoi(e)?i.DOI:i.MAU_THAU}static checkThungPhaSanh(e,t=5){const a=[...e];return!0===h.checkThung(a,t)&&!0===h.checkSanh(a,t)}static checkTuQuy(e){const t=[...e];if(t.sort((e,t)=>e.rank-t.rank),t.length<4)return!1;for(let a=0;a<t.length-1;a++){let e=0;for(let i=a+1;i<t.length;i++)t[i].rank===t[a].rank&&e++;if(3===e)return!0}return!1}static checkCulu(e){const t=[...e];if(!h.checkXam(t)||t.length<5)return!1;if(t.sort((e,t)=>e.rank-t.rank),5===t.length){for(let e=0;e<t.length-4;e++)if(t[e].rank===t[e+1].rank){if(t[e+1].rank===t[e+2].rank&&t[e+3].rank===t[e+4].rank)return!0;if(t[e+2].rank===t[e+3].rank&&t[e+3].rank===t[e+4].rank)return!0}return!1}let a=[];for(let i=0;i<t.length-2;i++)if(a=t,t[i].rank===t[i+1].rank&&t[i+1].rank===t[i+2].rank&&(a.slice(i,3),h.checkDoi(a)))return!0;return!1}static checkThung(e,t=5){const a=[...e];if(a.length<t)return!1;let i=0;for(let r=0;r<a.length;r++){i=0;for(let e=r+1;e<a.length;e++)a[e].suit===a[r].suit&&i++;if(i>=t-1)return!0}return!1}static checkSanh(e,t=5){const a=[...e];if(a.length<t)return!1;const i=[];for(let r=0;r<a.length;r++)i.push(a[r].rank),14===a[r].rank&&i.push(1);i.sort((e,t)=>e-t);for(let r=0;r<i.length-1;r++){let e=0;for(let t=r+1;t<i.length;t++)i[r]+e+1===i[t]&&e++;if(e>=t-1)return!0}return!1}static checkXam(e){const t=[...e];if(t.sort((e,t)=>e.rank-t.rank),t.length<3)return!1;for(let a=0;a<t.length-2;a++)if(t[a].rank===t[a+1].rank&&t[a+1].rank===t[a+2].rank)return!0;return!1}static checkThu(e){const t=[...e];if(t.sort((e,t)=>e.rank-t.rank),t.length<4)return!1;for(let a=0;a<t.length-1;a++)if(t[a].rank===t[a+1].rank)for(let e=a+2;e<t.length-1;e++)if(t[e].rank===t[e+1].rank)return!0;return!1}static checkDoi(e){const t=[...e];if(t.sort((e,t)=>e.rank-t.rank),t.length<2)return!1;for(let a=0;a<t.length-1;a++)if(t[a].rank===t[a+1].rank)return!0;return!1}static checkBinhGrandDragon(e){for(let t=1;t<e.length;t++)if(e[t].suit!=e[t-1].suit)return!1;return!!this.checkBinhDragon(e)}static checkBinhDragon(e){const t=[...e];t.sort((e,t)=>e.rank-t.rank);for(let a=1;a<t.length;a++)if(t[a].rank!=t[a-1].rank+1)return!1;return!0}static checkBinhSameColor(e){console.log("checkBinhSameColor",e);let t=0,a=0;for(let i=0;i<e.length;i++)e[i].suit<=2?t++:a++;return console.log("checkBinhSameColor",e,t,a),13==t||13==a}static checkBinhSixPairs(e){const t=[...e];t.sort((e,t)=>e.rank-t.rank);let a=0;for(let i=0;i<t.length-1;i++)t[i].rank==t[i+1].rank&&(a++,i+=1);return console.log("checkBinhSixPairs",a),6==a}static checkBinhThreeStraights(e,t,a){return!!(this.checkSanh(e,3)&&this.checkSanh(t,5)&&this.checkSanh(a,5))}static checkBinhThreeFlushes(e,t,a){return!!(this.checkThung(e,3)&&this.checkThung(t,5)&&this.checkThung(a,5))}static check2DoiThong(e){const t=[...e];if(4!==t.length)return!1;t.sort((e,t)=>e.rank-t.rank);for(let a=0;a<t.length-2;a++)if(t[a].rank+1!==t[a+2].rank)return!1;return!0}static check3DoiThong(e){const t=[...e];if(6!==t.length)return!1;t.sort((e,t)=>e.rank-t.rank);for(let a=0;a<t.length-2;a++)if(t[a].rank+1!==t[a+2].rank)return!1;return!0}static check4DoiThong(e){const t=[...e];if(8!==t.length)return!1;t.sort((e,t)=>e.rank-t.rank);for(let a=0;a<t.length-2;a++)if(t[a].rank+1!==t[a+2].rank)return!1;return!0}static checkSetOfTwos(e){const t=[...e];if(t.length>3||t.length<2)return!1;for(let a=0;a<t.length;a++)if(2!==t[a].rank)return!1;return!0}static checkDoiTL(e){return!(!this.checkDoi(e)||2!==e.length)}static checkXamTL(e){return!(!this.checkXam(e)||3!==e.length)}static checkSanhTL(e){const t=[...e];if(t.length<3)return!1;t.sort((e,t)=>e.rank-t.rank);for(let a=0;a<t.length-1;a++)if(t[a].rank+1!==t[a+1].rank)return!1;return!0}static ckeckThungPhaSanhTL(e){const t=[...e];if(!this.checkSanhTL(t))return!1;for(let a=0;a<t.length-1;a++)if(t[a].suit!==t[a+1].suit)return!1;return!0}static checkPokerFlush(e){const t=e[0];for(let a=1;a<e.length;a++)if(e[a].suit!=t.suit)return!1;return!0}static checkPokerStraight(e){const t=[...e];let a=!0,i=!0;t.sort((e,t)=>e.rank-t.rank);const r=t[0];for(let n=1;n<t.length;n++)if(t[n].rank!=r.rank+n){i=!1;break}t.forEach(e=>{14==e.rank&&(e.rank=1)}),t.sort((e,t)=>e.rank-t.rank);const s=t[0];for(let n=1;n<t.length;n++)if(t[n].rank!=s.rank+n){a=!1;break}return!(!a&&!i)}static checkPokerStrFlush(e){return!(!this.checkPokerFlush(e)||!this.checkPokerStraight(e))}static checkPokerPair(e){const t=[...e];t.sort((e,t)=>e.rank-t.rank);for(let a=0;a<t.length-1;a++)if(t[a].rank==t[a+1].rank)return!0;return!1}static checkPoker3Card(e){const t=e[0];if(e.length<3)return!1;for(let a=0;a<e.length;a++)if(t.rank!=e[a].rank)return!1;return!0}static checkPokerHighLightCard(e){if(6==e.length)return e;const t=this.checkPokerTypeCard(e),a=[],i=[...e];if(i.sort((e,t)=>e.rank-t.rank),t<=3)e.forEach(e=>{a.push(e)});else if(4==t){if(e.length>3)return[];for(let e=0;e<i.length-1;e++)if(i[e].rank==i[e+1].rank){a.push(i[e]),a.push(i[e+1]);break}}else{if(e.length>3)return[];let t=e[0];for(let a=1;a<e.length;a++)e[a].rank>=t.rank&&(t=e[a]);a.push(t)}return a}static checkPokerTypeCard(e){return this.checkPokerStrFlush(e)?0:this.checkPokerFlush(e)?1:this.checkPokerStraight(e)?2:this.checkPoker3Card(e)?3:this.checkPokerPair(e)?4:5}static listDoi(e){const t=[...e],a=[];if(!this.checkDoi(t))return a;t.sort((e,t)=>t.rank-e.rank);for(let i=t.length-1;i>0;i--)t[i].rank===t[i-1].rank&&(a.push([t[i],t[i-1]]),i--);return a}static listSortDoi(e){const t=[...e],a=[];if(!this.checkDoi(t))return a;t.sort((e,t)=>t.rank-e.rank);for(let i=1;i<t.length;i++)if(t[i].rank===t[i-1].rank){a.push(t[i-1],t[i]),t.splice(i-1,2);break}return a.push(...t),a}static listThu(e){const t=e,a=[];if(!h.checkThu(t))return a;t.sort((e,t)=>e.rank-t.rank);for(let i=t.length-1;i>0;i--)if(t[i].rank===t[i-1].rank){a.push(t[i]),a.push(t[i-1]);break}for(let i=0;i<a.length;i++)for(let e=0;e<t.length;e++)if(a[i]===t[e]){t.splice(e,1);break}for(let i=t.length-1;i>0;i--)if(t[i].rank===t[i-1].rank){a.push(t[i]),a.push(t[i-1]);break}for(let i=0;i<a.length;i++)for(let e=0;e<t.length;e++)if(a[i]===t[e]){t.splice(e,1);break}for(let i=0;i<t.length;i++)a.push(t[i]);return a}static listSamCo(e){const t=e,a=[];if(!h.checkXam(t))return a;t.sort((e,t)=>t.rank-e.rank);for(let i=t.length-1;i>1;i--)if(t[i].rank===t[i-1].rank){a.push(t[i]),a.push(t[i-1]),a.push(t[i-2]);break}for(let i=0;i<a.length;i++)for(let e=0;e<t.length;e++)if(a[i]===t[e]){t.splice(e,1);break}for(let i=0;i<t.length;i++)a.push(t[i]);return a}static listSanh(e){if(!h.checkSanh(e,5))return[];const t=e;t.sort((e,t)=>e.rank-t.rank),console.log("check sanh===>",t);const a=[],i=t[t.length-1],r=t[0];if(14===i.rank&&2===r.rank){for(let e=0;e<t.length-1;e++)a.push(t[e]);a.push(i)}else for(let s=0;s<t.length;s++)a.push(t[s]);return a}static listThungPhaSanh(e){return h.checkThung(e,5)?(e.sort((e,t)=>e.rank-t.rank),e):[]}static listThung(e){return h.checkThung(e,5)?(e.sort((e,t)=>t.rank-e.rank),e):[]}static listCuLu(e){const t=[];if(!h.checkCulu(e))return t;const a=e;a.sort((e,t)=>e.rank-t.rank);for(let i=a.length-1;i>1;i--)if(a[i].rank===a[i-1].rank&&a[i].rank===a[i-2].rank){t.push(a[i]),t.push(a[i-1]),t.push(a[i-2]);break}for(let i=0;i<t.length;i++)for(let e=0;e<a.length;e++)if(t[i]===a[e]){a.splice(e,1);break}for(let i=a.length-1;i>=0;i--)t.push(a[i]);return t}static listTuQuy(e){const t=[];if(!h.checkTuQuy(e))return t;const a=e;a.sort((e,t)=>e.rank-t.rank);for(let i=a.length-1;i>0;i--)if(a[i].rank===a[i-3].rank){t.push(a[i]),t.push(a[i-1]),t.push(a[i-2]),t.push(a[i-3]);break}for(let i=0;i<t.length;i++)for(let e=0;e<a.length;e++)if(t[i]===a[e]){a.splice(e,1);break}for(let i=a.length-1;i>=0;i--)t.push(a[i]);return t}}a.default=h,cc._RF.pop()},{BurmesePokerView:void 0}],PusoyNetworkTransport:[function(e,t,a){"use strict";cc._RF.push(t,"f0828vuvy5JgrkYgA7KF845","PusoyNetworkTransport"),Object.defineProperty(a,"__esModule",{value:!0});const i=e("../../lobby/src/common/ConfigClient"),r=e("../../lobby/src/common/Constants"),s=e("../../lobby/src/network/NetworkClient"),n=e("../../lobby/src/common/GlobalApp"),o=e("../../lobby/src/common/User"),l=e("../../lobby/src/dialogs/banner/BannerDialog"),c=e("../../lobby/src/chat/ChatPresenter"),h=e("./PusoyController"),d=e("../../lobby/src/lobby/GameList");class u{static subscribe(){s.default.getInstance().subscribeEventHandler(r.Game.Enum.PUSOY,u)}static matchPresenceHandler(e){cc.log("Received match presence update:",e),e.leaves?h.default.getInstance().removePresences(e.leaves.map(e=>e.user_id)):e.joins&&h.default.getInstance().addPresences(e.joins.map(e=>e.user_id))}static matchDataHandler(e){switch(e.op_code){case i.default.Network.OP_CODE.OPCODE_UPDATE_TABLE:if(cc.log("OPCODE_UPDATE_TABLE",e.data),h.default.getInstance().loadJackpot(e.data.jpTreasure),e.data.gameState>=r.Game.GAME_STATE.RUN){if(h.default.getInstance().loadPresences(e.data),n.default.getInstance().isReconnected)return h.default.getInstance().gameState=r.Game.GAME_STATE.RUN,h.default.getInstance().loadPlayingGame(e.data),void h.default.getInstance().loadSpectatingGame(e.data);h.default.getInstance().gameState=r.Game.GAME_STATE.SPECTATING,h.default.getInstance().loadSpectatingGame(e.data)}else h.default.getInstance().gameState=null,h.default.getInstance().loadPresences(e.data),h.default.getInstance().leaveMatch();break;case i.default.Network.OP_CODE.OPCODE_UPDATE_DEAL:if(cc.log("OPCODE_UPDATE_DEAL",e.data),e.data.presenceCard){if(n.default.getInstance().isReconnected){h.default.getInstance().loadReconnectPresenceCard(n.default.getInstance().matchInfo.self.user_id,e.data.presenceCard);break}h.default.getInstance().setPresenceCard(n.default.getInstance().matchInfo.self.user_id,e.data.presenceCard)}break;case i.default.Network.OP_CODE.OPCODE_UPDATE_GAME_STATE:u.processUpdateGameState(e);break;case i.default.Network.OP_CODE.OPCODE_UPDATE_CARD_STATE:cc.log("card state",e),u.processUpdateCardState(e);break;case i.default.Network.OP_CODE.OPCODE_UPDATE_FINISH:cc.log("result",e),h.default.getInstance().endGame(e.data);break;case i.default.Network.OP_CODE.OPCODE_UPDATE_WALLET:cc.log("wallet",e),h.default.getInstance().updateGameBalances(e.data);break;case i.default.Network.OP_CODE.OPCODE_KICK_OFF_THE_TABLE:l.BannerData.setBannerData(r.Banner.ShowType.KICK_OUT_MATCH,!0),cc.log("kick off",e),u.onQuit();break;case i.default.Network.OP_CODE.OPCODE_UPDATE_USER_INFO:u.processUpdateCardState(e);break;default:cc.log("Data code not found ",e)}}static processUpdateCardState(e){var t,a,i,s,n,o,l,c,d,u;switch(null===(a=null===(t=e.data)||void 0===t?void 0:t.arrangeCard)||void 0===a?void 0:a.cardEvent){case r.Game.CARD_EVENT.COMBINE:h.default.getInstance().updateGameState(null===(s=null===(i=e.data)||void 0===i?void 0:i.arrangeCard)||void 0===s?void 0:s.Presence.split(","),"arranging");break;case r.Game.CARD_EVENT.SHOW:h.default.getInstance().updateGameState(null===(o=null===(n=e.data)||void 0===n?void 0:n.arrangeCard)||void 0===o?void 0:o.Presence.split(","),"ready");break;case r.Game.CARD_EVENT.DECLARE:h.default.getInstance().updateGameState(null===(c=null===(l=e.data)||void 0===l?void 0:l.arrangeCard)||void 0===c?void 0:c.Presence.split(","),"ready");break;default:h.default.getInstance().updateGameState(null===(u=null===(d=e.data)||void 0===d?void 0:d.arrangeCard)||void 0===u?void 0:u.Presence.split(","),"arranging"),cc.log("State update card not found ",e)}}static processUpdateGameState(e){switch(e.data.state){case r.Game.GAME_STATE.MATCHING:cc.log("GAME_STATE.MATCHING",e),h.default.getInstance().matching();break;case r.Game.GAME_STATE.PREPARE:h.default.getInstance().countdown(e.data.countDown);break;case r.Game.GAME_STATE.RUN:cc.log("GAME_STATE.RUN",e),h.default.getInstance().gameState=r.Game.GAME_STATE.RUN,h.default.getInstance().matching(),h.default.getInstance().startGame(e.data.countDown);break;case r.Game.GAME_STATE.REWARD:cc.log("GAME_STATE.REWARD",e),h.default.getInstance().processReward(e.data.presenceCards);break;case r.Game.GAME_STATE.FINISH:cc.log("GAME_STATE.FINISH",e);break;default:cc.log("Match state not found ",e)}}static sendCombineCards(){s.default.getInstance().sendMatchState(n.default.getInstance().matchInfo.match_id,i.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_COMBINE_CARDS,{}).then(()=>{cc.log("sendCombineCards success ")},e=>{cc.log("sendCombineCards err",e)})}static sendShowCards(e){s.default.getInstance().sendMatchState(n.default.getInstance().matchInfo.match_id,i.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_SHOW_CARDS,{cards:{cards:e.map(e=>14===e.rank?{rank:1,suit:e.suit}:{rank:e.rank,suit:e.suit})}}).then(()=>{cc.log("sendShowCards success ")},e=>{cc.log("sendShowCards err",e)})}static sendDeclareCards(e){s.default.getInstance().sendMatchState(n.default.getInstance().matchInfo.match_id,i.default.Network.OP_CODE_REQUEST.OPCODE_REQUEST_DECLARE_CARDS,{cards:{cards:e.map(e=>14===e.rank?{rank:1,suit:e.suit}:{rank:e.rank,suit:e.suit})}}).then(()=>{cc.log("sendDeclareCards success ")},e=>{cc.log("sendDeclareCards err",e)})}static sendActionSignal(){s.default.getInstance().sendMatchState(n.default.getInstance().matchInfo.match_id,i.default.Network.OP_CODE_REQUEST.OPCODE_MOVE_CARDS,{}).then(()=>{cc.log("sendActionSignal success ")},e=>{cc.log("sendActionSignal err",e)})}static getUsers(e,t,a){return s.default.getInstance().getUsers(e,t,a)}static onQuit(e=(()=>{}),t=!0){s.default.getInstance().leaveMatch(n.default.getInstance().matchInfo.match_id).then(a=>{cc.log("leave match: ",a),h.default.getInstance().gameState=null,c.default.getInstance().leaveChat(),cc.sys.isBrowser&&i.default.AppInfo.WEB_NATIVE?(e(),window.location.href="/"):t?n.default.getInstance().loadSceneByMainBundle(o.default.vipLevel>0?i.default.AppInfo.SCENE_NAME.TABLELIST:i.default.AppInfo.SCENE_NAME.GAMELIST,()=>{var t;e(),null===(t=d.default.getInstance())||void 0===t||t.setGameType(r.GameType.Enum.TABLE_GAME),h.default.getInstance().node.destroy()}):e()},e=>{cc.log("err when leave match",e)})}}a.default=u,cc._RF.pop()},{"../../lobby/src/chat/ChatPresenter":void 0,"../../lobby/src/common/ConfigClient":void 0,"../../lobby/src/common/Constants":void 0,"../../lobby/src/common/GlobalApp":void 0,"../../lobby/src/common/User":void 0,"../../lobby/src/dialogs/banner/BannerDialog":void 0,"../../lobby/src/lobby/GameList":void 0,"../../lobby/src/network/NetworkClient":void 0,"./PusoyController":"PusoyController"}],PusoyRuleDialog:[function(e,t,a){"use strict";cc._RF.push(t,"69c45RKa4hLUZbrZHhCqzPQ","PusoyRuleDialog");var i,r=this&&this.__decorate||function(e,t,a,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,a,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(n=(s<3?r(n):s>3?r(t,a,n):r(t,a))||n);return s>3&&n&&Object.defineProperty(t,a,n),n};Object.defineProperty(a,"__esModule",{value:!0});const s=e("../../../bundles/lobby/src/common/BaseDialog"),n=e("../../../bundles/lobby/src/common/GlobalApp"),o=e("../../../bundles/lobby/src/common/ConfigClient"),{ccclass:l,property:c}=cc._decorator;let h=i=class extends s.default{static getInstance(){return this.instance}static show(e){null==this.instance||null==this.instance.node?n.default.getInstance().loadPrefabByBundle(o.default.Bundle.BUNDLE_NAME.PUSOY,"res/prefabs/PusoyRuleDialog",(t,a)=>{if(null!=t)return void n.default.getInstance().alertDialog.showMessage(t);let r=cc.instantiate(a);r.parent=e,this.instance=r.getComponent(i),this.instance.node.zIndex=1e3,this.instance.show()}):(this.instance.node.zIndex=1e3,this.instance.show())}};h.instance=null,h=i=r([l],h),a.default=h,cc._RF.pop()},{"../../../bundles/lobby/src/common/BaseDialog":void 0,"../../../bundles/lobby/src/common/ConfigClient":void 0,"../../../bundles/lobby/src/common/GlobalApp":void 0}],PusoyUtils:[function(e,t,a){"use strict";cc._RF.push(t,"36da6keiONHULFHNRgWeJ+l","PusoyUtils"),Object.defineProperty(a,"__esModule",{value:!0}),a.default=class{static getStraightFlush(e){let t=[],a=e,i=a.filter(e=>1===e.suit).sort((e,t)=>t.rank-e.rank),r=a.filter(e=>2===e.suit).sort((e,t)=>t.rank-e.rank),s=a.filter(e=>3===e.suit).sort((e,t)=>t.rank-e.rank),n=a.filter(e=>4===e.suit).sort((e,t)=>t.rank-e.rank),o=[];return o.push(i),o.push(r),o.push(s),o.push(n),o.forEach(e=>this.getStraight(e).length>0?this.getStraight(e).forEach(e=>{5===e.length&&(14===e[e.length-1].rank&&(e=e.splice(e.length-1,1).concat(e)),t.push(e))}):{}),t}static get4ofAKind(e){let t=e,a=[];for(let i=1;i<=14;i++){let e=t.filter(e=>e.rank===i);4===e.length&&a.push(e)}return a}static getFullHouse(e){let t=e,a=[],i=this.get3ofAKind(t),r=this.getPairs(t);if(0===i.length)return a;if(0===r.length)switch(i.length){case 1:return a;case 2:a.push(i[0].concat(i[1].slice(0,2)));break;case 3:a.push(i[0].concat(i[2].slice(0,2)));break;case 4:a.push(i[0].concat(i[3].slice(0,2))),a.push(i[1].concat(i[2].slice(0,2)))}else for(let s=0;s<i.length;s++)r[s]&&a.push(i[s].concat(r[s]));return a}static get3ofAKind(e){let t=e,a=[],i=t.filter(e=>14===e.rank);i.length>=3&&a.push(i.slice(0,3));for(let r=13;r>=2;r--){let e=t.filter(e=>e.rank===r);e.length>=3&&a.push(e.slice(0,3))}return a}static getPairs(e){let t=e,a=[];for(let r=2;r<=13;r++){let e=t.filter(e=>e.rank===r);2===e.length&&a.push(e)}let i=t.filter(e=>14===e.rank);return 2===i.length&&a.push(i),a}static getFlush(e){let t=e,a=t.filter(e=>1===e.suit).sort((e,t)=>t.rank-e.rank),i=t.filter(e=>2===e.suit).sort((e,t)=>t.rank-e.rank),r=t.filter(e=>3===e.suit).sort((e,t)=>t.rank-e.rank),s=t.filter(e=>4===e.suit).sort((e,t)=>t.rank-e.rank);a[a.length-1]&&14===a[a.length-1].rank&&(a=a.splice(a.length-1,1).concat(a)),i[i.length-1]&&14===i[i.length-1].rank&&(i=i.splice(i.length-1,1).concat(i)),r[r.length-1]&&14===r[r.length-1].rank&&(r=r.splice(r.length-1,1).concat(r)),s[s.length-1]&&14===s[s.length-1].rank&&(s=s.splice(s.length-1,1).concat(s));let n=[];if(3===e.length)a[2]&&n.push(a),i[2]&&n.push(i),r[2]&&n.push(r),s[2]&&n.push(s);else for(let o=0;o<10;o+=5)a[o+4]&&n.push(a.slice(o,o+5)),i[o+4]&&n.push(i.slice(o,o+5)),r[o+4]&&n.push(r.slice(o,o+5)),s[o+4]&&n.push(s.slice(o,o+5));return n}static checkStraight(e,t){let a=[];for(let i=0;i<t.length;i++){let r=e.find(e=>e.rank===t[i]);if(!r)return!1;a.push(r)}return a}static getStraight(e){let t=[].concat(e),a=[];if(t.sort((e,t)=>t.rank-e.rank),3===t.length){for(;this.checkStraight(t,[14,13,12]);){const e=this.checkStraight(t,[14,13,12]);e&&(a.push(e),e.forEach(e=>{let a=t.findIndex(t=>e.rank===t.rank&&e.suit===t.suit);t.splice(a,1)}))}for(;this.checkStraight(t,[14,2,3]);){const e=this.checkStraight(t,[14,2,3]);e&&(a.push(e),e.forEach(e=>{let a=t.findIndex(t=>e.rank===t.rank&&e.suit===t.suit);t.splice(a,1)}))}for(let e=13;e>=3;e--)for(;this.checkStraight(t,[e,e-1,e-2]);){const i=this.checkStraight(t,[e,e-1,e-2]);i&&(a.push(i),i.forEach(e=>{let a=t.findIndex(t=>e.rank===t.rank&&e.suit===t.suit);t.splice(a,1)}))}}else{for(;this.checkStraight(t,[14,13,12,11,10]);){const e=this.checkStraight(t,[14,13,12,11,10]);e&&(a.push(e),e.forEach(e=>{let a=t.findIndex(t=>e.rank===t.rank&&e.suit===t.suit);t.splice(a,1)}))}for(;this.checkStraight(t,[14,2,3,4,5]);){const e=this.checkStraight(t,[14,2,3,4,5]);e&&(a.push(e),e.forEach(e=>{let a=t.findIndex(t=>e.rank===t.rank&&e.suit===t.suit);t.splice(a,1)}))}for(let e=13;e>=5;e--)for(;this.checkStraight(t,[e,e-1,e-2,e-3,e-4]);){const i=this.checkStraight(t,[e,e-1,e-2,e-3,e-4]);i&&(a.push(i),i.forEach(e=>{let a=t.findIndex(t=>e.rank===t.rank&&e.suit===t.suit);t.splice(a,1)}))}}return a}static checkGrandDragon(e){return this.checkDragon(e)&&this.checkSameSuit(e)}static checkDragon(e){for(let t=1;t<=13;t++)if(-1===e.findIndex(e=>e.rank===t))return!1;return!0}static checkSameSuit(e){for(let t=1;t<e.length;t++)if(e[t].suit!==e[t-1].suit)return!1;return!0}static checkSameColor(e){for(let t=1;t<e.length;t++)if(1===e[t].suit||2===e[t].suit){if(3===e[t-1].suit||4===e[t-1].suit)return!1}else if(!(3!==e[t].suit&&4!==e[t].suit||1!==e[t-1].suit&&2!==e[t-1].suit))return!1;return!0}static checkSixPairs(e){return 6===this.getPairs(e).length}static compareHandPoint(e,t){return e.point>t.point?1:e.point<t.point?-1:e.lpoint>t.lpoint?1:e.lpoint<t.lpoint?-1:0}},cc._RF.pop()},{}]},{},["PusoyCard","PusoyChip","PusoyConstants","PusoyController","PusoyHandCards","PusoyJackpot","PusoyLogic","PusoyNetworkTransport","PusoyRuleDialog","PusoyUtils"]);